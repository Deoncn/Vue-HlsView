(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const v of a.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&n(v)}).observe(document,{childList:!0,subtree:!0});function r(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerpolicy&&(a.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?a.credentials="include":i.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(i){if(i.ep)return;i.ep=!0;const a=r(i);fetch(i.href,a)}})();function Si(e,t){const r=Object.create(null),n=e.split(",");for(let i=0;i<n.length;i++)r[n[i]]=!0;return t?i=>!!r[i.toLowerCase()]:i=>!!r[i]}function it(e){if(ue(e)){const t={};for(let r=0;r<e.length;r++){const n=e[r],i=ke(n)?Bs(n):it(n);if(i)for(const a in i)t[a]=i[a]}return t}else{if(ke(e))return e;if(Se(e))return e}}const Fs=/;(?![^(]*\))/g,Ms=/:([^]+)/,Ns=/\/\*.*?\*\//gs;function Bs(e){const t={};return e.replace(Ns,"").split(Fs).forEach(r=>{if(r){const n=r.split(Ms);n.length>1&&(t[n[0].trim()]=n[1].trim())}}),t}function nt(e){let t="";if(ke(e))t=e;else if(ue(e))for(let r=0;r<e.length;r++){const n=nt(e[r]);n&&(t+=n+" ")}else if(Se(e))for(const r in e)e[r]&&(t+=r+" ");return t.trim()}const Us="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Gs=Si(Us);function In(e){return!!e||e===""}const Le=e=>ke(e)?e:e==null?"":ue(e)||Se(e)&&(e.toString===Pn||!ce(e.toString))?JSON.stringify(e,wn,2):String(e),wn=(e,t)=>t&&t.__v_isRef?wn(e,t.value):Kt(t)?{[`Map(${t.size})`]:[...t.entries()].reduce((r,[n,i])=>(r[`${n} =>`]=i,r),{})}:xn(t)?{[`Set(${t.size})`]:[...t.values()]}:Se(t)&&!ue(t)&&!Fn(t)?String(t):t,be={},jt=[],$e=()=>{},js=()=>!1,Ks=/^on[^a-z]/,Fr=e=>Ks.test(e),Li=e=>e.startsWith("onUpdate:"),we=Object.assign,_i=(e,t)=>{const r=e.indexOf(t);r>-1&&e.splice(r,1)},Hs=Object.prototype.hasOwnProperty,ve=(e,t)=>Hs.call(e,t),ue=Array.isArray,Kt=e=>Mr(e)==="[object Map]",xn=e=>Mr(e)==="[object Set]",ce=e=>typeof e=="function",ke=e=>typeof e=="string",Ai=e=>typeof e=="symbol",Se=e=>e!==null&&typeof e=="object",On=e=>Se(e)&&ce(e.then)&&ce(e.catch),Pn=Object.prototype.toString,Mr=e=>Pn.call(e),Vs=e=>Mr(e).slice(8,-1),Fn=e=>Mr(e)==="[object Object]",Di=e=>ke(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,_r=Si(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Nr=e=>{const t=Object.create(null);return r=>t[r]||(t[r]=e(r))},Ws=/-(\w)/g,st=Nr(e=>e.replace(Ws,(t,r)=>r?r.toUpperCase():"")),qs=/\B([A-Z])/g,Mt=Nr(e=>e.replace(qs,"-$1").toLowerCase()),Br=Nr(e=>e.charAt(0).toUpperCase()+e.slice(1)),Xr=Nr(e=>e?`on${Br(e)}`:""),ar=(e,t)=>!Object.is(e,t),Ar=(e,t)=>{for(let r=0;r<e.length;r++)e[r](t)},Ir=(e,t,r)=>{Object.defineProperty(e,t,{configurable:!0,enumerable:!1,value:r})},or=e=>{const t=parseFloat(e);return isNaN(t)?e:t};let Hi;const Ys=()=>Hi||(Hi=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});let et;class zs{constructor(t=!1){this.detached=t,this.active=!0,this.effects=[],this.cleanups=[],this.parent=et,!t&&et&&(this.index=(et.scopes||(et.scopes=[])).push(this)-1)}run(t){if(this.active){const r=et;try{return et=this,t()}finally{et=r}}}on(){et=this}off(){et=this.parent}stop(t){if(this.active){let r,n;for(r=0,n=this.effects.length;r<n;r++)this.effects[r].stop();for(r=0,n=this.cleanups.length;r<n;r++)this.cleanups[r]();if(this.scopes)for(r=0,n=this.scopes.length;r<n;r++)this.scopes[r].stop(!0);if(!this.detached&&this.parent&&!t){const i=this.parent.scopes.pop();i&&i!==this&&(this.parent.scopes[this.index]=i,i.index=this.index)}this.parent=void 0,this.active=!1}}}function Xs(e,t=et){t&&t.active&&t.effects.push(e)}const ki=e=>{const t=new Set(e);return t.w=0,t.n=0,t},Mn=e=>(e.w&Et)>0,Nn=e=>(e.n&Et)>0,$s=({deps:e})=>{if(e.length)for(let t=0;t<e.length;t++)e[t].w|=Et},Qs=e=>{const{deps:t}=e;if(t.length){let r=0;for(let n=0;n<t.length;n++){const i=t[n];Mn(i)&&!Nn(i)?i.delete(e):t[r++]=i,i.w&=~Et,i.n&=~Et}t.length=r}},ni=new WeakMap;let tr=0,Et=1;const si=30;let ze;const Ot=Symbol(""),ai=Symbol("");class Ri{constructor(t,r=null,n){this.fn=t,this.scheduler=r,this.active=!0,this.deps=[],this.parent=void 0,Xs(this,n)}run(){if(!this.active)return this.fn();let t=ze,r=vt;for(;t;){if(t===this)return;t=t.parent}try{return this.parent=ze,ze=this,vt=!0,Et=1<<++tr,tr<=si?$s(this):Vi(this),this.fn()}finally{tr<=si&&Qs(this),Et=1<<--tr,ze=this.parent,vt=r,this.parent=void 0,this.deferStop&&this.stop()}}stop(){ze===this?this.deferStop=!0:this.active&&(Vi(this),this.onStop&&this.onStop(),this.active=!1)}}function Vi(e){const{deps:t}=e;if(t.length){for(let r=0;r<t.length;r++)t[r].delete(e);t.length=0}}let vt=!0;const Bn=[];function zt(){Bn.push(vt),vt=!1}function Xt(){const e=Bn.pop();vt=e===void 0?!0:e}function Ke(e,t,r){if(vt&&ze){let n=ni.get(e);n||ni.set(e,n=new Map);let i=n.get(r);i||n.set(r,i=ki()),Un(i)}}function Un(e,t){let r=!1;tr<=si?Nn(e)||(e.n|=Et,r=!Mn(e)):r=!e.has(ze),r&&(e.add(ze),ze.deps.push(e))}function lt(e,t,r,n,i,a){const v=ni.get(e);if(!v)return;let _=[];if(t==="clear")_=[...v.values()];else if(r==="length"&&ue(e)){const S=or(n);v.forEach((o,A)=>{(A==="length"||A>=S)&&_.push(o)})}else switch(r!==void 0&&_.push(v.get(r)),t){case"add":ue(e)?Di(r)&&_.push(v.get("length")):(_.push(v.get(Ot)),Kt(e)&&_.push(v.get(ai)));break;case"delete":ue(e)||(_.push(v.get(Ot)),Kt(e)&&_.push(v.get(ai)));break;case"set":Kt(e)&&_.push(v.get(Ot));break}if(_.length===1)_[0]&&oi(_[0]);else{const S=[];for(const o of _)o&&S.push(...o);oi(ki(S))}}function oi(e,t){const r=ue(e)?e:[...e];for(const n of r)n.computed&&Wi(n);for(const n of r)n.computed||Wi(n)}function Wi(e,t){(e!==ze||e.allowRecurse)&&(e.scheduler?e.scheduler():e.run())}const Js=Si("__proto__,__v_isRef,__isVue"),Gn=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>e!=="arguments"&&e!=="caller").map(e=>Symbol[e]).filter(Ai)),Zs=Ci(),ea=Ci(!1,!0),ta=Ci(!0),qi=ra();function ra(){const e={};return["includes","indexOf","lastIndexOf"].forEach(t=>{e[t]=function(...r){const n=ye(this);for(let a=0,v=this.length;a<v;a++)Ke(n,"get",a+"");const i=n[t](...r);return i===-1||i===!1?n[t](...r.map(ye)):i}}),["push","pop","shift","unshift","splice"].forEach(t=>{e[t]=function(...r){zt();const n=ye(this)[t].apply(this,r);return Xt(),n}}),e}function Ci(e=!1,t=!1){return function(n,i,a){if(i==="__v_isReactive")return!e;if(i==="__v_isReadonly")return e;if(i==="__v_isShallow")return t;if(i==="__v_raw"&&a===(e?t?ya:Wn:t?Vn:Hn).get(n))return n;const v=ue(n);if(!e&&v&&ve(qi,i))return Reflect.get(qi,i,a);const _=Reflect.get(n,i,a);return(Ai(i)?Gn.has(i):Js(i))||(e||Ke(n,"get",i),t)?_:Fe(_)?v&&Di(i)?_:_.value:Se(_)?e?qn(_):Ft(_):_}}const ia=jn(),na=jn(!0);function jn(e=!1){return function(r,n,i,a){let v=r[n];if(qt(v)&&Fe(v)&&!Fe(i))return!1;if(!e&&(!wr(i)&&!qt(i)&&(v=ye(v),i=ye(i)),!ue(r)&&Fe(v)&&!Fe(i)))return v.value=i,!0;const _=ue(r)&&Di(n)?Number(n)<r.length:ve(r,n),S=Reflect.set(r,n,i,a);return r===ye(a)&&(_?ar(i,v)&&lt(r,"set",n,i):lt(r,"add",n,i)),S}}function sa(e,t){const r=ve(e,t);e[t];const n=Reflect.deleteProperty(e,t);return n&&r&&lt(e,"delete",t,void 0),n}function aa(e,t){const r=Reflect.has(e,t);return(!Ai(t)||!Gn.has(t))&&Ke(e,"has",t),r}function oa(e){return Ke(e,"iterate",ue(e)?"length":Ot),Reflect.ownKeys(e)}const Kn={get:Zs,set:ia,deleteProperty:sa,has:aa,ownKeys:oa},la={get:ta,set(e,t){return!0},deleteProperty(e,t){return!0}},ua=we({},Kn,{get:ea,set:na}),Ii=e=>e,Ur=e=>Reflect.getPrototypeOf(e);function yr(e,t,r=!1,n=!1){e=e.__v_raw;const i=ye(e),a=ye(t);r||(t!==a&&Ke(i,"get",t),Ke(i,"get",a));const{has:v}=Ur(i),_=n?Ii:r?Oi:lr;if(v.call(i,t))return _(e.get(t));if(v.call(i,a))return _(e.get(a));e!==i&&e.get(t)}function Er(e,t=!1){const r=this.__v_raw,n=ye(r),i=ye(e);return t||(e!==i&&Ke(n,"has",e),Ke(n,"has",i)),e===i?r.has(e):r.has(e)||r.has(i)}function Tr(e,t=!1){return e=e.__v_raw,!t&&Ke(ye(e),"iterate",Ot),Reflect.get(e,"size",e)}function Yi(e){e=ye(e);const t=ye(this);return Ur(t).has.call(t,e)||(t.add(e),lt(t,"add",e,e)),this}function zi(e,t){t=ye(t);const r=ye(this),{has:n,get:i}=Ur(r);let a=n.call(r,e);a||(e=ye(e),a=n.call(r,e));const v=i.call(r,e);return r.set(e,t),a?ar(t,v)&&lt(r,"set",e,t):lt(r,"add",e,t),this}function Xi(e){const t=ye(this),{has:r,get:n}=Ur(t);let i=r.call(t,e);i||(e=ye(e),i=r.call(t,e)),n&&n.call(t,e);const a=t.delete(e);return i&&lt(t,"delete",e,void 0),a}function $i(){const e=ye(this),t=e.size!==0,r=e.clear();return t&&lt(e,"clear",void 0,void 0),r}function br(e,t){return function(n,i){const a=this,v=a.__v_raw,_=ye(v),S=t?Ii:e?Oi:lr;return!e&&Ke(_,"iterate",Ot),v.forEach((o,A)=>n.call(i,S(o),S(A),a))}}function Sr(e,t,r){return function(...n){const i=this.__v_raw,a=ye(i),v=Kt(a),_=e==="entries"||e===Symbol.iterator&&v,S=e==="keys"&&v,o=i[e](...n),A=r?Ii:t?Oi:lr;return!t&&Ke(a,"iterate",S?ai:Ot),{next(){const{value:T,done:y}=o.next();return y?{value:T,done:y}:{value:_?[A(T[0]),A(T[1])]:A(T),done:y}},[Symbol.iterator](){return this}}}}function dt(e){return function(...t){return e==="delete"?!1:this}}function ca(){const e={get(a){return yr(this,a)},get size(){return Tr(this)},has:Er,add:Yi,set:zi,delete:Xi,clear:$i,forEach:br(!1,!1)},t={get(a){return yr(this,a,!1,!0)},get size(){return Tr(this)},has:Er,add:Yi,set:zi,delete:Xi,clear:$i,forEach:br(!1,!0)},r={get(a){return yr(this,a,!0)},get size(){return Tr(this,!0)},has(a){return Er.call(this,a,!0)},add:dt("add"),set:dt("set"),delete:dt("delete"),clear:dt("clear"),forEach:br(!0,!1)},n={get(a){return yr(this,a,!0,!0)},get size(){return Tr(this,!0)},has(a){return Er.call(this,a,!0)},add:dt("add"),set:dt("set"),delete:dt("delete"),clear:dt("clear"),forEach:br(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(a=>{e[a]=Sr(a,!1,!1),r[a]=Sr(a,!0,!1),t[a]=Sr(a,!1,!0),n[a]=Sr(a,!0,!0)}),[e,r,t,n]}const[da,fa,ha,ga]=ca();function wi(e,t){const r=t?e?ga:ha:e?fa:da;return(n,i,a)=>i==="__v_isReactive"?!e:i==="__v_isReadonly"?e:i==="__v_raw"?n:Reflect.get(ve(r,i)&&i in n?r:n,i,a)}const pa={get:wi(!1,!1)},va={get:wi(!1,!0)},ma={get:wi(!0,!1)},Hn=new WeakMap,Vn=new WeakMap,Wn=new WeakMap,ya=new WeakMap;function Ea(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Ta(e){return e.__v_skip||!Object.isExtensible(e)?0:Ea(Vs(e))}function Ft(e){return qt(e)?e:xi(e,!1,Kn,pa,Hn)}function ba(e){return xi(e,!1,ua,va,Vn)}function qn(e){return xi(e,!0,la,ma,Wn)}function xi(e,t,r,n,i){if(!Se(e)||e.__v_raw&&!(t&&e.__v_isReactive))return e;const a=i.get(e);if(a)return a;const v=Ta(e);if(v===0)return e;const _=new Proxy(e,v===2?n:r);return i.set(e,_),_}function Ht(e){return qt(e)?Ht(e.__v_raw):!!(e&&e.__v_isReactive)}function qt(e){return!!(e&&e.__v_isReadonly)}function wr(e){return!!(e&&e.__v_isShallow)}function Yn(e){return Ht(e)||qt(e)}function ye(e){const t=e&&e.__v_raw;return t?ye(t):e}function zn(e){return Ir(e,"__v_skip",!0),e}const lr=e=>Se(e)?Ft(e):e,Oi=e=>Se(e)?qn(e):e;function Xn(e){vt&&ze&&(e=ye(e),Un(e.dep||(e.dep=ki())))}function $n(e,t){e=ye(e),e.dep&&oi(e.dep)}function Fe(e){return!!(e&&e.__v_isRef===!0)}function pt(e){return Sa(e,!1)}function Sa(e,t){return Fe(e)?e:new La(e,t)}class La{constructor(t,r){this.__v_isShallow=r,this.dep=void 0,this.__v_isRef=!0,this._rawValue=r?t:ye(t),this._value=r?t:lr(t)}get value(){return Xn(this),this._value}set value(t){const r=this.__v_isShallow||wr(t)||qt(t);t=r?t:ye(t),ar(t,this._rawValue)&&(this._rawValue=t,this._value=r?t:lr(t),$n(this))}}function J(e){return Fe(e)?e.value:e}const _a={get:(e,t,r)=>J(Reflect.get(e,t,r)),set:(e,t,r,n)=>{const i=e[t];return Fe(i)&&!Fe(r)?(i.value=r,!0):Reflect.set(e,t,r,n)}};function Qn(e){return Ht(e)?e:new Proxy(e,_a)}var Jn;class Aa{constructor(t,r,n,i){this._setter=r,this.dep=void 0,this.__v_isRef=!0,this[Jn]=!1,this._dirty=!0,this.effect=new Ri(t,()=>{this._dirty||(this._dirty=!0,$n(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!i,this.__v_isReadonly=n}get value(){const t=ye(this);return Xn(t),(t._dirty||!t._cacheable)&&(t._dirty=!1,t._value=t.effect.run()),t._value}set value(t){this._setter(t)}}Jn="__v_isReadonly";function Da(e,t,r=!1){let n,i;const a=ce(e);return a?(n=e,i=$e):(n=e.get,i=e.set),new Aa(n,i,a||!i,r)}function mt(e,t,r,n){let i;try{i=n?e(...n):e()}catch(a){Gr(a,t,r)}return i}function We(e,t,r,n){if(ce(e)){const a=mt(e,t,r,n);return a&&On(a)&&a.catch(v=>{Gr(v,t,r)}),a}const i=[];for(let a=0;a<e.length;a++)i.push(We(e[a],t,r,n));return i}function Gr(e,t,r,n=!0){const i=t?t.vnode:null;if(t){let a=t.parent;const v=t.proxy,_=r;for(;a;){const o=a.ec;if(o){for(let A=0;A<o.length;A++)if(o[A](e,v,_)===!1)return}a=a.parent}const S=t.appContext.config.errorHandler;if(S){mt(S,null,10,[e,v,_]);return}}ka(e,r,i,n)}function ka(e,t,r,n=!0){console.error(e)}let ur=!1,li=!1;const Oe=[];let rt=0;const Vt=[];let ot=null,Rt=0;const Zn=Promise.resolve();let Pi=null;function Fi(e){const t=Pi||Zn;return e?t.then(this?e.bind(this):e):t}function Ra(e){let t=rt+1,r=Oe.length;for(;t<r;){const n=t+r>>>1;cr(Oe[n])<e?t=n+1:r=n}return t}function Mi(e){(!Oe.length||!Oe.includes(e,ur&&e.allowRecurse?rt+1:rt))&&(e.id==null?Oe.push(e):Oe.splice(Ra(e.id),0,e),es())}function es(){!ur&&!li&&(li=!0,Pi=Zn.then(rs))}function Ca(e){const t=Oe.indexOf(e);t>rt&&Oe.splice(t,1)}function Ia(e){ue(e)?Vt.push(...e):(!ot||!ot.includes(e,e.allowRecurse?Rt+1:Rt))&&Vt.push(e),es()}function Qi(e,t=ur?rt+1:0){for(;t<Oe.length;t++){const r=Oe[t];r&&r.pre&&(Oe.splice(t,1),t--,r())}}function ts(e){if(Vt.length){const t=[...new Set(Vt)];if(Vt.length=0,ot){ot.push(...t);return}for(ot=t,ot.sort((r,n)=>cr(r)-cr(n)),Rt=0;Rt<ot.length;Rt++)ot[Rt]();ot=null,Rt=0}}const cr=e=>e.id==null?1/0:e.id,wa=(e,t)=>{const r=cr(e)-cr(t);if(r===0){if(e.pre&&!t.pre)return-1;if(t.pre&&!e.pre)return 1}return r};function rs(e){li=!1,ur=!0,Oe.sort(wa);const t=$e;try{for(rt=0;rt<Oe.length;rt++){const r=Oe[rt];r&&r.active!==!1&&mt(r,null,14)}}finally{rt=0,Oe.length=0,ts(),ur=!1,Pi=null,(Oe.length||Vt.length)&&rs()}}function xa(e,t,...r){if(e.isUnmounted)return;const n=e.vnode.props||be;let i=r;const a=t.startsWith("update:"),v=a&&t.slice(7);if(v&&v in n){const A=`${v==="modelValue"?"model":v}Modifiers`,{number:T,trim:y}=n[A]||be;y&&(i=r.map(R=>ke(R)?R.trim():R)),T&&(i=r.map(or))}let _,S=n[_=Xr(t)]||n[_=Xr(st(t))];!S&&a&&(S=n[_=Xr(Mt(t))]),S&&We(S,e,6,i);const o=n[_+"Once"];if(o){if(!e.emitted)e.emitted={};else if(e.emitted[_])return;e.emitted[_]=!0,We(o,e,6,i)}}function is(e,t,r=!1){const n=t.emitsCache,i=n.get(e);if(i!==void 0)return i;const a=e.emits;let v={},_=!1;if(!ce(e)){const S=o=>{const A=is(o,t,!0);A&&(_=!0,we(v,A))};!r&&t.mixins.length&&t.mixins.forEach(S),e.extends&&S(e.extends),e.mixins&&e.mixins.forEach(S)}return!a&&!_?(Se(e)&&n.set(e,null),null):(ue(a)?a.forEach(S=>v[S]=null):we(v,a),Se(e)&&n.set(e,v),v)}function jr(e,t){return!e||!Fr(t)?!1:(t=t.slice(2).replace(/Once$/,""),ve(e,t[0].toLowerCase()+t.slice(1))||ve(e,Mt(t))||ve(e,t))}let Ge=null,Kr=null;function xr(e){const t=Ge;return Ge=e,Kr=e&&e.type.__scopeId||null,t}function Nt(e){Kr=e}function Bt(){Kr=null}function Or(e,t=Ge,r){if(!t||e._n)return e;const n=(...i)=>{n._d&&ln(-1);const a=xr(t);let v;try{v=e(...i)}finally{xr(a),n._d&&ln(1)}return v};return n._n=!0,n._c=!0,n._d=!0,n}function $r(e){const{type:t,vnode:r,proxy:n,withProxy:i,props:a,propsOptions:[v],slots:_,attrs:S,emit:o,render:A,renderCache:T,data:y,setupState:R,ctx:k,inheritAttrs:g}=e;let s,d;const l=xr(e);try{if(r.shapeFlag&4){const m=i||n;s=tt(A.call(m,m,T,a,R,y,k)),d=S}else{const m=t;s=tt(m.length>1?m(a,{attrs:S,slots:_,emit:o}):m(a,null)),d=t.props?S:Oa(S)}}catch(m){sr.length=0,Gr(m,e,1),s=de(Qe)}let h=s;if(d&&g!==!1){const m=Object.keys(d),{shapeFlag:f}=h;m.length&&f&7&&(v&&m.some(Li)&&(d=Pa(d,v)),h=Tt(h,d))}return r.dirs&&(h=Tt(h),h.dirs=h.dirs?h.dirs.concat(r.dirs):r.dirs),r.transition&&(h.transition=r.transition),s=h,xr(l),s}const Oa=e=>{let t;for(const r in e)(r==="class"||r==="style"||Fr(r))&&((t||(t={}))[r]=e[r]);return t},Pa=(e,t)=>{const r={};for(const n in e)(!Li(n)||!(n.slice(9)in t))&&(r[n]=e[n]);return r};function Fa(e,t,r){const{props:n,children:i,component:a}=e,{props:v,children:_,patchFlag:S}=t,o=a.emitsOptions;if(t.dirs||t.transition)return!0;if(r&&S>=0){if(S&1024)return!0;if(S&16)return n?Ji(n,v,o):!!v;if(S&8){const A=t.dynamicProps;for(let T=0;T<A.length;T++){const y=A[T];if(v[y]!==n[y]&&!jr(o,y))return!0}}}else return(i||_)&&(!_||!_.$stable)?!0:n===v?!1:n?v?Ji(n,v,o):!0:!!v;return!1}function Ji(e,t,r){const n=Object.keys(t);if(n.length!==Object.keys(e).length)return!0;for(let i=0;i<n.length;i++){const a=n[i];if(t[a]!==e[a]&&!jr(r,a))return!0}return!1}function Ma({vnode:e,parent:t},r){for(;t&&t.subTree===e;)(e=t.vnode).el=r,t=t.parent}const Na=e=>e.__isSuspense;function Ba(e,t){t&&t.pendingBranch?ue(e)?t.effects.push(...e):t.effects.push(e):Ia(e)}function Ua(e,t){if(Ie){let r=Ie.provides;const n=Ie.parent&&Ie.parent.provides;n===r&&(r=Ie.provides=Object.create(n)),r[e]=t}}function Dr(e,t,r=!1){const n=Ie||Ge;if(n){const i=n.parent==null?n.vnode.appContext&&n.vnode.appContext.provides:n.parent.provides;if(i&&e in i)return i[e];if(arguments.length>1)return r&&ce(t)?t.call(n.proxy):t}}function Ga(e,t){return Ni(e,null,{flush:"post"})}const Lr={};function rr(e,t,r){return Ni(e,t,r)}function Ni(e,t,{immediate:r,deep:n,flush:i,onTrack:a,onTrigger:v}=be){const _=Ie;let S,o=!1,A=!1;if(Fe(e)?(S=()=>e.value,o=wr(e)):Ht(e)?(S=()=>e,n=!0):ue(e)?(A=!0,o=e.some(h=>Ht(h)||wr(h)),S=()=>e.map(h=>{if(Fe(h))return h.value;if(Ht(h))return wt(h);if(ce(h))return mt(h,_,2)})):ce(e)?t?S=()=>mt(e,_,2):S=()=>{if(!(_&&_.isUnmounted))return T&&T(),We(e,_,3,[y])}:S=$e,t&&n){const h=S;S=()=>wt(h())}let T,y=h=>{T=d.onStop=()=>{mt(h,_,4)}},R;if(hr)if(y=$e,t?r&&We(t,_,3,[S(),A?[]:void 0,y]):S(),i==="sync"){const h=Mo();R=h.__watcherHandles||(h.__watcherHandles=[])}else return $e;let k=A?new Array(e.length).fill(Lr):Lr;const g=()=>{if(d.active)if(t){const h=d.run();(n||o||(A?h.some((m,f)=>ar(m,k[f])):ar(h,k)))&&(T&&T(),We(t,_,3,[h,k===Lr?void 0:A&&k[0]===Lr?[]:k,y]),k=h)}else d.run()};g.allowRecurse=!!t;let s;i==="sync"?s=g:i==="post"?s=()=>Be(g,_&&_.suspense):(g.pre=!0,_&&(g.id=_.uid),s=()=>Mi(g));const d=new Ri(S,s);t?r?g():k=d.run():i==="post"?Be(d.run.bind(d),_&&_.suspense):d.run();const l=()=>{d.stop(),_&&_.scope&&_i(_.scope.effects,d)};return R&&R.push(l),l}function ja(e,t,r){const n=this.proxy,i=ke(e)?e.includes(".")?ns(n,e):()=>n[e]:e.bind(n,n);let a;ce(t)?a=t:(a=t.handler,r=t);const v=Ie;Yt(this);const _=Ni(i,a.bind(n),r);return v?Yt(v):Pt(),_}function ns(e,t){const r=t.split(".");return()=>{let n=e;for(let i=0;i<r.length&&n;i++)n=n[r[i]];return n}}function wt(e,t){if(!Se(e)||e.__v_skip||(t=t||new Set,t.has(e)))return e;if(t.add(e),Fe(e))wt(e.value,t);else if(ue(e))for(let r=0;r<e.length;r++)wt(e[r],t);else if(xn(e)||Kt(e))e.forEach(r=>{wt(r,t)});else if(Fn(e))for(const r in e)wt(e[r],t);return e}function Ka(){const e={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return vr(()=>{e.isMounted=!0}),us(()=>{e.isUnmounting=!0}),e}const Ve=[Function,Array],Ha={name:"BaseTransition",props:{mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Ve,onEnter:Ve,onAfterEnter:Ve,onEnterCancelled:Ve,onBeforeLeave:Ve,onLeave:Ve,onAfterLeave:Ve,onLeaveCancelled:Ve,onBeforeAppear:Ve,onAppear:Ve,onAfterAppear:Ve,onAppearCancelled:Ve},setup(e,{slots:t}){const r=Yr(),n=Ka();let i;return()=>{const a=t.default&&os(t.default(),!0);if(!a||!a.length)return;let v=a[0];if(a.length>1){for(const g of a)if(g.type!==Qe){v=g;break}}const _=ye(e),{mode:S}=_;if(n.isLeaving)return Qr(v);const o=Zi(v);if(!o)return Qr(v);const A=ui(o,_,n,r);ci(o,A);const T=r.subTree,y=T&&Zi(T);let R=!1;const{getTransitionKey:k}=o.type;if(k){const g=k();i===void 0?i=g:g!==i&&(i=g,R=!0)}if(y&&y.type!==Qe&&(!Ct(o,y)||R)){const g=ui(y,_,n,r);if(ci(y,g),S==="out-in")return n.isLeaving=!0,g.afterLeave=()=>{n.isLeaving=!1,r.update.active!==!1&&r.update()},Qr(v);S==="in-out"&&o.type!==Qe&&(g.delayLeave=(s,d,l)=>{const h=as(n,y);h[String(y.key)]=y,s._leaveCb=()=>{d(),s._leaveCb=void 0,delete A.delayedLeave},A.delayedLeave=l})}return v}}},ss=Ha;function as(e,t){const{leavingVNodes:r}=e;let n=r.get(t.type);return n||(n=Object.create(null),r.set(t.type,n)),n}function ui(e,t,r,n){const{appear:i,mode:a,persisted:v=!1,onBeforeEnter:_,onEnter:S,onAfterEnter:o,onEnterCancelled:A,onBeforeLeave:T,onLeave:y,onAfterLeave:R,onLeaveCancelled:k,onBeforeAppear:g,onAppear:s,onAfterAppear:d,onAppearCancelled:l}=t,h=String(e.key),m=as(r,e),f=(b,L)=>{b&&We(b,n,9,L)},E=(b,L)=>{const u=L[1];f(b,L),ue(b)?b.every(c=>c.length<=1)&&u():b.length<=1&&u()},D={mode:a,persisted:v,beforeEnter(b){let L=_;if(!r.isMounted)if(i)L=g||_;else return;b._leaveCb&&b._leaveCb(!0);const u=m[h];u&&Ct(e,u)&&u.el._leaveCb&&u.el._leaveCb(),f(L,[b])},enter(b){let L=S,u=o,c=A;if(!r.isMounted)if(i)L=s||S,u=d||o,c=l||A;else return;let p=!1;const C=b._enterCb=I=>{p||(p=!0,I?f(c,[b]):f(u,[b]),D.delayedLeave&&D.delayedLeave(),b._enterCb=void 0)};L?E(L,[b,C]):C()},leave(b,L){const u=String(e.key);if(b._enterCb&&b._enterCb(!0),r.isUnmounting)return L();f(T,[b]);let c=!1;const p=b._leaveCb=C=>{c||(c=!0,L(),C?f(k,[b]):f(R,[b]),b._leaveCb=void 0,m[u]===e&&delete m[u])};m[u]=e,y?E(y,[b,p]):p()},clone(b){return ui(b,t,r,n)}};return D}function Qr(e){if(Hr(e))return e=Tt(e),e.children=null,e}function Zi(e){return Hr(e)?e.children?e.children[0]:void 0:e}function ci(e,t){e.shapeFlag&6&&e.component?ci(e.component.subTree,t):e.shapeFlag&128?(e.ssContent.transition=t.clone(e.ssContent),e.ssFallback.transition=t.clone(e.ssFallback)):e.transition=t}function os(e,t=!1,r){let n=[],i=0;for(let a=0;a<e.length;a++){let v=e[a];const _=r==null?v.key:String(r)+String(v.key!=null?v.key:a);v.type===xe?(v.patchFlag&128&&i++,n=n.concat(os(v.children,t,_))):(t||v.type!==Qe)&&n.push(_!=null?Tt(v,{key:_}):v)}if(i>1)for(let a=0;a<n.length;a++)n[a].patchFlag=-2;return n}function $t(e){return ce(e)?{setup:e,name:e.name}:e}const kr=e=>!!e.type.__asyncLoader,Hr=e=>e.type.__isKeepAlive;function Va(e,t){ls(e,"a",t)}function Wa(e,t){ls(e,"da",t)}function ls(e,t,r=Ie){const n=e.__wdc||(e.__wdc=()=>{let i=r;for(;i;){if(i.isDeactivated)return;i=i.parent}return e()});if(Vr(t,n,r),r){let i=r.parent;for(;i&&i.parent;)Hr(i.parent.vnode)&&qa(n,t,r,i),i=i.parent}}function qa(e,t,r,n){const i=Vr(t,e,n,!0);mr(()=>{_i(n[t],i)},r)}function Vr(e,t,r=Ie,n=!1){if(r){const i=r[e]||(r[e]=[]),a=t.__weh||(t.__weh=(...v)=>{if(r.isUnmounted)return;zt(),Yt(r);const _=We(t,r,e,v);return Pt(),Xt(),_});return n?i.unshift(a):i.push(a),a}}const ut=e=>(t,r=Ie)=>(!hr||e==="sp")&&Vr(e,(...n)=>t(...n),r),Ya=ut("bm"),vr=ut("m"),za=ut("bu"),Xa=ut("u"),us=ut("bum"),mr=ut("um"),$a=ut("sp"),Qa=ut("rtg"),Ja=ut("rtc");function Za(e,t=Ie){Vr("ec",e,t)}function De(e,t){const r=Ge;if(r===null)return e;const n=zr(r)||r.proxy,i=e.dirs||(e.dirs=[]);for(let a=0;a<t.length;a++){let[v,_,S,o=be]=t[a];v&&(ce(v)&&(v={mounted:v,updated:v}),v.deep&&wt(_),i.push({dir:v,instance:n,value:_,oldValue:void 0,arg:S,modifiers:o}))}return e}function Lt(e,t,r,n){const i=e.dirs,a=t&&t.dirs;for(let v=0;v<i.length;v++){const _=i[v];a&&(_.oldValue=a[v].value);let S=_.dir[n];S&&(zt(),We(S,r,8,[e.el,_,e,t]),Xt())}}const cs="components";function ds(e,t){return to(cs,e,!0,t)||e}const eo=Symbol();function to(e,t,r=!0,n=!1){const i=Ge||Ie;if(i){const a=i.type;if(e===cs){const _=Io(a,!1);if(_&&(_===t||_===st(t)||_===Br(st(t))))return a}const v=en(i[e]||a[e],t)||en(i.appContext[e],t);return!v&&n?a:v}}function en(e,t){return e&&(e[t]||e[st(t)]||e[Br(st(t))])}function dr(e,t,r,n){let i;const a=r&&r[n];if(ue(e)||ke(e)){i=new Array(e.length);for(let v=0,_=e.length;v<_;v++)i[v]=t(e[v],v,void 0,a&&a[v])}else if(typeof e=="number"){i=new Array(e);for(let v=0;v<e;v++)i[v]=t(v+1,v,void 0,a&&a[v])}else if(Se(e))if(e[Symbol.iterator])i=Array.from(e,(v,_)=>t(v,_,void 0,a&&a[_]));else{const v=Object.keys(e);i=new Array(v.length);for(let _=0,S=v.length;_<S;_++){const o=v[_];i[_]=t(e[o],o,_,a&&a[_])}}else i=[];return r&&(r[n]=i),i}const di=e=>e?Ls(e)?zr(e)||e.proxy:di(e.parent):null,ir=we(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>di(e.parent),$root:e=>di(e.root),$emit:e=>e.emit,$options:e=>Bi(e),$forceUpdate:e=>e.f||(e.f=()=>Mi(e.update)),$nextTick:e=>e.n||(e.n=Fi.bind(e.proxy)),$watch:e=>ja.bind(e)}),Jr=(e,t)=>e!==be&&!e.__isScriptSetup&&ve(e,t),ro={get({_:e},t){const{ctx:r,setupState:n,data:i,props:a,accessCache:v,type:_,appContext:S}=e;let o;if(t[0]!=="$"){const R=v[t];if(R!==void 0)switch(R){case 1:return n[t];case 2:return i[t];case 4:return r[t];case 3:return a[t]}else{if(Jr(n,t))return v[t]=1,n[t];if(i!==be&&ve(i,t))return v[t]=2,i[t];if((o=e.propsOptions[0])&&ve(o,t))return v[t]=3,a[t];if(r!==be&&ve(r,t))return v[t]=4,r[t];fi&&(v[t]=0)}}const A=ir[t];let T,y;if(A)return t==="$attrs"&&Ke(e,"get",t),A(e);if((T=_.__cssModules)&&(T=T[t]))return T;if(r!==be&&ve(r,t))return v[t]=4,r[t];if(y=S.config.globalProperties,ve(y,t))return y[t]},set({_:e},t,r){const{data:n,setupState:i,ctx:a}=e;return Jr(i,t)?(i[t]=r,!0):n!==be&&ve(n,t)?(n[t]=r,!0):ve(e.props,t)||t[0]==="$"&&t.slice(1)in e?!1:(a[t]=r,!0)},has({_:{data:e,setupState:t,accessCache:r,ctx:n,appContext:i,propsOptions:a}},v){let _;return!!r[v]||e!==be&&ve(e,v)||Jr(t,v)||(_=a[0])&&ve(_,v)||ve(n,v)||ve(ir,v)||ve(i.config.globalProperties,v)},defineProperty(e,t,r){return r.get!=null?e._.accessCache[t]=0:ve(r,"value")&&this.set(e,t,r.value,null),Reflect.defineProperty(e,t,r)}};let fi=!0;function io(e){const t=Bi(e),r=e.proxy,n=e.ctx;fi=!1,t.beforeCreate&&tn(t.beforeCreate,e,"bc");const{data:i,computed:a,methods:v,watch:_,provide:S,inject:o,created:A,beforeMount:T,mounted:y,beforeUpdate:R,updated:k,activated:g,deactivated:s,beforeDestroy:d,beforeUnmount:l,destroyed:h,unmounted:m,render:f,renderTracked:E,renderTriggered:D,errorCaptured:b,serverPrefetch:L,expose:u,inheritAttrs:c,components:p,directives:C,filters:I}=t;if(o&&no(o,n,null,e.appContext.config.unwrapInjectedRef),v)for(const x in v){const P=v[x];ce(P)&&(n[x]=P.bind(r))}if(i){const x=i.call(r,r);Se(x)&&(e.data=Ft(x))}if(fi=!0,a)for(const x in a){const P=a[x],F=ce(P)?P.bind(r,r):ce(P.get)?P.get.bind(r,r):$e,M=!ce(P)&&ce(P.set)?P.set.bind(r):$e,U=yt({get:F,set:M});Object.defineProperty(n,x,{enumerable:!0,configurable:!0,get:()=>U.value,set:G=>U.value=G})}if(_)for(const x in _)fs(_[x],n,r,x);if(S){const x=ce(S)?S.call(r):S;Reflect.ownKeys(x).forEach(P=>{Ua(P,x[P])})}A&&tn(A,e,"c");function O(x,P){ue(P)?P.forEach(F=>x(F.bind(r))):P&&x(P.bind(r))}if(O(Ya,T),O(vr,y),O(za,R),O(Xa,k),O(Va,g),O(Wa,s),O(Za,b),O(Ja,E),O(Qa,D),O(us,l),O(mr,m),O($a,L),ue(u))if(u.length){const x=e.exposed||(e.exposed={});u.forEach(P=>{Object.defineProperty(x,P,{get:()=>r[P],set:F=>r[P]=F})})}else e.exposed||(e.exposed={});f&&e.render===$e&&(e.render=f),c!=null&&(e.inheritAttrs=c),p&&(e.components=p),C&&(e.directives=C)}function no(e,t,r=$e,n=!1){ue(e)&&(e=hi(e));for(const i in e){const a=e[i];let v;Se(a)?"default"in a?v=Dr(a.from||i,a.default,!0):v=Dr(a.from||i):v=Dr(a),Fe(v)&&n?Object.defineProperty(t,i,{enumerable:!0,configurable:!0,get:()=>v.value,set:_=>v.value=_}):t[i]=v}}function tn(e,t,r){We(ue(e)?e.map(n=>n.bind(t.proxy)):e.bind(t.proxy),t,r)}function fs(e,t,r,n){const i=n.includes(".")?ns(r,n):()=>r[n];if(ke(e)){const a=t[e];ce(a)&&rr(i,a)}else if(ce(e))rr(i,e.bind(r));else if(Se(e))if(ue(e))e.forEach(a=>fs(a,t,r,n));else{const a=ce(e.handler)?e.handler.bind(r):t[e.handler];ce(a)&&rr(i,a,e)}}function Bi(e){const t=e.type,{mixins:r,extends:n}=t,{mixins:i,optionsCache:a,config:{optionMergeStrategies:v}}=e.appContext,_=a.get(t);let S;return _?S=_:!i.length&&!r&&!n?S=t:(S={},i.length&&i.forEach(o=>Pr(S,o,v,!0)),Pr(S,t,v)),Se(t)&&a.set(t,S),S}function Pr(e,t,r,n=!1){const{mixins:i,extends:a}=t;a&&Pr(e,a,r,!0),i&&i.forEach(v=>Pr(e,v,r,!0));for(const v in t)if(!(n&&v==="expose")){const _=so[v]||r&&r[v];e[v]=_?_(e[v],t[v]):t[v]}return e}const so={data:rn,props:kt,emits:kt,methods:kt,computed:kt,beforeCreate:Ne,created:Ne,beforeMount:Ne,mounted:Ne,beforeUpdate:Ne,updated:Ne,beforeDestroy:Ne,beforeUnmount:Ne,destroyed:Ne,unmounted:Ne,activated:Ne,deactivated:Ne,errorCaptured:Ne,serverPrefetch:Ne,components:kt,directives:kt,watch:oo,provide:rn,inject:ao};function rn(e,t){return t?e?function(){return we(ce(e)?e.call(this,this):e,ce(t)?t.call(this,this):t)}:t:e}function ao(e,t){return kt(hi(e),hi(t))}function hi(e){if(ue(e)){const t={};for(let r=0;r<e.length;r++)t[e[r]]=e[r];return t}return e}function Ne(e,t){return e?[...new Set([].concat(e,t))]:t}function kt(e,t){return e?we(we(Object.create(null),e),t):t}function oo(e,t){if(!e)return t;if(!t)return e;const r=we(Object.create(null),e);for(const n in t)r[n]=Ne(e[n],t[n]);return r}function lo(e,t,r,n=!1){const i={},a={};Ir(a,qr,1),e.propsDefaults=Object.create(null),hs(e,t,i,a);for(const v in e.propsOptions[0])v in i||(i[v]=void 0);r?e.props=n?i:ba(i):e.type.props?e.props=i:e.props=a,e.attrs=a}function uo(e,t,r,n){const{props:i,attrs:a,vnode:{patchFlag:v}}=e,_=ye(i),[S]=e.propsOptions;let o=!1;if((n||v>0)&&!(v&16)){if(v&8){const A=e.vnode.dynamicProps;for(let T=0;T<A.length;T++){let y=A[T];if(jr(e.emitsOptions,y))continue;const R=t[y];if(S)if(ve(a,y))R!==a[y]&&(a[y]=R,o=!0);else{const k=st(y);i[k]=gi(S,_,k,R,e,!1)}else R!==a[y]&&(a[y]=R,o=!0)}}}else{hs(e,t,i,a)&&(o=!0);let A;for(const T in _)(!t||!ve(t,T)&&((A=Mt(T))===T||!ve(t,A)))&&(S?r&&(r[T]!==void 0||r[A]!==void 0)&&(i[T]=gi(S,_,T,void 0,e,!0)):delete i[T]);if(a!==_)for(const T in a)(!t||!ve(t,T))&&(delete a[T],o=!0)}o&&lt(e,"set","$attrs")}function hs(e,t,r,n){const[i,a]=e.propsOptions;let v=!1,_;if(t)for(let S in t){if(_r(S))continue;const o=t[S];let A;i&&ve(i,A=st(S))?!a||!a.includes(A)?r[A]=o:(_||(_={}))[A]=o:jr(e.emitsOptions,S)||(!(S in n)||o!==n[S])&&(n[S]=o,v=!0)}if(a){const S=ye(r),o=_||be;for(let A=0;A<a.length;A++){const T=a[A];r[T]=gi(i,S,T,o[T],e,!ve(o,T))}}return v}function gi(e,t,r,n,i,a){const v=e[r];if(v!=null){const _=ve(v,"default");if(_&&n===void 0){const S=v.default;if(v.type!==Function&&ce(S)){const{propsDefaults:o}=i;r in o?n=o[r]:(Yt(i),n=o[r]=S.call(null,t),Pt())}else n=S}v[0]&&(a&&!_?n=!1:v[1]&&(n===""||n===Mt(r))&&(n=!0))}return n}function gs(e,t,r=!1){const n=t.propsCache,i=n.get(e);if(i)return i;const a=e.props,v={},_=[];let S=!1;if(!ce(e)){const A=T=>{S=!0;const[y,R]=gs(T,t,!0);we(v,y),R&&_.push(...R)};!r&&t.mixins.length&&t.mixins.forEach(A),e.extends&&A(e.extends),e.mixins&&e.mixins.forEach(A)}if(!a&&!S)return Se(e)&&n.set(e,jt),jt;if(ue(a))for(let A=0;A<a.length;A++){const T=st(a[A]);nn(T)&&(v[T]=be)}else if(a)for(const A in a){const T=st(A);if(nn(T)){const y=a[A],R=v[T]=ue(y)||ce(y)?{type:y}:Object.assign({},y);if(R){const k=on(Boolean,R.type),g=on(String,R.type);R[0]=k>-1,R[1]=g<0||k<g,(k>-1||ve(R,"default"))&&_.push(T)}}}const o=[v,_];return Se(e)&&n.set(e,o),o}function nn(e){return e[0]!=="$"}function sn(e){const t=e&&e.toString().match(/^\s*function (\w+)/);return t?t[1]:e===null?"null":""}function an(e,t){return sn(e)===sn(t)}function on(e,t){return ue(t)?t.findIndex(r=>an(r,e)):ce(t)&&an(t,e)?0:-1}const ps=e=>e[0]==="_"||e==="$stable",Ui=e=>ue(e)?e.map(tt):[tt(e)],co=(e,t,r)=>{if(t._n)return t;const n=Or((...i)=>Ui(t(...i)),r);return n._c=!1,n},vs=(e,t,r)=>{const n=e._ctx;for(const i in e){if(ps(i))continue;const a=e[i];if(ce(a))t[i]=co(i,a,n);else if(a!=null){const v=Ui(a);t[i]=()=>v}}},ms=(e,t)=>{const r=Ui(t);e.slots.default=()=>r},fo=(e,t)=>{if(e.vnode.shapeFlag&32){const r=t._;r?(e.slots=ye(t),Ir(t,"_",r)):vs(t,e.slots={})}else e.slots={},t&&ms(e,t);Ir(e.slots,qr,1)},ho=(e,t,r)=>{const{vnode:n,slots:i}=e;let a=!0,v=be;if(n.shapeFlag&32){const _=t._;_?r&&_===1?a=!1:(we(i,t),!r&&_===1&&delete i._):(a=!t.$stable,vs(t,i)),v=t}else t&&(ms(e,t),v={default:1});if(a)for(const _ in i)!ps(_)&&!(_ in v)&&delete i[_]};function ys(){return{app:null,config:{isNativeTag:js,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let go=0;function po(e,t){return function(n,i=null){ce(n)||(n=Object.assign({},n)),i!=null&&!Se(i)&&(i=null);const a=ys(),v=new Set;let _=!1;const S=a.app={_uid:go++,_component:n,_props:i,_container:null,_context:a,_instance:null,version:No,get config(){return a.config},set config(o){},use(o,...A){return v.has(o)||(o&&ce(o.install)?(v.add(o),o.install(S,...A)):ce(o)&&(v.add(o),o(S,...A))),S},mixin(o){return a.mixins.includes(o)||a.mixins.push(o),S},component(o,A){return A?(a.components[o]=A,S):a.components[o]},directive(o,A){return A?(a.directives[o]=A,S):a.directives[o]},mount(o,A,T){if(!_){const y=de(n,i);return y.appContext=a,A&&t?t(y,o):e(y,o,T),_=!0,S._container=o,o.__vue_app__=S,zr(y.component)||y.component.proxy}},unmount(){_&&(e(null,S._container),delete S._container.__vue_app__)},provide(o,A){return a.provides[o]=A,S}};return S}}function pi(e,t,r,n,i=!1){if(ue(e)){e.forEach((y,R)=>pi(y,t&&(ue(t)?t[R]:t),r,n,i));return}if(kr(n)&&!i)return;const a=n.shapeFlag&4?zr(n.component)||n.component.proxy:n.el,v=i?null:a,{i:_,r:S}=e,o=t&&t.r,A=_.refs===be?_.refs={}:_.refs,T=_.setupState;if(o!=null&&o!==S&&(ke(o)?(A[o]=null,ve(T,o)&&(T[o]=null)):Fe(o)&&(o.value=null)),ce(S))mt(S,_,12,[v,A]);else{const y=ke(S),R=Fe(S);if(y||R){const k=()=>{if(e.f){const g=y?ve(T,S)?T[S]:A[S]:S.value;i?ue(g)&&_i(g,a):ue(g)?g.includes(a)||g.push(a):y?(A[S]=[a],ve(T,S)&&(T[S]=A[S])):(S.value=[a],e.k&&(A[e.k]=S.value))}else y?(A[S]=v,ve(T,S)&&(T[S]=v)):R&&(S.value=v,e.k&&(A[e.k]=v))};v?(k.id=-1,Be(k,r)):k()}}}const Be=Ba;function vo(e){return mo(e)}function mo(e,t){const r=Ys();r.__VUE__=!0;const{insert:n,remove:i,patchProp:a,createElement:v,createText:_,createComment:S,setText:o,setElementText:A,parentNode:T,nextSibling:y,setScopeId:R=$e,insertStaticContent:k}=e,g=(N,B,j,H=null,V=null,z=null,$=!1,X=null,Q=!!B.dynamicChildren)=>{if(N===B)return;N&&!Ct(N,B)&&(H=se(N),G(N,V,z,!0),N=null),B.patchFlag===-2&&(Q=!1,B.dynamicChildren=null);const{type:Y,ref:ie,shapeFlag:te}=B;switch(Y){case Wr:s(N,B,j,H);break;case Qe:d(N,B,j,H);break;case nr:N==null&&l(B,j,H,$);break;case xe:p(N,B,j,H,V,z,$,X,Q);break;default:te&1?f(N,B,j,H,V,z,$,X,Q):te&6?C(N,B,j,H,V,z,$,X,Q):(te&64||te&128)&&Y.process(N,B,j,H,V,z,$,X,Q,ae)}ie!=null&&V&&pi(ie,N&&N.ref,z,B||N,!B)},s=(N,B,j,H)=>{if(N==null)n(B.el=_(B.children),j,H);else{const V=B.el=N.el;B.children!==N.children&&o(V,B.children)}},d=(N,B,j,H)=>{N==null?n(B.el=S(B.children||""),j,H):B.el=N.el},l=(N,B,j,H)=>{[N.el,N.anchor]=k(N.children,B,j,H,N.el,N.anchor)},h=({el:N,anchor:B},j,H)=>{let V;for(;N&&N!==B;)V=y(N),n(N,j,H),N=V;n(B,j,H)},m=({el:N,anchor:B})=>{let j;for(;N&&N!==B;)j=y(N),i(N),N=j;i(B)},f=(N,B,j,H,V,z,$,X,Q)=>{$=$||B.type==="svg",N==null?E(B,j,H,V,z,$,X,Q):L(N,B,V,z,$,X,Q)},E=(N,B,j,H,V,z,$,X)=>{let Q,Y;const{type:ie,props:te,shapeFlag:re,transition:oe,dirs:le}=N;if(Q=N.el=v(N.type,z,te&&te.is,te),re&8?A(Q,N.children):re&16&&b(N.children,Q,null,H,V,z&&ie!=="foreignObject",$,X),le&&Lt(N,null,H,"created"),te){for(const ge in te)ge!=="value"&&!_r(ge)&&a(Q,ge,null,te[ge],z,N.children,H,V,ee);"value"in te&&a(Q,"value",null,te.value),(Y=te.onVnodeBeforeMount)&&Ze(Y,H,N)}D(Q,N,N.scopeId,$,H),le&&Lt(N,null,H,"beforeMount");const he=(!V||V&&!V.pendingBranch)&&oe&&!oe.persisted;he&&oe.beforeEnter(Q),n(Q,B,j),((Y=te&&te.onVnodeMounted)||he||le)&&Be(()=>{Y&&Ze(Y,H,N),he&&oe.enter(Q),le&&Lt(N,null,H,"mounted")},V)},D=(N,B,j,H,V)=>{if(j&&R(N,j),H)for(let z=0;z<H.length;z++)R(N,H[z]);if(V){let z=V.subTree;if(B===z){const $=V.vnode;D(N,$,$.scopeId,$.slotScopeIds,V.parent)}}},b=(N,B,j,H,V,z,$,X,Q=0)=>{for(let Y=Q;Y<N.length;Y++){const ie=N[Y]=X?gt(N[Y]):tt(N[Y]);g(null,ie,B,j,H,V,z,$,X)}},L=(N,B,j,H,V,z,$)=>{const X=B.el=N.el;let{patchFlag:Q,dynamicChildren:Y,dirs:ie}=B;Q|=N.patchFlag&16;const te=N.props||be,re=B.props||be;let oe;j&&_t(j,!1),(oe=re.onVnodeBeforeUpdate)&&Ze(oe,j,B,N),ie&&Lt(B,N,j,"beforeUpdate"),j&&_t(j,!0);const le=V&&B.type!=="foreignObject";if(Y?u(N.dynamicChildren,Y,X,j,H,le,z):$||P(N,B,X,null,j,H,le,z,!1),Q>0){if(Q&16)c(X,B,te,re,j,H,V);else if(Q&2&&te.class!==re.class&&a(X,"class",null,re.class,V),Q&4&&a(X,"style",te.style,re.style,V),Q&8){const he=B.dynamicProps;for(let ge=0;ge<he.length;ge++){const Te=he[ge],_e=te[Te],He=re[Te];(He!==_e||Te==="value")&&a(X,Te,_e,He,V,N.children,j,H,ee)}}Q&1&&N.children!==B.children&&A(X,B.children)}else!$&&Y==null&&c(X,B,te,re,j,H,V);((oe=re.onVnodeUpdated)||ie)&&Be(()=>{oe&&Ze(oe,j,B,N),ie&&Lt(B,N,j,"updated")},H)},u=(N,B,j,H,V,z,$)=>{for(let X=0;X<B.length;X++){const Q=N[X],Y=B[X],ie=Q.el&&(Q.type===xe||!Ct(Q,Y)||Q.shapeFlag&70)?T(Q.el):j;g(Q,Y,ie,null,H,V,z,$,!0)}},c=(N,B,j,H,V,z,$)=>{if(j!==H){if(j!==be)for(const X in j)!_r(X)&&!(X in H)&&a(N,X,j[X],null,$,B.children,V,z,ee);for(const X in H){if(_r(X))continue;const Q=H[X],Y=j[X];Q!==Y&&X!=="value"&&a(N,X,Y,Q,$,B.children,V,z,ee)}"value"in H&&a(N,"value",j.value,H.value)}},p=(N,B,j,H,V,z,$,X,Q)=>{const Y=B.el=N?N.el:_(""),ie=B.anchor=N?N.anchor:_("");let{patchFlag:te,dynamicChildren:re,slotScopeIds:oe}=B;oe&&(X=X?X.concat(oe):oe),N==null?(n(Y,j,H),n(ie,j,H),b(B.children,j,ie,V,z,$,X,Q)):te>0&&te&64&&re&&N.dynamicChildren?(u(N.dynamicChildren,re,j,V,z,$,X),(B.key!=null||V&&B===V.subTree)&&Es(N,B,!0)):P(N,B,j,ie,V,z,$,X,Q)},C=(N,B,j,H,V,z,$,X,Q)=>{B.slotScopeIds=X,N==null?B.shapeFlag&512?V.ctx.activate(B,j,H,$,Q):I(B,j,H,V,z,$,Q):w(N,B,Q)},I=(N,B,j,H,V,z,$)=>{const X=N.component=Do(N,H,V);if(Hr(N)&&(X.ctx.renderer=ae),ko(X),X.asyncDep){if(V&&V.registerDep(X,O),!N.el){const Q=X.subTree=de(Qe);d(null,Q,B,j)}return}O(X,N,B,j,V,z,$)},w=(N,B,j)=>{const H=B.component=N.component;if(Fa(N,B,j))if(H.asyncDep&&!H.asyncResolved){x(H,B,j);return}else H.next=B,Ca(H.update),H.update();else B.el=N.el,H.vnode=B},O=(N,B,j,H,V,z,$)=>{const X=()=>{if(N.isMounted){let{next:ie,bu:te,u:re,parent:oe,vnode:le}=N,he=ie,ge;_t(N,!1),ie?(ie.el=le.el,x(N,ie,$)):ie=le,te&&Ar(te),(ge=ie.props&&ie.props.onVnodeBeforeUpdate)&&Ze(ge,oe,ie,le),_t(N,!0);const Te=$r(N),_e=N.subTree;N.subTree=Te,g(_e,Te,T(_e.el),se(_e),N,V,z),ie.el=Te.el,he===null&&Ma(N,Te.el),re&&Be(re,V),(ge=ie.props&&ie.props.onVnodeUpdated)&&Be(()=>Ze(ge,oe,ie,le),V)}else{let ie;const{el:te,props:re}=B,{bm:oe,m:le,parent:he}=N,ge=kr(B);if(_t(N,!1),oe&&Ar(oe),!ge&&(ie=re&&re.onVnodeBeforeMount)&&Ze(ie,he,B),_t(N,!0),te&&Ee){const Te=()=>{N.subTree=$r(N),Ee(te,N.subTree,N,V,null)};ge?B.type.__asyncLoader().then(()=>!N.isUnmounted&&Te()):Te()}else{const Te=N.subTree=$r(N);g(null,Te,j,H,N,V,z),B.el=Te.el}if(le&&Be(le,V),!ge&&(ie=re&&re.onVnodeMounted)){const Te=B;Be(()=>Ze(ie,he,Te),V)}(B.shapeFlag&256||he&&kr(he.vnode)&&he.vnode.shapeFlag&256)&&N.a&&Be(N.a,V),N.isMounted=!0,B=j=H=null}},Q=N.effect=new Ri(X,()=>Mi(Y),N.scope),Y=N.update=()=>Q.run();Y.id=N.uid,_t(N,!0),Y()},x=(N,B,j)=>{B.component=N;const H=N.vnode.props;N.vnode=B,N.next=null,uo(N,B.props,H,j),ho(N,B.children,j),zt(),Qi(),Xt()},P=(N,B,j,H,V,z,$,X,Q=!1)=>{const Y=N&&N.children,ie=N?N.shapeFlag:0,te=B.children,{patchFlag:re,shapeFlag:oe}=B;if(re>0){if(re&128){M(Y,te,j,H,V,z,$,X,Q);return}else if(re&256){F(Y,te,j,H,V,z,$,X,Q);return}}oe&8?(ie&16&&ee(Y,V,z),te!==Y&&A(j,te)):ie&16?oe&16?M(Y,te,j,H,V,z,$,X,Q):ee(Y,V,z,!0):(ie&8&&A(j,""),oe&16&&b(te,j,H,V,z,$,X,Q))},F=(N,B,j,H,V,z,$,X,Q)=>{N=N||jt,B=B||jt;const Y=N.length,ie=B.length,te=Math.min(Y,ie);let re;for(re=0;re<te;re++){const oe=B[re]=Q?gt(B[re]):tt(B[re]);g(N[re],oe,j,null,V,z,$,X,Q)}Y>ie?ee(N,V,z,!0,!1,te):b(B,j,H,V,z,$,X,Q,te)},M=(N,B,j,H,V,z,$,X,Q)=>{let Y=0;const ie=B.length;let te=N.length-1,re=ie-1;for(;Y<=te&&Y<=re;){const oe=N[Y],le=B[Y]=Q?gt(B[Y]):tt(B[Y]);if(Ct(oe,le))g(oe,le,j,null,V,z,$,X,Q);else break;Y++}for(;Y<=te&&Y<=re;){const oe=N[te],le=B[re]=Q?gt(B[re]):tt(B[re]);if(Ct(oe,le))g(oe,le,j,null,V,z,$,X,Q);else break;te--,re--}if(Y>te){if(Y<=re){const oe=re+1,le=oe<ie?B[oe].el:H;for(;Y<=re;)g(null,B[Y]=Q?gt(B[Y]):tt(B[Y]),j,le,V,z,$,X,Q),Y++}}else if(Y>re)for(;Y<=te;)G(N[Y],V,z,!0),Y++;else{const oe=Y,le=Y,he=new Map;for(Y=le;Y<=re;Y++){const Ae=B[Y]=Q?gt(B[Y]):tt(B[Y]);Ae.key!=null&&he.set(Ae.key,Y)}let ge,Te=0;const _e=re-le+1;let He=!1,at=0;const Me=new Array(_e);for(Y=0;Y<_e;Y++)Me[Y]=0;for(Y=oe;Y<=te;Y++){const Ae=N[Y];if(Te>=_e){G(Ae,V,z,!0);continue}let Re;if(Ae.key!=null)Re=he.get(Ae.key);else for(ge=le;ge<=re;ge++)if(Me[ge-le]===0&&Ct(Ae,B[ge])){Re=ge;break}Re===void 0?G(Ae,V,z,!0):(Me[Re-le]=Y+1,Re>=at?at=Re:He=!0,g(Ae,B[Re],j,null,V,z,$,X,Q),Te++)}const ct=He?yo(Me):jt;for(ge=ct.length-1,Y=_e-1;Y>=0;Y--){const Ae=le+Y,Re=B[Ae],qe=Ae+1<ie?B[Ae+1].el:H;Me[Y]===0?g(null,Re,j,qe,V,z,$,X,Q):He&&(ge<0||Y!==ct[ge]?U(Re,j,qe,2):ge--)}}},U=(N,B,j,H,V=null)=>{const{el:z,type:$,transition:X,children:Q,shapeFlag:Y}=N;if(Y&6){U(N.component.subTree,B,j,H);return}if(Y&128){N.suspense.move(B,j,H);return}if(Y&64){$.move(N,B,j,ae);return}if($===xe){n(z,B,j);for(let te=0;te<Q.length;te++)U(Q[te],B,j,H);n(N.anchor,B,j);return}if($===nr){h(N,B,j);return}if(H!==2&&Y&1&&X)if(H===0)X.beforeEnter(z),n(z,B,j),Be(()=>X.enter(z),V);else{const{leave:te,delayLeave:re,afterLeave:oe}=X,le=()=>n(z,B,j),he=()=>{te(z,()=>{le(),oe&&oe()})};re?re(z,le,he):he()}else n(z,B,j)},G=(N,B,j,H=!1,V=!1)=>{const{type:z,props:$,ref:X,children:Q,dynamicChildren:Y,shapeFlag:ie,patchFlag:te,dirs:re}=N;if(X!=null&&pi(X,null,j,N,!0),ie&256){B.ctx.deactivate(N);return}const oe=ie&1&&re,le=!kr(N);let he;if(le&&(he=$&&$.onVnodeBeforeUnmount)&&Ze(he,B,N),ie&6)Z(N.component,j,H);else{if(ie&128){N.suspense.unmount(j,H);return}oe&&Lt(N,null,B,"beforeUnmount"),ie&64?N.type.remove(N,B,j,V,ae,H):Y&&(z!==xe||te>0&&te&64)?ee(Y,B,j,!1,!0):(z===xe&&te&384||!V&&ie&16)&&ee(Q,B,j),H&&K(N)}(le&&(he=$&&$.onVnodeUnmounted)||oe)&&Be(()=>{he&&Ze(he,B,N),oe&&Lt(N,null,B,"unmounted")},j)},K=N=>{const{type:B,el:j,anchor:H,transition:V}=N;if(B===xe){q(j,H);return}if(B===nr){m(N);return}const z=()=>{i(j),V&&!V.persisted&&V.afterLeave&&V.afterLeave()};if(N.shapeFlag&1&&V&&!V.persisted){const{leave:$,delayLeave:X}=V,Q=()=>$(j,z);X?X(N.el,z,Q):Q()}else z()},q=(N,B)=>{let j;for(;N!==B;)j=y(N),i(N),N=j;i(B)},Z=(N,B,j)=>{const{bum:H,scope:V,update:z,subTree:$,um:X}=N;H&&Ar(H),V.stop(),z&&(z.active=!1,G($,N,B,j)),X&&Be(X,B),Be(()=>{N.isUnmounted=!0},B),B&&B.pendingBranch&&!B.isUnmounted&&N.asyncDep&&!N.asyncResolved&&N.suspenseId===B.pendingId&&(B.deps--,B.deps===0&&B.resolve())},ee=(N,B,j,H=!1,V=!1,z=0)=>{for(let $=z;$<N.length;$++)G(N[$],B,j,H,V)},se=N=>N.shapeFlag&6?se(N.component.subTree):N.shapeFlag&128?N.suspense.next():y(N.anchor||N.el),ne=(N,B,j)=>{N==null?B._vnode&&G(B._vnode,null,null,!0):g(B._vnode||null,N,B,null,null,null,j),Qi(),ts(),B._vnode=N},ae={p:g,um:G,m:U,r:K,mt:I,mc:b,pc:P,pbc:u,n:se,o:e};let me,Ee;return t&&([me,Ee]=t(ae)),{render:ne,hydrate:me,createApp:po(ne,me)}}function _t({effect:e,update:t},r){e.allowRecurse=t.allowRecurse=r}function Es(e,t,r=!1){const n=e.children,i=t.children;if(ue(n)&&ue(i))for(let a=0;a<n.length;a++){const v=n[a];let _=i[a];_.shapeFlag&1&&!_.dynamicChildren&&((_.patchFlag<=0||_.patchFlag===32)&&(_=i[a]=gt(i[a]),_.el=v.el),r||Es(v,_)),_.type===Wr&&(_.el=v.el)}}function yo(e){const t=e.slice(),r=[0];let n,i,a,v,_;const S=e.length;for(n=0;n<S;n++){const o=e[n];if(o!==0){if(i=r[r.length-1],e[i]<o){t[n]=i,r.push(n);continue}for(a=0,v=r.length-1;a<v;)_=a+v>>1,e[r[_]]<o?a=_+1:v=_;o<e[r[a]]&&(a>0&&(t[n]=r[a-1]),r[a]=n)}}for(a=r.length,v=r[a-1];a-- >0;)r[a]=v,v=t[v];return r}const Eo=e=>e.__isTeleport,xe=Symbol(void 0),Wr=Symbol(void 0),Qe=Symbol(void 0),nr=Symbol(void 0),sr=[];let Xe=null;function fe(e=!1){sr.push(Xe=e?null:[])}function To(){sr.pop(),Xe=sr[sr.length-1]||null}let fr=1;function ln(e){fr+=e}function Ts(e){return e.dynamicChildren=fr>0?Xe||jt:null,To(),fr>0&&Xe&&Xe.push(e),e}function pe(e,t,r,n,i,a){return Ts(W(e,t,r,n,i,a,!0))}function bs(e,t,r,n,i){return Ts(de(e,t,r,n,i,!0))}function vi(e){return e?e.__v_isVNode===!0:!1}function Ct(e,t){return e.type===t.type&&e.key===t.key}const qr="__vInternal",Ss=({key:e})=>e??null,Rr=({ref:e,ref_key:t,ref_for:r})=>e!=null?ke(e)||Fe(e)||ce(e)?{i:Ge,r:e,k:t,f:!!r}:e:null;function W(e,t=null,r=null,n=0,i=null,a=e===xe?0:1,v=!1,_=!1){const S={__v_isVNode:!0,__v_skip:!0,type:e,props:t,key:t&&Ss(t),ref:t&&Rr(t),scopeId:Kr,slotScopeIds:null,children:r,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:a,patchFlag:n,dynamicProps:i,dynamicChildren:null,appContext:null,ctx:Ge};return _?(Gi(S,r),a&128&&e.normalize(S)):r&&(S.shapeFlag|=ke(r)?8:16),fr>0&&!v&&Xe&&(S.patchFlag>0||a&6)&&S.patchFlag!==32&&Xe.push(S),S}const de=bo;function bo(e,t=null,r=null,n=0,i=null,a=!1){if((!e||e===eo)&&(e=Qe),vi(e)){const _=Tt(e,t,!0);return r&&Gi(_,r),fr>0&&!a&&Xe&&(_.shapeFlag&6?Xe[Xe.indexOf(e)]=_:Xe.push(_)),_.patchFlag|=-2,_}if(wo(e)&&(e=e.__vccOpts),t){t=So(t);let{class:_,style:S}=t;_&&!ke(_)&&(t.class=nt(_)),Se(S)&&(Yn(S)&&!ue(S)&&(S=we({},S)),t.style=it(S))}const v=ke(e)?1:Na(e)?128:Eo(e)?64:Se(e)?4:ce(e)?2:0;return W(e,t,r,n,i,v,a,!0)}function So(e){return e?Yn(e)||qr in e?we({},e):e:null}function Tt(e,t,r=!1){const{props:n,ref:i,patchFlag:a,children:v}=e,_=t?ji(n||{},t):n;return{__v_isVNode:!0,__v_skip:!0,type:e.type,props:_,key:_&&Ss(_),ref:t&&t.ref?r&&i?ue(i)?i.concat(Rr(t)):[i,Rr(t)]:Rr(t):i,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:v,target:e.target,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:t&&e.type!==xe?a===-1?16:a|16:a,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:e.transition,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&Tt(e.ssContent),ssFallback:e.ssFallback&&Tt(e.ssFallback),el:e.el,anchor:e.anchor,ctx:e.ctx}}function Pe(e=" ",t=0){return de(Wr,null,e,t)}function Lo(e,t){const r=de(nr,null,e);return r.staticCount=t,r}function Ce(e="",t=!1){return t?(fe(),bs(Qe,null,e)):de(Qe,null,e)}function tt(e){return e==null||typeof e=="boolean"?de(Qe):ue(e)?de(xe,null,e.slice()):typeof e=="object"?gt(e):de(Wr,null,String(e))}function gt(e){return e.el===null&&e.patchFlag!==-1||e.memo?e:Tt(e)}function Gi(e,t){let r=0;const{shapeFlag:n}=e;if(t==null)t=null;else if(ue(t))r=16;else if(typeof t=="object")if(n&65){const i=t.default;i&&(i._c&&(i._d=!1),Gi(e,i()),i._c&&(i._d=!0));return}else{r=32;const i=t._;!i&&!(qr in t)?t._ctx=Ge:i===3&&Ge&&(Ge.slots._===1?t._=1:(t._=2,e.patchFlag|=1024))}else ce(t)?(t={default:t,_ctx:Ge},r=32):(t=String(t),n&64?(r=16,t=[Pe(t)]):r=8);e.children=t,e.shapeFlag|=r}function ji(...e){const t={};for(let r=0;r<e.length;r++){const n=e[r];for(const i in n)if(i==="class")t.class!==n.class&&(t.class=nt([t.class,n.class]));else if(i==="style")t.style=it([t.style,n.style]);else if(Fr(i)){const a=t[i],v=n[i];v&&a!==v&&!(ue(a)&&a.includes(v))&&(t[i]=a?[].concat(a,v):v)}else i!==""&&(t[i]=n[i])}return t}function Ze(e,t,r,n=null){We(e,t,7,[r,n])}const _o=ys();let Ao=0;function Do(e,t,r){const n=e.type,i=(t?t.appContext:e.appContext)||_o,a={uid:Ao++,vnode:e,type:n,parent:t,appContext:i,root:null,next:null,subTree:null,effect:null,update:null,scope:new zs(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:t?t.provides:Object.create(i.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:gs(n,i),emitsOptions:is(n,i),emit:null,emitted:null,propsDefaults:be,inheritAttrs:n.inheritAttrs,ctx:be,data:be,props:be,attrs:be,slots:be,refs:be,setupState:be,setupContext:null,suspense:r,suspenseId:r?r.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return a.ctx={_:a},a.root=t?t.root:a,a.emit=xa.bind(null,a),e.ce&&e.ce(a),a}let Ie=null;const Yr=()=>Ie||Ge,Yt=e=>{Ie=e,e.scope.on()},Pt=()=>{Ie&&Ie.scope.off(),Ie=null};function Ls(e){return e.vnode.shapeFlag&4}let hr=!1;function ko(e,t=!1){hr=t;const{props:r,children:n}=e.vnode,i=Ls(e);lo(e,r,i,t),fo(e,n);const a=i?Ro(e,t):void 0;return hr=!1,a}function Ro(e,t){const r=e.type;e.accessCache=Object.create(null),e.proxy=zn(new Proxy(e.ctx,ro));const{setup:n}=r;if(n){const i=e.setupContext=n.length>1?As(e):null;Yt(e),zt();const a=mt(n,e,0,[e.props,i]);if(Xt(),Pt(),On(a)){if(a.then(Pt,Pt),t)return a.then(v=>{un(e,v,t)}).catch(v=>{Gr(v,e,0)});e.asyncDep=a}else un(e,a,t)}else _s(e,t)}function un(e,t,r){ce(t)?e.type.__ssrInlineRender?e.ssrRender=t:e.render=t:Se(t)&&(e.setupState=Qn(t)),_s(e,r)}let cn;function _s(e,t,r){const n=e.type;if(!e.render){if(!t&&cn&&!n.render){const i=n.template||Bi(e).template;if(i){const{isCustomElement:a,compilerOptions:v}=e.appContext.config,{delimiters:_,compilerOptions:S}=n,o=we(we({isCustomElement:a,delimiters:_},v),S);n.render=cn(i,o)}}e.render=n.render||$e}Yt(e),zt(),io(e),Xt(),Pt()}function Co(e){return new Proxy(e.attrs,{get(t,r){return Ke(e,"get","$attrs"),t[r]}})}function As(e){const t=n=>{e.exposed=n||{}};let r;return{get attrs(){return r||(r=Co(e))},slots:e.slots,emit:e.emit,expose:t}}function zr(e){if(e.exposed)return e.exposeProxy||(e.exposeProxy=new Proxy(Qn(zn(e.exposed)),{get(t,r){if(r in t)return t[r];if(r in ir)return ir[r](e)},has(t,r){return r in t||r in ir}}))}function Io(e,t=!0){return ce(e)?e.displayName||e.name:e.name||t&&e.__name}function wo(e){return ce(e)&&"__vccOpts"in e}const yt=(e,t)=>Da(e,t,hr);function xo(){return Oo().attrs}function Oo(){const e=Yr();return e.setupContext||(e.setupContext=As(e))}function Po(e,t,r){const n=arguments.length;return n===2?Se(t)&&!ue(t)?vi(t)?de(e,null,[t]):de(e,t):de(e,null,t):(n>3?r=Array.prototype.slice.call(arguments,2):n===3&&vi(r)&&(r=[r]),de(e,t,r))}const Fo=Symbol(""),Mo=()=>Dr(Fo),No="3.2.45",Bo="http://www.w3.org/2000/svg",It=typeof document<"u"?document:null,dn=It&&It.createElement("template"),Uo={insert:(e,t,r)=>{t.insertBefore(e,r||null)},remove:e=>{const t=e.parentNode;t&&t.removeChild(e)},createElement:(e,t,r,n)=>{const i=t?It.createElementNS(Bo,e):It.createElement(e,r?{is:r}:void 0);return e==="select"&&n&&n.multiple!=null&&i.setAttribute("multiple",n.multiple),i},createText:e=>It.createTextNode(e),createComment:e=>It.createComment(e),setText:(e,t)=>{e.nodeValue=t},setElementText:(e,t)=>{e.textContent=t},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>It.querySelector(e),setScopeId(e,t){e.setAttribute(t,"")},insertStaticContent(e,t,r,n,i,a){const v=r?r.previousSibling:t.lastChild;if(i&&(i===a||i.nextSibling))for(;t.insertBefore(i.cloneNode(!0),r),!(i===a||!(i=i.nextSibling)););else{dn.innerHTML=n?`<svg>${e}</svg>`:e;const _=dn.content;if(n){const S=_.firstChild;for(;S.firstChild;)_.appendChild(S.firstChild);_.removeChild(S)}t.insertBefore(_,r)}return[v?v.nextSibling:t.firstChild,r?r.previousSibling:t.lastChild]}};function Go(e,t,r){const n=e._vtc;n&&(t=(t?[t,...n]:[...n]).join(" ")),t==null?e.removeAttribute("class"):r?e.setAttribute("class",t):e.className=t}function jo(e,t,r){const n=e.style,i=ke(r);if(r&&!i){for(const a in r)mi(n,a,r[a]);if(t&&!ke(t))for(const a in t)r[a]==null&&mi(n,a,"")}else{const a=n.display;i?t!==r&&(n.cssText=r):t&&e.removeAttribute("style"),"_vod"in e&&(n.display=a)}}const fn=/\s*!important$/;function mi(e,t,r){if(ue(r))r.forEach(n=>mi(e,t,n));else if(r==null&&(r=""),t.startsWith("--"))e.setProperty(t,r);else{const n=Ko(e,t);fn.test(r)?e.setProperty(Mt(n),r.replace(fn,""),"important"):e[n]=r}}const hn=["Webkit","Moz","ms"],Zr={};function Ko(e,t){const r=Zr[t];if(r)return r;let n=st(t);if(n!=="filter"&&n in e)return Zr[t]=n;n=Br(n);for(let i=0;i<hn.length;i++){const a=hn[i]+n;if(a in e)return Zr[t]=a}return t}const gn="http://www.w3.org/1999/xlink";function Ho(e,t,r,n,i){if(n&&t.startsWith("xlink:"))r==null?e.removeAttributeNS(gn,t.slice(6,t.length)):e.setAttributeNS(gn,t,r);else{const a=Gs(t);r==null||a&&!In(r)?e.removeAttribute(t):e.setAttribute(t,a?"":r)}}function Vo(e,t,r,n,i,a,v){if(t==="innerHTML"||t==="textContent"){n&&v(n,i,a),e[t]=r??"";return}if(t==="value"&&e.tagName!=="PROGRESS"&&!e.tagName.includes("-")){e._value=r;const S=r??"";(e.value!==S||e.tagName==="OPTION")&&(e.value=S),r==null&&e.removeAttribute(t);return}let _=!1;if(r===""||r==null){const S=typeof e[t];S==="boolean"?r=In(r):r==null&&S==="string"?(r="",_=!0):S==="number"&&(r=0,_=!0)}try{e[t]=r}catch{}_&&e.removeAttribute(t)}function Ut(e,t,r,n){e.addEventListener(t,r,n)}function Wo(e,t,r,n){e.removeEventListener(t,r,n)}function qo(e,t,r,n,i=null){const a=e._vei||(e._vei={}),v=a[t];if(n&&v)v.value=n;else{const[_,S]=Yo(t);if(n){const o=a[t]=$o(n,i);Ut(e,_,o,S)}else v&&(Wo(e,_,v,S),a[t]=void 0)}}const pn=/(?:Once|Passive|Capture)$/;function Yo(e){let t;if(pn.test(e)){t={};let n;for(;n=e.match(pn);)e=e.slice(0,e.length-n[0].length),t[n[0].toLowerCase()]=!0}return[e[2]===":"?e.slice(3):Mt(e.slice(2)),t]}let ei=0;const zo=Promise.resolve(),Xo=()=>ei||(zo.then(()=>ei=0),ei=Date.now());function $o(e,t){const r=n=>{if(!n._vts)n._vts=Date.now();else if(n._vts<=r.attached)return;We(Qo(n,r.value),t,5,[n])};return r.value=e,r.attached=Xo(),r}function Qo(e,t){if(ue(t)){const r=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{r.call(e),e._stopped=!0},t.map(n=>i=>!i._stopped&&n&&n(i))}else return t}const vn=/^on[a-z]/,Jo=(e,t,r,n,i=!1,a,v,_,S)=>{t==="class"?Go(e,n,i):t==="style"?jo(e,r,n):Fr(t)?Li(t)||qo(e,t,r,n,v):(t[0]==="."?(t=t.slice(1),!0):t[0]==="^"?(t=t.slice(1),!1):Zo(e,t,n,i))?Vo(e,t,n,a,v,_,S):(t==="true-value"?e._trueValue=n:t==="false-value"&&(e._falseValue=n),Ho(e,t,n,i))};function Zo(e,t,r,n){return n?!!(t==="innerHTML"||t==="textContent"||t in e&&vn.test(t)&&ce(r)):t==="spellcheck"||t==="draggable"||t==="translate"||t==="form"||t==="list"&&e.tagName==="INPUT"||t==="type"&&e.tagName==="TEXTAREA"||vn.test(t)&&ke(r)?!1:t in e}function Ki(e){const t=Yr();if(!t)return;const r=t.ut=(i=e(t.proxy))=>{Array.from(document.querySelectorAll(`[data-v-owner="${t.uid}"]`)).forEach(a=>Ei(a,i))},n=()=>{const i=e(t.proxy);yi(t.subTree,i),r(i)};Ga(n),vr(()=>{const i=new MutationObserver(n);i.observe(t.subTree.el.parentNode,{childList:!0}),mr(()=>i.disconnect())})}function yi(e,t){if(e.shapeFlag&128){const r=e.suspense;e=r.activeBranch,r.pendingBranch&&!r.isHydrating&&r.effects.push(()=>{yi(r.activeBranch,t)})}for(;e.component;)e=e.component.subTree;if(e.shapeFlag&1&&e.el)Ei(e.el,t);else if(e.type===xe)e.children.forEach(r=>yi(r,t));else if(e.type===nr){let{el:r,anchor:n}=e;for(;r&&(Ei(r,t),r!==n);)r=r.nextSibling}}function Ei(e,t){if(e.nodeType===1){const r=e.style;for(const n in t)r.setProperty(`--${n}`,t[n])}}const ft="transition",Qt="animation",gr=(e,{slots:t})=>Po(ss,el(e),t);gr.displayName="Transition";const Ds={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String};gr.props=we({},ss.props,Ds);const At=(e,t=[])=>{ue(e)?e.forEach(r=>r(...t)):e&&e(...t)},mn=e=>e?ue(e)?e.some(t=>t.length>1):e.length>1:!1;function el(e){const t={};for(const p in e)p in Ds||(t[p]=e[p]);if(e.css===!1)return t;const{name:r="v",type:n,duration:i,enterFromClass:a=`${r}-enter-from`,enterActiveClass:v=`${r}-enter-active`,enterToClass:_=`${r}-enter-to`,appearFromClass:S=a,appearActiveClass:o=v,appearToClass:A=_,leaveFromClass:T=`${r}-leave-from`,leaveActiveClass:y=`${r}-leave-active`,leaveToClass:R=`${r}-leave-to`}=e,k=tl(i),g=k&&k[0],s=k&&k[1],{onBeforeEnter:d,onEnter:l,onEnterCancelled:h,onLeave:m,onLeaveCancelled:f,onBeforeAppear:E=d,onAppear:D=l,onAppearCancelled:b=h}=t,L=(p,C,I)=>{Dt(p,C?A:_),Dt(p,C?o:v),I&&I()},u=(p,C)=>{p._isLeaving=!1,Dt(p,T),Dt(p,R),Dt(p,y),C&&C()},c=p=>(C,I)=>{const w=p?D:l,O=()=>L(C,p,I);At(w,[C,O]),yn(()=>{Dt(C,p?S:a),ht(C,p?A:_),mn(w)||En(C,n,g,O)})};return we(t,{onBeforeEnter(p){At(d,[p]),ht(p,a),ht(p,v)},onBeforeAppear(p){At(E,[p]),ht(p,S),ht(p,o)},onEnter:c(!1),onAppear:c(!0),onLeave(p,C){p._isLeaving=!0;const I=()=>u(p,C);ht(p,T),nl(),ht(p,y),yn(()=>{p._isLeaving&&(Dt(p,T),ht(p,R),mn(m)||En(p,n,s,I))}),At(m,[p,I])},onEnterCancelled(p){L(p,!1),At(h,[p])},onAppearCancelled(p){L(p,!0),At(b,[p])},onLeaveCancelled(p){u(p),At(f,[p])}})}function tl(e){if(e==null)return null;if(Se(e))return[ti(e.enter),ti(e.leave)];{const t=ti(e);return[t,t]}}function ti(e){return or(e)}function ht(e,t){t.split(/\s+/).forEach(r=>r&&e.classList.add(r)),(e._vtc||(e._vtc=new Set)).add(t)}function Dt(e,t){t.split(/\s+/).forEach(n=>n&&e.classList.remove(n));const{_vtc:r}=e;r&&(r.delete(t),r.size||(e._vtc=void 0))}function yn(e){requestAnimationFrame(()=>{requestAnimationFrame(e)})}let rl=0;function En(e,t,r,n){const i=e._endId=++rl,a=()=>{i===e._endId&&n()};if(r)return setTimeout(a,r);const{type:v,timeout:_,propCount:S}=il(e,t);if(!v)return n();const o=v+"end";let A=0;const T=()=>{e.removeEventListener(o,y),a()},y=R=>{R.target===e&&++A>=S&&T()};setTimeout(()=>{A<S&&T()},_+1),e.addEventListener(o,y)}function il(e,t){const r=window.getComputedStyle(e),n=k=>(r[k]||"").split(", "),i=n(`${ft}Delay`),a=n(`${ft}Duration`),v=Tn(i,a),_=n(`${Qt}Delay`),S=n(`${Qt}Duration`),o=Tn(_,S);let A=null,T=0,y=0;t===ft?v>0&&(A=ft,T=v,y=a.length):t===Qt?o>0&&(A=Qt,T=o,y=S.length):(T=Math.max(v,o),A=T>0?v>o?ft:Qt:null,y=A?A===ft?a.length:S.length:0);const R=A===ft&&/\b(transform|all)(,|$)/.test(n(`${ft}Property`).toString());return{type:A,timeout:T,propCount:y,hasTransform:R}}function Tn(e,t){for(;e.length<t.length;)e=e.concat(e);return Math.max(...t.map((r,n)=>bn(r)+bn(e[n])))}function bn(e){return Number(e.slice(0,-1).replace(",","."))*1e3}function nl(){return document.body.offsetHeight}const Sn=e=>{const t=e.props["onUpdate:modelValue"]||!1;return ue(t)?r=>Ar(t,r):t};function sl(e){e.target.composing=!0}function Ln(e){const t=e.target;t.composing&&(t.composing=!1,t.dispatchEvent(new Event("input")))}const Gt={created(e,{modifiers:{lazy:t,trim:r,number:n}},i){e._assign=Sn(i);const a=n||i.props&&i.props.type==="number";Ut(e,t?"change":"input",v=>{if(v.target.composing)return;let _=e.value;r&&(_=_.trim()),a&&(_=or(_)),e._assign(_)}),r&&Ut(e,"change",()=>{e.value=e.value.trim()}),t||(Ut(e,"compositionstart",sl),Ut(e,"compositionend",Ln),Ut(e,"change",Ln))},mounted(e,{value:t}){e.value=t??""},beforeUpdate(e,{value:t,modifiers:{lazy:r,trim:n,number:i}},a){if(e._assign=Sn(a),e.composing||document.activeElement===e&&e.type!=="range"&&(r||n&&e.value.trim()===t||(i||e.type==="number")&&or(e.value)===t))return;const v=t??"";e.value!==v&&(e.value=v)}},al=["ctrl","shift","alt","meta"],ol={stop:e=>e.stopPropagation(),prevent:e=>e.preventDefault(),self:e=>e.target!==e.currentTarget,ctrl:e=>!e.ctrlKey,shift:e=>!e.shiftKey,alt:e=>!e.altKey,meta:e=>!e.metaKey,left:e=>"button"in e&&e.button!==0,middle:e=>"button"in e&&e.button!==1,right:e=>"button"in e&&e.button!==2,exact:(e,t)=>al.some(r=>e[`${r}Key`]&&!t.includes(r))},ll=(e,t)=>(r,...n)=>{for(let i=0;i<t.length;i++){const a=ol[t[i]];if(a&&a(r,t))return}return e(r,...n)},ul={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},Jt=(e,t)=>r=>{if(!("key"in r))return;const n=Mt(r.key);if(t.some(i=>i===n||ul[i]===n))return e(r)},je={beforeMount(e,{value:t},{transition:r}){e._vod=e.style.display==="none"?"":e.style.display,r&&t?r.beforeEnter(e):Zt(e,t)},mounted(e,{value:t},{transition:r}){r&&t&&r.enter(e)},updated(e,{value:t,oldValue:r},{transition:n}){!t!=!r&&(n?t?(n.beforeEnter(e),Zt(e,!0),n.enter(e)):n.leave(e,()=>{Zt(e,!1)}):Zt(e,t))},beforeUnmount(e,{value:t}){Zt(e,t)}};function Zt(e,t){e.style.display=t?e._vod:"none"}const cl=we({patchProp:Jo},Uo);let _n;function dl(){return _n||(_n=vo(cl))}const fl=(...e)=>{const t=dl().createApp(...e),{mount:r}=t;return t.mount=n=>{const i=hl(n);if(!i)return;const a=t._component;!ce(a)&&!a.render&&!a.template&&(a.template=i.innerHTML),i.innerHTML="";const v=r(i,!1,i instanceof SVGElement);return i instanceof Element&&(i.removeAttribute("v-cloak"),i.setAttribute("data-v-app","")),v},t};function hl(e){return ke(e)?document.querySelector(e):e}const ks=(e,t)=>{const r=e.__vccOpts||e;for(const[n,i]of t)r[n]=i;return r},gl={data(){return{count:0,NewSrc:"",M3u8Video:{width:"800px",height:"450px",color:"#409eff",title:"",type:"m3u8",src:"https://s-bj-2339-mydisk1.oss.dogecdn.com/testvideo/test.m3u8",newsrc:"",muted:!1,webFullScreen:!1,speedRate:["1.0","1.25"],autoPlay:!1,loop:!1,mirror:!1,ligthOff:!1,volume:.3,control:!0,controlBtns:["audioTrack","quality","speedRate","volume","setting","pip","pageFullScreen","fullScreen"]},Mp4Video:{width:"800px",height:"450px",color:"#409eff",title:"",src:"https://s-bj-2339-mydisk1.oss.dogecdn.com/Im%20Nothing%20Without%20You.mp4",muted:!1,webFullScreen:!1,speedRate:["1.0","1.25"],autoPlay:!1,loop:!1,mirror:!1,ligthOff:!1,volume:.3,control:!0,controlBtns:["audioTrack","quality","speedRate","volume","setting","pip","pageFullScreen","fullScreen"]},VideoObject:{width:"800px",height:"450px",color:"#409eff",title:"",src:"https://garen.dynv6.net/002.mp4",muted:!1,webFullScreen:!1,speedRate:["1.0","1.25"],autoPlay:!1,loop:!1,mirror:!1,ligthOff:!1,volume:.3,control:!0,controlBtns:["audioTrack","quality","speedRate","volume","setting","pip","pageFullScreen","fullScreen"]}}},methods:{increment(){this.count++},GetIt(){console.log("干甚呢？",this.NewSrc)},ChangeVideo(){this.NewSrc.substring(this.NewSrc.lastIndexOf(".")+1)=="m3u8"?(this.M3u8Video.src=this.NewSrc,this.VideoObject=this.M3u8Video,console.log("实现 M3U8 对象")):this.NewSrc.substring(this.NewSrc.lastIndexOf(".")+1)=="mp4"?(this.Mp4Video.src=this.NewSrc,this.VideoObject=this.Mp4Video,console.log("MP4,MP4,MP4,MP4,MP4")):(console.log("!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"),alert("未知后缀！！！！！"))}},mounted(){}},pl={align:"center"},vl=W("br",null,null,-1),ml=W("br",null,null,-1),yl=W("br",null,null,-1),El=W("br",null,null,-1),Tl=W("br",null,null,-1);function bl(e,t,r,n,i,a){const v=ds("vue3VideoPlay");return fe(),pe("div",pl,[W("p",null,[De(W("input",{style:{width:"800px"},type:"text","onUpdate:modelValue":t[0]||(t[0]=_=>i.NewSrc=_)},null,512),[[Gt,i.NewSrc]])]),W("button",{onClick:t[1]||(t[1]=(..._)=>a.GetIt&&a.GetIt(..._))},"获取"),W("button",{onClick:t[2]||(t[2]=(..._)=>a.ChangeVideo&&a.ChangeVideo(..._))},"应用"),vl,ml,yl,El,W("p",null,[Tl,de(v,ji({width:"800px"},i.VideoObject),null,16)])])}const Sl=ks(gl,[["render",bl]]);const Ll={components:{Mp4Page:Sl},setup(){},name:"App",data(){return{istext:!1,inputid:null,inputid:0,inputdescription:"",inputname:"",inputsrc:"",contt:1,contexts:JSON.parse(localStorage.getItem("VideoList"))||[{id:1,name:"圣职者",src:"https://baidu.com",description:"你好！"},{id:2,name:"圣职者2",src:"https://baidu.com",description:"你好！"}],context:JSON.parse(localStorage.getItem("context"))||`本地数据为空：
  https://s-bj-2339-mydisk1.oss.dogecdn.com/%E3%81%82%E3%81%AE%E3%81%AF%E3%81%AA.mp4,
 https://s-bj-2339-mydisk1.oss.dogecdn.com/test/TE.m3u8 ,
 https://s-bj-2339-mydisk1.oss.dogecdn.com/movie/yrcy_m3u8/YRCY_m3u8.m3u8`}},methods:{datatoContext(e){localStorage.setItem("context",JSON.stringify(e)),alert("保存成功")},datatoVideoList(e){localStorage.setItem("VideoList",JSON.stringify(e)),alert("保存成功")},toggletext(){this.istext=!this.istext},addVideos(e,t,r,n){crypto.randomUUID(),console.log("开发中.");const i={id:e,name:r,src:n,description:t};this.contexts.push(i)},deletevideo(e){confirm("确认要删除吗？")==!0?(console.log("确认删除"),this.contexts.splice(e,1)):console.log("否")},copythevideosrc(e){console.log(e.src)},copyTextToClipboard(e){var t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),alert("复制成功!")}},watch:{}},_l={id:"app"},Al=Lo('<header><h1><img width="30" src="https://avatars.githubusercontent.com/u/51418619?v=4" alt=""> 👺🥥 简易视频播放器 </h1><p> JwPlayer <a href="https://www.jwplayer.com/" target="_blank">JwPlayer</a> | <a href="https://github.com/jwplayer/jwplayer" target="_blank"> Github </a></p><p> DPlayer <a href="https://dplayer.diygod.dev/" target="_blank"> DPlayer </a> |👉 <a href="https://github.com/DIYgod/DPlayer" target="_blank"> Github </a></p><p> hello-muiplayer <a href="https://muiplayer.js.org/" target="_blank"> muiplayer </a> | <a href="https://github.com/muiplayer/hello-muiplayer" target="_blank"> muiplayer </a></p><p> v-videos.js <a href="https://videojs.com/" target="_blank"> videojs </a> | <a href="https://github.com/videojs/video.js" target="_blank"> videojs </a></p><p> v-videos.js <a href="https://codelife.cc/vue3-video-play/" target="_blank"> vue3-video-play </a> | <a href="https://github.com/xdlumia/vue3-video-play" target="_blank"> videojs </a></p></header>',1),Dl={style:{border:"1cm solid rebeccapurple"}},kl={key:0,id:"no-downloads"},Rl=W("div",null,[W("div",{class:"illustration"}),W("span",null,"您添加的视频会显示在此处")],-1),Cl=[Rl],Il={id:"downloadsList"},wl={id:"content","focus-row-container":"",class:"is-active focus-row-active"},xl=W("div",{id:"file-icon-wrapper",class:"icon-wrapper","aria-hidden":"true"},[W("img",{class:"icon",id:"file-icon",src:"https://www.gstatic.com/images/icons/material/apps/fonts/1x/catalog/v5/favicon.svg"})],-1),Ol={id:"details"},Pl={id:"title-area",role:"gridcell"},Fl={id:"name",hidden:""},Ml=W("span",{id:"tag"},null,-1),Nl={role:"gridcell"},Bl=["onClick"],Ul={id:"description",role:"gridcell"},Gl={class:"more-options"},jl={role:"gridcell"},Kl={class:"icon-clear",id:"remove",title:"从列表中移除","focus-row-control":"","focus-type":"remove",style:{},"aria-disabled":"false",role:"button",tabindex:"0"},Hl={id:"icon"},Vl=["onClick"],Wl=W("span",{class:"material-icons"}," close ",-1),ql=[Wl],Yl=W("br",null,null,-1),zl=W("br",null,null,-1);function Xl(e,t,r,n,i,a){const v=ds("Mp4Page");return fe(),pe("div",_l,[Al,W("main",null,[W("div",Dl,[W("p",null,[W("p",null,[Pe(" 视频ID ："),De(W("input",{"onUpdate:modelValue":t[0]||(t[0]=_=>i.inputid=_),type:"text"},null,512),[[Gt,i.inputid]])]),W("p",null,[Pe(" 视频名称 ："),De(W("input",{"onUpdate:modelValue":t[1]||(t[1]=_=>i.inputname=_),type:"text"},null,512),[[Gt,i.inputname]])]),W("p",null,[Pe(" 视频路径 ："),De(W("input",{"onUpdate:modelValue":t[2]||(t[2]=_=>i.inputsrc=_),type:"text",style:{width:"800px"}},null,512),[[Gt,i.inputsrc]])]),W("p",null,[Pe(" 视频描述 ："),De(W("input",{"onUpdate:modelValue":t[3]||(t[3]=_=>i.inputdescription=_),type:"text"},null,512),[[Gt,i.inputdescription]])]),W("button",{onClick:t[4]||(t[4]=_=>a.addVideos(i.inputid,i.inputdescription,i.inputname,i.inputsrc))}," 添加 "),W("button",{onClick:t[5]||(t[5]=_=>a.datatoVideoList(i.contexts))},"保存")]),i.contt?Ce("",!0):(fe(),pe("div",kl,Cl)),W("div",Il,[i.contt?(fe(!0),pe(xe,{key:0},dr(i.contexts,(_,S)=>(fe(),pe("div",{key:S},[W("div",wl,[xl,W("div",Ol,[W("div",Pl,[W("a",{is:"action-link",id:"file-link","focus-type":"fileLink",tabindex:"0",role:"link",onClick:t[6]||(t[6]=(...o)=>a.copythevideosrc&&a.copythevideosrc(...o)),href:"#"},Le(_.name),1),W("span",Fl,Le(_.name),1),Ml]),W("div",Nl,[W("a",{id:"url","focus-type":"url",href:"javascript:void",onClick:o=>a.copyTextToClipboard(_.src),tabindex:"0"},Le(_.src),9,Bl)]),W("div",Ul,Le(S)+" : "+Le(_.description),1)]),W("div",Gl,[W("div",jl,[W("div",Kl,[W("div",Hl,[W("button",{onClick:o=>a.deletevideo(S)},ql,8,Vl)])])])])])]))),128)):Ce("",!0)])]),W("p",null,[i.istext?De((fe(),pe("textarea",{key:0,cols:"85",rows:"30","onUpdate:modelValue":t[7]||(t[7]=_=>i.context=_)},null,512)),[[Gt,i.context]]):Ce("",!0)]),W("p",null,[W("button",{onClick:t[8]||(t[8]=_=>a.toggletext())}," 显示或隐藏文字区 "),Pe(" | "),W("button",{onClick:t[9]||(t[9]=_=>a.datatoContext(i.context))}," 保存(文字到 localStorge) ")]),Yl,zl,de(v)])])}const $l=ks(Ll,[["render",Xl]]);var Ql=Object.defineProperty,Jl=Object.defineProperties,Zl=Object.getOwnPropertyDescriptors,An=Object.getOwnPropertySymbols,eu=Object.prototype.hasOwnProperty,tu=Object.prototype.propertyIsEnumerable,Dn=(e,t,r)=>t in e?Ql(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Ti=(e,t)=>{for(var r in t||(t={}))eu.call(t,r)&&Dn(e,r,t[r]);if(An)for(var r of An(t))tu.call(t,r)&&Dn(e,r,t[r]);return e},bi=(e,t)=>Jl(e,Zl(t));function kn(e,t,r,n){var i,a=!1,v=0;function _(){i&&clearTimeout(i)}function S(){for(var o=arguments.length,A=new Array(o),T=0;T<o;T++)A[T]=arguments[T];var y=this,R=Date.now()-v;function k(){v=Date.now(),r.apply(y,A)}function g(){i=void 0}a||(n&&!i&&k(),_(),n===void 0&&R>e?k():t!==!0&&(i=setTimeout(n?g:k,n===void 0?e-R:e)))}return typeof t!="boolean"&&(n=r,r=t,t=void 0),S.cancel=function(){_(),a=!0},S}function Rn(e,t,r){return r===void 0?kn(e,t,!1):kn(e,r,t!==!1)}function ru(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Rs={exports:{}};typeof window<"u"&&(Rs.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(n,i,a){r.o(n,i)||Object.defineProperty(n,i,{enumerable:!0,get:a})},r.r=function(n){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},r.t=function(n,i){if(1&i&&(n=r(n)),8&i||4&i&&typeof n=="object"&&n&&n.__esModule)return n;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:n}),2&i&&typeof n!="string")for(var v in n)r.d(a,v,function(_){return n[_]}.bind(null,v));return a},r.n=function(n){var i=n&&n.__esModule?function(){return n.default}:function(){return n};return r.d(i,"a",i),i},r.o=function(n,i){return Object.prototype.hasOwnProperty.call(n,i)},r.p="/dist/",r(r.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(e,t,r){var n=Object.prototype.hasOwnProperty,i="~";function a(){}function v(A,T,y){this.fn=A,this.context=T,this.once=y||!1}function _(A,T,y,R,k){if(typeof y!="function")throw new TypeError("The listener must be a function");var g=new v(y,R||A,k),s=i?i+T:T;return A._events[s]?A._events[s].fn?A._events[s]=[A._events[s],g]:A._events[s].push(g):(A._events[s]=g,A._eventsCount++),A}function S(A,T){--A._eventsCount==0?A._events=new a:delete A._events[T]}function o(){this._events=new a,this._eventsCount=0}Object.create&&(a.prototype=Object.create(null),new a().__proto__||(i=!1)),o.prototype.eventNames=function(){var A,T,y=[];if(this._eventsCount===0)return y;for(T in A=this._events)n.call(A,T)&&y.push(i?T.slice(1):T);return Object.getOwnPropertySymbols?y.concat(Object.getOwnPropertySymbols(A)):y},o.prototype.listeners=function(A){var T=i?i+A:A,y=this._events[T];if(!y)return[];if(y.fn)return[y.fn];for(var R=0,k=y.length,g=new Array(k);R<k;R++)g[R]=y[R].fn;return g},o.prototype.listenerCount=function(A){var T=i?i+A:A,y=this._events[T];return y?y.fn?1:y.length:0},o.prototype.emit=function(A,T,y,R,k,g){var s=i?i+A:A;if(!this._events[s])return!1;var d,l,h=this._events[s],m=arguments.length;if(h.fn){switch(h.once&&this.removeListener(A,h.fn,void 0,!0),m){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,T),!0;case 3:return h.fn.call(h.context,T,y),!0;case 4:return h.fn.call(h.context,T,y,R),!0;case 5:return h.fn.call(h.context,T,y,R,k),!0;case 6:return h.fn.call(h.context,T,y,R,k,g),!0}for(l=1,d=new Array(m-1);l<m;l++)d[l-1]=arguments[l];h.fn.apply(h.context,d)}else{var f,E=h.length;for(l=0;l<E;l++)switch(h[l].once&&this.removeListener(A,h[l].fn,void 0,!0),m){case 1:h[l].fn.call(h[l].context);break;case 2:h[l].fn.call(h[l].context,T);break;case 3:h[l].fn.call(h[l].context,T,y);break;case 4:h[l].fn.call(h[l].context,T,y,R);break;default:if(!d)for(f=1,d=new Array(m-1);f<m;f++)d[f-1]=arguments[f];h[l].fn.apply(h[l].context,d)}}return!0},o.prototype.on=function(A,T,y){return _(this,A,T,y,!1)},o.prototype.once=function(A,T,y){return _(this,A,T,y,!0)},o.prototype.removeListener=function(A,T,y,R){var k=i?i+A:A;if(!this._events[k])return this;if(!T)return S(this,k),this;var g=this._events[k];if(g.fn)g.fn!==T||R&&!g.once||y&&g.context!==y||S(this,k);else{for(var s=0,d=[],l=g.length;s<l;s++)(g[s].fn!==T||R&&!g[s].once||y&&g[s].context!==y)&&d.push(g[s]);d.length?this._events[k]=d.length===1?d[0]:d:S(this,k)}return this},o.prototype.removeAllListeners=function(A){var T;return A?(T=i?i+A:A,this._events[T]&&S(this,T)):(this._events=new a,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=i,o.EventEmitter=o,e.exports=o},"./node_modules/url-toolkit/src/url-toolkit.js":function(e,t,r){var n,i,a,v,_;n=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/,i=/^([^\/?#]*)([^]*)$/,a=/(?:\/|^)\.(?=\/)/g,v=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,_={buildAbsoluteURL:function(S,o,A){if(A=A||{},S=S.trim(),!(o=o.trim())){if(!A.alwaysNormalize)return S;var T=_.parseURL(S);if(!T)throw new Error("Error trying to parse base URL.");return T.path=_.normalizePath(T.path),_.buildURLFromParts(T)}var y=_.parseURL(o);if(!y)throw new Error("Error trying to parse relative URL.");if(y.scheme)return A.alwaysNormalize?(y.path=_.normalizePath(y.path),_.buildURLFromParts(y)):o;var R=_.parseURL(S);if(!R)throw new Error("Error trying to parse base URL.");if(!R.netLoc&&R.path&&R.path[0]!=="/"){var k=i.exec(R.path);R.netLoc=k[1],R.path=k[2]}R.netLoc&&!R.path&&(R.path="/");var g={scheme:R.scheme,netLoc:y.netLoc,path:null,params:y.params,query:y.query,fragment:y.fragment};if(!y.netLoc&&(g.netLoc=R.netLoc,y.path[0]!=="/"))if(y.path){var s=R.path,d=s.substring(0,s.lastIndexOf("/")+1)+y.path;g.path=_.normalizePath(d)}else g.path=R.path,y.params||(g.params=R.params,y.query||(g.query=R.query));return g.path===null&&(g.path=A.alwaysNormalize?_.normalizePath(y.path):y.path),_.buildURLFromParts(g)},parseURL:function(S){var o=n.exec(S);return o?{scheme:o[1]||"",netLoc:o[2]||"",path:o[3]||"",params:o[4]||"",query:o[5]||"",fragment:o[6]||""}:null},normalizePath:function(S){for(S=S.split("").reverse().join("").replace(a,"");S.length!==(S=S.replace(v,"")).length;);return S.split("").reverse().join("")},buildURLFromParts:function(S){return S.scheme+S.netLoc+S.path+S.params+S.query+S.fragment}},e.exports=_},"./node_modules/webworkify-webpack/index.js":function(e,t,r){function n(o){var A={};function T(R){if(A[R])return A[R].exports;var k=A[R]={i:R,l:!1,exports:{}};return o[R].call(k.exports,k,k.exports,T),k.l=!0,k.exports}T.m=o,T.c=A,T.i=function(R){return R},T.d=function(R,k,g){T.o(R,k)||Object.defineProperty(R,k,{configurable:!1,enumerable:!0,get:g})},T.r=function(R){Object.defineProperty(R,"__esModule",{value:!0})},T.n=function(R){var k=R&&R.__esModule?function(){return R.default}:function(){return R};return T.d(k,"a",k),k},T.o=function(R,k){return Object.prototype.hasOwnProperty.call(R,k)},T.p="/",T.oe=function(R){throw console.error(R),R};var y=T(T.s=ENTRY_MODULE);return y.default||y}var i="[\\.|\\-|\\+|\\w|/|@]+",a="\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)";function v(o){return(o+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function _(o,A,T){var y={};y[T]=[];var R=A.toString(),k=R.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!k)return y;for(var g,s=k[1],d=new RegExp("(\\\\n|\\W)"+v(s)+a,"g");g=d.exec(R);)g[3]!=="dll-reference"&&y[T].push(g[3]);for(d=new RegExp("\\("+v(s)+'\\("(dll-reference\\s('+i+'))"\\)\\)'+a,"g");g=d.exec(R);)o[g[2]]||(y[T].push(g[1]),o[g[2]]=r(g[1]).m),y[g[2]]=y[g[2]]||[],y[g[2]].push(g[4]);for(var l,h=Object.keys(y),m=0;m<h.length;m++)for(var f=0;f<y[h[m]].length;f++)l=y[h[m]][f],isNaN(1*l)||(y[h[m]][f]=1*y[h[m]][f]);return y}function S(o){return Object.keys(o).reduce(function(A,T){return A||o[T].length>0},!1)}e.exports=function(o,A){A=A||{};var T={main:r.m},y=A.all?{main:Object.keys(T.main)}:function(d,l){for(var h={main:[l]},m={main:[]},f={main:{}};S(h);)for(var E=Object.keys(h),D=0;D<E.length;D++){var b=E[D],L=h[b].pop();if(f[b]=f[b]||{},!f[b][L]&&d[b][L]){f[b][L]=!0,m[b]=m[b]||[],m[b].push(L);for(var u=_(d,d[b][L],b),c=Object.keys(u),p=0;p<c.length;p++)h[c[p]]=h[c[p]]||[],h[c[p]]=h[c[p]].concat(u[c[p]])}}return m}(T,o),R="";Object.keys(y).filter(function(d){return d!=="main"}).forEach(function(d){for(var l=0;y[d][l];)l++;y[d].push(l),T[d][l]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",R=R+"var "+d+" = ("+n.toString().replace("ENTRY_MODULE",JSON.stringify(l))+")({"+y[d].map(function(h){return JSON.stringify(h)+": "+T[d][h].toString()}).join(",")+`});
`}),R=R+"new (("+n.toString().replace("ENTRY_MODULE",JSON.stringify(o))+")({"+y.main.map(function(d){return JSON.stringify(d)+": "+T.main[d].toString()}).join(",")+"}))(self);";var k=new window.Blob([R],{type:"text/javascript"});if(A.bare)return k;var g=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(k),s=new window.Worker(g);return s.objectURL=g,s}},"./src/config.ts":function(e,t,r){r.r(t),r.d(t,"hlsDefaultConfig",function(){return E}),r.d(t,"mergeConfig",function(){return D}),r.d(t,"enableStreamingMode",function(){return b});var n=r("./src/controller/abr-controller.ts"),i=r("./src/controller/audio-stream-controller.ts"),a=r("./src/controller/audio-track-controller.ts"),v=r("./src/controller/subtitle-stream-controller.ts"),_=r("./src/controller/subtitle-track-controller.ts"),S=r("./src/controller/buffer-controller.ts"),o=r("./src/controller/timeline-controller.ts"),A=r("./src/controller/cap-level-controller.ts"),T=r("./src/controller/fps-controller.ts"),y=r("./src/controller/eme-controller.ts"),R=r("./src/utils/xhr-loader.ts"),k=r("./src/utils/fetch-loader.ts"),g=r("./src/utils/cues.ts"),s=r("./src/utils/mediakeys-helper.ts"),d=r("./src/utils/logger.ts");function l(){return(l=Object.assign||function(L){for(var u=1;u<arguments.length;u++){var c=arguments[u];for(var p in c)Object.prototype.hasOwnProperty.call(c,p)&&(L[p]=c[p])}return L}).apply(this,arguments)}function h(L,u){var c=Object.keys(L);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(L);u&&(p=p.filter(function(C){return Object.getOwnPropertyDescriptor(L,C).enumerable})),c.push.apply(c,p)}return c}function m(L){for(var u=1;u<arguments.length;u++){var c=arguments[u]!=null?arguments[u]:{};u%2?h(Object(c),!0).forEach(function(p){f(L,p,c[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(L,Object.getOwnPropertyDescriptors(c)):h(Object(c)).forEach(function(p){Object.defineProperty(L,p,Object.getOwnPropertyDescriptor(c,p))})}return L}function f(L,u,c){return u in L?Object.defineProperty(L,u,{value:c,enumerable:!0,configurable:!0,writable:!0}):L[u]=c,L}var E=m(m({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:R.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:n.default,bufferController:S.default,capLevelController:A.default,fpsController:T.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:s.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0},{cueHandler:g.default,enableCEA708Captions:!0,enableWebVTT:!0,enableIMSC1:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:v.SubtitleStreamController,subtitleTrackController:_.default,timelineController:o.TimelineController,audioStreamController:i.default,audioTrackController:a.default,emeController:y.default});function D(L,u){if((u.liveSyncDurationCount||u.liveMaxLatencyDurationCount)&&(u.liveSyncDuration||u.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(u.liveMaxLatencyDurationCount!==void 0&&(u.liveSyncDurationCount===void 0||u.liveMaxLatencyDurationCount<=u.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(u.liveMaxLatencyDuration!==void 0&&(u.liveSyncDuration===void 0||u.liveMaxLatencyDuration<=u.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return l({},L,u)}function b(L){var u=L.loader;u!==k.default&&u!==R.default?(d.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),L.progressive=!1):Object(k.fetchSupported)()&&(L.loader=k.default,L.progressive=!0,L.enableSoftwareAES=!0,d.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}},"./src/controller/abr-controller.ts":function(e,t,r){r.r(t);var n=r("./src/polyfills/number.ts"),i=r("./src/utils/ewma-bandwidth-estimator.ts"),a=r("./src/events.ts"),v=r("./src/utils/buffer-helper.ts"),_=r("./src/errors.ts"),S=r("./src/types/loader.ts"),o=r("./src/utils/logger.ts");function A(y,R){for(var k=0;k<R.length;k++){var g=R[k];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(y,g.key,g)}}var T=function(){function y(s){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=s;var d=s.config;this.bwEstimator=new i.default(d.abrEwmaSlowVoD,d.abrEwmaFastVoD,d.abrEwmaDefaultEstimate),this.registerListeners()}var R,k,g=y.prototype;return g.registerListeners=function(){var s=this.hls;s.on(a.Events.FRAG_LOADING,this.onFragLoading,this),s.on(a.Events.FRAG_LOADED,this.onFragLoaded,this),s.on(a.Events.FRAG_BUFFERED,this.onFragBuffered,this),s.on(a.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.on(a.Events.ERROR,this.onError,this)},g.unregisterListeners=function(){var s=this.hls;s.off(a.Events.FRAG_LOADING,this.onFragLoading,this),s.off(a.Events.FRAG_LOADED,this.onFragLoaded,this),s.off(a.Events.FRAG_BUFFERED,this.onFragBuffered,this),s.off(a.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.off(a.Events.ERROR,this.onError,this)},g.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},g.onFragLoading=function(s,d){var l,h=d.frag;h.type===S.PlaylistLevelType.MAIN&&(this.timer||(this.fragCurrent=h,this.partCurrent=(l=d.part)!=null?l:null,this.timer=self.setInterval(this.onCheck,100)))},g.onLevelLoaded=function(s,d){var l=this.hls.config;d.details.live?this.bwEstimator.update(l.abrEwmaSlowLive,l.abrEwmaFastLive):this.bwEstimator.update(l.abrEwmaSlowVoD,l.abrEwmaFastVoD)},g._abandonRulesCheck=function(){var s=this.fragCurrent,d=this.partCurrent,l=this.hls,h=l.autoLevelEnabled,m=l.config,f=l.media;if(s&&f){var E=d?d.stats:s.stats,D=d?d.duration:s.duration;if(E.aborted)return o.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);if(h&&!f.paused&&f.playbackRate&&f.readyState){var b=performance.now()-E.loading.start,L=Math.abs(f.playbackRate);if(!(b<=500*D/L)){var u=l.levels,c=l.minAutoLevel,p=u[s.level],C=E.total||Math.max(E.loaded,Math.round(D*p.maxBitrate/8)),I=Math.max(1,E.bwEstimate?E.bwEstimate/8:1e3*E.loaded/b),w=(C-E.loaded)/I,O=f.currentTime,x=(v.BufferHelper.bufferInfo(f,O,m.maxBufferHole).end-O)/L;if(!(x>=2*D/L||w<=x)){var P,F=Number.POSITIVE_INFINITY;for(P=s.level-1;P>c&&!((F=D*u[P].maxBitrate/(6.4*I))<x);P--);if(!(F>=w)){var M=this.bwEstimator.getEstimate();o.logger.warn("Fragment "+s.sn+(d?" part "+d.index:"")+" of level "+s.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+P+`
      Current BW estimate: `+(Object(n.isFiniteNumber)(M)?(M/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+w.toFixed(3)+` s
      Estimated load time for the next fragment: `+F.toFixed(3)+` s
      Time to underbuffer: `+x.toFixed(3)+" s"),l.nextLoadLevel=P,this.bwEstimator.sample(b,E.loaded),this.clearTimer(),s.loader&&(this.fragCurrent=this.partCurrent=null,s.loader.abort()),l.trigger(a.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:s,part:d,stats:E})}}}}}},g.onFragLoaded=function(s,d){var l=d.frag,h=d.part;if(l.type===S.PlaylistLevelType.MAIN&&Object(n.isFiniteNumber)(l.sn)){var m=h?h.stats:l.stats,f=h?h.duration:l.duration;if(this.clearTimer(),this.lastLoadedFragLevel=l.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var E=this.hls.levels[l.level],D=(E.loaded?E.loaded.bytes:0)+m.loaded,b=(E.loaded?E.loaded.duration:0)+f;E.loaded={bytes:D,duration:b},E.realBitrate=Math.round(8*D/b)}if(l.bitrateTest){var L={stats:m,frag:l,part:h,id:l.type};this.onFragBuffered(a.Events.FRAG_BUFFERED,L),l.bitrateTest=!1}}},g.onFragBuffered=function(s,d){var l=d.frag,h=d.part,m=h?h.stats:l.stats;if(!m.aborted&&l.type===S.PlaylistLevelType.MAIN&&l.sn!=="initSegment"){var f=m.parsing.end-m.loading.start;this.bwEstimator.sample(f,m.loaded),m.bwEstimate=this.bwEstimator.getEstimate(),l.bitrateTest?this.bitrateTestDelay=f/1e3:this.bitrateTestDelay=0}},g.onError=function(s,d){switch(d.details){case _.ErrorDetails.FRAG_LOAD_ERROR:case _.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},g.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},g.getNextABRAutoLevel=function(){var s=this.fragCurrent,d=this.partCurrent,l=this.hls,h=l.maxAutoLevel,m=l.config,f=l.minAutoLevel,E=l.media,D=d?d.duration:s?s.duration:0,b=E?E.currentTime:0,L=E&&E.playbackRate!==0?Math.abs(E.playbackRate):1,u=this.bwEstimator?this.bwEstimator.getEstimate():m.abrEwmaDefaultEstimate,c=(v.BufferHelper.bufferInfo(E,b,m.maxBufferHole).end-b)/L,p=this.findBestLevel(u,f,h,c,m.abrBandWidthFactor,m.abrBandWidthUpFactor);if(p>=0)return p;o.logger.trace((c?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var C=D?Math.min(D,m.maxStarvationDelay):m.maxStarvationDelay,I=m.abrBandWidthFactor,w=m.abrBandWidthUpFactor;if(!c){var O=this.bitrateTestDelay;O&&(C=(D?Math.min(D,m.maxLoadingDelay):m.maxLoadingDelay)-O,o.logger.trace("bitrate test took "+Math.round(1e3*O)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*C)+" ms"),I=w=1)}return p=this.findBestLevel(u,f,h,c+C,I,w),Math.max(p,0)},g.findBestLevel=function(s,d,l,h,m,f){for(var E,D=this.fragCurrent,b=this.partCurrent,L=this.lastLoadedFragLevel,u=this.hls.levels,c=u[L],p=!(c==null||(E=c.details)===null||E===void 0||!E.live),C=c==null?void 0:c.codecSet,I=b?b.duration:D?D.duration:0,w=l;w>=d;w--){var O=u[w];if(O&&(!C||O.codecSet===C)){var x=O.details,P=(b?x==null?void 0:x.partTarget:x==null?void 0:x.averagetargetduration)||I,F=void 0;F=w<=L?m*s:f*s;var M=u[w].maxBitrate,U=M*P/F;if(o.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+w+"/"+Math.round(F)+"/"+M+"/"+P+"/"+h+"/"+U),F>M&&(!U||p&&!this.bitrateTestDelay||U<h))return w}}return-1},R=y,(k=[{key:"nextAutoLevel",get:function(){var s=this._nextAutoLevel,d=this.bwEstimator;if(!(s===-1||d&&d.canEstimate()))return s;var l=this.getNextABRAutoLevel();return s!==-1&&(l=Math.min(s,l)),l},set:function(s){this._nextAutoLevel=s}}])&&A(R.prototype,k),y}();t.default=T},"./src/controller/audio-stream-controller.ts":function(e,t,r){r.r(t);var n=r("./src/polyfills/number.ts"),i=r("./src/controller/base-stream-controller.ts"),a=r("./src/events.ts"),v=r("./src/utils/buffer-helper.ts"),_=r("./src/controller/fragment-tracker.ts"),S=r("./src/types/level.ts"),o=r("./src/types/loader.ts"),A=r("./src/loader/fragment.ts"),T=r("./src/demux/chunk-cache.ts"),y=r("./src/demux/transmuxer-interface.ts"),R=r("./src/types/transmuxer.ts"),k=r("./src/controller/fragment-finders.ts"),g=r("./src/utils/discontinuities.ts"),s=r("./src/errors.ts"),d=r("./src/utils/logger.ts");function l(){return(l=Object.assign||function(f){for(var E=1;E<arguments.length;E++){var D=arguments[E];for(var b in D)Object.prototype.hasOwnProperty.call(D,b)&&(f[b]=D[b])}return f}).apply(this,arguments)}function h(f,E){return(h=Object.setPrototypeOf||function(D,b){return D.__proto__=b,D})(f,E)}var m=function(f){var E,D;function b(u,c){var p;return(p=f.call(this,u,c,"[audio-stream-controller]")||this).videoBuffer=null,p.videoTrackCC=-1,p.waitingVideoCC=-1,p.audioSwitch=!1,p.trackId=-1,p.waitingData=null,p.mainDetails=null,p.bufferFlushed=!1,p._registerListeners(),p}D=f,(E=b).prototype=Object.create(D.prototype),E.prototype.constructor=E,h(E,D);var L=b.prototype;return L.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},L._registerListeners=function(){var u=this.hls;u.on(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),u.on(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this),u.on(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.on(a.Events.LEVEL_LOADED,this.onLevelLoaded,this),u.on(a.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),u.on(a.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),u.on(a.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),u.on(a.Events.ERROR,this.onError,this),u.on(a.Events.BUFFER_RESET,this.onBufferReset,this),u.on(a.Events.BUFFER_CREATED,this.onBufferCreated,this),u.on(a.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),u.on(a.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),u.on(a.Events.FRAG_BUFFERED,this.onFragBuffered,this)},L._unregisterListeners=function(){var u=this.hls;u.off(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),u.off(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this),u.off(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.off(a.Events.LEVEL_LOADED,this.onLevelLoaded,this),u.off(a.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),u.off(a.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),u.off(a.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),u.off(a.Events.ERROR,this.onError,this),u.off(a.Events.BUFFER_RESET,this.onBufferReset,this),u.off(a.Events.BUFFER_CREATED,this.onBufferCreated,this),u.off(a.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),u.off(a.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),u.off(a.Events.FRAG_BUFFERED,this.onFragBuffered,this)},L.onInitPtsFound=function(u,c){var p=c.frag,C=c.id,I=c.initPTS;if(C==="main"){var w=p.cc;this.initPTS[p.cc]=I,this.log("InitPTS for cc: "+w+" found from main: "+I),this.videoTrackCC=w,this.state===i.State.WAITING_INIT_PTS&&this.tick()}},L.startLoad=function(u){if(!this.levels)return this.startPosition=u,void(this.state=i.State.STOPPED);var c=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,c>0&&u===-1?(this.log("Override startPosition with lastCurrentTime @"+c.toFixed(3)),this.state=i.State.IDLE):(this.loadedmetadata=!1,this.state=i.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=u,this.tick()},L.doTick=function(){switch(this.state){case i.State.IDLE:this.doTickIdle();break;case i.State.WAITING_TRACK:var u,c=this.levels,p=this.trackId,C=c==null||(u=c[p])===null||u===void 0?void 0:u.details;if(C){if(this.waitForCdnTuneIn(C))break;this.state=i.State.WAITING_INIT_PTS}break;case i.State.FRAG_LOADING_WAITING_RETRY:var I,w=performance.now(),O=this.retryDate;(!O||w>=O||(I=this.media)!==null&&I!==void 0&&I.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=i.State.IDLE);break;case i.State.WAITING_INIT_PTS:var x=this.waitingData;if(x){var P=x.frag,F=x.part,M=x.cache,U=x.complete;if(this.initPTS[P.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=i.State.FRAG_LOADING;var G={frag:P,part:F,payload:M.flush(),networkDetails:null};this._handleFragmentLoadProgress(G),U&&f.prototype._handleFragmentLoadComplete.call(this,G)}else if(this.videoTrackCC!==this.waitingVideoCC)d.logger.log("Waiting fragment cc ("+P.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var K=this.getLoadPosition(),q=v.BufferHelper.bufferInfo(this.mediaBuffer,K,this.config.maxBufferHole);Object(k.fragmentWithinToleranceTest)(q.end,this.config.maxFragLookUpTolerance,P)<0&&(d.logger.log("Waiting fragment cc ("+P.cc+") @ "+P.start+" cancelled because another fragment at "+q.end+" is needed"),this.clearWaitingFragment())}}else this.state=i.State.IDLE}this.onTickEnd()},L.clearWaitingFragment=function(){var u=this.waitingData;u&&(this.fragmentTracker.removeFragment(u.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=i.State.IDLE)},L.onTickEnd=function(){var u=this.media;if(u&&u.readyState){var c=(this.mediaBuffer?this.mediaBuffer:u).buffered;!this.loadedmetadata&&c.length&&(this.loadedmetadata=!0),this.lastCurrentTime=u.currentTime}},L.doTickIdle=function(){var u,c,p=this.hls,C=this.levels,I=this.media,w=this.trackId,O=p.config;if(C&&C[w]&&(I||!this.startFragRequested&&O.startFragPrefetch)){var x=C[w].details;if(!x||x.live&&this.levelLastLoaded!==w||this.waitForCdnTuneIn(x))this.state=i.State.WAITING_TRACK;else{this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,A.ElementaryStreamTypes.AUDIO,o.PlaylistLevelType.AUDIO));var P=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,o.PlaylistLevelType.AUDIO);if(P!==null){var F=P.len,M=this.getMaxBufferLength(),U=this.audioSwitch;if(!(F>=M)||U){if(!U&&this._streamEnded(P,x))return p.trigger(a.Events.BUFFER_EOS,{type:"audio"}),void(this.state=i.State.ENDED);var G=x.fragments[0].start,K=P.end;if(U){var q=this.getLoadPosition();K=q,x.PTSKnown&&q<G&&(P.end>G||P.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),I.currentTime=G+.05)}var Z=this.getNextFragment(K,x);Z?((u=Z.decryptdata)===null||u===void 0?void 0:u.keyFormat)!=="identity"||(c=Z.decryptdata)!==null&&c!==void 0&&c.key?this.loadFragment(Z,x,K):this.loadKey(Z,x):this.bufferFlushed=!0}}}}},L.getMaxBufferLength=function(){var u=f.prototype.getMaxBufferLength.call(this),c=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,o.PlaylistLevelType.MAIN);return c===null?u:Math.max(u,c.len)},L.onMediaDetaching=function(){this.videoBuffer=null,f.prototype.onMediaDetaching.call(this)},L.onAudioTracksUpdated=function(u,c){var p=c.audioTracks;this.resetTransmuxer(),this.levels=p.map(function(C){return new S.Level(C)})},L.onAudioTrackSwitching=function(u,c){var p=!!c.url;this.trackId=c.id;var C=this.fragCurrent;C!=null&&C.loader&&C.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),p?this.setInterval(100):this.resetTransmuxer(),p?(this.audioSwitch=!0,this.state=i.State.IDLE):this.state=i.State.STOPPED,this.tick()},L.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},L.onLevelLoaded=function(u,c){this.mainDetails=c.details},L.onAudioTrackLoaded=function(u,c){var p,C=this.levels,I=c.details,w=c.id;if(C){this.log("Track "+w+" loaded ["+I.startSN+","+I.endSN+"],duration:"+I.totalduration);var O=C[w],x=0;if(I.live||(p=O.details)!==null&&p!==void 0&&p.live){var P=this.mainDetails;if(I.fragments[0]||(I.deltaUpdateFailed=!0),I.deltaUpdateFailed||!P)return;!O.details&&I.hasProgramDateTime&&P.hasProgramDateTime?(Object(g.alignPDT)(I,P),x=I.fragments[0].start):x=this.alignPlaylists(I,O.details)}O.details=I,this.levelLastLoaded=w,this.startFragRequested||!this.mainDetails&&I.live||this.setStartPosition(O.details,x),this.state!==i.State.WAITING_TRACK||this.waitForCdnTuneIn(I)||(this.state=i.State.IDLE),this.tick()}else this.warn("Audio tracks were reset while loading level "+w)},L._handleFragmentLoadProgress=function(u){var c,p=u.frag,C=u.part,I=u.payload,w=this.config,O=this.trackId,x=this.levels;if(x){var P=x[O];console.assert(P,"Audio track is defined on fragment load progress");var F=P.details;console.assert(F,"Audio track details are defined on fragment load progress");var M=w.defaultAudioCodec||P.audioCodec||"mp4a.40.2",U=this.transmuxer;U||(U=this.transmuxer=new y.default(this.hls,o.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var G=this.initPTS[p.cc],K=(c=p.initSegment)===null||c===void 0?void 0:c.data;if(G!==void 0){var q=C?C.index:-1,Z=q!==-1,ee=new R.ChunkMetadata(p.level,p.sn,p.stats.chunkCount,I.byteLength,q,Z);U.push(I,K,M,"",p,C,F.totalduration,!1,ee,G)}else d.logger.log("Unknown video PTS for cc "+p.cc+", waiting for video PTS before demuxing audio frag "+p.sn+" of ["+F.startSN+" ,"+F.endSN+"],track "+O),(this.waitingData=this.waitingData||{frag:p,part:C,cache:new T.default,complete:!1}).cache.push(new Uint8Array(I)),this.waitingVideoCC=this.videoTrackCC,this.state=i.State.WAITING_INIT_PTS}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+p.sn+" of level "+p.level+" will not be buffered")},L._handleFragmentLoadComplete=function(u){this.waitingData?this.waitingData.complete=!0:f.prototype._handleFragmentLoadComplete.call(this,u)},L.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},L.onBufferCreated=function(u,c){var p=c.tracks.audio;p&&(this.mediaBuffer=p.buffer),c.tracks.video&&(this.videoBuffer=c.tracks.video.buffer)},L.onFragBuffered=function(u,c){var p=c.frag,C=c.part;p.type===o.PlaylistLevelType.AUDIO&&(this.fragContextChanged(p)?this.warn("Fragment "+p.sn+(C?" p: "+C.index:"")+" of level "+p.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch):(p.sn!=="initSegment"&&(this.fragPrevious=p,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(a.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(p,C)))},L.onError=function(u,c){switch(c.details){case s.ErrorDetails.FRAG_LOAD_ERROR:case s.ErrorDetails.FRAG_LOAD_TIMEOUT:case s.ErrorDetails.KEY_LOAD_ERROR:case s.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(o.PlaylistLevelType.AUDIO,c);break;case s.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case s.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==i.State.ERROR&&this.state!==i.State.STOPPED&&(this.state=c.fatal?i.State.ERROR:i.State.IDLE,this.warn(c.details+" while loading frag, switching to "+this.state+" state"));break;case s.ErrorDetails.BUFFER_FULL_ERROR:if(c.parent==="audio"&&(this.state===i.State.PARSING||this.state===i.State.PARSED)){var p=!0,C=this.getFwdBufferInfo(this.mediaBuffer,o.PlaylistLevelType.AUDIO);C&&C.len>.5&&(p=!this.reduceMaxBufferLength(C.len)),p&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,f.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}}},L.onBufferFlushed=function(u,c){c.type===A.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},L._handleTransmuxComplete=function(u){var c,p="audio",C=this.hls,I=u.remuxResult,w=u.chunkMeta,O=this.getCurrentContext(w);if(!O)return this.warn("The loading context changed while buffering fragment "+w.sn+" of level "+w.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(w.level);var x=O.frag,P=O.part,F=I.audio,M=I.text,U=I.id3,G=I.initSegment;if(!this.fragContextChanged(x)){if(this.state=i.State.PARSING,this.audioSwitch&&F&&this.completeAudioSwitch(),G!=null&&G.tracks&&(this._bufferInitSegment(G.tracks,x,w),C.trigger(a.Events.FRAG_PARSING_INIT_SEGMENT,{frag:x,id:p,tracks:G.tracks})),F){var K=F.startPTS,q=F.endPTS,Z=F.startDTS,ee=F.endDTS;P&&(P.elementaryStreams[A.ElementaryStreamTypes.AUDIO]={startPTS:K,endPTS:q,startDTS:Z,endDTS:ee}),x.setElementaryStreamInfo(A.ElementaryStreamTypes.AUDIO,K,q,Z,ee),this.bufferFragmentData(F,x,P,w)}if(U!=null&&(c=U.samples)!==null&&c!==void 0&&c.length){var se=l({frag:x,id:p},U);C.trigger(a.Events.FRAG_PARSING_METADATA,se)}if(M){var ne=l({frag:x,id:p},M);C.trigger(a.Events.FRAG_PARSING_USERDATA,ne)}}},L._bufferInitSegment=function(u,c,p){if(this.state===i.State.PARSING){u.video&&delete u.video;var C=u.audio;if(C){C.levelCodec=C.codec,C.id="audio",this.log("Init audio buffer, container:"+C.container+", codecs[parsed]=["+C.codec+"]"),this.hls.trigger(a.Events.BUFFER_CODECS,u);var I=C.initSegment;if(I!=null&&I.byteLength){var w={type:"audio",frag:c,part:null,chunkMeta:p,parent:c.type,data:I};this.hls.trigger(a.Events.BUFFER_APPENDING,w)}this.tick()}}},L.loadFragment=function(u,c,p){var C=this.fragmentTracker.getState(u);this.fragCurrent=u,(this.audioSwitch||C===_.FragmentState.NOT_LOADED||C===_.FragmentState.PARTIAL)&&(u.sn==="initSegment"?this._loadInitSegment(u):c.live&&!Object(n.isFiniteNumber)(this.initPTS[u.cc])?(this.log("Waiting for video PTS in continuity counter "+u.cc+" of live stream before loading audio fragment "+u.sn+" of level "+this.trackId),this.state=i.State.WAITING_INIT_PTS):(this.startFragRequested=!0,f.prototype.loadFragment.call(this,u,c,p)))},L.completeAudioSwitch=function(){var u=this.hls,c=this.media,p=this.trackId;c&&(this.log("Switching audio track : flushing all audio"),f.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,u.trigger(a.Events.AUDIO_TRACK_SWITCHED,{id:p})},b}(i.default);t.default=m},"./src/controller/audio-track-controller.ts":function(e,t,r){r.r(t);var n=r("./src/events.ts"),i=r("./src/errors.ts"),a=r("./src/controller/base-playlist-controller.ts"),v=r("./src/types/loader.ts");function _(A,T){for(var y=0;y<T.length;y++){var R=T[y];R.enumerable=R.enumerable||!1,R.configurable=!0,"value"in R&&(R.writable=!0),Object.defineProperty(A,R.key,R)}}function S(A,T){return(S=Object.setPrototypeOf||function(y,R){return y.__proto__=R,y})(A,T)}var o=function(A){var T,y;function R(d){var l;return(l=A.call(this,d,"[audio-track-controller]")||this).tracks=[],l.groupId=null,l.tracksInGroup=[],l.trackId=-1,l.trackName="",l.selectDefaultTrack=!0,l.registerListeners(),l}y=A,(T=R).prototype=Object.create(y.prototype),T.prototype.constructor=T,S(T,y);var k,g,s=R.prototype;return s.registerListeners=function(){var d=this.hls;d.on(n.Events.MANIFEST_LOADING,this.onManifestLoading,this),d.on(n.Events.MANIFEST_PARSED,this.onManifestParsed,this),d.on(n.Events.LEVEL_LOADING,this.onLevelLoading,this),d.on(n.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),d.on(n.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),d.on(n.Events.ERROR,this.onError,this)},s.unregisterListeners=function(){var d=this.hls;d.off(n.Events.MANIFEST_LOADING,this.onManifestLoading,this),d.off(n.Events.MANIFEST_PARSED,this.onManifestParsed,this),d.off(n.Events.LEVEL_LOADING,this.onLevelLoading,this),d.off(n.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),d.off(n.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),d.off(n.Events.ERROR,this.onError,this)},s.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,A.prototype.destroy.call(this)},s.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},s.onManifestParsed=function(d,l){this.tracks=l.audioTracks||[]},s.onAudioTrackLoaded=function(d,l){var h=l.id,m=l.details,f=this.tracksInGroup[h];if(f){var E=f.details;f.details=l.details,this.log("audioTrack "+h+" loaded ["+m.startSN+"-"+m.endSN+"]"),h===this.trackId&&(this.retryCount=0,this.playlistLoaded(h,l,E))}else this.warn("Invalid audio track id "+h)},s.onLevelLoading=function(d,l){this.switchLevel(l.level)},s.onLevelSwitching=function(d,l){this.switchLevel(l.level)},s.switchLevel=function(d){var l=this.hls.levels[d];if(l!=null&&l.audioGroupIds){var h=l.audioGroupIds[l.urlId];if(this.groupId!==h){this.groupId=h;var m=this.tracks.filter(function(E){return!h||E.groupId===h});this.selectDefaultTrack&&!m.some(function(E){return E.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=m;var f={audioTracks:m};this.log("Updating audio tracks, "+m.length+' track(s) found in "'+h+'" group-id'),this.hls.trigger(n.Events.AUDIO_TRACKS_UPDATED,f),this.selectInitialTrack()}}},s.onError=function(d,l){A.prototype.onError.call(this,d,l),!l.fatal&&l.context&&l.context.type===v.PlaylistContextType.AUDIO_TRACK&&l.context.id===this.trackId&&l.context.groupId===this.groupId&&this.retryLoadingOrFail(l)},s.setAudioTrack=function(d){var l=this.tracksInGroup;if(d<0||d>=l.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var h=l[this.trackId];this.log("Now switching to audio-track index "+d);var m=l[d],f=m.id,E=m.groupId,D=E===void 0?"":E,b=m.name,L=m.type,u=m.url;if(this.trackId=d,this.trackName=b,this.selectDefaultTrack=!1,this.hls.trigger(n.Events.AUDIO_TRACK_SWITCHING,{id:f,groupId:D,name:b,type:L,url:u}),!m.details||m.details.live){var c=this.switchParams(m.url,h==null?void 0:h.details);this.loadPlaylist(c)}}},s.selectInitialTrack=function(){var d=this.tracksInGroup;console.assert(d.length,"Initial audio track should be selected when tracks are known");var l=this.trackName,h=this.findTrackId(l)||this.findTrackId();h!==-1?this.setAudioTrack(h):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(n.Events.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},s.findTrackId=function(d){for(var l=this.tracksInGroup,h=0;h<l.length;h++){var m=l[h];if((!this.selectDefaultTrack||m.default)&&(!d||d===m.name))return m.id}return-1},s.loadPlaylist=function(d){var l=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(l)){var h=l.id,m=l.groupId,f=l.url;if(d)try{f=d.addDirectives(f)}catch(E){this.warn("Could not construct new URL with HLS Delivery Directives: "+E)}this.log("loading audio-track playlist for id: "+h),this.clearTimer(),this.hls.trigger(n.Events.AUDIO_TRACK_LOADING,{url:f,id:h,groupId:m,deliveryDirectives:d||null})}},k=R,(g=[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(d){this.selectDefaultTrack=!1,this.setAudioTrack(d)}}])&&_(k.prototype,g),R}(a.default);t.default=o},"./src/controller/base-playlist-controller.ts":function(e,t,r){r.r(t),r.d(t,"default",function(){return S});var n=r("./src/polyfills/number.ts"),i=r("./src/types/level.ts"),a=r("./src/controller/level-helper.ts"),v=r("./src/utils/logger.ts"),_=r("./src/errors.ts"),S=function(){function o(T,y){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=v.logger.log.bind(v.logger,y+":"),this.warn=v.logger.warn.bind(v.logger,y+":"),this.hls=T}var A=o.prototype;return A.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},A.onError=function(T,y){y.fatal&&y.type===_.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},A.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},A.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},A.stopLoad=function(){this.canLoad=!1,this.clearTimer()},A.switchParams=function(T,y){var R=y==null?void 0:y.renditionReports;if(R)for(var k=0;k<R.length;k++){var g=R[k],s=""+g.URI;if(s===T.substr(-s.length)){var d=parseInt(g["LAST-MSN"]),l=parseInt(g["LAST-PART"]);if(y&&this.hls.config.lowLatencyMode){var h=Math.min(y.age-y.partTarget,y.targetduration);l!==void 0&&h>y.partTarget&&(l+=1)}if(Object(n.isFiniteNumber)(d))return new i.HlsUrlParameters(d,Object(n.isFiniteNumber)(l)?l:void 0,i.HlsSkip.No)}}},A.loadPlaylist=function(T){},A.shouldLoadTrack=function(T){return this.canLoad&&T&&!!T.url&&(!T.details||T.details.live)},A.playlistLoaded=function(T,y,R){var k=this,g=y.details,s=y.stats,d=s.loading.end?Math.max(0,self.performance.now()-s.loading.end):0;if(g.advancedDateTime=Date.now()-d,g.live||R!=null&&R.live){if(g.reloaded(R),R&&this.log("live playlist "+T+" "+(g.advanced?"REFRESHED "+g.lastPartSn+"-"+g.lastPartIndex:"MISSED")),R&&g.fragments.length>0&&Object(a.mergeDetails)(R,g),!this.canLoad||!g.live)return;var l,h=void 0,m=void 0;if(g.canBlockReload&&g.endSN&&g.advanced){var f=this.hls.config.lowLatencyMode,E=g.lastPartSn,D=g.endSN,b=g.lastPartIndex,L=E===D;b!==-1?(h=L?D+1:E,m=L?f?0:b:b+1):h=D+1;var u=g.age,c=u+g.ageHeader,p=Math.min(c-g.partTarget,1.5*g.targetduration);if(p>0){if(R&&p>R.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+R.tuneInGoal+" to: "+p+" with playlist age: "+g.age),p=0;else{var C=Math.floor(p/g.targetduration);h+=C,m!==void 0&&(m+=Math.round(p%g.targetduration/g.partTarget)),this.log("CDN Tune-in age: "+g.ageHeader+"s last advanced "+u.toFixed(2)+"s goal: "+p+" skip sn "+C+" to part "+m)}g.tuneInGoal=p}if(l=this.getDeliveryDirectives(g,y.deliveryDirectives,h,m),f||!L)return void this.loadPlaylist(l)}else l=this.getDeliveryDirectives(g,y.deliveryDirectives,h,m);var I=Object(a.computeReloadInterval)(g,s);h!==void 0&&g.canBlockReload&&(I-=g.partTarget||1),this.log("reload live playlist "+T+" in "+Math.round(I)+" ms"),this.timer=self.setTimeout(function(){return k.loadPlaylist(l)},I)}else this.clearTimer()},A.getDeliveryDirectives=function(T,y,R,k){var g=Object(i.getSkipValue)(T,R);return y!=null&&y.skip&&T.deltaUpdateFailed&&(R=y.msn,k=y.part,g=i.HlsSkip.No),new i.HlsUrlParameters(R,k,g)},A.retryLoadingOrFail=function(T){var y,R=this,k=this.hls.config,g=this.retryCount<k.levelLoadingMaxRetry;if(g)if(this.retryCount++,T.details.indexOf("LoadTimeOut")>-1&&(y=T.context)!==null&&y!==void 0&&y.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+T.details+'"'),this.loadPlaylist();else{var s=Math.min(Math.pow(2,this.retryCount)*k.levelLoadingRetryDelay,k.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return R.loadPlaylist()},s),this.warn("retry playlist loading #"+this.retryCount+" in "+s+' ms after "'+T.details+'"')}else this.warn('cannot recover from error "'+T.details+'"'),this.clearTimer(),T.fatal=!0;return g},o}()},"./src/controller/base-stream-controller.ts":function(e,t,r){r.r(t),r.d(t,"State",function(){return f}),r.d(t,"default",function(){return E});var n=r("./src/polyfills/number.ts"),i=r("./src/task-loop.ts"),a=r("./src/controller/fragment-tracker.ts"),v=r("./src/utils/buffer-helper.ts"),_=r("./src/utils/logger.ts"),S=r("./src/events.ts"),o=r("./src/errors.ts"),A=r("./src/types/transmuxer.ts"),T=r("./src/utils/mp4-tools.ts"),y=r("./src/utils/discontinuities.ts"),R=r("./src/controller/fragment-finders.ts"),k=r("./src/controller/level-helper.ts"),g=r("./src/loader/fragment-loader.ts"),s=r("./src/crypt/decrypter.ts"),d=r("./src/utils/time-ranges.ts"),l=r("./src/types/loader.ts");function h(D,b){for(var L=0;L<b.length;L++){var u=b[L];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(D,u.key,u)}}function m(D,b){return(m=Object.setPrototypeOf||function(L,u){return L.__proto__=u,L})(D,b)}var f={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BACKTRACKING:"BACKTRACKING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},E=function(D){var b,L;function u(I,w,O){var x;return(x=D.call(this)||this).hls=void 0,x.fragPrevious=null,x.fragCurrent=null,x.fragmentTracker=void 0,x.transmuxer=null,x._state=f.STOPPED,x.media=void 0,x.mediaBuffer=void 0,x.config=void 0,x.bitrateTest=!1,x.lastCurrentTime=0,x.nextLoadPosition=0,x.startPosition=0,x.loadedmetadata=!1,x.fragLoadError=0,x.retryDate=0,x.levels=null,x.fragmentLoader=void 0,x.levelLastLoaded=null,x.startFragRequested=!1,x.decrypter=void 0,x.initPTS=[],x.onvseeking=null,x.onvended=null,x.logPrefix="",x.log=void 0,x.warn=void 0,x.logPrefix=O,x.log=_.logger.log.bind(_.logger,O+":"),x.warn=_.logger.warn.bind(_.logger,O+":"),x.hls=I,x.fragmentLoader=new g.default(I.config),x.fragmentTracker=w,x.config=I.config,x.decrypter=new s.default(I,I.config),I.on(S.Events.KEY_LOADED,x.onKeyLoaded,function(P){if(P===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return P}(x)),x}L=D,(b=u).prototype=Object.create(L.prototype),b.prototype.constructor=b,m(b,L);var c,p,C=u.prototype;return C.doTick=function(){this.onTickEnd()},C.onTickEnd=function(){},C.startLoad=function(I){},C.stopLoad=function(){this.fragmentLoader.abort();var I=this.fragCurrent;I&&this.fragmentTracker.removeFragment(I),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=f.STOPPED},C._streamEnded=function(I,w){var O=this.fragCurrent,x=this.fragmentTracker;if(!w.live&&O&&O.sn===w.endSN&&!I.nextStart){var P=x.getState(O);return P===a.FragmentState.PARTIAL||P===a.FragmentState.OK}return!1},C.onMediaAttached=function(I,w){var O=this.media=this.mediaBuffer=w.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),O.addEventListener("seeking",this.onvseeking),O.addEventListener("ended",this.onvended);var x=this.config;this.levels&&x.autoStartLoad&&this.state===f.STOPPED&&this.startLoad(x.startPosition)},C.onMediaDetaching=function(){var I=this.media;I!=null&&I.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),I&&(I.removeEventListener("seeking",this.onvseeking),I.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},C.onMediaSeeking=function(){var I=this.config,w=this.fragCurrent,O=this.media,x=this.mediaBuffer,P=this.state,F=O?O.currentTime:0,M=v.BufferHelper.bufferInfo(x||O,F,I.maxBufferHole);if(this.log("media seeking to "+(Object(n.isFiniteNumber)(F)?F.toFixed(3):F)+", state: "+P),P===f.ENDED)this.resetLoadingState();else if(w&&!M.len){var U=I.maxFragLookUpTolerance,G=w.start-U,K=F>w.start+w.duration+U;(F<G||K)&&(K&&w.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),w.loader.abort()),this.resetLoadingState())}O&&(this.lastCurrentTime=F),this.loadedmetadata||M.len||(this.nextLoadPosition=this.startPosition=F),this.tickImmediate()},C.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},C.onKeyLoaded=function(I,w){if(this.state===f.KEY_LOADING&&w.frag===this.fragCurrent&&this.levels){this.state=f.IDLE;var O=this.levels[w.frag.level].details;O&&this.loadFragment(w.frag,O,w.frag.start)}},C.onHandlerDestroying=function(){this.stopLoad(),D.prototype.onHandlerDestroying.call(this)},C.onHandlerDestroyed=function(){this.state=f.STOPPED,this.hls.off(S.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,D.prototype.onHandlerDestroyed.call(this)},C.loadKey=function(I,w){this.log("Loading key for "+I.sn+" of ["+w.startSN+"-"+w.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+I.level),this.state=f.KEY_LOADING,this.fragCurrent=I,this.hls.trigger(S.Events.KEY_LOADING,{frag:I})},C.loadFragment=function(I,w,O){this._loadFragForPlayback(I,w,O)},C._loadFragForPlayback=function(I,w,O){var x=this;this._doFragLoad(I,w,O,function(P){if(x.fragContextChanged(I))return x.warn("Fragment "+I.sn+(P.part?" p: "+P.part.index:"")+" of level "+I.level+" was dropped during download."),void x.fragmentTracker.removeFragment(I);I.stats.chunkCount++,x._handleFragmentLoadProgress(P)}).then(function(P){if(P){x.fragLoadError=0;var F=x.state;if(!x.fragContextChanged(I))return"payload"in P&&(x.log("Loaded fragment "+I.sn+" of level "+I.level),x.hls.trigger(S.Events.FRAG_LOADED,P),x.state===f.BACKTRACKING)?(x.fragmentTracker.backtrack(I,P),void x.resetFragmentLoading(I)):void x._handleFragmentLoadComplete(P);(F===f.FRAG_LOADING||F===f.BACKTRACKING||!x.fragCurrent&&F===f.PARSING)&&(x.fragmentTracker.removeFragment(I),x.state=f.IDLE)}}).catch(function(P){x.warn(P),x.resetFragmentLoading(I)})},C.flushMainBuffer=function(I,w,O){if(O===void 0&&(O=null),I-w){var x={startOffset:I,endOffset:w,type:O};this.fragLoadError=0,this.hls.trigger(S.Events.BUFFER_FLUSHING,x)}},C._loadInitSegment=function(I){var w=this;this._doFragLoad(I).then(function(O){if(!O||w.fragContextChanged(I)||!w.levels)throw new Error("init load aborted");return O}).then(function(O){var x=w.hls,P=O.payload,F=I.decryptdata;if(P&&P.byteLength>0&&F&&F.key&&F.iv&&F.method==="AES-128"){var M=self.performance.now();return w.decrypter.webCryptoDecrypt(new Uint8Array(P),F.key.buffer,F.iv.buffer).then(function(U){var G=self.performance.now();return x.trigger(S.Events.FRAG_DECRYPTED,{frag:I,payload:U,stats:{tstart:M,tdecrypt:G}}),O.payload=U,O})}return O}).then(function(O){var x=w.fragCurrent,P=w.hls,F=w.levels;if(!F)throw new Error("init load aborted, missing levels");var M=F[I.level].details;console.assert(M,"Level details are defined when init segment is loaded");var U=I.stats;w.state=f.IDLE,w.fragLoadError=0,I.data=new Uint8Array(O.payload),U.parsing.start=U.buffering.start=self.performance.now(),U.parsing.end=U.buffering.end=self.performance.now(),O.frag===x&&P.trigger(S.Events.FRAG_BUFFERED,{stats:U,frag:x,part:null,id:I.type}),w.tick()}).catch(function(O){w.warn(O),w.resetFragmentLoading(I)})},C.fragContextChanged=function(I){var w=this.fragCurrent;return!I||!w||I.level!==w.level||I.sn!==w.sn||I.urlId!==w.urlId},C.fragBufferedComplete=function(I,w){var O=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+I.type+" sn: "+I.sn+(w?" part: "+w.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+I.level+" "+d.default.toString(v.BufferHelper.getBuffered(O))),this.state=f.IDLE,this.tick()},C._handleFragmentLoadComplete=function(I){var w=this.transmuxer;if(w){var O=I.frag,x=I.part,P=I.partsLoaded,F=!P||P.length===0||P.some(function(U){return!U}),M=new A.ChunkMetadata(O.level,O.sn,O.stats.chunkCount+1,0,x?x.index:-1,!F);w.flush(M)}},C._handleFragmentLoadProgress=function(I){},C._doFragLoad=function(I,w,O,x){var P=this;if(O===void 0&&(O=null),!this.levels)throw new Error("frag load aborted, missing levels");if(O=Math.max(I.start,O||0),this.config.lowLatencyMode&&w){var F=w.partList;if(F&&x){O>I.end&&w.fragmentHint&&(I=w.fragmentHint);var M=this.getNextPart(F,I,O);if(M>-1){var U=F[M];return this.log("Loading part sn: "+I.sn+" p: "+U.index+" cc: "+I.cc+" of playlist ["+w.startSN+"-"+w.endSN+"] parts [0-"+M+"-"+(F.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+I.level+", target: "+parseFloat(O.toFixed(3))),this.nextLoadPosition=U.start+U.duration,this.state=f.FRAG_LOADING,this.hls.trigger(S.Events.FRAG_LOADING,{frag:I,part:F[M],targetBufferTime:O}),this.doFragPartsLoad(I,F,M,x).catch(function(G){return P.handleFragLoadError(G)})}if(!I.url||this.loadedEndOfParts(F,O))return Promise.resolve(null)}}return this.log("Loading fragment "+I.sn+" cc: "+I.cc+" "+(w?"of ["+w.startSN+"-"+w.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+I.level+", target: "+parseFloat(O.toFixed(3))),Object(n.isFiniteNumber)(I.sn)&&!this.bitrateTest&&(this.nextLoadPosition=I.start+I.duration),this.state=f.FRAG_LOADING,this.hls.trigger(S.Events.FRAG_LOADING,{frag:I,targetBufferTime:O}),this.fragmentLoader.load(I,x).catch(function(G){return P.handleFragLoadError(G)})},C.doFragPartsLoad=function(I,w,O,x){var P=this;return new Promise(function(F,M){var U=[];(function G(K){var q=w[K];P.fragmentLoader.loadPart(I,q,x).then(function(Z){U[q.index]=Z;var ee=Z.part;P.hls.trigger(S.Events.FRAG_LOADED,Z);var se=w[K+1];if(!se||se.fragment!==I)return F({frag:I,part:ee,partsLoaded:U});G(K+1)}).catch(M)})(O)})},C.handleFragLoadError=function(I){var w=I.data;return w&&w.details===o.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(w.frag,w.part):this.hls.trigger(S.Events.ERROR,w),null},C._handleTransmuxerFlush=function(I){var w=this.getCurrentContext(I);if(w&&this.state===f.PARSING){var O=w.frag,x=w.part,P=w.level,F=self.performance.now();O.stats.parsing.end=F,x&&(x.stats.parsing.end=F),this.updateLevelTiming(O,x,P,I.partial)}else this.fragCurrent||(this.state=f.IDLE)},C.getCurrentContext=function(I){var w=this.levels,O=I.level,x=I.sn,P=I.part;if(!w||!w[O])return this.warn("Levels object was unset while buffering fragment "+x+" of level "+O+". The current chunk will not be buffered."),null;var F=w[O],M=P>-1?Object(k.getPartWith)(F,x,P):null,U=M?M.fragment:Object(k.getFragmentWithSN)(F,x,this.fragCurrent);return U?{frag:U,part:M,level:F}:null},C.bufferFragmentData=function(I,w,O,x){if(I&&this.state===f.PARSING){var P=I.data1,F=I.data2,M=P;if(P&&F&&(M=Object(T.appendUint8Array)(P,F)),M&&M.length){var U={type:I.type,frag:w,part:O,chunkMeta:x,parent:w.type,data:M};this.hls.trigger(S.Events.BUFFER_APPENDING,U),I.dropped&&I.independent&&!O&&this.flushBufferGap(w)}}},C.flushBufferGap=function(I){var w=this.media;if(w)if(v.BufferHelper.isBuffered(w,w.currentTime)){var O=w.currentTime,x=v.BufferHelper.bufferInfo(w,O,0),P=I.duration,F=Math.min(2*this.config.maxFragLookUpTolerance,.25*P),M=Math.max(Math.min(I.start-F,x.end-F),O+F);I.start-M>F&&this.flushMainBuffer(M,I.start)}else this.flushMainBuffer(0,I.start)},C.getFwdBufferInfo=function(I,w){var O=this.config,x=this.getLoadPosition();if(!Object(n.isFiniteNumber)(x))return null;var P=v.BufferHelper.bufferInfo(I,x,O.maxBufferHole);if(P.len===0&&P.nextStart!==void 0){var F=this.fragmentTracker.getBufferedFrag(x,w);if(F&&P.nextStart<F.end)return v.BufferHelper.bufferInfo(I,x,Math.max(P.nextStart,O.maxBufferHole))}return P},C.getMaxBufferLength=function(I){var w,O=this.config;return w=I?Math.max(8*O.maxBufferSize/I,O.maxBufferLength):O.maxBufferLength,Math.min(w,O.maxMaxBufferLength)},C.reduceMaxBufferLength=function(I){var w=this.config,O=I||w.maxBufferLength;return w.maxMaxBufferLength>=O&&(w.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+w.maxMaxBufferLength+"s"),!0)},C.getNextFragment=function(I,w){var O,x,P=w.fragments,F=P.length;if(!F)return null;var M,U=this.config,G=P[0].start;if(w.live){var K=U.initialLiveManifestSize;if(F<K)return this.warn("Not enough fragments to start playback (have: "+F+", need: "+K+")"),null;w.PTSKnown||this.startFragRequested||this.startPosition!==-1||(M=this.getInitialLiveFragment(w,P),this.startPosition=M?this.hls.liveSyncPosition||M.start:I)}else I<=G&&(M=P[0]);if(!M){var q=U.lowLatencyMode?w.partEnd:w.fragmentEnd;M=this.getFragmentAtPosition(I,q,w)}return(O=M)===null||O===void 0||!O.initSegment||(x=M)!==null&&x!==void 0&&x.initSegment.data||this.bitrateTest||(M=M.initSegment),M},C.getNextPart=function(I,w,O){for(var x=-1,P=!1,F=!0,M=0,U=I.length;M<U;M++){var G=I[M];if(F=F&&!G.independent,x>-1&&O<G.start)break;var K=G.loaded;!K&&(P||G.independent||F)&&G.fragment===w&&(x=M),P=K}return x},C.loadedEndOfParts=function(I,w){var O=I[I.length-1];return O&&w>O.start&&O.loaded},C.getInitialLiveFragment=function(I,w){var O=this.fragPrevious,x=null;if(O){if(I.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+O.programDateTime),x=Object(R.findFragmentByPDT)(w,O.endProgramDateTime,this.config.maxFragLookUpTolerance)),!x){var P=O.sn+1;if(P>=I.startSN&&P<=I.endSN){var F=w[P-I.startSN];O.cc===F.cc&&(x=F,this.log("Live playlist, switching playlist, load frag with next SN: "+x.sn))}x||(x=Object(R.findFragWithCC)(w,O.cc))&&this.log("Live playlist, switching playlist, load frag with same CC: "+x.sn)}}else{var M=this.hls.liveSyncPosition;M!==null&&(x=this.getFragmentAtPosition(M,this.bitrateTest?I.fragmentEnd:I.edge,I))}return x},C.getFragmentAtPosition=function(I,w,O){var x,P=this.config,F=this.fragPrevious,M=O.fragments,U=O.endSN,G=O.fragmentHint,K=P.maxFragLookUpTolerance,q=!!(P.lowLatencyMode&&O.partList&&G);if(q&&G&&!this.bitrateTest&&(M=M.concat(G),U=G.sn),I<w){var Z=I>w-K?0:K;x=Object(R.findFragmentByPTS)(F,M,I,Z)}else x=M[M.length-1];if(x){var ee=x.sn-O.startSN,se=F&&x.level===F.level,ne=M[ee+1];if(this.fragmentTracker.getState(x)===a.FragmentState.BACKTRACKED){x=null;for(var ae=ee;M[ae]&&this.fragmentTracker.getState(M[ae])===a.FragmentState.BACKTRACKED;)x=F?M[ae--]:M[--ae];x||(x=ne)}else F&&x.sn===F.sn&&!q&&se&&(x.sn<U&&this.fragmentTracker.getState(ne)!==a.FragmentState.OK?(this.log("SN "+x.sn+" just loaded, load next one: "+ne.sn),x=ne):x=null)}return x},C.synchronizeToLiveEdge=function(I){var w=this.config,O=this.media;if(O){var x=this.hls.liveSyncPosition,P=O.currentTime,F=I.fragments[0].start,M=I.edge,U=P>=F-w.maxFragLookUpTolerance&&P<=M;if(x!==null&&O.duration>x&&(P<x||!U)){var G=w.liveMaxLatencyDuration!==void 0?w.liveMaxLatencyDuration:w.liveMaxLatencyDurationCount*I.targetduration;(!U&&O.readyState<4||P<M-G)&&(this.loadedmetadata||(this.nextLoadPosition=x),O.readyState&&(this.warn("Playback: "+P.toFixed(3)+" is located too far from the end of live sliding playlist: "+M+", reset currentTime to : "+x.toFixed(3)),O.currentTime=x))}}},C.alignPlaylists=function(I,w){var O=this.levels,x=this.levelLastLoaded,P=this.fragPrevious,F=x!==null?O[x]:null,M=I.fragments.length;if(!M)return this.warn("No fragments in live playlist"),0;var U=I.fragments[0].start,G=!w,K=I.alignedSliding&&Object(n.isFiniteNumber)(U);if(G||!K&&!U){Object(y.alignStream)(P,F,I);var q=I.fragments[0].start;return this.log("Live playlist sliding: "+q.toFixed(2)+" start-sn: "+(w?w.startSN:"na")+"->"+I.startSN+" prev-sn: "+(P?P.sn:"na")+" fragments: "+M),q}return U},C.waitForCdnTuneIn=function(I){return I.live&&I.canBlockReload&&I.tuneInGoal>Math.max(I.partHoldBack,3*I.partTarget)},C.setStartPosition=function(I,w){var O=this.startPosition;if(O<w&&(O=-1),O===-1||this.lastCurrentTime===-1){var x=I.startTimeOffset;Object(n.isFiniteNumber)(x)?(O=w+x,x<0&&(O+=I.totalduration),O=Math.min(Math.max(w,O),w+I.totalduration),this.log("Start time offset "+x+" found in playlist, adjust startPosition to "+O),this.startPosition=O):I.live?O=this.hls.liveSyncPosition||w:this.startPosition=O=0,this.lastCurrentTime=O}this.nextLoadPosition=O},C.getLoadPosition=function(){var I=this.media,w=0;return this.loadedmetadata&&I?w=I.currentTime:this.nextLoadPosition&&(w=this.nextLoadPosition),w},C.handleFragLoadAborted=function(I,w){this.transmuxer&&I.sn!=="initSegment"&&I.stats.aborted&&(this.warn("Fragment "+I.sn+(w?" part"+w.index:"")+" of level "+I.level+" was aborted"),this.resetFragmentLoading(I))},C.resetFragmentLoading=function(I){this.fragCurrent&&this.fragContextChanged(I)||(this.state=f.IDLE)},C.onFragmentOrKeyLoadError=function(I,w){if(!w.fatal){var O=w.frag;if(O&&O.type===I){var x=this.fragCurrent;console.assert(x&&O.sn===x.sn&&O.level===x.level&&O.urlId===x.urlId,"Frag load error must match current frag to retry");var P=this.config;if(this.fragLoadError+1<=P.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(O.level))return;var F=Math.min(Math.pow(2,this.fragLoadError)*P.fragLoadingRetryDelay,P.fragLoadingMaxRetryTimeout);this.warn("Fragment "+O.sn+" of "+I+" "+O.level+" failed to load, retrying in "+F+"ms"),this.retryDate=self.performance.now()+F,this.fragLoadError++,this.state=f.FRAG_LOADING_WAITING_RETRY}else w.levelRetry?(I===l.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=f.IDLE):(_.logger.error(w.details+" reaches max retry, redispatch as fatal ..."),w.fatal=!0,this.hls.stopLoad(),this.state=f.ERROR)}}},C.afterBufferFlushed=function(I,w,O){if(I){var x=v.BufferHelper.getBuffered(I);this.fragmentTracker.detectEvictedFragments(w,x,O),this.state===f.ENDED&&this.resetLoadingState()}},C.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=f.IDLE},C.resetLiveStartWhenNotLoaded=function(I){if(!this.loadedmetadata){this.startFragRequested=!1;var w=this.levels?this.levels[I].details:null;if(w!=null&&w.live)return this.startPosition=-1,this.setStartPosition(w,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},C.updateLevelTiming=function(I,w,O,x){var P=this,F=O.details;console.assert(!!F,"level.details must be defined"),Object.keys(I.elementaryStreams).reduce(function(M,U){var G=I.elementaryStreams[U];if(G){var K=G.endPTS-G.startPTS;if(K<=0)return P.warn("Could not parse fragment "+I.sn+" "+U+" duration reliably ("+K+") resetting transmuxer to fallback to playlist timing"),P.resetTransmuxer(),M||!1;var q=x?0:Object(k.updateFragPTSDTS)(F,I,G.startPTS,G.endPTS,G.startDTS,G.endDTS);return P.hls.trigger(S.Events.LEVEL_PTS_UPDATED,{details:F,level:O,drift:q,type:U,frag:I,start:G.startPTS,end:G.endPTS}),!0}return M},!1)?(this.state=f.PARSED,this.hls.trigger(S.Events.FRAG_PARSED,{frag:I,part:w})):this.resetLoadingState()},C.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},c=u,(p=[{key:"state",get:function(){return this._state},set:function(I){var w=this._state;w!==I&&(this._state=I,this.log(w+"->"+I))}}])&&h(c.prototype,p),u}(i.default)},"./src/controller/buffer-controller.ts":function(e,t,r){r.r(t),r.d(t,"default",function(){return R});var n=r("./src/polyfills/number.ts"),i=r("./src/events.ts"),a=r("./src/utils/logger.ts"),v=r("./src/errors.ts"),_=r("./src/utils/buffer-helper.ts"),S=r("./src/utils/mediasource-helper.ts"),o=r("./src/loader/fragment.ts"),A=r("./src/controller/buffer-operation-queue.ts"),T=Object(S.getMediaSource)(),y=/([ha]vc.)(?:\.[^.,]+)+/,R=function(){function k(s){var d=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var l=d.hls,h=d.media,m=d.mediaSource;a.logger.log("[buffer-controller]: Media source opened"),h&&(d.updateMediaElementDuration(),l.trigger(i.Events.MEDIA_ATTACHED,{media:h})),m&&m.removeEventListener("sourceopen",d._onMediaSourceOpen),d.checkPendingTracks()},this._onMediaSourceClose=function(){a.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){a.logger.log("[buffer-controller]: Media source ended")},this.hls=s,this._initSourceBuffer(),this.registerListeners()}var g=k.prototype;return g.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},g.destroy=function(){this.unregisterListeners(),this.details=null},g.registerListeners=function(){var s=this.hls;s.on(i.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),s.on(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.on(i.Events.MANIFEST_PARSED,this.onManifestParsed,this),s.on(i.Events.BUFFER_RESET,this.onBufferReset,this),s.on(i.Events.BUFFER_APPENDING,this.onBufferAppending,this),s.on(i.Events.BUFFER_CODECS,this.onBufferCodecs,this),s.on(i.Events.BUFFER_EOS,this.onBufferEos,this),s.on(i.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),s.on(i.Events.LEVEL_UPDATED,this.onLevelUpdated,this),s.on(i.Events.FRAG_PARSED,this.onFragParsed,this),s.on(i.Events.FRAG_CHANGED,this.onFragChanged,this)},g.unregisterListeners=function(){var s=this.hls;s.off(i.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),s.off(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.off(i.Events.MANIFEST_PARSED,this.onManifestParsed,this),s.off(i.Events.BUFFER_RESET,this.onBufferReset,this),s.off(i.Events.BUFFER_APPENDING,this.onBufferAppending,this),s.off(i.Events.BUFFER_CODECS,this.onBufferCodecs,this),s.off(i.Events.BUFFER_EOS,this.onBufferEos,this),s.off(i.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),s.off(i.Events.LEVEL_UPDATED,this.onLevelUpdated,this),s.off(i.Events.FRAG_PARSED,this.onFragParsed,this),s.off(i.Events.FRAG_CHANGED,this.onFragChanged,this)},g._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new A.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},g.onManifestParsed=function(s,d){var l=2;(d.audio&&!d.video||!d.altAudio)&&(l=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=l,this.details=null,a.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},g.onMediaAttaching=function(s,d){var l=this.media=d.media;if(l&&T){var h=this.mediaSource=new T;h.addEventListener("sourceopen",this._onMediaSourceOpen),h.addEventListener("sourceended",this._onMediaSourceEnded),h.addEventListener("sourceclose",this._onMediaSourceClose),l.src=self.URL.createObjectURL(h),this._objectUrl=l.src}},g.onMediaDetaching=function(){var s=this.media,d=this.mediaSource,l=this._objectUrl;if(d){if(a.logger.log("[buffer-controller]: media source detaching"),d.readyState==="open")try{d.endOfStream()}catch(h){a.logger.warn("[buffer-controller]: onMediaDetaching: "+h.message+" while calling endOfStream")}this.onBufferReset(),d.removeEventListener("sourceopen",this._onMediaSourceOpen),d.removeEventListener("sourceended",this._onMediaSourceEnded),d.removeEventListener("sourceclose",this._onMediaSourceClose),s&&(l&&self.URL.revokeObjectURL(l),s.src===l?(s.removeAttribute("src"),s.load()):a.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(i.Events.MEDIA_DETACHED,void 0)},g.onBufferReset=function(){var s=this;this.getSourceBufferTypes().forEach(function(d){var l=s.sourceBuffer[d];try{l&&(s.removeBufferListeners(d),s.mediaSource&&s.mediaSource.removeSourceBuffer(l),s.sourceBuffer[d]=void 0)}catch(h){a.logger.warn("[buffer-controller]: Failed to reset the "+d+" buffer",h)}}),this._initSourceBuffer()},g.onBufferCodecs=function(s,d){var l=this,h=this.getSourceBufferTypes().length;Object.keys(d).forEach(function(m){if(h){var f=l.tracks[m];if(f&&typeof f.buffer.changeType=="function"){var E=d[m],D=E.codec,b=E.levelCodec,L=E.container;if((f.levelCodec||f.codec).replace(y,"$1")!==(b||D).replace(y,"$1")){var u=L+";codecs="+(b||D);l.appendChangeType(m,u)}}}else l.pendingTracks[m]=d[m]}),h||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},g.appendChangeType=function(s,d){var l=this,h=this.operationQueue,m={execute:function(){var f=l.sourceBuffer[s];f&&(a.logger.log("[buffer-controller]: changing "+s+" sourceBuffer type to "+d),f.changeType(d)),h.shiftAndExecuteNext(s)},onStart:function(){},onComplete:function(){},onError:function(f){a.logger.warn("[buffer-controller]: Failed to change "+s+" SourceBuffer type",f)}};h.append(m,s)},g.onBufferAppending=function(s,d){var l=this,h=this.hls,m=this.operationQueue,f=this.tracks,E=d.data,D=d.type,b=d.frag,L=d.part,u=d.chunkMeta,c=u.buffering[D],p=self.performance.now();c.start=p;var C=b.stats.buffering,I=L?L.stats.buffering:null;C.start===0&&(C.start=p),I&&I.start===0&&(I.start=p);var w=f.audio,O=D==="audio"&&u.id===1&&(w==null?void 0:w.container)==="audio/mpeg",x={execute:function(){if(c.executeStart=self.performance.now(),O){var P=l.sourceBuffer[D];if(P){var F=b.start-P.timestampOffset;Math.abs(F)>=.1&&(a.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+b.start+" (delta: "+F+") sn: "+b.sn+")"),P.timestampOffset=b.start)}}l.appendExecutor(E,D)},onStart:function(){},onComplete:function(){var P=self.performance.now();c.executeEnd=c.end=P,C.first===0&&(C.first=P),I&&I.first===0&&(I.first=P);var F=l.sourceBuffer,M={};for(var U in F)M[U]=_.BufferHelper.getBuffered(F[U]);l.appendError=0,l.hls.trigger(i.Events.BUFFER_APPENDED,{type:D,frag:b,part:L,chunkMeta:u,parent:b.type,timeRanges:M})},onError:function(P){a.logger.error("[buffer-controller]: Error encountered while trying to append to the "+D+" SourceBuffer",P);var F={type:v.ErrorTypes.MEDIA_ERROR,parent:b.type,details:v.ErrorDetails.BUFFER_APPEND_ERROR,err:P,fatal:!1};P.code===DOMException.QUOTA_EXCEEDED_ERR?F.details=v.ErrorDetails.BUFFER_FULL_ERROR:(l.appendError++,F.details=v.ErrorDetails.BUFFER_APPEND_ERROR,l.appendError>h.config.appendErrorMaxRetry&&(a.logger.error("[buffer-controller]: Failed "+h.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),F.fatal=!0)),h.trigger(i.Events.ERROR,F)}};m.append(x,D)},g.onBufferFlushing=function(s,d){var l=this,h=this.operationQueue,m=function(f){return{execute:l.removeExecutor.bind(l,f,d.startOffset,d.endOffset),onStart:function(){},onComplete:function(){l.hls.trigger(i.Events.BUFFER_FLUSHED,{type:f})},onError:function(E){a.logger.warn("[buffer-controller]: Failed to remove from "+f+" SourceBuffer",E)}}};d.type?h.append(m(d.type),d.type):this.getSourceBufferTypes().forEach(function(f){h.append(m(f),f)})},g.onFragParsed=function(s,d){var l=this,h=d.frag,m=d.part,f=[],E=m?m.elementaryStreams:h.elementaryStreams;E[o.ElementaryStreamTypes.AUDIOVIDEO]?f.push("audiovideo"):(E[o.ElementaryStreamTypes.AUDIO]&&f.push("audio"),E[o.ElementaryStreamTypes.VIDEO]&&f.push("video")),f.length===0&&a.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+h.type+" level: "+h.level+" sn: "+h.sn),this.blockBuffers(function(){var D=self.performance.now();h.stats.buffering.end=D,m&&(m.stats.buffering.end=D);var b=m?m.stats:h.stats;l.hls.trigger(i.Events.FRAG_BUFFERED,{frag:h,part:m,stats:b,id:h.type})},f)},g.onFragChanged=function(s,d){this.flushBackBuffer()},g.onBufferEos=function(s,d){var l=this;this.getSourceBufferTypes().reduce(function(h,m){var f=l.sourceBuffer[m];return d.type&&d.type!==m||f&&!f.ended&&(f.ended=!0,a.logger.log("[buffer-controller]: "+m+" sourceBuffer now EOS")),h&&!(f&&!f.ended)},!0)&&this.blockBuffers(function(){var h=l.mediaSource;h&&h.readyState==="open"&&h.endOfStream()})},g.onLevelUpdated=function(s,d){var l=d.details;l.fragments.length&&(this.details=l,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},g.flushBackBuffer=function(){var s=this.hls,d=this.details,l=this.media,h=this.sourceBuffer;if(l&&d!==null){var m=this.getSourceBufferTypes();if(m.length){var f=d.live&&s.config.liveBackBufferLength!==null?s.config.liveBackBufferLength:s.config.backBufferLength;if(Object(n.isFiniteNumber)(f)&&!(f<0)){var E=l.currentTime,D=d.levelTargetDuration,b=Math.max(f,D),L=Math.floor(E/D)*D-b;m.forEach(function(u){var c=h[u];if(c){var p=_.BufferHelper.getBuffered(c);p.length>0&&L>p.start(0)&&(s.trigger(i.Events.BACK_BUFFER_REACHED,{bufferEnd:L}),d.live&&s.trigger(i.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:L}),s.trigger(i.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:L,type:u}))}})}}}},g.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&this.mediaSource.readyState==="open"){var s=this.details,d=this.hls,l=this.media,h=this.mediaSource,m=s.fragments[0].start+s.totalduration,f=l.duration,E=Object(n.isFiniteNumber)(h.duration)?h.duration:0;s.live&&d.config.liveDurationInfinity?(a.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),h.duration=1/0,this.updateSeekableRange(s)):(m>E&&m>f||!Object(n.isFiniteNumber)(f))&&(a.logger.log("[buffer-controller]: Updating Media Source duration to "+m.toFixed(3)),h.duration=m)}},g.updateSeekableRange=function(s){var d=this.mediaSource,l=s.fragments;if(l.length&&s.live&&d!=null&&d.setLiveSeekableRange){var h=Math.max(0,l[0].start),m=Math.max(h,h+s.totalduration);d.setLiveSeekableRange(h,m)}},g.checkPendingTracks=function(){var s=this.bufferCodecEventsExpected,d=this.operationQueue,l=this.pendingTracks,h=Object.keys(l).length;if(h&&!s||h===2){this.createSourceBuffers(l),this.pendingTracks={};var m=this.getSourceBufferTypes();if(m.length===0)return void this.hls.trigger(i.Events.ERROR,{type:v.ErrorTypes.MEDIA_ERROR,details:v.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});m.forEach(function(f){d.executeNext(f)})}},g.createSourceBuffers=function(s){var d=this.sourceBuffer,l=this.mediaSource;if(!l)throw Error("createSourceBuffers called when mediaSource was null");var h=0;for(var m in s)if(!d[m]){var f=s[m];if(!f)throw Error("source buffer exists for track "+m+", however track does not");var E=f.levelCodec||f.codec,D=f.container+";codecs="+E;a.logger.log("[buffer-controller]: creating sourceBuffer("+D+")");try{var b=d[m]=l.addSourceBuffer(D),L=m;this.addBufferListener(L,"updatestart",this._onSBUpdateStart),this.addBufferListener(L,"updateend",this._onSBUpdateEnd),this.addBufferListener(L,"error",this._onSBUpdateError),this.tracks[m]={buffer:b,codec:E,container:f.container,levelCodec:f.levelCodec,id:f.id},h++}catch(u){a.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+u.message),this.hls.trigger(i.Events.ERROR,{type:v.ErrorTypes.MEDIA_ERROR,details:v.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:u,mimeType:D})}}h&&this.hls.trigger(i.Events.BUFFER_CREATED,{tracks:this.tracks})},g._onSBUpdateStart=function(s){this.operationQueue.current(s).onStart()},g._onSBUpdateEnd=function(s){var d=this.operationQueue;d.current(s).onComplete(),d.shiftAndExecuteNext(s)},g._onSBUpdateError=function(s,d){a.logger.error("[buffer-controller]: "+s+" SourceBuffer error",d),this.hls.trigger(i.Events.ERROR,{type:v.ErrorTypes.MEDIA_ERROR,details:v.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var l=this.operationQueue.current(s);l&&l.onError(d)},g.removeExecutor=function(s,d,l){var h=this.media,m=this.mediaSource,f=this.operationQueue,E=this.sourceBuffer[s];if(!h||!m||!E)return a.logger.warn("[buffer-controller]: Attempting to remove from the "+s+" SourceBuffer, but it does not exist"),void f.shiftAndExecuteNext(s);var D=Object(n.isFiniteNumber)(h.duration)?h.duration:1/0,b=Object(n.isFiniteNumber)(m.duration)?m.duration:1/0,L=Math.max(0,d),u=Math.min(l,D,b);u>L?(a.logger.log("[buffer-controller]: Removing ["+L+","+u+"] from the "+s+" SourceBuffer"),console.assert(!E.updating,s+" sourceBuffer must not be updating"),E.remove(L,u)):f.shiftAndExecuteNext(s)},g.appendExecutor=function(s,d){var l=this.operationQueue,h=this.sourceBuffer[d];if(!h)return a.logger.warn("[buffer-controller]: Attempting to append to the "+d+" SourceBuffer, but it does not exist"),void l.shiftAndExecuteNext(d);h.ended=!1,console.assert(!h.updating,d+" sourceBuffer must not be updating"),h.appendBuffer(s)},g.blockBuffers=function(s,d){var l=this;if(d===void 0&&(d=this.getSourceBufferTypes()),!d.length)return a.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve(s);var h=this.operationQueue,m=d.map(function(f){return h.appendBlocker(f)});Promise.all(m).then(function(){s(),d.forEach(function(f){var E=l.sourceBuffer[f];E&&E.updating||h.shiftAndExecuteNext(f)})})},g.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},g.addBufferListener=function(s,d,l){var h=this.sourceBuffer[s];if(h){var m=l.bind(this,s);this.listeners[s].push({event:d,listener:m}),h.addEventListener(d,m)}},g.removeBufferListeners=function(s){var d=this.sourceBuffer[s];d&&this.listeners[s].forEach(function(l){d.removeEventListener(l.event,l.listener)})},k}()},"./src/controller/buffer-operation-queue.ts":function(e,t,r){r.r(t),r.d(t,"default",function(){return i});var n=r("./src/utils/logger.ts"),i=function(){function a(_){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=_}var v=a.prototype;return v.append=function(_,S){var o=this.queues[S];o.push(_),o.length===1&&this.buffers[S]&&this.executeNext(S)},v.insertAbort=function(_,S){this.queues[S].unshift(_),this.executeNext(S)},v.appendBlocker=function(_){var S,o=new Promise(function(T){S=T}),A={execute:S,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(A,_),o},v.executeNext=function(_){var S=this.buffers,o=this.queues,A=S[_],T=o[_];if(T.length){var y=T[0];try{y.execute()}catch(R){n.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),y.onError(R),A&&A.updating||(T.shift(),this.executeNext(_))}}},v.shiftAndExecuteNext=function(_){this.queues[_].shift(),this.executeNext(_)},v.current=function(_){return this.queues[_][0]},a}()},"./src/controller/cap-level-controller.ts":function(e,t,r){r.r(t);var n=r("./src/events.ts");function i(v,_){for(var S=0;S<_.length;S++){var o=_[S];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(v,o.key,o)}}var a=function(){function v(T){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=T,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var _,S,o,A=v.prototype;return A.setStreamController=function(T){this.streamController=T},A.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},A.registerListeners=function(){var T=this.hls;T.on(n.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),T.on(n.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),T.on(n.Events.MANIFEST_PARSED,this.onManifestParsed,this),T.on(n.Events.BUFFER_CODECS,this.onBufferCodecs,this),T.on(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},A.unregisterListener=function(){var T=this.hls;T.off(n.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),T.off(n.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),T.off(n.Events.MANIFEST_PARSED,this.onManifestParsed,this),T.off(n.Events.BUFFER_CODECS,this.onBufferCodecs,this),T.off(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},A.onFpsDropLevelCapping=function(T,y){v.isLevelAllowed(y.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(y.droppedLevel)},A.onMediaAttaching=function(T,y){this.media=y.media instanceof HTMLVideoElement?y.media:null},A.onManifestParsed=function(T,y){var R=this.hls;this.restrictedLevels=[],this.firstLevel=y.firstLevel,R.config.capLevelToPlayerSize&&y.video&&this.startCapping()},A.onBufferCodecs=function(T,y){this.hls.config.capLevelToPlayerSize&&y.video&&this.startCapping()},A.onMediaDetaching=function(){this.stopCapping()},A.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var T=this.hls.levels;if(T.length){var y=this.hls;y.autoLevelCapping=this.getMaxLevel(T.length-1),y.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=y.autoLevelCapping}}},A.getMaxLevel=function(T){var y=this,R=this.hls.levels;if(!R.length)return-1;var k=R.filter(function(g,s){return v.isLevelAllowed(s,y.restrictedLevels)&&s<=T});return this.clientRect=null,v.getMaxLevelByMediaSize(k,this.mediaWidth,this.mediaHeight)},A.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},A.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},A.getDimensions=function(){if(this.clientRect)return this.clientRect;var T=this.media,y={width:0,height:0};if(T){var R=T.getBoundingClientRect();y.width=R.width,y.height=R.height,y.width||y.height||(y.width=R.right-R.left||T.width||0,y.height=R.bottom-R.top||T.height||0)}return this.clientRect=y,y},v.isLevelAllowed=function(T,y){return y===void 0&&(y=[]),y.indexOf(T)===-1},v.getMaxLevelByMediaSize=function(T,y,R){if(!T||!T.length)return-1;for(var k,g,s=T.length-1,d=0;d<T.length;d+=1){var l=T[d];if((l.width>=y||l.height>=R)&&(k=l,!(g=T[d+1])||k.width!==g.width||k.height!==g.height)){s=d;break}}return s},_=v,o=[{key:"contentScaleFactor",get:function(){var T=1;try{T=self.devicePixelRatio}catch{}return T}}],(S=[{key:"mediaWidth",get:function(){return this.getDimensions().width*v.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*v.contentScaleFactor}}])&&i(_.prototype,S),o&&i(_,o),v}();t.default=a},"./src/controller/eme-controller.ts":function(e,t,r){r.r(t);var n=r("./src/events.ts"),i=r("./src/errors.ts"),a=r("./src/utils/logger.ts"),v=r("./src/utils/mediakeys-helper.ts");function _(o,A){for(var T=0;T<A.length;T++){var y=A[T];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(o,y.key,y)}}var S=function(){function o(R){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=R,this._config=R.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var A,T,y=o.prototype;return y.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},y._registerListeners=function(){this.hls.on(n.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(n.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(n.Events.MANIFEST_PARSED,this.onManifestParsed,this)},y._unregisterListeners=function(){this.hls.off(n.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(n.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(n.Events.MANIFEST_PARSED,this.onManifestParsed,this)},y.getLicenseServerUrl=function(R){switch(R){case v.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+R+'"')},y._attemptKeySystemAccess=function(R,k,g){var s=this,d=function(h,m,f,E){switch(h){case v.KeySystems.WIDEVINE:return function(D,b,L){var u={audioCapabilities:[],videoCapabilities:[]};return D.forEach(function(c){u.audioCapabilities.push({contentType:'audio/mp4; codecs="'+c+'"',robustness:L.audioRobustness||""})}),b.forEach(function(c){u.videoCapabilities.push({contentType:'video/mp4; codecs="'+c+'"',robustness:L.videoRobustness||""})}),[u]}(m,f,E);default:throw new Error("Unknown key-system: "+h)}}(R,k,g,this._drmSystemOptions);a.logger.log("Requesting encrypted media key-system access");var l=this.requestMediaKeySystemAccess(R,d);this.mediaKeysPromise=l.then(function(h){return s._onMediaKeySystemAccessObtained(R,h)}),l.catch(function(h){a.logger.error('Failed to obtain key-system "'+R+'" access:',h)})},y._onMediaKeySystemAccessObtained=function(R,k){var g=this;a.logger.log('Access for key-system "'+R+'" obtained');var s={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:k,mediaKeySystemDomain:R};this._mediaKeysList.push(s);var d=Promise.resolve().then(function(){return k.createMediaKeys()}).then(function(l){return s.mediaKeys=l,a.logger.log('Media-keys created for key-system "'+R+'"'),g._onMediaKeysCreated(),l});return d.catch(function(l){a.logger.error("Failed to create media-keys:",l)}),d},y._onMediaKeysCreated=function(){var R=this;this._mediaKeysList.forEach(function(k){k.mediaKeysSession||(k.mediaKeysSession=k.mediaKeys.createSession(),R._onNewMediaKeySession(k.mediaKeysSession))})},y._onNewMediaKeySession=function(R){var k=this;a.logger.log("New key-system session "+R.sessionId),R.addEventListener("message",function(g){k._onKeySessionMessage(R,g.message)},!1)},y._onKeySessionMessage=function(R,k){a.logger.log("Got EME message event, creating license request"),this._requestLicense(k,function(g){a.logger.log("Received license data (length: "+(g&&g.byteLength)+"), updating key-session"),R.update(g)})},y.onMediaEncrypted=function(R){var k=this;if(a.logger.log('Media is encrypted using "'+R.initDataType+'" init data type'),!this.mediaKeysPromise)return a.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void this.hls.trigger(n.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});var g=function(s){k._media&&(k._attemptSetMediaKeys(s),k._generateRequestWithPreferredKeySession(R.initDataType,R.initData))};this.mediaKeysPromise.then(g).catch(g)},y._attemptSetMediaKeys=function(R){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var k=this._mediaKeysList[0];if(!k||!k.mediaKeys)return a.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(n.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});a.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(k.mediaKeys),this._hasSetMediaKeys=!0}},y._generateRequestWithPreferredKeySession=function(R,k){var g=this,s=this._mediaKeysList[0];if(!s)return a.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(n.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(s.mediaKeysSessionInitialized)a.logger.warn("Key-Session already initialized but requested again");else{var d=s.mediaKeysSession;if(!d)return a.logger.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(n.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});if(!k)return a.logger.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(n.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});a.logger.log('Generating key-session request for "'+R+'" init data type'),s.mediaKeysSessionInitialized=!0,d.generateRequest(R,k).then(function(){a.logger.debug("Key-session generation succeeded")}).catch(function(l){a.logger.error("Error generating key-session request:",l),g.hls.trigger(n.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})}},y._createLicenseXhr=function(R,k,g){var s=new XMLHttpRequest;s.responseType="arraybuffer",s.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,s,R,k,g);var d=this._licenseXhrSetup;if(d)try{d.call(this.hls,s,R),d=void 0}catch(l){a.logger.error(l)}try{s.readyState||s.open("POST",R,!0),d&&d.call(this.hls,s,R)}catch(l){throw new Error("issue setting up KeySystem license XHR "+l)}return s},y._onLicenseRequestReadyStageChange=function(R,k,g,s){switch(R.readyState){case 4:if(R.status===200){this._requestLicenseFailureCount=0,a.logger.log("License request succeeded");var d=R.response,l=this._licenseResponseCallback;if(l)try{d=l.call(this.hls,R,k)}catch(m){a.logger.error(m)}s(d)}else{if(a.logger.error("License Request XHR failed ("+k+"). Status: "+R.status+" ("+R.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>3)return void this.hls.trigger(n.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});var h=3-this._requestLicenseFailureCount+1;a.logger.warn("Retrying license request, "+h+" attempts left"),this._requestLicense(g,s)}}},y._generateLicenseRequestChallenge=function(R,k){switch(R.mediaKeySystemDomain){case v.KeySystems.WIDEVINE:return k}throw new Error("unsupported key-system: "+R.mediaKeySystemDomain)},y._requestLicense=function(R,k){a.logger.log("Requesting content license for key-system");var g=this._mediaKeysList[0];if(!g)return a.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(n.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var s=this.getLicenseServerUrl(g.mediaKeySystemDomain),d=this._createLicenseXhr(s,R,k);a.logger.log("Sending license request to URL: "+s);var l=this._generateLicenseRequestChallenge(g,R);d.send(l)}catch(h){a.logger.error("Failure requesting DRM license: "+h),this.hls.trigger(n.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},y.onMediaAttached=function(R,k){if(this._emeEnabled){var g=k.media;this._media=g,g.addEventListener("encrypted",this._onMediaEncrypted)}},y.onMediaDetached=function(){var R=this._media,k=this._mediaKeysList;R&&(R.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(k.map(function(g){if(g.mediaKeysSession)return g.mediaKeysSession.close().catch(function(){})})).then(function(){return R.setMediaKeys(null)}).catch(function(){}))},y.onManifestParsed=function(R,k){if(this._emeEnabled){var g=k.levels.map(function(d){return d.audioCodec}).filter(function(d){return!!d}),s=k.levels.map(function(d){return d.videoCodec}).filter(function(d){return!!d});this._attemptKeySystemAccess(v.KeySystems.WIDEVINE,g,s)}},A=o,(T=[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}])&&_(A.prototype,T),o}();t.default=S},"./src/controller/fps-controller.ts":function(e,t,r){r.r(t);var n=r("./src/events.ts"),i=r("./src/utils/logger.ts"),a=function(){function v(S){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=S,this.registerListeners()}var _=v.prototype;return _.setStreamController=function(S){this.streamController=S},_.registerListeners=function(){this.hls.on(n.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},_.unregisterListeners=function(){this.hls.off(n.Events.MEDIA_ATTACHING,this.onMediaAttaching)},_.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},_.onMediaAttaching=function(S,o){var A=this.hls.config;if(A.capLevelOnFPSDrop){var T=o.media instanceof self.HTMLVideoElement?o.media:null;this.media=T,T&&typeof T.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),A.fpsDroppedMonitoringPeriod)}},_.checkFPS=function(S,o,A){var T=performance.now();if(o){if(this.lastTime){var y=T-this.lastTime,R=A-this.lastDroppedFrames,k=o-this.lastDecodedFrames,g=1e3*R/y,s=this.hls;if(s.trigger(n.Events.FPS_DROP,{currentDropped:R,currentDecoded:k,totalDroppedFrames:A}),g>0&&R>s.config.fpsDroppedMonitoringThreshold*k){var d=s.currentLevel;i.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+d),d>0&&(s.autoLevelCapping===-1||s.autoLevelCapping>=d)&&(d-=1,s.trigger(n.Events.FPS_DROP_LEVEL_CAPPING,{level:d,droppedLevel:s.currentLevel}),s.autoLevelCapping=d,this.streamController.nextLevelSwitch())}}this.lastTime=T,this.lastDroppedFrames=A,this.lastDecodedFrames=o}},_.checkFPSInterval=function(){var S=this.media;if(S)if(this.isVideoPlaybackQualityAvailable){var o=S.getVideoPlaybackQuality();this.checkFPS(S,o.totalVideoFrames,o.droppedVideoFrames)}else this.checkFPS(S,S.webkitDecodedFrameCount,S.webkitDroppedFrameCount)},v}();t.default=a},"./src/controller/fragment-finders.ts":function(e,t,r){r.r(t),r.d(t,"findFragmentByPDT",function(){return a}),r.d(t,"findFragmentByPTS",function(){return v}),r.d(t,"fragmentWithinToleranceTest",function(){return _}),r.d(t,"pdtWithinToleranceTest",function(){return S}),r.d(t,"findFragWithCC",function(){return o});var n=r("./src/polyfills/number.ts"),i=r("./src/utils/binary-search.ts");function a(A,T,y){if(T===null||!Array.isArray(A)||!A.length||!Object(n.isFiniteNumber)(T)||T<(A[0].programDateTime||0)||T>=(A[A.length-1].endProgramDateTime||0))return null;y=y||0;for(var R=0;R<A.length;++R){var k=A[R];if(S(T,y,k))return k}return null}function v(A,T,y,R){y===void 0&&(y=0),R===void 0&&(R=0);var k=null;if(A?k=T[A.sn-T[0].sn+1]||null:y===0&&T[0].start===0&&(k=T[0]),k&&_(y,R,k)===0)return k;var g=i.default.search(T,_.bind(null,y,R));return g||k}function _(A,T,y){A===void 0&&(A=0),T===void 0&&(T=0);var R=Math.min(T,y.duration+(y.deltaPTS?y.deltaPTS:0));return y.start+y.duration-R<=A?1:y.start-R>A&&y.start?-1:0}function S(A,T,y){var R=1e3*Math.min(T,y.duration+(y.deltaPTS?y.deltaPTS:0));return(y.endProgramDateTime||0)-R>A}function o(A,T){return i.default.search(A,function(y){return y.cc<T?1:y.cc>T?-1:0})}},"./src/controller/fragment-tracker.ts":function(e,t,r){r.r(t),r.d(t,"FragmentState",function(){return n}),r.d(t,"FragmentTracker",function(){return _});var n,i,a=r("./src/events.ts"),v=r("./src/types/loader.ts");(i=n||(n={})).NOT_LOADED="NOT_LOADED",i.BACKTRACKED="BACKTRACKED",i.APPENDING="APPENDING",i.PARTIAL="PARTIAL",i.OK="OK";var _=function(){function A(y){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=y,this._registerListeners()}var T=A.prototype;return T._registerListeners=function(){var y=this.hls;y.on(a.Events.BUFFER_APPENDED,this.onBufferAppended,this),y.on(a.Events.FRAG_BUFFERED,this.onFragBuffered,this),y.on(a.Events.FRAG_LOADED,this.onFragLoaded,this)},T._unregisterListeners=function(){var y=this.hls;y.off(a.Events.BUFFER_APPENDED,this.onBufferAppended,this),y.off(a.Events.FRAG_BUFFERED,this.onFragBuffered,this),y.off(a.Events.FRAG_LOADED,this.onFragLoaded,this)},T.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},T.getAppendedFrag=function(y,R){if(R===v.PlaylistLevelType.MAIN){var k=this.activeFragment,g=this.activeParts;if(!k)return null;if(g)for(var s=g.length;s--;){var d=g[s],l=d?d.end:k.appendedPTS;if(d.start<=y&&l!==void 0&&y<=l)return s>9&&(this.activeParts=g.slice(s-9)),d}else if(k.start<=y&&k.appendedPTS!==void 0&&y<=k.appendedPTS)return k}return this.getBufferedFrag(y,R)},T.getBufferedFrag=function(y,R){for(var k=this.fragments,g=Object.keys(k),s=g.length;s--;){var d=k[g[s]];if((d==null?void 0:d.body.type)===R&&d.buffered){var l=d.body;if(l.start<=y&&y<=l.end)return l}}return null},T.detectEvictedFragments=function(y,R,k){var g=this;Object.keys(this.fragments).forEach(function(s){var d=g.fragments[s];if(d)if(d.buffered){var l=d.range[y];l&&l.time.some(function(h){var m=!g.isTimeBuffered(h.startPTS,h.endPTS,R);return m&&g.removeFragment(d.body),m})}else d.body.type===k&&g.removeFragment(d.body)})},T.detectPartialFragments=function(y){var R=this,k=this.timeRanges,g=y.frag,s=y.part;if(k&&g.sn!=="initSegment"){var d=o(g),l=this.fragments[d];l&&(Object.keys(k).forEach(function(h){var m=g.elementaryStreams[h];if(m){var f=k[h],E=s!==null||m.partial===!0;l.range[h]=R.getBufferedTimes(g,s,E,f)}}),l.backtrack=l.loaded=null,Object.keys(l.range).length?l.buffered=!0:this.removeFragment(l.body))}},T.fragBuffered=function(y){var R=o(y),k=this.fragments[R];k&&(k.backtrack=k.loaded=null,k.buffered=!0)},T.getBufferedTimes=function(y,R,k,g){for(var s={time:[],partial:k},d=R?R.start:y.start,l=R?R.end:y.end,h=y.minEndPTS||l,m=y.maxStartPTS||d,f=0;f<g.length;f++){var E=g.start(f)-this.bufferPadding,D=g.end(f)+this.bufferPadding;if(m>=E&&h<=D){s.time.push({startPTS:Math.max(d,g.start(f)),endPTS:Math.min(l,g.end(f))});break}if(d<D&&l>E)s.partial=!0,s.time.push({startPTS:Math.max(d,g.start(f)),endPTS:Math.min(l,g.end(f))});else if(l<=E)break}return s},T.getPartialFragment=function(y){var R,k,g,s=null,d=0,l=this.bufferPadding,h=this.fragments;return Object.keys(h).forEach(function(m){var f=h[m];f&&S(f)&&(k=f.body.start-l,g=f.body.end+l,y>=k&&y<=g&&(R=Math.min(y-k,g-y),d<=R&&(s=f.body,d=R)))}),s},T.getState=function(y){var R=o(y),k=this.fragments[R];return k?k.buffered?S(k)?n.PARTIAL:n.OK:k.backtrack?n.BACKTRACKED:n.APPENDING:n.NOT_LOADED},T.backtrack=function(y,R){var k=o(y),g=this.fragments[k];if(!g||g.backtrack)return null;var s=g.backtrack=R||g.loaded;return g.loaded=null,s},T.getBacktrackData=function(y){var R=o(y),k=this.fragments[R];if(k){var g,s=k.backtrack;if(s!=null&&(g=s.payload)!==null&&g!==void 0&&g.byteLength)return s;this.removeFragment(y)}return null},T.isTimeBuffered=function(y,R,k){for(var g,s,d=0;d<k.length;d++){if(g=k.start(d)-this.bufferPadding,s=k.end(d)+this.bufferPadding,y>=g&&R<=s)return!0;if(R<=g)return!1}return!1},T.onFragLoaded=function(y,R){var k=R.frag,g=R.part;if(k.sn!=="initSegment"&&!k.bitrateTest&&!g){var s=o(k);this.fragments[s]={body:k,loaded:R,backtrack:null,buffered:!1,range:Object.create(null)}}},T.onBufferAppended=function(y,R){var k=this,g=R.frag,s=R.part,d=R.timeRanges;if(g.type===v.PlaylistLevelType.MAIN)if(this.activeFragment=g,s){var l=this.activeParts;l||(this.activeParts=l=[]),l.push(s)}else this.activeParts=null;this.timeRanges=d,Object.keys(d).forEach(function(h){var m=d[h];if(k.detectEvictedFragments(h,m),!s)for(var f=0;f<m.length;f++)g.appendedPTS=Math.max(m.end(f),g.appendedPTS||0)})},T.onFragBuffered=function(y,R){this.detectPartialFragments(R)},T.hasFragment=function(y){var R=o(y);return!!this.fragments[R]},T.removeFragmentsInRange=function(y,R,k){var g=this;Object.keys(this.fragments).forEach(function(s){var d=g.fragments[s];if(d&&d.buffered){var l=d.body;l.type===k&&l.start<R&&l.end>y&&g.removeFragment(l)}})},T.removeFragment=function(y){var R=o(y);y.stats.loaded=0,y.clearElementaryStreamInfo(),delete this.fragments[R]},T.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},A}();function S(A){var T,y;return A.buffered&&(((T=A.range.video)===null||T===void 0?void 0:T.partial)||((y=A.range.audio)===null||y===void 0?void 0:y.partial))}function o(A){return A.type+"_"+A.level+"_"+A.urlId+"_"+A.sn}},"./src/controller/gap-controller.ts":function(e,t,r){r.r(t),r.d(t,"STALL_MINIMUM_DURATION_MS",function(){return _}),r.d(t,"MAX_START_GAP_JUMP",function(){return S}),r.d(t,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return o}),r.d(t,"SKIP_BUFFER_RANGE_START",function(){return A}),r.d(t,"default",function(){return T});var n=r("./src/utils/buffer-helper.ts"),i=r("./src/errors.ts"),a=r("./src/events.ts"),v=r("./src/utils/logger.ts"),_=250,S=2,o=.1,A=.05,T=function(){function y(k,g,s,d){this.config=void 0,this.media=void 0,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=k,this.media=g,this.fragmentTracker=s,this.hls=d}var R=y.prototype;return R.destroy=function(){this.hls=this.fragmentTracker=this.media=null},R.poll=function(k){var g=this.config,s=this.media,d=this.stalled,l=s.currentTime,h=s.seeking,m=this.seeking&&!h,f=!this.seeking&&h;if(this.seeking=h,l===k){if((f||m)&&(this.stalled=null),!s.paused&&!s.ended&&s.playbackRate!==0&&n.BufferHelper.getBuffered(s).length){var E=n.BufferHelper.bufferInfo(s,l,0),D=E.len>0,b=E.nextStart||0;if(D||b){if(h){var L=E.len>S,u=!b||b-l>S&&!this.fragmentTracker.getPartialFragment(l);if(L||u)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var c,p=Math.max(b,E.start||0)-l,C=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,I=!(C==null||(c=C.details)===null||c===void 0)&&c.live?2*C.details.targetduration:S;if(p>0&&p<=I)return void this._trySkipBufferHole(null)}var w=self.performance.now();if(d!==null){var O=w-d;!h&&O>=_&&this._reportStall(E.len);var x=n.BufferHelper.bufferInfo(s,l,g.maxBufferHole);this._tryFixBufferStall(x,O)}else this.stalled=w}}}else if(this.moved=!0,d!==null){if(this.stallReported){var P=self.performance.now()-d;v.logger.warn("playback not stuck anymore @"+l+", after "+Math.round(P)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}},R._tryFixBufferStall=function(k,g){var s=this.config,d=this.fragmentTracker,l=this.media.currentTime,h=d.getPartialFragment(l);h&&this._trySkipBufferHole(h)||k.len>s.maxBufferHole&&g>1e3*s.highBufferWatchdogPeriod&&(v.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},R._reportStall=function(k){var g=this.hls,s=this.media;this.stallReported||(this.stallReported=!0,v.logger.warn("Playback stalling at @"+s.currentTime+" due to low buffer (buffer="+k+")"),g.trigger(a.Events.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:k}))},R._trySkipBufferHole=function(k){for(var g=this.config,s=this.hls,d=this.media,l=d.currentTime,h=0,m=n.BufferHelper.getBuffered(d),f=0;f<m.length;f++){var E=m.start(f);if(l+g.maxBufferHole>=h&&l<E){var D=Math.max(E+A,d.currentTime+o);return v.logger.warn("skipping hole, adjusting currentTime from "+l+" to "+D),this.moved=!0,this.stalled=null,d.currentTime=D,k&&s.trigger(a.Events.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+l+" to "+D,frag:k}),D}h=m.end(f)}return 0},R._tryNudgeBuffer=function(){var k=this.config,g=this.hls,s=this.media,d=s.currentTime,l=(this.nudgeRetry||0)+1;if(this.nudgeRetry=l,l<k.nudgeMaxRetry){var h=d+l*k.nudgeOffset;v.logger.warn("Nudging 'currentTime' from "+d+" to "+h),s.currentTime=h,g.trigger(a.Events.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else v.logger.error("Playhead still not moving while enough data buffered @"+d+" after "+k.nudgeMaxRetry+" nudges"),g.trigger(a.Events.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},y}()},"./src/controller/id3-track-controller.ts":function(e,t,r){r.r(t);var n=r("./src/events.ts"),i=r("./src/utils/texttrack-utils.ts"),a=r("./src/demux/id3.ts"),v=function(){function _(o){this.hls=void 0,this.id3Track=null,this.media=null,this.hls=o,this._registerListeners()}var S=_.prototype;return S.destroy=function(){this._unregisterListeners()},S._registerListeners=function(){var o=this.hls;o.on(n.Events.MEDIA_ATTACHED,this.onMediaAttached,this),o.on(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.on(n.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),o.on(n.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},S._unregisterListeners=function(){var o=this.hls;o.off(n.Events.MEDIA_ATTACHED,this.onMediaAttached,this),o.off(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.off(n.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),o.off(n.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},S.onMediaAttached=function(o,A){this.media=A.media},S.onMediaDetaching=function(){this.id3Track&&(Object(i.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null)},S.getID3Track=function(o){if(this.media){for(var A=0;A<o.length;A++){var T=o[A];if(T.kind==="metadata"&&T.label==="id3")return Object(i.sendAddTrackEvent)(T,this.media),T}return this.media.addTextTrack("metadata","id3")}},S.onFragParsingMetadata=function(o,A){if(this.media){var T=A.frag,y=A.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var R=self.WebKitDataCue||self.VTTCue||self.TextTrackCue,k=0;k<y.length;k++){var g=a.getID3Frames(y[k].data);if(g){var s=y[k].pts,d=k<y.length-1?y[k+1].pts:T.end;d-s<=0&&(d=s+.25);for(var l=0;l<g.length;l++){var h=g[l];if(!a.isTimeStampFrame(h)){var m=new R(s,d,"");m.value=h,this.id3Track.addCue(m)}}}}}},S.onBufferFlushing=function(o,A){var T=A.startOffset,y=A.endOffset,R=A.type;if(!R||R==="audio"){var k=this.id3Track;k&&Object(i.removeCuesInRange)(k,T,y)}},_}();t.default=v},"./src/controller/latency-controller.ts":function(e,t,r){r.r(t),r.d(t,"default",function(){return _});var n=r("./src/errors.ts"),i=r("./src/events.ts"),a=r("./src/utils/logger.ts");function v(S,o){for(var A=0;A<o.length;A++){var T=o[A];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(S,T.key,T)}}var _=function(){function S(y){var R=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return R.timeupdate()},this.hls=y,this.config=y.config,this.registerListeners()}var o,A,T=S.prototype;return T.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},T.registerListeners=function(){this.hls.on(i.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(i.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(i.Events.ERROR,this.onError,this)},T.unregisterListeners=function(){this.hls.off(i.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(i.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(i.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(i.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(i.Events.ERROR,this.onError)},T.onMediaAttached=function(y,R){this.media=R.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},T.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},T.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},T.onLevelUpdated=function(y,R){var k=R.details;this.levelDetails=k,k.advanced&&this.timeupdate(),!k.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},T.onError=function(y,R){R.details===n.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,a.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},T.timeupdate=function(){var y=this.media,R=this.levelDetails;if(y&&R){this.currentTime=y.currentTime;var k=this.computeLatency();if(k!==null){this._latency=k;var g=this.config,s=g.lowLatencyMode,d=g.maxLiveSyncPlaybackRate;if(s&&d!==1){var l=this.targetLatency;if(l!==null){var h=k-l,m=h<Math.min(this.maxLatency,l+R.targetduration);if(R.live&&m&&h>.05&&this.forwardBufferLength>1){var f=Math.min(2,Math.max(1,d)),E=Math.round(2/(1+Math.exp(-.75*h-this.edgeStalled))*20)/20;y.playbackRate=Math.min(f,Math.max(1,E))}else y.playbackRate!==1&&y.playbackRate!==0&&(y.playbackRate=1)}}}}},T.estimateLiveEdge=function(){var y=this.levelDetails;return y===null?null:y.edge+y.age},T.computeLatency=function(){var y=this.estimateLiveEdge();return y===null?null:y-this.currentTime},o=S,(A=[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var y=this.config,R=this.levelDetails;return y.liveMaxLatencyDuration!==void 0?y.liveMaxLatencyDuration:R?y.liveMaxLatencyDurationCount*R.targetduration:0}},{key:"targetLatency",get:function(){var y=this.levelDetails;if(y===null)return null;var R=y.holdBack,k=y.partHoldBack,g=y.targetduration,s=this.config,d=s.liveSyncDuration,l=s.liveSyncDurationCount,h=s.lowLatencyMode,m=this.hls.userConfig,f=h&&k||R;(m.liveSyncDuration||m.liveSyncDurationCount||f===0)&&(f=d!==void 0?d:l*g);var E=g;return f+Math.min(1*this.stallCount,E)}},{key:"liveSyncPosition",get:function(){var y=this.estimateLiveEdge(),R=this.targetLatency,k=this.levelDetails;if(y===null||R===null||k===null)return null;var g=k.edge,s=y-R-this.edgeStalled,d=g-k.totalduration,l=g-(this.config.lowLatencyMode&&k.partTarget||k.targetduration);return Math.min(Math.max(d,s),l)}},{key:"drift",get:function(){var y=this.levelDetails;return y===null?1:y.drift}},{key:"edgeStalled",get:function(){var y=this.levelDetails;if(y===null)return 0;var R=3*(this.config.lowLatencyMode&&y.partTarget||y.targetduration);return Math.max(y.age-R,0)}},{key:"forwardBufferLength",get:function(){var y=this.media,R=this.levelDetails;if(!y||!R)return 0;var k=y.buffered.length;return k?y.buffered.end(k-1):R.edge-this.currentTime}}])&&v(o.prototype,A),S}()},"./src/controller/level-controller.ts":function(e,t,r){r.r(t),r.d(t,"default",function(){return k});var n=r("./src/types/level.ts"),i=r("./src/events.ts"),a=r("./src/errors.ts"),v=r("./src/utils/codecs.ts"),_=r("./src/controller/level-helper.ts"),S=r("./src/controller/base-playlist-controller.ts"),o=r("./src/types/loader.ts");function A(){return(A=Object.assign||function(g){for(var s=1;s<arguments.length;s++){var d=arguments[s];for(var l in d)Object.prototype.hasOwnProperty.call(d,l)&&(g[l]=d[l])}return g}).apply(this,arguments)}function T(g,s){for(var d=0;d<s.length;d++){var l=s[d];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(g,l.key,l)}}function y(g,s){return(y=Object.setPrototypeOf||function(d,l){return d.__proto__=l,d})(g,s)}var R=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),k=function(g){var s,d;function l(E){var D;return(D=g.call(this,E,"[level-controller]")||this)._levels=[],D._firstLevel=-1,D._startLevel=void 0,D.currentLevelIndex=-1,D.manualLevelIndex=-1,D.onParsedComplete=void 0,D._registerListeners(),D}d=g,(s=l).prototype=Object.create(d.prototype),s.prototype.constructor=s,y(s,d);var h,m,f=l.prototype;return f._registerListeners=function(){var E=this.hls;E.on(i.Events.MANIFEST_LOADED,this.onManifestLoaded,this),E.on(i.Events.LEVEL_LOADED,this.onLevelLoaded,this),E.on(i.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),E.on(i.Events.FRAG_LOADED,this.onFragLoaded,this),E.on(i.Events.ERROR,this.onError,this)},f._unregisterListeners=function(){var E=this.hls;E.off(i.Events.MANIFEST_LOADED,this.onManifestLoaded,this),E.off(i.Events.LEVEL_LOADED,this.onLevelLoaded,this),E.off(i.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),E.off(i.Events.FRAG_LOADED,this.onFragLoaded,this),E.off(i.Events.ERROR,this.onError,this)},f.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,g.prototype.destroy.call(this)},f.startLoad=function(){this._levels.forEach(function(E){E.loadError=0}),g.prototype.startLoad.call(this)},f.onManifestLoaded=function(E,D){var b,L,u=[],c=[],p=[],C={},I=!1,w=!1,O=!1;if(D.levels.forEach(function(M){var U=M.attrs;I=I||!(!M.width||!M.height),w=w||!!M.videoCodec,O=O||!!M.audioCodec,R&&M.audioCodec&&M.audioCodec.indexOf("mp4a.40.34")!==-1&&(M.audioCodec=void 0);var G=M.bitrate+"-"+M.attrs.RESOLUTION+"-"+M.attrs.CODECS;(L=C[G])?L.url.push(M.url):(L=new n.Level(M),C[G]=L,u.push(L)),U&&(U.AUDIO&&Object(_.addGroupId)(L,"audio",U.AUDIO),U.SUBTITLES&&Object(_.addGroupId)(L,"text",U.SUBTITLES))}),(I||w)&&O&&(u=u.filter(function(M){var U=M.videoCodec,G=M.width,K=M.height;return!!U||!(!G||!K)})),u=u.filter(function(M){var U=M.audioCodec,G=M.videoCodec;return(!U||Object(v.isCodecSupportedInMp4)(U,"audio"))&&(!G||Object(v.isCodecSupportedInMp4)(G,"video"))}),D.audioTracks&&(c=D.audioTracks.filter(function(M){return!M.audioCodec||Object(v.isCodecSupportedInMp4)(M.audioCodec,"audio")}),Object(_.assignTrackIdsByGroup)(c)),D.subtitles&&(p=D.subtitles,Object(_.assignTrackIdsByGroup)(p)),u.length>0){b=u[0].bitrate,u.sort(function(M,U){return M.bitrate-U.bitrate}),this._levels=u;for(var x=0;x<u.length;x++)if(u[x].bitrate===b){this._firstLevel=x,this.log("manifest loaded, "+u.length+" level(s) found, first bitrate: "+b);break}var P=O&&!w,F={levels:u,audioTracks:c,subtitleTracks:p,firstLevel:this._firstLevel,stats:D.stats,audio:O,video:w,altAudio:!P&&c.some(function(M){return!!M.url})};this.hls.trigger(i.Events.MANIFEST_PARSED,F),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(i.Events.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:D.url,reason:"no level with compatible codecs found in manifest"})},f.onError=function(E,D){if(g.prototype.onError.call(this,E,D),!D.fatal){var b=D.context,L=this._levels[this.currentLevelIndex];if(b&&(b.type===o.PlaylistContextType.AUDIO_TRACK&&L.audioGroupIds&&b.groupId===L.audioGroupIds[L.urlId]||b.type===o.PlaylistContextType.SUBTITLE_TRACK&&L.textGroupIds&&b.groupId===L.textGroupIds[L.urlId]))this.redundantFailover(this.currentLevelIndex);else{var u,c=!1,p=!0;switch(D.details){case a.ErrorDetails.FRAG_LOAD_ERROR:case a.ErrorDetails.FRAG_LOAD_TIMEOUT:case a.ErrorDetails.KEY_LOAD_ERROR:case a.ErrorDetails.KEY_LOAD_TIMEOUT:if(D.frag){var C=this._levels[D.frag.level];C?(C.fragmentError++,C.fragmentError>this.hls.config.fragLoadingMaxRetry&&(u=D.frag.level)):u=D.frag.level}break;case a.ErrorDetails.LEVEL_LOAD_ERROR:case a.ErrorDetails.LEVEL_LOAD_TIMEOUT:b&&(b.deliveryDirectives&&(p=!1),u=b.level),c=!0;break;case a.ErrorDetails.REMUX_ALLOC_ERROR:u=D.level,c=!0}u!==void 0&&this.recoverLevel(D,u,c,p)}}},f.recoverLevel=function(E,D,b,L){var u=E.details,c=this._levels[D];if(c.loadError++,b){if(!this.retryLoadingOrFail(E))return void(this.currentLevelIndex=-1);E.levelRetry=!0}if(L){var p=c.url.length;if(p>1&&c.loadError<p)E.levelRetry=!0,this.redundantFailover(D);else if(this.manualLevelIndex===-1){var C=D===0?this._levels.length-1:D-1;this.currentLevelIndex!==C&&this._levels[C].loadError===0&&(this.warn(u+": switch to "+C),E.levelRetry=!0,this.hls.nextAutoLevel=C)}}},f.redundantFailover=function(E){var D=this._levels[E],b=D.url.length;if(b>1){var L=(D.urlId+1)%b;this.warn("Switching to redundant URL-id "+L),this._levels.forEach(function(u){u.urlId=L}),this.level=E}},f.onFragLoaded=function(E,D){var b=D.frag;if(b!==void 0&&b.type===o.PlaylistLevelType.MAIN){var L=this._levels[b.level];L!==void 0&&(L.fragmentError=0,L.loadError=0)}},f.onLevelLoaded=function(E,D){var b,L,u=D.level,c=D.details,p=this._levels[u];if(!p)return this.warn("Invalid level index "+u),void((L=D.deliveryDirectives)!==null&&L!==void 0&&L.skip&&(c.deltaUpdateFailed=!0));u===this.currentLevelIndex?(p.fragmentError===0&&(p.loadError=0,this.retryCount=0),this.playlistLoaded(u,D,p.details)):(b=D.deliveryDirectives)!==null&&b!==void 0&&b.skip&&(c.deltaUpdateFailed=!0)},f.onAudioTrackSwitched=function(E,D){var b=this.hls.levels[this.currentLevelIndex];if(b&&b.audioGroupIds){for(var L=-1,u=this.hls.audioTracks[D.id].groupId,c=0;c<b.audioGroupIds.length;c++)if(b.audioGroupIds[c]===u){L=c;break}L!==b.urlId&&(b.urlId=L,this.startLoad())}},f.loadPlaylist=function(E){var D=this.currentLevelIndex,b=this._levels[D];if(this.canLoad&&b&&b.url.length>0){var L=b.urlId,u=b.url[L];if(E)try{u=E.addDirectives(u)}catch(c){this.warn("Could not construct new URL with HLS Delivery Directives: "+c)}this.log("Attempt loading level index "+D+(E?" at sn "+E.msn+" part "+E.part:"")+" with URL-id "+L+" "+u),this.clearTimer(),this.hls.trigger(i.Events.LEVEL_LOADING,{url:u,level:D,id:L,deliveryDirectives:E||null})}},f.removeLevel=function(E,D){var b=function(u,c){return c!==D},L=this._levels.filter(function(u,c){return c!==E||u.url.length>1&&D!==void 0&&(u.url=u.url.filter(b),u.audioGroupIds&&(u.audioGroupIds=u.audioGroupIds.filter(b)),u.textGroupIds&&(u.textGroupIds=u.textGroupIds.filter(b)),u.urlId=0,!0)}).map(function(u,c){var p=u.details;return p!=null&&p.fragments&&p.fragments.forEach(function(C){C.level=c}),u});this._levels=L,this.hls.trigger(i.Events.LEVELS_UPDATED,{levels:L})},h=l,(m=[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(E){var D,b=this._levels;if(b.length!==0&&(this.currentLevelIndex!==E||(D=b[E])===null||D===void 0||!D.details)){if(E<0||E>=b.length){var L=E<0;if(this.hls.trigger(i.Events.ERROR,{type:a.ErrorTypes.OTHER_ERROR,details:a.ErrorDetails.LEVEL_SWITCH_ERROR,level:E,fatal:L,reason:"invalid level idx"}),L)return;E=Math.min(E,b.length-1)}this.clearTimer();var u=this.currentLevelIndex,c=b[u],p=b[E];this.log("switching to level "+E+" from "+u),this.currentLevelIndex=E;var C=A({},p,{level:E,maxBitrate:p.maxBitrate,uri:p.uri,urlId:p.urlId});delete C._urlId,this.hls.trigger(i.Events.LEVEL_SWITCHING,C);var I=p.details;if(!I||I.live){var w=this.switchParams(p.uri,c==null?void 0:c.details);this.loadPlaylist(w)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(E){this.manualLevelIndex=E,this._startLevel===void 0&&(this._startLevel=E),E!==-1&&(this.level=E)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(E){this._firstLevel=E}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var E=this.hls.config.startLevel;return E!==void 0?E:this._firstLevel}return this._startLevel},set:function(E){this._startLevel=E}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(E){this.level=E,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=E)}}])&&T(h.prototype,m),l}(S.default)},"./src/controller/level-helper.ts":function(e,t,r){r.r(t),r.d(t,"addGroupId",function(){return a}),r.d(t,"assignTrackIdsByGroup",function(){return v}),r.d(t,"updatePTS",function(){return _}),r.d(t,"updateFragPTSDTS",function(){return o}),r.d(t,"mergeDetails",function(){return A}),r.d(t,"mapPartIntersection",function(){return T}),r.d(t,"mapFragmentIntersection",function(){return y}),r.d(t,"adjustSliding",function(){return R}),r.d(t,"addSliding",function(){return k}),r.d(t,"computeReloadInterval",function(){return g}),r.d(t,"getFragmentWithSN",function(){return s}),r.d(t,"getPartWith",function(){return d});var n=r("./src/polyfills/number.ts"),i=r("./src/utils/logger.ts");function a(l,h,m){switch(h){case"audio":l.audioGroupIds||(l.audioGroupIds=[]),l.audioGroupIds.push(m);break;case"text":l.textGroupIds||(l.textGroupIds=[]),l.textGroupIds.push(m)}}function v(l){var h={};l.forEach(function(m){var f=m.groupId||"";m.id=h[f]=h[f]||0,h[f]++})}function _(l,h,m){S(l[h],l[m])}function S(l,h){var m=h.startPTS;if(Object(n.isFiniteNumber)(m)){var f,E=0;h.sn>l.sn?(E=m-l.start,f=l):(E=l.start-m,f=h),f.duration!==E&&(f.duration=E)}else h.sn>l.sn?l.cc===h.cc&&l.minEndPTS?h.start=l.start+(l.minEndPTS-l.start):h.start=l.start+l.duration:h.start=Math.max(l.start-h.duration,0)}function o(l,h,m,f,E,D){f-m<=0&&(i.logger.warn("Fragment should have a positive duration",h),f=m+h.duration,D=E+h.duration);var b=m,L=f,u=h.startPTS,c=h.endPTS;if(Object(n.isFiniteNumber)(u)){var p=Math.abs(u-m);Object(n.isFiniteNumber)(h.deltaPTS)?h.deltaPTS=Math.max(p,h.deltaPTS):h.deltaPTS=p,b=Math.max(m,u),m=Math.min(m,u),E=Math.min(E,h.startDTS),L=Math.min(f,c),f=Math.max(f,c),D=Math.max(D,h.endDTS)}h.duration=f-m;var C=m-h.start;h.appendedPTS=f,h.start=h.startPTS=m,h.maxStartPTS=b,h.startDTS=E,h.endPTS=f,h.minEndPTS=L,h.endDTS=D;var I,w=h.sn;if(!l||w<l.startSN||w>l.endSN)return 0;var O=w-l.startSN,x=l.fragments;for(x[O]=h,I=O;I>0;I--)S(x[I],x[I-1]);for(I=O;I<x.length-1;I++)S(x[I],x[I+1]);return l.fragmentHint&&S(x[x.length-1],l.fragmentHint),l.PTSKnown=l.alignedSliding=!0,C}function A(l,h){for(var m=null,f=l.fragments,E=f.length-1;E>=0;E--){var D=f[E].initSegment;if(D){m=D;break}}l.fragmentHint&&delete l.fragmentHint.endPTS;var b,L=0;if(y(l,h,function(w,O){var x;w.relurl&&(L=w.cc-O.cc),Object(n.isFiniteNumber)(w.startPTS)&&Object(n.isFiniteNumber)(w.endPTS)&&(O.start=O.startPTS=w.startPTS,O.startDTS=w.startDTS,O.appendedPTS=w.appendedPTS,O.maxStartPTS=w.maxStartPTS,O.endPTS=w.endPTS,O.endDTS=w.endDTS,O.minEndPTS=w.minEndPTS,O.duration=w.endPTS-w.startPTS,O.duration&&(b=O),h.PTSKnown=h.alignedSliding=!0),O.elementaryStreams=w.elementaryStreams,O.loader=w.loader,O.stats=w.stats,O.urlId=w.urlId,w.initSegment?(O.initSegment=w.initSegment,m=w.initSegment):O.initSegment&&O.initSegment.relurl!=((x=m)===null||x===void 0?void 0:x.relurl)||(O.initSegment=m)}),h.skippedSegments&&(h.deltaUpdateFailed=h.fragments.some(function(w){return!w}),h.deltaUpdateFailed)){i.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var u=h.skippedSegments;u--;)h.fragments.shift();h.startSN=h.fragments[0].sn,h.startCC=h.fragments[0].cc}var c=h.fragments;if(L){i.logger.warn("discontinuity sliding from playlist, take drift into account");for(var p=0;p<c.length;p++)c[p].cc+=L}h.skippedSegments&&(h.startCC=h.fragments[0].cc),T(l.partList,h.partList,function(w,O){O.elementaryStreams=w.elementaryStreams,O.stats=w.stats}),b?o(h,b,b.startPTS,b.endPTS,b.startDTS,b.endDTS):R(l,h),c.length&&(h.totalduration=h.edge-c[0].start),h.driftStartTime=l.driftStartTime,h.driftStart=l.driftStart;var C=h.advancedDateTime;if(h.advanced&&C){var I=h.edge;h.driftStart||(h.driftStartTime=C,h.driftStart=I),h.driftEndTime=C,h.driftEnd=I}else h.driftEndTime=l.driftEndTime,h.driftEnd=l.driftEnd,h.advancedDateTime=l.advancedDateTime}function T(l,h,m){if(l&&h)for(var f=0,E=0,D=l.length;E<=D;E++){var b=l[E],L=h[E+f];b&&L&&b.index===L.index&&b.fragment.sn===L.fragment.sn?m(b,L):f--}}function y(l,h,m){for(var f=h.skippedSegments,E=Math.max(l.startSN,h.startSN)-h.startSN,D=(l.fragmentHint?1:0)+(f?h.endSN:Math.min(l.endSN,h.endSN))-h.startSN,b=h.startSN-l.startSN,L=h.fragmentHint?h.fragments.concat(h.fragmentHint):h.fragments,u=l.fragmentHint?l.fragments.concat(l.fragmentHint):l.fragments,c=E;c<=D;c++){var p=u[b+c],C=L[c];f&&!C&&c<f&&(C=h.fragments[c]=p),p&&C&&m(p,C)}}function R(l,h){var m=h.startSN+h.skippedSegments-l.startSN,f=l.fragments;m<0||m>=f.length||k(h,f[m].start)}function k(l,h){if(h){for(var m=l.fragments,f=l.skippedSegments;f<m.length;f++)m[f].start+=h;l.fragmentHint&&(l.fragmentHint.start+=h)}}function g(l,h){var m,f=1e3*l.levelTargetDuration,E=f/2,D=l.age,b=D>0&&D<3*f,L=h.loading.end-h.loading.start,u=l.availabilityDelay;if(l.updated===!1)if(b){var c=333*l.misses;m=Math.max(Math.min(E,2*L),c),l.availabilityDelay=(l.availabilityDelay||0)+m}else m=E;else b?(u=Math.min(u||f/2,D),l.availabilityDelay=u,m=u+f-D):m=f-L;return Math.round(m)}function s(l,h,m){if(!l||!l.details)return null;var f=l.details,E=f.fragments[h-f.startSN];return E||((E=f.fragmentHint)&&E.sn===h?E:h<f.startSN&&m&&m.sn===h?m:null)}function d(l,h,m){if(!l||!l.details)return null;var f=l.details.partList;if(f)for(var E=f.length;E--;){var D=f[E];if(D.index===m&&D.fragment.sn===h)return D}return null}},"./src/controller/stream-controller.ts":function(e,t,r){r.r(t),r.d(t,"default",function(){return l});var n=r("./src/polyfills/number.ts"),i=r("./src/controller/base-stream-controller.ts"),a=r("./src/is-supported.ts"),v=r("./src/events.ts"),_=r("./src/utils/buffer-helper.ts"),S=r("./src/controller/fragment-tracker.ts"),o=r("./src/types/loader.ts"),A=r("./src/loader/fragment.ts"),T=r("./src/demux/transmuxer-interface.ts"),y=r("./src/types/transmuxer.ts"),R=r("./src/controller/gap-controller.ts"),k=r("./src/errors.ts"),g=r("./src/utils/logger.ts");function s(h,m){for(var f=0;f<m.length;f++){var E=m[f];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(h,E.key,E)}}function d(h,m){return(d=Object.setPrototypeOf||function(f,E){return f.__proto__=E,f})(h,m)}var l=function(h){var m,f;function E(u,c){var p;return(p=h.call(this,u,c,"[stream-controller]")||this).audioCodecSwap=!1,p.gapController=null,p.level=-1,p._forceStartLoad=!1,p.altAudio=!1,p.audioOnly=!1,p.fragPlaying=null,p.onvplaying=null,p.onvseeked=null,p.fragLastKbps=0,p.stalled=!1,p.couldBacktrack=!1,p.audioCodecSwitch=!1,p.videoBuffer=null,p._registerListeners(),p}f=h,(m=E).prototype=Object.create(f.prototype),m.prototype.constructor=m,d(m,f);var D,b,L=E.prototype;return L._registerListeners=function(){var u=this.hls;u.on(v.Events.MEDIA_ATTACHED,this.onMediaAttached,this),u.on(v.Events.MEDIA_DETACHING,this.onMediaDetaching,this),u.on(v.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.on(v.Events.MANIFEST_PARSED,this.onManifestParsed,this),u.on(v.Events.LEVEL_LOADING,this.onLevelLoading,this),u.on(v.Events.LEVEL_LOADED,this.onLevelLoaded,this),u.on(v.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),u.on(v.Events.ERROR,this.onError,this),u.on(v.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),u.on(v.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),u.on(v.Events.BUFFER_CREATED,this.onBufferCreated,this),u.on(v.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),u.on(v.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),u.on(v.Events.FRAG_BUFFERED,this.onFragBuffered,this)},L._unregisterListeners=function(){var u=this.hls;u.off(v.Events.MEDIA_ATTACHED,this.onMediaAttached,this),u.off(v.Events.MEDIA_DETACHING,this.onMediaDetaching,this),u.off(v.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.off(v.Events.MANIFEST_PARSED,this.onManifestParsed,this),u.off(v.Events.LEVEL_LOADED,this.onLevelLoaded,this),u.off(v.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),u.off(v.Events.ERROR,this.onError,this),u.off(v.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),u.off(v.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),u.off(v.Events.BUFFER_CREATED,this.onBufferCreated,this),u.off(v.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),u.off(v.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),u.off(v.Events.FRAG_BUFFERED,this.onFragBuffered,this)},L.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},L.startLoad=function(u){if(this.levels){var c=this.lastCurrentTime,p=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var C=p.startLevel;C===-1&&(p.config.testBandwidth?(C=0,this.bitrateTest=!0):C=p.nextAutoLevel),this.level=p.nextLoadLevel=C,this.loadedmetadata=!1}c>0&&u===-1&&(this.log("Override startPosition with lastCurrentTime @"+c.toFixed(3)),u=c),this.state=i.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=u,this.tick()}else this._forceStartLoad=!0,this.state=i.State.STOPPED},L.stopLoad=function(){this._forceStartLoad=!1,h.prototype.stopLoad.call(this)},L.doTick=function(){switch(this.state){case i.State.IDLE:this.doTickIdle();break;case i.State.WAITING_LEVEL:var u,c=this.levels,p=this.level,C=c==null||(u=c[p])===null||u===void 0?void 0:u.details;if(C&&(!C.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(C))break;this.state=i.State.IDLE;break}break;case i.State.FRAG_LOADING_WAITING_RETRY:var I,w=self.performance.now(),O=this.retryDate;(!O||w>=O||(I=this.media)!==null&&I!==void 0&&I.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=i.State.IDLE)}this.onTickEnd()},L.onTickEnd=function(){h.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},L.doTickIdle=function(){var u,c,p=this.hls,C=this.levelLastLoaded,I=this.levels,w=this.media,O=p.config,x=p.nextLoadLevel;if(C!==null&&(w||!this.startFragRequested&&O.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&I&&I[x]){var P=I[x];this.level=p.nextLoadLevel=x;var F=P.details;if(!F||this.state===i.State.WAITING_LEVEL||F.live&&this.levelLastLoaded!==x)this.state=i.State.WAITING_LEVEL;else{var M=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:w,o.PlaylistLevelType.MAIN);if(M!==null&&!(M.len>=this.getMaxBufferLength(P.maxBitrate))){if(this._streamEnded(M,F)){var U={};return this.altAudio&&(U.type="video"),this.hls.trigger(v.Events.BUFFER_EOS,U),void(this.state=i.State.ENDED)}var G=M.end,K=this.getNextFragment(G,F);if(this.couldBacktrack&&!this.fragPrevious&&K&&K.sn!=="initSegment"){var q=K.sn-F.startSN;q>1&&(K=F.fragments[q-1],this.fragmentTracker.removeFragment(K))}if(K&&this.fragmentTracker.getState(K)===S.FragmentState.OK&&this.nextLoadPosition>G){var Z=this.audioOnly&&!this.altAudio?A.ElementaryStreamTypes.AUDIO:A.ElementaryStreamTypes.VIDEO;this.afterBufferFlushed(w,Z,o.PlaylistLevelType.MAIN),K=this.getNextFragment(this.nextLoadPosition,F)}K&&(!K.initSegment||K.initSegment.data||this.bitrateTest||(K=K.initSegment),((u=K.decryptdata)===null||u===void 0?void 0:u.keyFormat)!=="identity"||(c=K.decryptdata)!==null&&c!==void 0&&c.key?this.loadFragment(K,F,G):this.loadKey(K,F))}}}},L.loadFragment=function(u,c,p){var C,I=this.fragmentTracker.getState(u);if(this.fragCurrent=u,I===S.FragmentState.BACKTRACKED){var w=this.fragmentTracker.getBacktrackData(u);if(w)return this._handleFragmentLoadProgress(w),void this._handleFragmentLoadComplete(w);I=S.FragmentState.NOT_LOADED}I===S.FragmentState.NOT_LOADED||I===S.FragmentState.PARTIAL?u.sn==="initSegment"?this._loadInitSegment(u):this.bitrateTest?(u.bitrateTest=!0,this.log("Fragment "+u.sn+" of level "+u.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(u)):(this.startFragRequested=!0,h.prototype.loadFragment.call(this,u,c,p)):I===S.FragmentState.APPENDING?this.reduceMaxBufferLength(u.duration)&&this.fragmentTracker.removeFragment(u):((C=this.media)===null||C===void 0?void 0:C.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},L.getAppendedFrag=function(u){var c=this.fragmentTracker.getAppendedFrag(u,o.PlaylistLevelType.MAIN);return c&&"fragment"in c?c.fragment:c},L.getBufferedFrag=function(u){return this.fragmentTracker.getBufferedFrag(u,o.PlaylistLevelType.MAIN)},L.followingBufferedFrag=function(u){return u?this.getBufferedFrag(u.end+.5):null},L.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},L.nextLevelSwitch=function(){var u=this.levels,c=this.media;if(c!=null&&c.readyState){var p,C=this.getAppendedFrag(c.currentTime);if(C&&C.start>1&&this.flushMainBuffer(0,C.start-1),!c.paused&&u){var I=u[this.hls.nextLoadLevel],w=this.fragLastKbps;p=w&&this.fragCurrent?this.fragCurrent.duration*I.maxBitrate/(1e3*w)+1:0}else p=0;var O=this.getBufferedFrag(c.currentTime+p);if(O){var x=this.followingBufferedFrag(O);if(x){this.abortCurrentFrag();var P=x.maxStartPTS?x.maxStartPTS:x.start,F=x.duration,M=Math.max(O.end,P+Math.min(Math.max(F-this.config.maxFragLookUpTolerance,.5*F),.75*F));this.flushMainBuffer(M,Number.POSITIVE_INFINITY)}}}},L.abortCurrentFrag=function(){var u=this.fragCurrent;this.fragCurrent=null,u!=null&&u.loader&&u.loader.abort(),this.state===i.State.KEY_LOADING&&(this.state=i.State.IDLE),this.nextLoadPosition=this.getLoadPosition()},L.flushMainBuffer=function(u,c){h.prototype.flushMainBuffer.call(this,u,c,this.altAudio?"video":null)},L.onMediaAttached=function(u,c){h.prototype.onMediaAttached.call(this,u,c);var p=c.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),p.addEventListener("playing",this.onvplaying),p.addEventListener("seeked",this.onvseeked),this.gapController=new R.default(this.config,p,this.fragmentTracker,this.hls)},L.onMediaDetaching=function(){var u=this.media;u&&(u.removeEventListener("playing",this.onvplaying),u.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),h.prototype.onMediaDetaching.call(this)},L.onMediaPlaying=function(){this.tick()},L.onMediaSeeked=function(){var u=this.media,c=u?u.currentTime:null;Object(n.isFiniteNumber)(c)&&this.log("Media seeked to "+c.toFixed(3)),this.tick()},L.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(v.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=this.stalled=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null},L.onManifestParsed=function(u,c){var p,C=!1,I=!1;c.levels.forEach(function(w){(p=w.audioCodec)&&(p.indexOf("mp4a.40.2")!==-1&&(C=!0),p.indexOf("mp4a.40.5")!==-1&&(I=!0))}),this.audioCodecSwitch=C&&I&&!Object(a.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=c.levels,this.startFragRequested=!1},L.onLevelLoading=function(u,c){var p=this.levels;if(p&&this.state===i.State.IDLE){var C=p[c.level];(!C.details||C.details.live&&this.levelLastLoaded!==c.level||this.waitForCdnTuneIn(C.details))&&(this.state=i.State.WAITING_LEVEL)}},L.onLevelLoaded=function(u,c){var p,C=this.levels,I=c.level,w=c.details,O=w.totalduration;if(C){this.log("Level "+I+" loaded ["+w.startSN+","+w.endSN+"], cc ["+w.startCC+", "+w.endCC+"] duration:"+O);var x=this.fragCurrent;!x||this.state!==i.State.FRAG_LOADING&&this.state!==i.State.FRAG_LOADING_WAITING_RETRY||x.level!==c.level&&x.loader&&(this.state=i.State.IDLE,x.loader.abort());var P=C[I],F=0;if(w.live||(p=P.details)!==null&&p!==void 0&&p.live){if(w.fragments[0]||(w.deltaUpdateFailed=!0),w.deltaUpdateFailed)return;F=this.alignPlaylists(w,P.details)}if(P.details=w,this.levelLastLoaded=I,this.hls.trigger(v.Events.LEVEL_UPDATED,{details:w,level:I}),this.state===i.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(w))return;this.state=i.State.IDLE}this.startFragRequested?w.live&&this.synchronizeToLiveEdge(w):this.setStartPosition(w,F),this.tick()}else this.warn("Levels were reset while loading level "+I)},L._handleFragmentLoadProgress=function(u){var c,p=u.frag,C=u.part,I=u.payload,w=this.levels;if(w){var O=w[p.level],x=O.details;if(x){var P=O.videoCodec,F=x.PTSKnown||!x.live,M=(c=p.initSegment)===null||c===void 0?void 0:c.data,U=this._getAudioCodec(O),G=this.transmuxer=this.transmuxer||new T.default(this.hls,o.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),K=C?C.index:-1,q=K!==-1,Z=new y.ChunkMetadata(p.level,p.sn,p.stats.chunkCount,I.byteLength,K,q),ee=this.initPTS[p.cc];G.push(I,M,U,P,p,C,x.totalduration,F,Z,ee)}else this.warn("Dropping fragment "+p.sn+" of level "+p.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+p.sn+" of level "+p.level+" will not be buffered")},L.onAudioTrackSwitching=function(u,c){var p=this.altAudio,C=!!c.url,I=c.id;if(!C){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var w=this.fragCurrent;w!=null&&w.loader&&(this.log("Switching to main audio track, cancel main fragment load"),w.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var O=this.hls;p&&O.trigger(v.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),O.trigger(v.Events.AUDIO_TRACK_SWITCHED,{id:I})}},L.onAudioTrackSwitched=function(u,c){var p=c.id,C=!!this.hls.audioTracks[p].url;if(C){var I=this.videoBuffer;I&&this.mediaBuffer!==I&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=I)}this.altAudio=C,this.tick()},L.onBufferCreated=function(u,c){var p,C,I=c.tracks,w=!1;for(var O in I){var x=I[O];if(x.id==="main"){if(C=O,p=x,O==="video"){var P=I[O];P&&(this.videoBuffer=P.buffer)}}else w=!0}w&&p?(this.log("Alternate track found, use "+C+".buffered to schedule main fragment loading"),this.mediaBuffer=p.buffer):this.mediaBuffer=this.media},L.onFragBuffered=function(u,c){var p=c.frag,C=c.part;if(!p||p.type===o.PlaylistLevelType.MAIN){if(this.fragContextChanged(p))return this.warn("Fragment "+p.sn+(C?" p: "+C.index:"")+" of level "+p.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===i.State.PARSED&&(this.state=i.State.IDLE));var I=C?C.stats:p.stats;this.fragLastKbps=Math.round(8*I.total/(I.buffering.end-I.loading.first)),p.sn!=="initSegment"&&(this.fragPrevious=p),this.fragBufferedComplete(p,C)}},L.onError=function(u,c){switch(c.details){case k.ErrorDetails.FRAG_LOAD_ERROR:case k.ErrorDetails.FRAG_LOAD_TIMEOUT:case k.ErrorDetails.KEY_LOAD_ERROR:case k.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(o.PlaylistLevelType.MAIN,c);break;case k.ErrorDetails.LEVEL_LOAD_ERROR:case k.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==i.State.ERROR&&(c.fatal?(this.warn(""+c.details),this.state=i.State.ERROR):c.levelRetry||this.state!==i.State.WAITING_LEVEL||(this.state=i.State.IDLE));break;case k.ErrorDetails.BUFFER_FULL_ERROR:if(c.parent==="main"&&(this.state===i.State.PARSING||this.state===i.State.PARSED)){var p=!0,C=this.getFwdBufferInfo(this.media,o.PlaylistLevelType.MAIN);C&&C.len>.5&&(p=!this.reduceMaxBufferLength(C.len)),p&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}}},L.checkBuffer=function(){var u=this.media,c=this.gapController;if(u&&c&&u.readyState){var p=_.BufferHelper.getBuffered(u);!this.loadedmetadata&&p.length?(this.loadedmetadata=!0,this.seekToStartPos()):c.poll(this.lastCurrentTime),this.lastCurrentTime=u.currentTime}},L.onFragLoadEmergencyAborted=function(){this.state=i.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},L.onBufferFlushed=function(u,c){var p=c.type;if(p!==A.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var C=(p===A.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(C,p,o.PlaylistLevelType.MAIN)}},L.onLevelsUpdated=function(u,c){this.levels=c.levels},L.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},L.seekToStartPos=function(){var u=this.media,c=u.currentTime,p=this.startPosition;if(p>=0&&c<p){if(u.seeking)return void g.logger.log("could not seek to "+p+", already seeking at "+c);var C=_.BufferHelper.getBuffered(u),I=(C.length?C.start(0):0)-p;I>0&&I<this.config.maxBufferHole&&(g.logger.log("adjusting start position by "+I+" to match buffer start"),p+=I,this.startPosition=p),this.log("seek to target start position "+p+" from current time "+c),u.currentTime=p}},L._getAudioCodec=function(u){var c=this.config.defaultAudioCodec||u.audioCodec;return this.audioCodecSwap&&c&&(this.log("Swapping audio codec"),c=c.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),c},L._loadBitrateTestFrag=function(u){var c=this;this._doFragLoad(u).then(function(p){var C=c.hls;if(p&&!C.nextLoadLevel&&!c.fragContextChanged(u)){c.fragLoadError=0,c.state=i.State.IDLE,c.startFragRequested=!1,c.bitrateTest=!1;var I=u.stats;I.parsing.start=I.parsing.end=I.buffering.start=I.buffering.end=self.performance.now(),C.trigger(v.Events.FRAG_LOADED,p)}})},L._handleTransmuxComplete=function(u){var c,p="main",C=this.hls,I=u.remuxResult,w=u.chunkMeta,O=this.getCurrentContext(w);if(!O)return this.warn("The loading context changed while buffering fragment "+w.sn+" of level "+w.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(w.level);var x=O.frag,P=O.part,F=O.level,M=I.video,U=I.text,G=I.id3,K=I.initSegment,q=this.altAudio?void 0:I.audio;if(!this.fragContextChanged(x)){if(this.state=i.State.PARSING,K){K.tracks&&(this._bufferInitSegment(F,K.tracks,x,w),C.trigger(v.Events.FRAG_PARSING_INIT_SEGMENT,{frag:x,id:p,tracks:K.tracks}));var Z=K.initPTS,ee=K.timescale;Object(n.isFiniteNumber)(Z)&&(this.initPTS[x.cc]=Z,C.trigger(v.Events.INIT_PTS_FOUND,{frag:x,id:p,initPTS:Z,timescale:ee}))}if(M&&I.independent!==!1){if(F.details){var se=M.startPTS,ne=M.endPTS,ae=M.startDTS,me=M.endDTS;if(P)P.elementaryStreams[M.type]={startPTS:se,endPTS:ne,startDTS:ae,endDTS:me};else if(M.firstKeyFrame&&M.independent&&(this.couldBacktrack=!0),M.dropped&&M.independent){if(this.getLoadPosition()+this.config.maxBufferHole<se)return void this.backtrack(x);x.setElementaryStreamInfo(M.type,x.start,ne,x.start,me,!0)}x.setElementaryStreamInfo(M.type,se,ne,ae,me),this.bufferFragmentData(M,x,P,w)}}else if(I.independent===!1)return void this.backtrack(x);if(q){var Ee=q.startPTS,N=q.endPTS,B=q.startDTS,j=q.endDTS;P&&(P.elementaryStreams[A.ElementaryStreamTypes.AUDIO]={startPTS:Ee,endPTS:N,startDTS:B,endDTS:j}),x.setElementaryStreamInfo(A.ElementaryStreamTypes.AUDIO,Ee,N,B,j),this.bufferFragmentData(q,x,P,w)}if(G!=null&&(c=G.samples)!==null&&c!==void 0&&c.length){var H={frag:x,id:p,samples:G.samples};C.trigger(v.Events.FRAG_PARSING_METADATA,H)}if(U){var V={frag:x,id:p,samples:U.samples};C.trigger(v.Events.FRAG_PARSING_USERDATA,V)}}},L._bufferInitSegment=function(u,c,p,C){var I=this;if(this.state===i.State.PARSING){this.audioOnly=!!c.audio&&!c.video,this.altAudio&&!this.audioOnly&&delete c.audio;var w=c.audio,O=c.video,x=c.audiovideo;if(w){var P=u.audioCodec,F=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(P&&(P=P.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),w.metadata.channelCount!==1&&F.indexOf("firefox")===-1&&(P="mp4a.40.5")),F.indexOf("android")!==-1&&w.container!=="audio/mpeg"&&(P="mp4a.40.2",this.log("Android: force audio codec to "+P)),u.audioCodec&&u.audioCodec!==P&&this.log('Swapping manifest audio codec "'+u.audioCodec+'" for "'+P+'"'),w.levelCodec=P,w.id="main",this.log("Init audio buffer, container:"+w.container+", codecs[selected/level/parsed]=["+(P||"")+"/"+(u.audioCodec||"")+"/"+w.codec+"]")}O&&(O.levelCodec=u.videoCodec,O.id="main",this.log("Init video buffer, container:"+O.container+", codecs[level/parsed]=["+(u.videoCodec||"")+"/"+O.codec+"]")),x&&this.log("Init audiovideo buffer, container:"+x.container+", codecs[level/parsed]=["+(u.attrs.CODECS||"")+"/"+x.codec+"]"),this.hls.trigger(v.Events.BUFFER_CODECS,c),Object.keys(c).forEach(function(M){var U=c[M].initSegment;U!=null&&U.byteLength&&I.hls.trigger(v.Events.BUFFER_APPENDING,{type:M,data:U,frag:p,part:null,chunkMeta:C,parent:p.type})}),this.tick()}},L.backtrack=function(u){this.couldBacktrack=!0,this.resetTransmuxer(),this.flushBufferGap(u);var c=this.fragmentTracker.backtrack(u);this.fragPrevious=null,this.nextLoadPosition=u.start,c?this.resetFragmentLoading(u):this.state=i.State.BACKTRACKING},L.checkFragmentChanged=function(){var u=this.media,c=null;if(u&&u.readyState>1&&u.seeking===!1){var p=u.currentTime;if(_.BufferHelper.isBuffered(u,p)?c=this.getAppendedFrag(p):_.BufferHelper.isBuffered(u,p+.1)&&(c=this.getAppendedFrag(p+.1)),c){var C=this.fragPlaying,I=c.level;C&&c.sn===C.sn&&C.level===I&&c.urlId===C.urlId||(this.hls.trigger(v.Events.FRAG_CHANGED,{frag:c}),C&&C.level===I||this.hls.trigger(v.Events.LEVEL_SWITCHED,{level:I}),this.fragPlaying=c)}}},D=E,(b=[{key:"nextLevel",get:function(){var u=this.nextBufferedFrag;return u?u.level:-1}},{key:"currentLevel",get:function(){var u=this.media;if(u){var c=this.getAppendedFrag(u.currentTime);if(c)return c.level}return-1}},{key:"nextBufferedFrag",get:function(){var u=this.media;if(u){var c=this.getAppendedFrag(u.currentTime);return this.followingBufferedFrag(c)}return null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}])&&s(D.prototype,b),E}(i.default)},"./src/controller/subtitle-stream-controller.ts":function(e,t,r){r.r(t),r.d(t,"SubtitleStreamController",function(){return g});var n=r("./src/events.ts"),i=r("./src/utils/logger.ts"),a=r("./src/utils/buffer-helper.ts"),v=r("./src/controller/fragment-finders.ts"),_=r("./src/utils/discontinuities.ts"),S=r("./src/controller/level-helper.ts"),o=r("./src/controller/fragment-tracker.ts"),A=r("./src/controller/base-stream-controller.ts"),T=r("./src/types/loader.ts"),y=r("./src/types/level.ts");function R(s,d){for(var l=0;l<d.length;l++){var h=d[l];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(s,h.key,h)}}function k(s,d){return(k=Object.setPrototypeOf||function(l,h){return l.__proto__=h,l})(s,d)}var g=function(s){var d,l;function h(D,b){var L;return(L=s.call(this,D,b,"[subtitle-stream-controller]")||this).levels=[],L.currentTrackId=-1,L.tracksBuffered=[],L.mainDetails=null,L._registerListeners(),L}l=s,(d=h).prototype=Object.create(l.prototype),d.prototype.constructor=d,k(d,l);var m,f,E=h.prototype;return E.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},E._registerListeners=function(){var D=this.hls;D.on(n.Events.MEDIA_ATTACHED,this.onMediaAttached,this),D.on(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this),D.on(n.Events.MANIFEST_LOADING,this.onManifestLoading,this),D.on(n.Events.LEVEL_LOADED,this.onLevelLoaded,this),D.on(n.Events.ERROR,this.onError,this),D.on(n.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),D.on(n.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),D.on(n.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),D.on(n.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),D.on(n.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},E._unregisterListeners=function(){var D=this.hls;D.off(n.Events.MEDIA_ATTACHED,this.onMediaAttached,this),D.off(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this),D.off(n.Events.MANIFEST_LOADING,this.onManifestLoading,this),D.off(n.Events.LEVEL_LOADED,this.onLevelLoaded,this),D.off(n.Events.ERROR,this.onError,this),D.off(n.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),D.off(n.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),D.off(n.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),D.off(n.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),D.off(n.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},E.startLoad=function(){this.stopLoad(),this.state=A.State.IDLE,this.setInterval(500),this.tick()},E.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},E.onLevelLoaded=function(D,b){this.mainDetails=b.details},E.onSubtitleFragProcessed=function(D,b){var L=b.frag,u=b.success;if(this.fragPrevious=L,this.state=A.State.IDLE,u){var c=this.tracksBuffered[this.currentTrackId];if(c){for(var p,C=L.start,I=0;I<c.length;I++)if(C>=c[I].start&&C<=c[I].end){p=c[I];break}var w=L.start+L.duration;p?p.end=w:(p={start:C,end:w},c.push(p)),this.fragmentTracker.fragBuffered(L)}}},E.onBufferFlushing=function(D,b){var L=b.startOffset,u=b.endOffset;if(L===0&&u!==Number.POSITIVE_INFINITY){var c=this.currentTrackId,p=this.levels;if(!p.length||!p[c]||!p[c].details)return;var C=u-p[c].details.targetduration;if(C<=0)return;b.endOffsetSubtitles=Math.max(0,C),this.tracksBuffered.forEach(function(I){for(var w=0;w<I.length;)if(I[w].end<=C)I.shift();else{if(!(I[w].start<C))break;I[w].start=C,w++}}),this.fragmentTracker.removeFragmentsInRange(L,C,T.PlaylistLevelType.SUBTITLE)}},E.onError=function(D,b){var L,u=b.frag;u&&u.type===T.PlaylistLevelType.SUBTITLE&&((L=this.fragCurrent)!==null&&L!==void 0&&L.loader&&this.fragCurrent.loader.abort(),this.state=A.State.IDLE)},E.onSubtitleTracksUpdated=function(D,b){var L=this,u=b.subtitleTracks;this.tracksBuffered=[],this.levels=u.map(function(c){return new y.Level(c)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(c){L.tracksBuffered[c.id]=[]}),this.mediaBuffer=null},E.onSubtitleTrackSwitch=function(D,b){if(this.currentTrackId=b.id,this.levels.length&&this.currentTrackId!==-1){var L=this.levels[this.currentTrackId];L!=null&&L.details?(this.mediaBuffer=this.mediaBufferTimeRanges,this.setInterval(500)):this.mediaBuffer=null}else this.clearInterval()},E.onSubtitleTrackLoaded=function(D,b){var L,u=b.details,c=b.id,p=this.currentTrackId,C=this.levels;if(C.length){var I=C[p];if(!(c>=C.length||c!==p)&&I){if(this.mediaBuffer=this.mediaBufferTimeRanges,u.live||(L=I.details)!==null&&L!==void 0&&L.live){var w=this.mainDetails;if(u.deltaUpdateFailed||!w)return;var O=w.fragments[0];I.details?this.alignPlaylists(u,I.details)===0&&O&&Object(S.addSliding)(u,O.start):u.hasProgramDateTime&&w.hasProgramDateTime?Object(_.alignPDT)(u,w):O&&Object(S.addSliding)(u,O.start)}I.details=u,this.levelLastLoaded=c,this.tick(),u.live&&!this.fragCurrent&&this.media&&this.state===A.State.IDLE&&(Object(v.findFragmentByPTS)(null,u.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),I.details=void 0))}}},E._handleFragmentLoadComplete=function(D){var b=D.frag,L=D.payload,u=b.decryptdata,c=this.hls;if(!this.fragContextChanged(b)&&L&&L.byteLength>0&&u&&u.key&&u.iv&&u.method==="AES-128"){var p=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(L),u.key.buffer,u.iv.buffer).then(function(C){var I=performance.now();c.trigger(n.Events.FRAG_DECRYPTED,{frag:b,payload:C,stats:{tstart:p,tdecrypt:I}})})}},E.doTick=function(){if(this.media){if(this.state===A.State.IDLE){var D,b=this.currentTrackId,L=this.levels;if(!L.length||!L[b]||!L[b].details)return;var u=L[b].details,c=u.targetduration,p=this.config,C=this.media,I=a.BufferHelper.bufferedInfo(this.mediaBufferTimeRanges,C.currentTime-c,p.maxBufferHole),w=I.end;if(I.len>this.getMaxBufferLength()+c)return;console.assert(u,"Subtitle track details are defined on idle subtitle stream controller tick");var O,x=u.fragments,P=x.length,F=u.edge,M=this.fragPrevious;if(w<F){var U=p.maxFragLookUpTolerance;M&&u.hasProgramDateTime&&(O=Object(v.findFragmentByPDT)(x,M.endProgramDateTime,U)),O||!(O=Object(v.findFragmentByPTS)(M,x,w,U))&&M&&M.start<x[0].start&&(O=x[0])}else O=x[P-1];(D=O)!==null&&D!==void 0&&D.encrypted?(i.logger.log("Loading key for "+O.sn),this.state=A.State.KEY_LOADING,this.hls.trigger(n.Events.KEY_LOADING,{frag:O})):O&&this.fragmentTracker.getState(O)===o.FragmentState.NOT_LOADED&&this.loadFragment(O,u,w)}}else this.state=A.State.IDLE},E.loadFragment=function(D,b,L){this.fragCurrent=D,s.prototype.loadFragment.call(this,D,b,L)},m=h,(f=[{key:"mediaBufferTimeRanges",get:function(){return this.tracksBuffered[this.currentTrackId]||[]}}])&&R(m.prototype,f),h}(A.default)},"./src/controller/subtitle-track-controller.ts":function(e,t,r){r.r(t);var n=r("./src/events.ts"),i=r("./src/utils/texttrack-utils.ts"),a=r("./src/controller/base-playlist-controller.ts"),v=r("./src/types/loader.ts");function _(T,y){for(var R=0;R<y.length;R++){var k=y[R];k.enumerable=k.enumerable||!1,k.configurable=!0,"value"in k&&(k.writable=!0),Object.defineProperty(T,k.key,k)}}function S(T,y){return(S=Object.setPrototypeOf||function(R,k){return R.__proto__=k,R})(T,y)}var o=function(T){var y,R;function k(l){var h;return(h=T.call(this,l,"[subtitle-track-controller]")||this).media=null,h.tracks=[],h.groupId=null,h.tracksInGroup=[],h.trackId=-1,h.selectDefaultTrack=!0,h.queuedDefaultTrack=-1,h.trackChangeListener=function(){return h.onTextTracksChanged()},h.asyncPollTrackChange=function(){return h.pollTrackChange(0)},h.useTextTrackPolling=!1,h.subtitlePollingInterval=-1,h.subtitleDisplay=!0,h.registerListeners(),h}R=T,(y=k).prototype=Object.create(R.prototype),y.prototype.constructor=y,S(y,R);var g,s,d=k.prototype;return d.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,T.prototype.destroy.call(this)},d.registerListeners=function(){var l=this.hls;l.on(n.Events.MEDIA_ATTACHED,this.onMediaAttached,this),l.on(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this),l.on(n.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.on(n.Events.MANIFEST_PARSED,this.onManifestParsed,this),l.on(n.Events.LEVEL_LOADING,this.onLevelLoading,this),l.on(n.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),l.on(n.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),l.on(n.Events.ERROR,this.onError,this)},d.unregisterListeners=function(){var l=this.hls;l.off(n.Events.MEDIA_ATTACHED,this.onMediaAttached,this),l.off(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this),l.off(n.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.off(n.Events.MANIFEST_PARSED,this.onManifestParsed,this),l.off(n.Events.LEVEL_LOADING,this.onLevelLoading,this),l.off(n.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),l.off(n.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),l.off(n.Events.ERROR,this.onError,this)},d.onMediaAttached=function(l,h){this.media=h.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},d.pollTrackChange=function(l){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,l)},d.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),A(this.media.textTracks).forEach(function(l){Object(i.clearCurrentCues)(l)}),this.subtitleTrack=-1,this.media=null)},d.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},d.onManifestParsed=function(l,h){this.tracks=h.subtitleTracks},d.onSubtitleTrackLoaded=function(l,h){var m=h.id,f=h.details,E=this.trackId,D=this.tracksInGroup[E];if(D){var b=D.details;D.details=h.details,this.log("subtitle track "+m+" loaded ["+f.startSN+"-"+f.endSN+"]"),m===this.trackId&&(this.retryCount=0,this.playlistLoaded(m,h,b))}else this.warn("Invalid subtitle track id "+m)},d.onLevelLoading=function(l,h){this.switchLevel(h.level)},d.onLevelSwitching=function(l,h){this.switchLevel(h.level)},d.switchLevel=function(l){var h=this.hls.levels[l];if(h!=null&&h.textGroupIds){var m=h.textGroupIds[h.urlId];if(this.groupId!==m){var f=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,E=this.tracks.filter(function(L){return!m||L.groupId===m});this.tracksInGroup=E;var D=this.findTrackId(f==null?void 0:f.name)||this.findTrackId();this.groupId=m;var b={subtitleTracks:E};this.log("Updating subtitle tracks, "+E.length+' track(s) found in "'+m+'" group-id'),this.hls.trigger(n.Events.SUBTITLE_TRACKS_UPDATED,b),D!==-1&&this.setSubtitleTrack(D,f)}}},d.findTrackId=function(l){for(var h=this.tracksInGroup,m=0;m<h.length;m++){var f=h[m];if((!this.selectDefaultTrack||f.default)&&(!l||l===f.name))return f.id}return-1},d.onError=function(l,h){T.prototype.onError.call(this,l,h),!h.fatal&&h.context&&h.context.type===v.PlaylistContextType.SUBTITLE_TRACK&&h.context.id===this.trackId&&h.context.groupId===this.groupId&&this.retryLoadingOrFail(h)},d.loadPlaylist=function(l){var h=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(h)){var m=h.id,f=h.groupId,E=h.url;if(l)try{E=l.addDirectives(E)}catch(D){this.warn("Could not construct new URL with HLS Delivery Directives: "+D)}this.log("Loading subtitle playlist for id "+m),this.hls.trigger(n.Events.SUBTITLE_TRACK_LOADING,{url:E,id:m,groupId:f,deliveryDirectives:l||null})}},d.toggleTrackModes=function(l){var h=this,m=this.media,f=this.subtitleDisplay,E=this.trackId;if(m){var D=A(m.textTracks),b=D.filter(function(c){return c.groupId===h.groupId});if(l===-1)[].slice.call(D).forEach(function(c){c.mode="disabled"});else{var L=b[E];L&&(L.mode="disabled")}var u=b[l];u&&(u.mode=f?"showing":"hidden")}},d.setSubtitleTrack=function(l,h){var m,f=this.tracksInGroup;if(this.media){if(this.trackId!==l&&this.toggleTrackModes(l),!(this.trackId===l&&(l===-1||(m=f[l])!==null&&m!==void 0&&m.details)||l<-1||l>=f.length)){this.clearTimer();var E=f[l];if(this.log("Switching to subtitle track "+l),this.trackId=l,E){var D=E.id,b=E.groupId,L=b===void 0?"":b,u=E.name,c=E.type,p=E.url;this.hls.trigger(n.Events.SUBTITLE_TRACK_SWITCH,{id:D,groupId:L,name:u,type:c,url:p});var C=this.switchParams(E.url,h==null?void 0:h.details);this.loadPlaylist(C)}else this.hls.trigger(n.Events.SUBTITLE_TRACK_SWITCH,{id:l})}}else this.queuedDefaultTrack=l},d.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var l=-1,h=A(this.media.textTracks),m=0;m<h.length;m++)if(h[m].mode==="hidden")l=m;else if(h[m].mode==="showing"){l=m;break}this.subtitleTrack!==l&&(this.subtitleTrack=l)}},g=k,(s=[{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(l){this.selectDefaultTrack=!1;var h=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(l,h)}}])&&_(g.prototype,s),k}(a.default);function A(T){for(var y=[],R=0;R<T.length;R++){var k=T[R];k.kind==="subtitles"&&k.label&&y.push(T[R])}return y}t.default=o},"./src/controller/timeline-controller.ts":function(e,t,r){r.r(t),r.d(t,"TimelineController",function(){return y});var n=r("./src/polyfills/number.ts"),i=r("./src/events.ts"),a=r("./src/utils/cea-608-parser.ts"),v=r("./src/utils/output-filter.ts"),_=r("./src/utils/webvtt-parser.ts"),S=r("./src/utils/texttrack-utils.ts"),o=r("./src/utils/imsc1-ttml-parser.ts"),A=r("./src/types/loader.ts"),T=r("./src/utils/logger.ts"),y=function(){function k(s){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this.captionsProperties=void 0,this.hls=s,this.config=s.config,this.Cues=s.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var d=new v.default(this,"textTrack1"),l=new v.default(this,"textTrack2"),h=new v.default(this,"textTrack3"),m=new v.default(this,"textTrack4");this.cea608Parser1=new a.default(1,d,l),this.cea608Parser2=new a.default(3,h,m)}s.on(i.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),s.on(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.on(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),s.on(i.Events.MANIFEST_LOADED,this.onManifestLoaded,this),s.on(i.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),s.on(i.Events.FRAG_LOADING,this.onFragLoading,this),s.on(i.Events.FRAG_LOADED,this.onFragLoaded,this),s.on(i.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),s.on(i.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),s.on(i.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),s.on(i.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),s.on(i.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var g=k.prototype;return g.destroy=function(){var s=this.hls;s.off(i.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),s.off(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.off(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),s.off(i.Events.MANIFEST_LOADED,this.onManifestLoaded,this),s.off(i.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),s.off(i.Events.FRAG_LOADING,this.onFragLoading,this),s.off(i.Events.FRAG_LOADED,this.onFragLoaded,this),s.off(i.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),s.off(i.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),s.off(i.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),s.off(i.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),s.off(i.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},g.addCues=function(s,d,l,h,m){for(var f,E,D,b,L=!1,u=m.length;u--;){var c=m[u],p=(f=c[0],E=c[1],D=d,b=l,Math.min(E,b)-Math.max(f,D));if(p>=0&&(c[0]=Math.min(c[0],d),c[1]=Math.max(c[1],l),L=!0,p/(l-d)>.5))return}if(L||m.push([d,l]),this.config.renderTextTracksNatively){var C=this.captionsTracks[s];this.Cues.newCue(C,d,l,h)}else{var I=this.Cues.newCue(null,d,l,h);this.hls.trigger(i.Events.CUES_PARSED,{type:"captions",cues:I,track:s})}},g.onInitPtsFound=function(s,d){var l=this,h=d.frag,m=d.id,f=d.initPTS,E=d.timescale,D=this.unparsedVttFrags;m==="main"&&(this.initPTS[h.cc]=f,this.timescale[h.cc]=E),D.length&&(this.unparsedVttFrags=[],D.forEach(function(b){l.onFragLoaded(i.Events.FRAG_LOADED,b)}))},g.getExistingTrack=function(s){var d=this.media;if(d)for(var l=0;l<d.textTracks.length;l++){var h=d.textTracks[l];if(h[s])return h}return null},g.createCaptionsTrack=function(s){this.config.renderTextTracksNatively?this.createNativeTrack(s):this.createNonNativeTrack(s)},g.createNativeTrack=function(s){if(!this.captionsTracks[s]){var d=this.captionsProperties,l=this.captionsTracks,h=this.media,m=d[s],f=m.label,E=m.languageCode,D=this.getExistingTrack(s);if(D)l[s]=D,Object(S.clearCurrentCues)(l[s]),Object(S.sendAddTrackEvent)(l[s],h);else{var b=this.createTextTrack("captions",f,E);b&&(b[s]=!0,l[s]=b)}}},g.createNonNativeTrack=function(s){if(!this.nonNativeCaptionsTracks[s]){var d=this.captionsProperties[s];if(d){var l={_id:s,label:d.label,kind:"captions",default:!!d.media&&!!d.media.default,closedCaptions:d.media};this.nonNativeCaptionsTracks[s]=l,this.hls.trigger(i.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[l]})}}},g.createTextTrack=function(s,d,l){var h=this.media;if(h)return h.addTextTrack(s,d,l)},g.onMediaAttaching=function(s,d){this.media=d.media,this._cleanTracks()},g.onMediaDetaching=function(){var s=this.captionsTracks;Object.keys(s).forEach(function(d){Object(S.clearCurrentCues)(s[d]),delete s[d]}),this.nonNativeCaptionsTracks={}},g.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},g._cleanTracks=function(){var s=this.media;if(s){var d=s.textTracks;if(d)for(var l=0;l<d.length;l++)Object(S.clearCurrentCues)(d[l])}},g.onSubtitleTracksUpdated=function(s,d){var l=this;this.textTracks=[];var h=d.subtitleTracks||[],m=h.some(function(b){return b.textCodec===o.IMSC1_CODEC});if(this.config.enableWebVTT||m&&this.config.enableIMSC1){var f=this.tracks&&h&&this.tracks.length===h.length;if(this.tracks=h||[],this.config.renderTextTracksNatively){var E=this.media?this.media.textTracks:[];this.tracks.forEach(function(b,L){var u;if(L<E.length){for(var c=null,p=0;p<E.length;p++)if(R(E[p],b)){c=E[p];break}c&&(u=c)}u?Object(S.clearCurrentCues)(u):(u=l.createTextTrack("subtitles",b.name,b.lang))&&(u.mode="disabled"),u&&(u.groupId=b.groupId,l.textTracks.push(u))})}else if(!f&&this.tracks&&this.tracks.length){var D=this.tracks.map(function(b){return{label:b.name,kind:b.type.toLowerCase(),default:b.default,subtitleTrack:b}});this.hls.trigger(i.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:D})}}},g.onManifestLoaded=function(s,d){var l=this;this.config.enableCEA708Captions&&d.captions&&d.captions.forEach(function(h){var m=/(?:CC|SERVICE)([1-4])/.exec(h.instreamId);if(m){var f="textTrack"+m[1],E=l.captionsProperties[f];E&&(E.label=h.name,h.lang&&(E.languageCode=h.lang),E.media=h)}})},g.onFragLoading=function(s,d){var l=this.cea608Parser1,h=this.cea608Parser2,m=this.lastSn;if(this.enabled&&l&&h&&d.frag.type===A.PlaylistLevelType.MAIN){var f=d.frag.sn;f!==m+1&&(l.reset(),h.reset()),this.lastSn=f}},g.onFragLoaded=function(s,d){var l=d.frag,h=d.payload,m=this.initPTS,f=this.unparsedVttFrags;if(l.type===A.PlaylistLevelType.SUBTITLE)if(h.byteLength){if(!Object(n.isFiniteNumber)(m[l.cc]))return f.push(d),void(m.length&&this.hls.trigger(i.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:l,error:new Error("Missing initial subtitle PTS")}));var E=l.decryptdata;if(E==null||E.key==null||E.method!=="AES-128"){var D=this.tracks[l.level],b=this.vttCCs;b[l.cc]||(b[l.cc]={start:l.start,prevCC:this.prevCC,new:!0},this.prevCC=l.cc),D&&D.textCodec===o.IMSC1_CODEC?this._parseIMSC1(l,h):this._parseVTTs(l,h,b)}}else this.hls.trigger(i.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:l,error:new Error("Empty subtitle payload")})},g._parseIMSC1=function(s,d){var l=this,h=this.hls;Object(o.parseIMSC1)(d,this.initPTS[s.cc],this.timescale[s.cc],function(m){l._appendCues(m,s.level),h.trigger(i.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:s})},function(m){T.logger.log("Failed to parse IMSC1: "+m),h.trigger(i.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:m})})},g._parseVTTs=function(s,d,l){var h=this,m=this.hls;Object(_.parseWebVTT)(d,this.initPTS[s.cc],this.timescale[s.cc],l,s.cc,s.start,function(f){h._appendCues(f,s.level),m.trigger(i.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:s})},function(f){h._fallbackToIMSC1(s,d),T.logger.log("Failed to parse VTT cue: "+f),m.trigger(i.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:f})})},g._fallbackToIMSC1=function(s,d){var l=this,h=this.tracks[s.level];h.textCodec||Object(o.parseIMSC1)(d,this.initPTS[s.cc],this.timescale[s.cc],function(){h.textCodec=o.IMSC1_CODEC,l._parseIMSC1(s,d)},function(){h.textCodec="wvtt"})},g._appendCues=function(s,d){var l=this.hls;if(this.config.renderTextTracksNatively){var h=this.textTracks[d];if(h.mode==="disabled")return;s.forEach(function(f){return Object(S.addCueToTrack)(h,f)})}else{var m=this.tracks[d].default?"default":"subtitles"+d;l.trigger(i.Events.CUES_PARSED,{type:"subtitles",cues:s,track:m})}},g.onFragDecrypted=function(s,d){var l=d.frag;if(l.type===A.PlaylistLevelType.SUBTITLE){if(!Object(n.isFiniteNumber)(this.initPTS[l.cc]))return void this.unparsedVttFrags.push(d);this.onFragLoaded(i.Events.FRAG_LOADED,d)}},g.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},g.onFragParsingUserdata=function(s,d){var l=this.cea608Parser1,h=this.cea608Parser2;if(this.enabled&&l&&h)for(var m=0;m<d.samples.length;m++){var f=d.samples[m].bytes;if(f){var E=this.extractCea608Data(f);l.addData(d.samples[m].pts,E[0]),h.addData(d.samples[m].pts,E[1])}}},g.onBufferFlushing=function(s,d){var l=d.startOffset,h=d.endOffset,m=d.endOffsetSubtitles,f=d.type,E=this.media;if(E&&!(E.currentTime<h)){if(!f||f==="video"){var D=this.captionsTracks;Object.keys(D).forEach(function(L){return Object(S.removeCuesInRange)(D[L],l,h)})}if(this.config.renderTextTracksNatively&&l===0&&m!==void 0){var b=this.textTracks;Object.keys(b).forEach(function(L){return Object(S.removeCuesInRange)(b[L],l,m)})}}},g.extractCea608Data=function(s){for(var d=31&s[0],l=2,h=[[],[]],m=0;m<d;m++){var f=s[l++],E=127&s[l++],D=127&s[l++],b=3&f;E===0&&D===0||4&f&&(b!==0&&b!==1||(h[b].push(E),h[b].push(D)))}return h},k}();function R(k,g){return k&&k.label===g.name&&!(k.textTrack1||k.textTrack2)}},"./src/crypt/aes-crypto.ts":function(e,t,r){r.r(t),r.d(t,"default",function(){return n});var n=function(){function i(a,v){this.subtle=void 0,this.aesIV=void 0,this.subtle=a,this.aesIV=v}return i.prototype.decrypt=function(a,v){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},v,a)},i}()},"./src/crypt/aes-decryptor.ts":function(e,t,r){r.r(t),r.d(t,"removePadding",function(){return i}),r.d(t,"default",function(){return a});var n=r("./src/utils/typed-array.ts");function i(v){var _=v.byteLength,S=_&&new DataView(v.buffer).getUint8(_-1);return S?Object(n.sliceUint8)(v,0,_-S):v}var a=function(){function v(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var _=v.prototype;return _.uint8ArrayToUint32Array_=function(S){for(var o=new DataView(S),A=new Uint32Array(4),T=0;T<4;T++)A[T]=o.getUint32(4*T);return A},_.initTable=function(){var S=this.sBox,o=this.invSBox,A=this.subMix,T=A[0],y=A[1],R=A[2],k=A[3],g=this.invSubMix,s=g[0],d=g[1],l=g[2],h=g[3],m=new Uint32Array(256),f=0,E=0,D=0;for(D=0;D<256;D++)m[D]=D<128?D<<1:D<<1^283;for(D=0;D<256;D++){var b=E^E<<1^E<<2^E<<3^E<<4;b=b>>>8^255&b^99,S[f]=b,o[b]=f;var L=m[f],u=m[L],c=m[u],p=257*m[b]^16843008*b;T[f]=p<<24|p>>>8,y[f]=p<<16|p>>>16,R[f]=p<<8|p>>>24,k[f]=p,p=16843009*c^65537*u^257*L^16843008*f,s[b]=p<<24|p>>>8,d[b]=p<<16|p>>>16,l[b]=p<<8|p>>>24,h[b]=p,f?(f=L^m[m[m[c^L]]],E^=m[m[E]]):f=E=1}},_.expandKey=function(S){for(var o=this.uint8ArrayToUint32Array_(S),A=!0,T=0;T<o.length&&A;)A=o[T]===this.key[T],T++;if(!A){this.key=o;var y=this.keySize=o.length;if(y!==4&&y!==6&&y!==8)throw new Error("Invalid aes key size="+y);var R,k,g,s,d=this.ksRows=4*(y+6+1),l=this.keySchedule=new Uint32Array(d),h=this.invKeySchedule=new Uint32Array(d),m=this.sBox,f=this.rcon,E=this.invSubMix,D=E[0],b=E[1],L=E[2],u=E[3];for(R=0;R<d;R++)R<y?g=l[R]=o[R]:(s=g,R%y==0?(s=m[(s=s<<8|s>>>24)>>>24]<<24|m[s>>>16&255]<<16|m[s>>>8&255]<<8|m[255&s],s^=f[R/y|0]<<24):y>6&&R%y==4&&(s=m[s>>>24]<<24|m[s>>>16&255]<<16|m[s>>>8&255]<<8|m[255&s]),l[R]=g=(l[R-y]^s)>>>0);for(k=0;k<d;k++)R=d-k,s=3&k?l[R]:l[R-4],h[k]=k<4||R<=4?s:D[m[s>>>24]]^b[m[s>>>16&255]]^L[m[s>>>8&255]]^u[m[255&s]],h[k]=h[k]>>>0}},_.networkToHostOrderSwap=function(S){return S<<24|(65280&S)<<8|(16711680&S)>>8|S>>>24},_.decrypt=function(S,o,A){for(var T,y,R,k,g,s,d,l,h,m,f,E,D,b,L=this.keySize+6,u=this.invKeySchedule,c=this.invSBox,p=this.invSubMix,C=p[0],I=p[1],w=p[2],O=p[3],x=this.uint8ArrayToUint32Array_(A),P=x[0],F=x[1],M=x[2],U=x[3],G=new Int32Array(S),K=new Int32Array(G.length),q=this.networkToHostOrderSwap;o<G.length;){for(h=q(G[o]),m=q(G[o+1]),f=q(G[o+2]),E=q(G[o+3]),g=h^u[0],s=E^u[1],d=f^u[2],l=m^u[3],D=4,b=1;b<L;b++)T=C[g>>>24]^I[s>>16&255]^w[d>>8&255]^O[255&l]^u[D],y=C[s>>>24]^I[d>>16&255]^w[l>>8&255]^O[255&g]^u[D+1],R=C[d>>>24]^I[l>>16&255]^w[g>>8&255]^O[255&s]^u[D+2],k=C[l>>>24]^I[g>>16&255]^w[s>>8&255]^O[255&d]^u[D+3],g=T,s=y,d=R,l=k,D+=4;T=c[g>>>24]<<24^c[s>>16&255]<<16^c[d>>8&255]<<8^c[255&l]^u[D],y=c[s>>>24]<<24^c[d>>16&255]<<16^c[l>>8&255]<<8^c[255&g]^u[D+1],R=c[d>>>24]<<24^c[l>>16&255]<<16^c[g>>8&255]<<8^c[255&s]^u[D+2],k=c[l>>>24]<<24^c[g>>16&255]<<16^c[s>>8&255]<<8^c[255&d]^u[D+3],K[o]=q(T^P),K[o+1]=q(k^F),K[o+2]=q(R^M),K[o+3]=q(y^U),P=h,F=m,M=f,U=E,o+=4}return K.buffer},v}()},"./src/crypt/decrypter.ts":function(e,t,r){r.r(t),r.d(t,"default",function(){return o});var n=r("./src/crypt/aes-crypto.ts"),i=r("./src/crypt/fast-aes-key.ts"),a=r("./src/crypt/aes-decryptor.ts"),v=r("./src/utils/logger.ts"),_=r("./src/utils/mp4-tools.ts"),S=r("./src/utils/typed-array.ts"),o=function(){function A(y,R,k){var g=(k===void 0?{}:k).removePKCS7Padding,s=g===void 0||g;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=y,this.config=R,this.removePKCS7Padding=s,s)try{var d=self.crypto;d&&(this.subtle=d.subtle||d.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var T=A.prototype;return T.destroy=function(){this.observer=null},T.isSync=function(){return this.config.enableSoftwareAES},T.flush=function(){var y=this.currentResult;if(y){var R=new Uint8Array(y);return this.reset(),this.removePKCS7Padding?Object(a.removePadding)(R):R}this.reset()},T.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},T.decrypt=function(y,R,k,g){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(y),R,k);var s=this.flush();s&&g(s.buffer)}else this.webCryptoDecrypt(new Uint8Array(y),R,k).then(g)},T.softwareDecrypt=function(y,R,k){var g=this.currentIV,s=this.currentResult,d=this.remainderData;this.logOnce("JS AES decrypt"),d&&(y=Object(_.appendUint8Array)(d,y),this.remainderData=null);var l=this.getValidChunk(y);if(!l.length)return null;g&&(k=g);var h=this.softwareDecrypter;h||(h=this.softwareDecrypter=new a.default),h.expandKey(R);var m=s;return this.currentResult=h.decrypt(l.buffer,0,k),this.currentIV=Object(S.sliceUint8)(l,-16).buffer,m||null},T.webCryptoDecrypt=function(y,R,k){var g=this,s=this.subtle;return this.key===R&&this.fastAesKey||(this.key=R,this.fastAesKey=new i.default(s,R)),this.fastAesKey.expandKey().then(function(d){return s?new n.default(s,k).decrypt(y.buffer,d):Promise.reject(new Error("web crypto not initialized"))}).catch(function(d){return g.onWebCryptoError(d,y,R,k)})},T.onWebCryptoError=function(y,R,k,g){return v.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",y),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(R,k,g)},T.getValidChunk=function(y){var R=y,k=y.length-y.length%16;return k!==y.length&&(R=Object(S.sliceUint8)(y,0,k),this.remainderData=Object(S.sliceUint8)(y,k)),R},T.logOnce=function(y){this.logEnabled&&(v.logger.log("[decrypter.ts]: "+y),this.logEnabled=!1)},A}()},"./src/crypt/fast-aes-key.ts":function(e,t,r){r.r(t),r.d(t,"default",function(){return n});var n=function(){function i(a,v){this.subtle=void 0,this.key=void 0,this.subtle=a,this.key=v}return i.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},i}()},"./src/demux/aacdemuxer.ts":function(e,t,r){r.r(t);var n=r("./src/demux/base-audio-demuxer.ts"),i=r("./src/demux/adts.ts"),a=r("./src/utils/logger.ts"),v=r("./src/demux/id3.ts");function _(o,A){return(_=Object.setPrototypeOf||function(T,y){return T.__proto__=y,T})(o,A)}var S=function(o){var A,T;function y(k,g){var s;return(s=o.call(this)||this).observer=void 0,s.config=void 0,s.observer=k,s.config=g,s}T=o,(A=y).prototype=Object.create(T.prototype),A.prototype.constructor=A,_(A,T);var R=y.prototype;return R.resetInitSegment=function(k,g,s){o.prototype.resetInitSegment.call(this,k,g,s),this._audioTrack={container:"audio/adts",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!0,samples:[],manifestCodec:k,duration:s,inputTimeScale:9e4,dropped:0}},y.probe=function(k){if(!k)return!1;for(var g=(v.getID3Data(k,0)||[]).length,s=k.length;g<s;g++)if(i.probe(k,g))return a.logger.log("ADTS sync word found !"),!0;return!1},R.canParse=function(k,g){return i.canParse(k,g)},R.appendFrame=function(k,g,s){i.initTrackConfig(k,this.observer,g,s,k.manifestCodec);var d=i.appendFrame(k,g,s,this.initPTS,this.frameIndex);if(d&&d.missing===0)return d},y}(n.default);S.minProbeByteLength=9,t.default=S},"./src/demux/adts.ts":function(e,t,r){r.r(t),r.d(t,"getAudioConfig",function(){return v}),r.d(t,"isHeaderPattern",function(){return _}),r.d(t,"getHeaderLength",function(){return S}),r.d(t,"getFullFrameLength",function(){return o}),r.d(t,"canGetFrameLength",function(){return A}),r.d(t,"isHeader",function(){return T}),r.d(t,"canParse",function(){return y}),r.d(t,"probe",function(){return R}),r.d(t,"initTrackConfig",function(){return k}),r.d(t,"getFrameDuration",function(){return g}),r.d(t,"parseFrameHeader",function(){return s}),r.d(t,"appendFrame",function(){return d});var n=r("./src/utils/logger.ts"),i=r("./src/errors.ts"),a=r("./src/events.ts");function v(l,h,m,f){var E,D,b,L,u=navigator.userAgent.toLowerCase(),c=f,p=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];E=1+((192&h[m+2])>>>6);var C=(60&h[m+2])>>>2;if(!(C>p.length-1))return b=(1&h[m+2])<<2,b|=(192&h[m+3])>>>6,n.logger.log("manifest codec:"+f+", ADTS type:"+E+", samplingIndex:"+C),/firefox/i.test(u)?C>=6?(E=5,L=new Array(4),D=C-3):(E=2,L=new Array(2),D=C):u.indexOf("android")!==-1?(E=2,L=new Array(2),D=C):(E=5,L=new Array(4),f&&(f.indexOf("mp4a.40.29")!==-1||f.indexOf("mp4a.40.5")!==-1)||!f&&C>=6?D=C-3:((f&&f.indexOf("mp4a.40.2")!==-1&&(C>=6&&b===1||/vivaldi/i.test(u))||!f&&b===1)&&(E=2,L=new Array(2)),D=C)),L[0]=E<<3,L[0]|=(14&C)>>1,L[1]|=(1&C)<<7,L[1]|=b<<3,E===5&&(L[1]|=(14&D)>>1,L[2]=(1&D)<<7,L[2]|=8,L[3]=0),{config:L,samplerate:p[C],channelCount:b,codec:"mp4a.40."+E,manifestCodec:c};l.trigger(a.Events.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+C})}function _(l,h){return l[h]===255&&(246&l[h+1])==240}function S(l,h){return 1&l[h+1]?7:9}function o(l,h){return(3&l[h+3])<<11|l[h+4]<<3|(224&l[h+5])>>>5}function A(l,h){return h+5<l.length}function T(l,h){return h+1<l.length&&_(l,h)}function y(l,h){return A(l,h)&&_(l,h)&&o(l,h)<=l.length-h}function R(l,h){if(T(l,h)){var m=S(l,h);if(h+m>=l.length)return!1;var f=o(l,h);if(f<=m)return!1;var E=h+f;return E===l.length||T(l,E)}return!1}function k(l,h,m,f,E){if(!l.samplerate){var D=v(h,m,f,E);if(!D)return;l.config=D.config,l.samplerate=D.samplerate,l.channelCount=D.channelCount,l.codec=D.codec,l.manifestCodec=D.manifestCodec,n.logger.log("parsed codec:"+l.codec+", rate:"+D.samplerate+", channels:"+D.channelCount)}}function g(l){return 9216e4/l}function s(l,h,m,f,E){var D=S(l,h),b=o(l,h);if((b-=D)>0)return{headerLength:D,frameLength:b,stamp:m+f*E}}function d(l,h,m,f,E){var D=s(h,m,f,E,g(l.samplerate));if(D){var b,L=D.frameLength,u=D.headerLength,c=D.stamp,p=u+L,C=Math.max(0,m+p-h.length);C?(b=new Uint8Array(p-u)).set(h.subarray(m+u,h.length),0):b=h.subarray(m+u,m+p);var I={unit:b,pts:c};return C||l.samples.push(I),{sample:I,length:p,missing:C}}}},"./src/demux/base-audio-demuxer.ts":function(e,t,r){r.r(t),r.d(t,"initPTSFn",function(){return o});var n=r("./src/polyfills/number.ts"),i=r("./src/demux/id3.ts"),a=r("./src/demux/dummy-demuxed-track.ts"),v=r("./src/utils/mp4-tools.ts"),_=r("./src/utils/typed-array.ts"),S=function(){function A(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.initPTS=null}var T=A.prototype;return T.resetInitSegment=function(y,R,k){this._id3Track={type:"id3",id:0,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},T.resetTimeStamp=function(){},T.resetContiguity=function(){},T.canParse=function(y,R){return!1},T.appendFrame=function(y,R,k){},T.demux=function(y,R){this.cachedData&&(y=Object(v.appendUint8Array)(this.cachedData,y),this.cachedData=null);var k,g,s=i.getID3Data(y,0),d=s?s.length:0,l=this._audioTrack,h=this._id3Track,m=s?i.getTimeStamp(s):void 0,f=y.length;for(this.frameIndex!==0&&this.initPTS!==null||(this.initPTS=o(m,R)),s&&s.length>0&&h.samples.push({pts:this.initPTS,dts:this.initPTS,data:s}),g=this.initPTS;d<f;){if(this.canParse(y,d)){var E=this.appendFrame(l,y,d);E?(this.frameIndex++,g=E.sample.pts,k=d+=E.length):d=f}else i.canParse(y,d)?(s=i.getID3Data(y,d),h.samples.push({pts:g,dts:g,data:s}),k=d+=s.length):d++;if(d===f&&k!==f){var D=Object(_.sliceUint8)(y,k);this.cachedData?this.cachedData=Object(v.appendUint8Array)(this.cachedData,D):this.cachedData=D}}return{audioTrack:l,avcTrack:Object(a.dummyTrack)(),id3Track:h,textTrack:Object(a.dummyTrack)()}},T.demuxSampleAes=function(y,R,k){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},T.flush=function(y){var R=this.cachedData;return R&&(this.cachedData=null,this.demux(R,0)),this.frameIndex=0,{audioTrack:this._audioTrack,avcTrack:Object(a.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(a.dummyTrack)()}},T.destroy=function(){},A}(),o=function(A,T){return Object(n.isFiniteNumber)(A)?90*A:9e4*T};t.default=S},"./src/demux/chunk-cache.ts":function(e,t,r){r.r(t),r.d(t,"default",function(){return n});var n=function(){function i(){this.chunks=[],this.dataLength=0}var a=i.prototype;return a.push=function(v){this.chunks.push(v),this.dataLength+=v.length},a.flush=function(){var v,_=this.chunks,S=this.dataLength;return _.length?(v=_.length===1?_[0]:function(o,A){for(var T=new Uint8Array(A),y=0,R=0;R<o.length;R++){var k=o[R];T.set(k,y),y+=k.length}return T}(_,S),this.reset(),v):new Uint8Array(0)},a.reset=function(){this.chunks.length=0,this.dataLength=0},i}()},"./src/demux/dummy-demuxed-track.ts":function(e,t,r){function n(){return{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0}}r.r(t),r.d(t,"dummyTrack",function(){return n})},"./src/demux/exp-golomb.ts":function(e,t,r){r.r(t);var n=r("./src/utils/logger.ts"),i=function(){function a(_){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=_,this.bytesAvailable=_.byteLength,this.word=0,this.bitsAvailable=0}var v=a.prototype;return v.loadWord=function(){var _=this.data,S=this.bytesAvailable,o=_.byteLength-S,A=new Uint8Array(4),T=Math.min(4,S);if(T===0)throw new Error("no bytes available");A.set(_.subarray(o,o+T)),this.word=new DataView(A.buffer).getUint32(0),this.bitsAvailable=8*T,this.bytesAvailable-=T},v.skipBits=function(_){var S;this.bitsAvailable>_?(this.word<<=_,this.bitsAvailable-=_):(_-=this.bitsAvailable,_-=(S=_>>3)>>3,this.bytesAvailable-=S,this.loadWord(),this.word<<=_,this.bitsAvailable-=_)},v.readBits=function(_){var S=Math.min(this.bitsAvailable,_),o=this.word>>>32-S;return _>32&&n.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=S,this.bitsAvailable>0?this.word<<=S:this.bytesAvailable>0&&this.loadWord(),(S=_-S)>0&&this.bitsAvailable?o<<S|this.readBits(S):o},v.skipLZ=function(){var _;for(_=0;_<this.bitsAvailable;++_)if(this.word&2147483648>>>_)return this.word<<=_,this.bitsAvailable-=_,_;return this.loadWord(),_+this.skipLZ()},v.skipUEG=function(){this.skipBits(1+this.skipLZ())},v.skipEG=function(){this.skipBits(1+this.skipLZ())},v.readUEG=function(){var _=this.skipLZ();return this.readBits(_+1)-1},v.readEG=function(){var _=this.readUEG();return 1&_?1+_>>>1:-1*(_>>>1)},v.readBoolean=function(){return this.readBits(1)===1},v.readUByte=function(){return this.readBits(8)},v.readUShort=function(){return this.readBits(16)},v.readUInt=function(){return this.readBits(32)},v.skipScalingList=function(_){for(var S=8,o=8,A=0;A<_;A++)o!==0&&(o=(S+this.readEG()+256)%256),S=o===0?S:o},v.readSPS=function(){var _,S,o,A=0,T=0,y=0,R=0,k=this.readUByte.bind(this),g=this.readBits.bind(this),s=this.readUEG.bind(this),d=this.readBoolean.bind(this),l=this.skipBits.bind(this),h=this.skipEG.bind(this),m=this.skipUEG.bind(this),f=this.skipScalingList.bind(this);k();var E=k();if(g(5),l(3),k(),m(),E===100||E===110||E===122||E===244||E===44||E===83||E===86||E===118||E===128){var D=s();if(D===3&&l(1),m(),m(),l(1),d())for(S=D!==3?8:12,o=0;o<S;o++)d()&&f(o<6?16:64)}m();var b=s();if(b===0)s();else if(b===1)for(l(1),h(),h(),_=s(),o=0;o<_;o++)h();m(),l(1);var L=s(),u=s(),c=g(1);c===0&&l(1),l(1),d()&&(A=s(),T=s(),y=s(),R=s());var p=[1,1];if(d()&&d())switch(k()){case 1:p=[1,1];break;case 2:p=[12,11];break;case 3:p=[10,11];break;case 4:p=[16,11];break;case 5:p=[40,33];break;case 6:p=[24,11];break;case 7:p=[20,11];break;case 8:p=[32,11];break;case 9:p=[80,33];break;case 10:p=[18,11];break;case 11:p=[15,11];break;case 12:p=[64,33];break;case 13:p=[160,99];break;case 14:p=[4,3];break;case 15:p=[3,2];break;case 16:p=[2,1];break;case 255:p=[k()<<8|k(),k()<<8|k()]}return{width:Math.ceil(16*(L+1)-2*A-2*T),height:(2-c)*(u+1)*16-(c?2:4)*(y+R),pixelRatio:p}},v.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},a}();t.default=i},"./src/demux/id3.ts":function(e,t,r){r.r(t),r.d(t,"isHeader",function(){return i}),r.d(t,"isFooter",function(){return a}),r.d(t,"getID3Data",function(){return v}),r.d(t,"canParse",function(){return S}),r.d(t,"getTimeStamp",function(){return o}),r.d(t,"isTimeStampFrame",function(){return A}),r.d(t,"getID3Frames",function(){return y}),r.d(t,"decodeFrame",function(){return R}),r.d(t,"utf8ArrayToStr",function(){return l}),r.d(t,"testables",function(){return h});var n,i=function(m,f){return f+10<=m.length&&m[f]===73&&m[f+1]===68&&m[f+2]===51&&m[f+3]<255&&m[f+4]<255&&m[f+6]<128&&m[f+7]<128&&m[f+8]<128&&m[f+9]<128},a=function(m,f){return f+10<=m.length&&m[f]===51&&m[f+1]===68&&m[f+2]===73&&m[f+3]<255&&m[f+4]<255&&m[f+6]<128&&m[f+7]<128&&m[f+8]<128&&m[f+9]<128},v=function(m,f){for(var E=f,D=0;i(m,f);)D+=10,D+=_(m,f+6),a(m,f+10)&&(D+=10),f+=D;if(D>0)return m.subarray(E,E+D)},_=function(m,f){var E=0;return E=(127&m[f])<<21,E|=(127&m[f+1])<<14,E|=(127&m[f+2])<<7,E|=127&m[f+3]},S=function(m,f){return i(m,f)&&_(m,f+6)+10<=m.length-f},o=function(m){for(var f=y(m),E=0;E<f.length;E++){var D=f[E];if(A(D))return d(D)}},A=function(m){return m&&m.key==="PRIV"&&m.info==="com.apple.streaming.transportStreamTimestamp"},T=function(m){var f=String.fromCharCode(m[0],m[1],m[2],m[3]),E=_(m,4);return{type:f,size:E,data:m.subarray(10,10+E)}},y=function(m){for(var f=0,E=[];i(m,f);){for(var D=_(m,f+6),b=(f+=10)+D;f+8<b;){var L=T(m.subarray(f)),u=R(L);u&&E.push(u),f+=L.size+10}a(m,f)&&(f+=10)}return E},R=function(m){return m.type==="PRIV"?k(m):m.type[0]==="W"?s(m):g(m)},k=function(m){if(!(m.size<2)){var f=l(m.data,!0),E=new Uint8Array(m.data.subarray(f.length+1));return{key:m.type,info:f,data:E.buffer}}},g=function(m){if(!(m.size<2)){if(m.type==="TXXX"){var f=1,E=l(m.data.subarray(f),!0);f+=E.length+1;var D=l(m.data.subarray(f));return{key:m.type,info:E,data:D}}var b=l(m.data.subarray(1));return{key:m.type,data:b}}},s=function(m){if(m.type==="WXXX"){if(m.size<2)return;var f=1,E=l(m.data.subarray(f),!0);f+=E.length+1;var D=l(m.data.subarray(f));return{key:m.type,info:E,data:D}}var b=l(m.data);return{key:m.type,data:b}},d=function(m){if(m.data.byteLength===8){var f=new Uint8Array(m.data),E=1&f[3],D=(f[4]<<23)+(f[5]<<15)+(f[6]<<7)+f[7];return D/=45,E&&(D+=4772185884e-2),Math.round(D)}},l=function(m,f){f===void 0&&(f=!1);var E=(n||self.TextDecoder===void 0||(n=new self.TextDecoder("utf-8")),n);if(E){var D=E.decode(m);if(f){var b=D.indexOf("\0");return b!==-1?D.substring(0,b):D}return D.replace(/\0/g,"")}for(var L,u,c,p=m.length,C="",I=0;I<p;){if((L=m[I++])===0&&f)return C;if(L!==0&&L!==3)switch(L>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:C+=String.fromCharCode(L);break;case 12:case 13:u=m[I++],C+=String.fromCharCode((31&L)<<6|63&u);break;case 14:u=m[I++],c=m[I++],C+=String.fromCharCode((15&L)<<12|(63&u)<<6|(63&c)<<0)}}return C},h={decodeTextFrame:g}},"./src/demux/mp3demuxer.ts":function(e,t,r){r.r(t);var n=r("./src/demux/base-audio-demuxer.ts"),i=r("./src/demux/id3.ts"),a=r("./src/utils/logger.ts"),v=r("./src/demux/mpegaudio.ts");function _(o,A){return(_=Object.setPrototypeOf||function(T,y){return T.__proto__=y,T})(o,A)}var S=function(o){var A,T;function y(){return o.apply(this,arguments)||this}T=o,(A=y).prototype=Object.create(T.prototype),A.prototype.constructor=A,_(A,T);var R=y.prototype;return R.resetInitSegment=function(k,g,s){o.prototype.resetInitSegment.call(this,k,g,s),this._audioTrack={container:"audio/mpeg",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!1,samples:[],manifestCodec:k,duration:s,inputTimeScale:9e4,dropped:0}},y.probe=function(k){if(!k)return!1;for(var g=(i.getID3Data(k,0)||[]).length,s=k.length;g<s;g++)if(v.probe(k,g))return a.logger.log("MPEG Audio sync word found !"),!0;return!1},R.canParse=function(k,g){return v.canParse(k,g)},R.appendFrame=function(k,g,s){if(this.initPTS!==null)return v.appendFrame(k,g,s,this.initPTS,this.frameIndex)},y}(n.default);S.minProbeByteLength=4,t.default=S},"./src/demux/mp4demuxer.ts":function(e,t,r){r.r(t);var n=r("./src/utils/mp4-tools.ts"),i=r("./src/demux/dummy-demuxed-track.ts"),a=function(){function v(S,o){this.remainderData=null,this.config=void 0,this.config=o}var _=v.prototype;return _.resetTimeStamp=function(){},_.resetInitSegment=function(){},_.resetContiguity=function(){},v.probe=function(S){return Object(n.findBox)({data:S,start:0,end:Math.min(S.length,16384)},["moof"]).length>0},_.demux=function(S){var o=S,A=Object(i.dummyTrack)();if(this.config.progressive){this.remainderData&&(o=Object(n.appendUint8Array)(this.remainderData,S));var T=Object(n.segmentValidRange)(o);this.remainderData=T.remainder,A.samples=T.valid||new Uint8Array}else A.samples=o;return{audioTrack:Object(i.dummyTrack)(),avcTrack:A,id3Track:Object(i.dummyTrack)(),textTrack:Object(i.dummyTrack)()}},_.flush=function(){var S=Object(i.dummyTrack)();return S.samples=this.remainderData||new Uint8Array,this.remainderData=null,{audioTrack:Object(i.dummyTrack)(),avcTrack:S,id3Track:Object(i.dummyTrack)(),textTrack:Object(i.dummyTrack)()}},_.demuxSampleAes=function(S,o,A){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},_.destroy=function(){},v}();a.minProbeByteLength=1024,t.default=a},"./src/demux/mpegaudio.ts":function(e,t,r){r.r(t),r.d(t,"appendFrame",function(){return S}),r.d(t,"parseHeader",function(){return o}),r.d(t,"isHeaderPattern",function(){return A}),r.d(t,"isHeader",function(){return T}),r.d(t,"canParse",function(){return y}),r.d(t,"probe",function(){return R});var n=null,i=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],a=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],v=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],_=[0,1,1,4];function S(k,g,s,d,l){if(!(s+24>g.length)){var h=o(g,s);if(h&&s+h.frameLength<=g.length){var m=d+l*(9e4*h.samplesPerFrame/h.sampleRate),f={unit:g.subarray(s,s+h.frameLength),pts:m,dts:m};return k.config=[],k.channelCount=h.channelCount,k.samplerate=h.sampleRate,k.samples.push(f),{sample:f,length:h.frameLength,missing:0}}}}function o(k,g){var s=k[g+1]>>3&3,d=k[g+1]>>1&3,l=k[g+2]>>4&15,h=k[g+2]>>2&3;if(s!==1&&l!==0&&l!==15&&h!==3){var m=k[g+2]>>1&1,f=k[g+3]>>6,E=1e3*i[14*(s===3?3-d:d===3?3:4)+l-1],D=a[3*(s===3?0:s===2?1:2)+h],b=f===3?1:2,L=v[s][d],u=_[d],c=8*L*u,p=Math.floor(L*E/D+m)*u;if(n===null){var C=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);n=C?parseInt(C[1]):0}return n&&n<=87&&d===2&&E>=224e3&&f===0&&(k[g+3]=128|k[g+3]),{sampleRate:D,channelCount:b,frameLength:p,samplesPerFrame:c}}}function A(k,g){return k[g]===255&&(224&k[g+1])==224&&(6&k[g+1])!=0}function T(k,g){return g+1<k.length&&A(k,g)}function y(k,g){return A(k,g)&&4<=k.length-g}function R(k,g){if(g+1<k.length&&A(k,g)){var s=o(k,g),d=4;s!=null&&s.frameLength&&(d=s.frameLength);var l=g+d;return l===k.length||T(k,l)}return!1}},"./src/demux/sample-aes.ts":function(e,t,r){r.r(t);var n=r("./src/crypt/decrypter.ts"),i=r("./src/demux/tsdemuxer.ts"),a=function(){function v(S,o,A){this.keyData=void 0,this.decrypter=void 0,this.keyData=A,this.decrypter=new n.default(S,o,{removePKCS7Padding:!1})}var _=v.prototype;return _.decryptBuffer=function(S,o){this.decrypter.decrypt(S,this.keyData.key.buffer,this.keyData.iv.buffer,o)},_.decryptAacSample=function(S,o,A,T){var y=S[o].unit,R=y.subarray(16,y.length-y.length%16),k=R.buffer.slice(R.byteOffset,R.byteOffset+R.length),g=this;this.decryptBuffer(k,function(s){var d=new Uint8Array(s);y.set(d,16),T||g.decryptAacSamples(S,o+1,A)})},_.decryptAacSamples=function(S,o,A){for(;;o++){if(o>=S.length)return void A();if(!(S[o].unit.length<32)){var T=this.decrypter.isSync();if(this.decryptAacSample(S,o,A,T),!T)return}}},_.getAvcEncryptedData=function(S){for(var o=16*Math.floor((S.length-48)/160)+16,A=new Int8Array(o),T=0,y=32;y<=S.length-16;y+=160,T+=16)A.set(S.subarray(y,y+16),T);return A},_.getAvcDecryptedUnit=function(S,o){for(var A=new Uint8Array(o),T=0,y=32;y<=S.length-16;y+=160,T+=16)S.set(A.subarray(T,T+16),y);return S},_.decryptAvcSample=function(S,o,A,T,y,R){var k=Object(i.discardEPB)(y.data),g=this.getAvcEncryptedData(k),s=this;this.decryptBuffer(g.buffer,function(d){y.data=s.getAvcDecryptedUnit(k,d),R||s.decryptAvcSamples(S,o,A+1,T)})},_.decryptAvcSamples=function(S,o,A,T){if(S instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;o++,A=0){if(o>=S.length)return void T();for(var y=S[o].units;!(A>=y.length);A++){var R=y[A];if(!(R.data.length<=48||R.type!==1&&R.type!==5)){var k=this.decrypter.isSync();if(this.decryptAvcSample(S,o,A,T,R,k),!k)return}}}},v}();t.default=a},"./src/demux/transmuxer-interface.ts":function(e,t,r){r.r(t),r.d(t,"default",function(){return T});var n=r("./node_modules/webworkify-webpack/index.js"),i=r("./src/events.ts"),a=r("./src/demux/transmuxer.ts"),v=r("./src/utils/logger.ts"),_=r("./src/errors.ts"),S=r("./src/utils/mediasource-helper.ts"),o=r("./node_modules/eventemitter3/index.js"),A=Object(S.getMediaSource)()||{isTypeSupported:function(){return!1}},T=function(){function y(k,g,s,d){var l=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=k,this.id=g,this.onTransmuxComplete=s,this.onFlush=d;var h=k.config,m=function(b,L){(L=L||{}).frag=l.frag,L.id=l.id,k.trigger(b,L)};this.observer=new o.EventEmitter,this.observer.on(i.Events.FRAG_DECRYPTED,m),this.observer.on(i.Events.ERROR,m);var f={mp4:A.isTypeSupported("video/mp4"),mpeg:A.isTypeSupported("audio/mpeg"),mp3:A.isTypeSupported('audio/mp4; codecs="mp3"')},E=navigator.vendor;if(h.enableWorker&&typeof Worker<"u"){var D;v.logger.log("demuxing in webworker");try{D=this.worker=n("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),D.addEventListener("message",this.onwmsg),D.onerror=function(b){k.trigger(i.Events.ERROR,{type:_.ErrorTypes.OTHER_ERROR,details:_.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(b.message+"  ("+b.filename+":"+b.lineno+")")})},D.postMessage({cmd:"init",typeSupported:f,vendor:E,id:g,config:JSON.stringify(h)})}catch(b){v.logger.warn("Error in worker:",b),v.logger.error("Error while initializing DemuxerWorker, fallback to inline"),D&&self.URL.revokeObjectURL(D.objectURL),this.transmuxer=new a.default(this.observer,f,h,E,g),this.worker=null}}else this.transmuxer=new a.default(this.observer,f,h,E,g)}var R=y.prototype;return R.destroy=function(){var k=this.worker;if(k)k.removeEventListener("message",this.onwmsg),k.terminate(),this.worker=null;else{var g=this.transmuxer;g&&(g.destroy(),this.transmuxer=null)}var s=this.observer;s&&s.removeAllListeners(),this.observer=null},R.push=function(k,g,s,d,l,h,m,f,E,D){var b=this;E.transmuxing.start=self.performance.now();var L=this.transmuxer,u=this.worker,c=h?h.start:l.start,p=l.decryptdata,C=this.frag,I=!(C&&l.cc===C.cc),w=!(C&&E.level===C.level),O=C?E.sn-C.sn:-1,x=this.part?E.part-this.part.index:1,P=!w&&(O===1||O===0&&x===1),F=self.performance.now();(w||O||l.stats.parsing.start===0)&&(l.stats.parsing.start=F),!h||!x&&P||(h.stats.parsing.start=F);var M=new a.TransmuxState(I,P,f,w,c);if(!P||I){v.logger.log("[transmuxer-interface, "+l.type+"]: Starting new transmux session for sn: "+E.sn+" p: "+E.part+" level: "+E.level+" id: "+E.id+`
        discontinuity: `+I+`
        trackSwitch: `+w+`
        contiguous: `+P+`
        accurateTimeOffset: `+f+`
        timeOffset: `+c);var U=new a.TransmuxConfig(s,d,g,m,D);this.configureTransmuxer(U)}if(this.frag=l,this.part=h,u)u.postMessage({cmd:"demux",data:k,decryptdata:p,chunkMeta:E,state:M},k instanceof ArrayBuffer?[k]:[]);else if(L){var G=L.push(k,p,E,M);Object(a.isPromise)(G)?G.then(function(K){b.handleTransmuxComplete(K)}):this.handleTransmuxComplete(G)}},R.flush=function(k){var g=this;k.transmuxing.start=self.performance.now();var s=this.transmuxer,d=this.worker;if(d)d.postMessage({cmd:"flush",chunkMeta:k});else if(s){var l=s.flush(k);Object(a.isPromise)(l)?l.then(function(h){g.handleFlushResult(h,k)}):this.handleFlushResult(l,k)}},R.handleFlushResult=function(k,g){var s=this;k.forEach(function(d){s.handleTransmuxComplete(d)}),this.onFlush(g)},R.onWorkerMessage=function(k){var g=k.data,s=this.hls;switch(g.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(g.data);break;case"flush":this.onFlush(g.data);break;default:g.data=g.data||{},g.data.frag=this.frag,g.data.id=this.id,s.trigger(g.event,g.data)}},R.configureTransmuxer=function(k){var g=this.worker,s=this.transmuxer;g?g.postMessage({cmd:"configure",config:k}):s&&s.configure(k)},R.handleTransmuxComplete=function(k){k.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(k)},y}()},"./src/demux/transmuxer-worker.ts":function(e,t,r){r.r(t),r.d(t,"default",function(){return _});var n=r("./src/demux/transmuxer.ts"),i=r("./src/events.ts"),a=r("./src/utils/logger.ts"),v=r("./node_modules/eventemitter3/index.js");function _(T){var y=new v.EventEmitter,R=function(k,g){T.postMessage({event:k,data:g})};y.on(i.Events.FRAG_DECRYPTED,R),y.on(i.Events.ERROR,R),T.addEventListener("message",function(k){var g=k.data;switch(g.cmd){case"init":var s=JSON.parse(g.config);T.transmuxer=new n.default(y,g.typeSupported,s,g.vendor,g.id),Object(a.enableLogs)(s.debug),R("init",null);break;case"configure":T.transmuxer.configure(g.config);break;case"demux":var d=T.transmuxer.push(g.data,g.decryptdata,g.chunkMeta,g.state);Object(n.isPromise)(d)?d.then(function(m){S(T,m)}):S(T,d);break;case"flush":var l=g.chunkMeta,h=T.transmuxer.flush(l);Object(n.isPromise)(h)?h.then(function(m){A(T,m,l)}):A(T,h,l)}})}function S(T,y){if((R=y.remuxResult).audio||R.video||R.text||R.id3||R.initSegment){var R,k=[],g=y.remuxResult,s=g.audio,d=g.video;s&&o(k,s),d&&o(k,d),T.postMessage({event:"transmuxComplete",data:y},k)}}function o(T,y){y.data1&&T.push(y.data1.buffer),y.data2&&T.push(y.data2.buffer)}function A(T,y,R){y.forEach(function(k){S(T,k)}),T.postMessage({event:"flush",data:R})}},"./src/demux/transmuxer.ts":function(e,t,r){r.r(t),r.d(t,"default",function(){return l}),r.d(t,"isPromise",function(){return m}),r.d(t,"TransmuxConfig",function(){return f}),r.d(t,"TransmuxState",function(){return E});var n,i=r("./src/events.ts"),a=r("./src/errors.ts"),v=r("./src/crypt/decrypter.ts"),_=r("./src/demux/aacdemuxer.ts"),S=r("./src/demux/mp4demuxer.ts"),o=r("./src/demux/tsdemuxer.ts"),A=r("./src/demux/mp3demuxer.ts"),T=r("./src/remux/mp4-remuxer.ts"),y=r("./src/remux/passthrough-remuxer.ts"),R=r("./src/demux/chunk-cache.ts"),k=r("./src/utils/mp4-tools.ts"),g=r("./src/utils/logger.ts");try{n=self.performance.now.bind(self.performance)}catch{g.logger.debug("Unable to use Performance API on this environment"),n=self.Date.now}var s=[{demux:o.default,remux:T.default},{demux:S.default,remux:y.default},{demux:_.default,remux:T.default},{demux:A.default,remux:T.default}],d=1024;s.forEach(function(D){var b=D.demux;d=Math.max(d,b.minProbeByteLength)});var l=function(){function D(L,u,c,p,C){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new R.default,this.observer=L,this.typeSupported=u,this.config=c,this.vendor=p,this.id=C}var b=D.prototype;return b.configure=function(L){this.transmuxConfig=L,this.decrypter&&this.decrypter.reset()},b.push=function(L,u,c,p){var C=this,I=c.transmuxing;I.executeStart=n();var w=new Uint8Array(L),O=this.cache,x=this.config,P=this.currentTransmuxState,F=this.transmuxConfig;p&&(this.currentTransmuxState=p);var M=function(z,$){var X=null;return z.byteLength>0&&$!=null&&$.key!=null&&$.iv!==null&&$.method!=null&&(X=$),X}(w,u);if(M&&M.method==="AES-128"){var U=this.getDecrypter();if(!x.enableSoftwareAES)return this.decryptionPromise=U.webCryptoDecrypt(w,M.key.buffer,M.iv.buffer).then(function(z){var $=C.push(z,null,c);return C.decryptionPromise=null,$}),this.decryptionPromise;var G=U.softwareDecrypt(w,M.key.buffer,M.iv.buffer);if(!G)return I.executeEnd=n(),h(c);w=new Uint8Array(G)}var K=p||P,q=K.contiguous,Z=K.discontinuity,ee=K.trackSwitch,se=K.accurateTimeOffset,ne=K.timeOffset,ae=F.audioCodec,me=F.videoCodec,Ee=F.defaultInitPts,N=F.duration,B=F.initSegmentData;if((Z||ee)&&this.resetInitSegment(B,ae,me,N),Z&&this.resetInitialTimestamp(Ee),q||this.resetContiguity(),this.needsProbing(w,Z,ee)){if(O.dataLength){var j=O.flush();w=Object(k.appendUint8Array)(j,w)}this.configureTransmuxer(w,F)}var H=this.transmux(w,M,ne,se,c),V=this.currentTransmuxState;return V.contiguous=!0,V.discontinuity=!1,V.trackSwitch=!1,I.executeEnd=n(),H},b.flush=function(L){var u=this,c=L.transmuxing;c.executeStart=n();var p=this.decrypter,C=this.cache,I=this.currentTransmuxState,w=this.decryptionPromise;if(w)return w.then(function(){return u.flush(L)});var O=[],x=I.timeOffset;if(p){var P=p.flush();P&&O.push(this.push(P,null,L))}var F=C.dataLength;C.reset();var M=this.demuxer,U=this.remuxer;if(!M||!U)return F>=d&&this.observer.emit(i.Events.ERROR,i.Events.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),c.executeEnd=n(),[h(L)];var G=M.flush(x);return m(G)?G.then(function(K){return u.flushRemux(O,K,L),O}):(this.flushRemux(O,G,L),O)},b.flushRemux=function(L,u,c){var p=u.audioTrack,C=u.avcTrack,I=u.id3Track,w=u.textTrack,O=this.currentTransmuxState,x=O.accurateTimeOffset,P=O.timeOffset;g.logger.log("[transmuxer.ts]: Flushed fragment "+c.sn+(c.part>-1?" p: "+c.part:"")+" of level "+c.level);var F=this.remuxer.remux(p,C,I,w,P,x,!0,this.id);L.push({remuxResult:F,chunkMeta:c}),c.transmuxing.executeEnd=n()},b.resetInitialTimestamp=function(L){var u=this.demuxer,c=this.remuxer;u&&c&&(u.resetTimeStamp(L),c.resetTimeStamp(L))},b.resetContiguity=function(){var L=this.demuxer,u=this.remuxer;L&&u&&(L.resetContiguity(),u.resetNextTimestamp())},b.resetInitSegment=function(L,u,c,p){var C=this.demuxer,I=this.remuxer;C&&I&&(C.resetInitSegment(u,c,p),I.resetInitSegment(L,u,c))},b.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},b.transmux=function(L,u,c,p,C){return u&&u.method==="SAMPLE-AES"?this.transmuxSampleAes(L,u,c,p,C):this.transmuxUnencrypted(L,c,p,C)},b.transmuxUnencrypted=function(L,u,c,p){var C=this.demuxer.demux(L,u,!1,!this.config.progressive),I=C.audioTrack,w=C.avcTrack,O=C.id3Track,x=C.textTrack;return{remuxResult:this.remuxer.remux(I,w,O,x,u,c,!1,this.id),chunkMeta:p}},b.transmuxSampleAes=function(L,u,c,p,C){var I=this;return this.demuxer.demuxSampleAes(L,u,c).then(function(w){return{remuxResult:I.remuxer.remux(w.audioTrack,w.avcTrack,w.id3Track,w.textTrack,c,p,!1,I.id),chunkMeta:C}})},b.configureTransmuxer=function(L,u){for(var c,p=this.config,C=this.observer,I=this.typeSupported,w=this.vendor,O=u.audioCodec,x=u.defaultInitPts,P=u.duration,F=u.initSegmentData,M=u.videoCodec,U=0,G=s.length;U<G;U++)if(s[U].demux.probe(L)){c=s[U];break}c||(g.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),c={demux:S.default,remux:y.default});var K=this.demuxer,q=this.remuxer,Z=c.remux,ee=c.demux;q&&q instanceof Z||(this.remuxer=new Z(C,p,I,w)),K&&K instanceof ee||(this.demuxer=new ee(C,p,I),this.probe=ee.probe),this.resetInitSegment(F,O,M,P),this.resetInitialTimestamp(x)},b.needsProbing=function(L,u,c){return!this.demuxer||!this.remuxer||u||c},b.getDecrypter=function(){var L=this.decrypter;return L||(L=this.decrypter=new v.default(this.observer,this.config)),L},D}(),h=function(D){return{remuxResult:{},chunkMeta:D}};function m(D){return"then"in D&&D.then instanceof Function}var f=function(D,b,L,u,c){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=D,this.videoCodec=b,this.initSegmentData=L,this.duration=u,this.defaultInitPts=c},E=function(D,b,L,u,c){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.discontinuity=D,this.contiguous=b,this.accurateTimeOffset=L,this.trackSwitch=u,this.timeOffset=c}},"./src/demux/tsdemuxer.ts":function(e,t,r){r.r(t),r.d(t,"discardEPB",function(){return m});var n=r("./src/demux/adts.ts"),i=r("./src/demux/mpegaudio.ts"),a=r("./src/demux/exp-golomb.ts"),v=r("./src/demux/id3.ts"),_=r("./src/demux/sample-aes.ts"),S=r("./src/events.ts"),o=r("./src/utils/mp4-tools.ts"),A=r("./src/utils/logger.ts"),T=r("./src/errors.ts"),y={video:1,audio:2,id3:3,text:4},R=function(){function f(D,b,L){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this.aacLastPTS=null,this._initPTS=null,this._initDTS=null,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=D,this.config=b,this.typeSupported=L}f.probe=function(D){var b=f.syncOffset(D);return!(b<0||(b&&A.logger.warn("MPEG2-TS detected but first sync word found @ offset "+b+", junk ahead ?"),0))},f.syncOffset=function(D){for(var b=Math.min(1e3,D.length-564),L=0;L<b;){if(D[L]===71&&D[L+188]===71&&D[L+376]===71)return L;L++}return-1},f.createTrack=function(D,b){return{container:D==="video"||D==="audio"?"video/mp2t":void 0,type:D,id:y[D],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:D==="audio"?b:void 0}};var E=f.prototype;return E.resetInitSegment=function(D,b,L){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=f.createTrack("video",L),this._audioTrack=f.createTrack("audio",L),this._id3Track=f.createTrack("id3",L),this._txtTrack=f.createTrack("text",L),this._audioTrack.isAAC=!0,this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=D,this.videoCodec=b,this._duration=L},E.resetTimeStamp=function(){},E.resetContiguity=function(){var D=this._audioTrack,b=this._avcTrack,L=this._id3Track;D&&(D.pesData=null),b&&(b.pesData=null),L&&(L.pesData=null),this.aacOverFlow=null,this.aacLastPTS=null},E.demux=function(D,b,L,u){var c;L===void 0&&(L=!1),u===void 0&&(u=!1),L||(this.sampleAes=null);var p=this._avcTrack,C=this._audioTrack,I=this._id3Track,w=p.pid,O=p.pesData,x=C.pid,P=I.pid,F=C.pesData,M=I.pesData,U=!1,G=this.pmtParsed,K=this._pmtId,q=D.length;if(this.remainderData&&(q=(D=Object(o.appendUint8Array)(this.remainderData,D)).length,this.remainderData=null),q<188&&!u)return this.remainderData=D,{audioTrack:C,avcTrack:p,id3Track:I,textTrack:this._txtTrack};var Z=Math.max(0,f.syncOffset(D));(q-=(q+Z)%188)<D.byteLength&&!u&&(this.remainderData=new Uint8Array(D.buffer,q,D.buffer.byteLength-q));for(var ee=Z;ee<q;ee+=188)if(D[ee]===71){var se=!!(64&D[ee+1]),ne=((31&D[ee+1])<<8)+D[ee+2],ae=void 0;if((48&D[ee+3])>>4>1){if((ae=ee+5+D[ee+4])===ee+188)continue}else ae=ee+4;switch(ne){case w:se&&(O&&(c=d(O))&&this.parseAVCPES(c,!1),O={data:[],size:0}),O&&(O.data.push(D.subarray(ae,ee+188)),O.size+=ee+188-ae);break;case x:se&&(F&&(c=d(F))&&(C.isAAC?this.parseAACPES(c):this.parseMPEGPES(c)),F={data:[],size:0}),F&&(F.data.push(D.subarray(ae,ee+188)),F.size+=ee+188-ae);break;case P:se&&(M&&(c=d(M))&&this.parseID3PES(c),M={data:[],size:0}),M&&(M.data.push(D.subarray(ae,ee+188)),M.size+=ee+188-ae);break;case 0:se&&(ae+=D[ae]+1),K=this._pmtId=g(D,ae);break;case K:se&&(ae+=D[ae]+1);var me=s(D,ae,this.typeSupported.mpeg===!0||this.typeSupported.mp3===!0,L);(w=me.avc)>0&&(p.pid=w),(x=me.audio)>0&&(C.pid=x,C.isAAC=me.isAAC),(P=me.id3)>0&&(I.pid=P),U&&!G&&(A.logger.log("reparse from beginning"),U=!1,ee=Z-188),G=this.pmtParsed=!0;break;case 17:case 8191:break;default:U=!0}}else this.observer.emit(S.Events.ERROR,S.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});p.pesData=O,C.pesData=F,I.pesData=M;var Ee={audioTrack:C,avcTrack:p,id3Track:I,textTrack:this._txtTrack};return u&&this.extractRemainingSamples(Ee),Ee},E.flush=function(){var D,b=this.remainderData;return this.remainderData=null,D=b?this.demux(b,-1,!1,!0):{audioTrack:this._audioTrack,avcTrack:this._avcTrack,textTrack:this._txtTrack,id3Track:this._id3Track},this.extractRemainingSamples(D),this.sampleAes?this.decrypt(D,this.sampleAes):D},E.extractRemainingSamples=function(D){var b,L=D.audioTrack,u=D.avcTrack,c=D.id3Track,p=u.pesData,C=L.pesData,I=c.pesData;p&&(b=d(p))?(this.parseAVCPES(b,!0),u.pesData=null):u.pesData=p,C&&(b=d(C))?(L.isAAC?this.parseAACPES(b):this.parseMPEGPES(b),L.pesData=null):(C!=null&&C.size&&A.logger.log("last AAC PES packet truncated,might overlap between fragments"),L.pesData=C),I&&(b=d(I))?(this.parseID3PES(b),c.pesData=null):c.pesData=I},E.demuxSampleAes=function(D,b,L){var u=this.demux(D,L,!0,!this.config.progressive),c=this.sampleAes=new _.default(this.observer,this.config,b);return this.decrypt(u,c)},E.decrypt=function(D,b){return new Promise(function(L){var u=D.audioTrack,c=D.avcTrack;u.samples&&u.isAAC?b.decryptAacSamples(u.samples,0,function(){c.samples?b.decryptAvcSamples(c.samples,0,0,function(){L(D)}):L(D)}):c.samples&&b.decryptAvcSamples(c.samples,0,0,function(){L(D)})})},E.destroy=function(){this._initPTS=this._initDTS=null,this._duration=0},E.parseAVCPES=function(D,b){var L,u=this,c=this._avcTrack,p=this.parseAVCNALu(D.data),C=this.avcSample,I=!1;D.data=null,C&&p.length&&!c.audFound&&(l(C,c),C=this.avcSample=k(!1,D.pts,D.dts,"")),p.forEach(function(w){switch(w.type){case 1:L=!0,C||(C=u.avcSample=k(!0,D.pts,D.dts,"")),C.frame=!0;var O=w.data;if(I&&O.length>4){var x=new a.default(O).readSliceType();x!==2&&x!==4&&x!==7&&x!==9||(C.key=!0)}break;case 5:L=!0,C||(C=u.avcSample=k(!0,D.pts,D.dts,"")),C.key=!0,C.frame=!0;break;case 6:L=!0;var P=new a.default(m(w.data));P.readUByte();for(var F=0,M=0,U=!1,G=0;!U&&P.bytesAvailable>1;){F=0;do F+=G=P.readUByte();while(G===255);M=0;do M+=G=P.readUByte();while(G===255);if(F===4&&P.bytesAvailable!==0){if(U=!0,P.readUByte()===181&&P.readUShort()===49&&P.readUInt()===1195456820&&P.readUByte()===3){for(var K=P.readUByte(),q=31&K,Z=[K,P.readUByte()],ee=0;ee<q;ee++)Z.push(P.readUByte()),Z.push(P.readUByte()),Z.push(P.readUByte());h(u._txtTrack.samples,{type:3,pts:D.pts,bytes:Z})}}else if(F===5&&P.bytesAvailable!==0){if(U=!0,M>16){for(var se=[],ne=0;ne<16;ne++)se.push(P.readUByte().toString(16)),ne!==3&&ne!==5&&ne!==7&&ne!==9||se.push("-");for(var ae=M-16,me=new Uint8Array(ae),Ee=0;Ee<ae;Ee++)me[Ee]=P.readUByte();h(u._txtTrack.samples,{pts:D.pts,payloadType:F,uuid:se.join(""),userData:Object(v.utf8ArrayToStr)(me),userDataBytes:me})}}else if(M<P.bytesAvailable)for(var N=0;N<M;N++)P.readUByte()}break;case 7:if(L=!0,I=!0,!c.sps){var B=new a.default(w.data).readSPS();c.width=B.width,c.height=B.height,c.pixelRatio=B.pixelRatio,c.sps=[w.data],c.duration=u._duration;for(var j=w.data.subarray(1,4),H="avc1.",V=0;V<3;V++){var z=j[V].toString(16);z.length<2&&(z="0"+z),H+=z}c.codec=H}break;case 8:L=!0,c.pps||(c.pps=[w.data]);break;case 9:L=!1,c.audFound=!0,C&&l(C,c),C=u.avcSample=k(!1,D.pts,D.dts,"");break;case 12:L=!1;break;default:L=!1,C&&(C.debug+="unknown NAL "+w.type+" ")}C&&L&&C.units.push(w)}),b&&C&&(l(C,c),this.avcSample=null)},E.getLastNalUnit=function(){var D,b,L=this.avcSample;if(!L||L.units.length===0){var u=this._avcTrack.samples;L=u[u.length-1]}if((D=L)!==null&&D!==void 0&&D.units){var c=L.units;b=c[c.length-1]}return b},E.parseAVCNALu=function(D){var b,L,u=D.byteLength,c=this._avcTrack,p=c.naluState||0,C=p,I=[],w=0,O=-1,x=0;for(p===-1&&(O=0,x=31&D[0],p=0,w=1);w<u;)if(b=D[w++],p)if(p!==1)if(b)if(b===1){if(O>=0){var P={data:D.subarray(O,w-p-1),type:x};I.push(P)}else{var F=this.getLastNalUnit();if(F&&(C&&w<=4-C&&F.state&&(F.data=F.data.subarray(0,F.data.byteLength-C)),(L=w-p-1)>0)){var M=new Uint8Array(F.data.byteLength+L);M.set(F.data,0),M.set(D.subarray(0,L),F.data.byteLength),F.data=M}}w<u?(O=w,x=31&D[w],p=0):p=-1}else p=0;else p=3;else p=b?0:2;else p=b?0:1;if(O>=0&&p>=0){var U={data:D.subarray(O,u),type:x,state:p};I.push(U)}if(I.length===0){var G=this.getLastNalUnit();if(G){var K=new Uint8Array(G.data.byteLength+D.byteLength);K.set(G.data,0),K.set(D,G.data.byteLength),G.data=K}}return c.naluState=p,I},E.parseAACPES=function(D){var b,L,u,c,p,C=0,I=this._audioTrack,w=this.aacOverFlow,O=D.data;if(w){this.aacOverFlow=null;var x=w.sample.unit.byteLength,P=Math.min(w.missing,x),F=x-P;w.sample.unit.set(O.subarray(0,P),F),I.samples.push(w.sample),C=w.missing}for(b=C,L=O.length;b<L-1&&!n.isHeader(O,b);b++);if(b===C||(b<L-1?(u="AAC PES did not start with ADTS header,offset:"+b,c=!1):(u="no ADTS header found in AAC PES",c=!0),A.logger.warn("parsing error:"+u),this.observer.emit(S.Events.ERROR,S.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.FRAG_PARSING_ERROR,fatal:c,reason:u}),!c)){if(n.initTrackConfig(I,this.observer,O,b,this.audioCodec),D.pts!==void 0)p=D.pts;else{if(!w)return void A.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var M=n.getFrameDuration(I.samplerate);p=w.sample.pts+M}for(var U=0;b<L;){if(n.isHeader(O,b)){if(b+5<L){var G=n.appendFrame(I,O,b,p,U);if(G){if(!G.missing){b+=G.length,U++;continue}this.aacOverFlow=G}}break}b++}}},E.parseMPEGPES=function(D){var b=D.data,L=b.length,u=0,c=0,p=D.pts;if(p!==void 0)for(;c<L;)if(i.isHeader(b,c)){var C=i.appendFrame(this._audioTrack,b,c,p,u);if(!C)break;c+=C.length,u++}else c++;else A.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},E.parseID3PES=function(D){D.pts!==void 0?this._id3Track.samples.push(D):A.logger.warn("[tsdemuxer]: ID3 PES unknown PTS")},f}();function k(f,E,D,b){return{key:f,frame:!1,pts:E,dts:D,units:[],debug:b,length:0}}function g(f,E){return(31&f[E+10])<<8|f[E+11]}function s(f,E,D,b){var L={audio:-1,avc:-1,id3:-1,isAAC:!0},u=E+3+((15&f[E+1])<<8|f[E+2])-4;for(E+=12+((15&f[E+10])<<8|f[E+11]);E<u;){var c=(31&f[E+1])<<8|f[E+2];switch(f[E]){case 207:if(!b){A.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:L.audio===-1&&(L.audio=c);break;case 21:L.id3===-1&&(L.id3=c);break;case 219:if(!b){A.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:L.avc===-1&&(L.avc=c);break;case 3:case 4:D?L.audio===-1&&(L.audio=c,L.isAAC=!1):A.logger.log("MPEG audio found, not supported in this browser");break;case 36:A.logger.warn("Unsupported HEVC stream type found")}E+=5+((15&f[E+3])<<8|f[E+4])}return L}function d(f){var E,D,b,L,u,c=0,p=f.data;if(!f||f.size===0)return null;for(;p[0].length<19&&p.length>1;){var C=new Uint8Array(p[0].length+p[1].length);C.set(p[0]),C.set(p[1],p[0].length),p[0]=C,p.splice(1,1)}if(((E=p[0])[0]<<16)+(E[1]<<8)+E[2]===1){if((D=(E[4]<<8)+E[5])&&D>f.size-6)return null;var I=E[7];192&I&&(L=536870912*(14&E[9])+4194304*(255&E[10])+16384*(254&E[11])+128*(255&E[12])+(254&E[13])/2,64&I?L-(u=536870912*(14&E[14])+4194304*(255&E[15])+16384*(254&E[16])+128*(255&E[17])+(254&E[18])/2)>54e5&&(A.logger.warn(Math.round((L-u)/9e4)+"s delta between PTS and DTS, align them"),L=u):u=L);var w=(b=E[8])+9;if(f.size<=w)return null;f.size-=w;for(var O=new Uint8Array(f.size),x=0,P=p.length;x<P;x++){var F=(E=p[x]).byteLength;if(w){if(w>F){w-=F;continue}E=E.subarray(w),F-=w,w=0}O.set(E,c),c+=F}return D&&(D-=b+3),{data:O,pts:L,dts:u,len:D}}return null}function l(f,E){if(f.units.length&&f.frame){if(f.pts===void 0){var D=E.samples,b=D.length;if(!b)return void E.dropped++;var L=D[b-1];f.pts=L.pts,f.dts=L.dts}E.samples.push(f)}f.debug.length&&A.logger.log(f.pts+"/"+f.dts+":"+f.debug)}function h(f,E){var D=f.length;if(D>0){if(E.pts>=f[D-1].pts)f.push(E);else for(var b=D-1;b>=0;b--)if(E.pts<f[b].pts){f.splice(b,0,E);break}}else f.push(E)}function m(f){for(var E=f.byteLength,D=[],b=1;b<E-2;)f[b]===0&&f[b+1]===0&&f[b+2]===3?(D.push(b+2),b+=2):b++;if(D.length===0)return f;var L=E-D.length,u=new Uint8Array(L),c=0;for(b=0;b<L;c++,b++)c===D[0]&&(c++,D.shift()),u[b]=f[c];return u}R.minProbeByteLength=188,t.default=R},"./src/errors.ts":function(e,t,r){var n,i,a,v;r.r(t),r.d(t,"ErrorTypes",function(){return n}),r.d(t,"ErrorDetails",function(){return a}),(i=n||(n={})).NETWORK_ERROR="networkError",i.MEDIA_ERROR="mediaError",i.KEY_SYSTEM_ERROR="keySystemError",i.MUX_ERROR="muxError",i.OTHER_ERROR="otherError",(v=a||(a={})).KEY_SYSTEM_NO_KEYS="keySystemNoKeys",v.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",v.KEY_SYSTEM_NO_SESSION="keySystemNoSession",v.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",v.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",v.MANIFEST_LOAD_ERROR="manifestLoadError",v.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",v.MANIFEST_PARSING_ERROR="manifestParsingError",v.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",v.LEVEL_EMPTY_ERROR="levelEmptyError",v.LEVEL_LOAD_ERROR="levelLoadError",v.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",v.LEVEL_SWITCH_ERROR="levelSwitchError",v.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",v.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",v.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",v.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",v.FRAG_LOAD_ERROR="fragLoadError",v.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",v.FRAG_DECRYPT_ERROR="fragDecryptError",v.FRAG_PARSING_ERROR="fragParsingError",v.REMUX_ALLOC_ERROR="remuxAllocError",v.KEY_LOAD_ERROR="keyLoadError",v.KEY_LOAD_TIMEOUT="keyLoadTimeOut",v.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",v.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",v.BUFFER_APPEND_ERROR="bufferAppendError",v.BUFFER_APPENDING_ERROR="bufferAppendingError",v.BUFFER_STALLED_ERROR="bufferStalledError",v.BUFFER_FULL_ERROR="bufferFullError",v.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",v.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",v.INTERNAL_EXCEPTION="internalException",v.INTERNAL_ABORTED="aborted",v.UNKNOWN="unknown"},"./src/events.ts":function(e,t,r){var n,i;r.r(t),r.d(t,"Events",function(){return n}),(i=n||(n={})).MEDIA_ATTACHING="hlsMediaAttaching",i.MEDIA_ATTACHED="hlsMediaAttached",i.MEDIA_DETACHING="hlsMediaDetaching",i.MEDIA_DETACHED="hlsMediaDetached",i.BUFFER_RESET="hlsBufferReset",i.BUFFER_CODECS="hlsBufferCodecs",i.BUFFER_CREATED="hlsBufferCreated",i.BUFFER_APPENDING="hlsBufferAppending",i.BUFFER_APPENDED="hlsBufferAppended",i.BUFFER_EOS="hlsBufferEos",i.BUFFER_FLUSHING="hlsBufferFlushing",i.BUFFER_FLUSHED="hlsBufferFlushed",i.MANIFEST_LOADING="hlsManifestLoading",i.MANIFEST_LOADED="hlsManifestLoaded",i.MANIFEST_PARSED="hlsManifestParsed",i.LEVEL_SWITCHING="hlsLevelSwitching",i.LEVEL_SWITCHED="hlsLevelSwitched",i.LEVEL_LOADING="hlsLevelLoading",i.LEVEL_LOADED="hlsLevelLoaded",i.LEVEL_UPDATED="hlsLevelUpdated",i.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",i.LEVELS_UPDATED="hlsLevelsUpdated",i.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",i.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",i.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",i.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",i.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",i.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",i.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",i.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",i.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",i.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",i.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",i.CUES_PARSED="hlsCuesParsed",i.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",i.INIT_PTS_FOUND="hlsInitPtsFound",i.FRAG_LOADING="hlsFragLoading",i.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",i.FRAG_LOADED="hlsFragLoaded",i.FRAG_DECRYPTED="hlsFragDecrypted",i.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",i.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",i.FRAG_PARSING_METADATA="hlsFragParsingMetadata",i.FRAG_PARSED="hlsFragParsed",i.FRAG_BUFFERED="hlsFragBuffered",i.FRAG_CHANGED="hlsFragChanged",i.FPS_DROP="hlsFpsDrop",i.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",i.ERROR="hlsError",i.DESTROYING="hlsDestroying",i.KEY_LOADING="hlsKeyLoading",i.KEY_LOADED="hlsKeyLoaded",i.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",i.BACK_BUFFER_REACHED="hlsBackBufferReached"},"./src/hls.ts":function(e,t,r){r.r(t),r.d(t,"default",function(){return l});var n=r("./node_modules/url-toolkit/src/url-toolkit.js"),i=r("./src/loader/playlist-loader.ts"),a=r("./src/loader/key-loader.ts"),v=r("./src/controller/id3-track-controller.ts"),_=r("./src/controller/latency-controller.ts"),S=r("./src/controller/level-controller.ts"),o=r("./src/controller/fragment-tracker.ts"),A=r("./src/controller/stream-controller.ts"),T=r("./src/is-supported.ts"),y=r("./src/utils/logger.ts"),R=r("./src/config.ts"),k=r("./node_modules/eventemitter3/index.js"),g=r("./src/events.ts"),s=r("./src/errors.ts");function d(h,m){for(var f=0;f<m.length;f++){var E=m[f];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(h,E.key,E)}}var l=function(){function h(b){b===void 0&&(b={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new k.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this._media=null,this.url=null;var L=this.config=Object(R.mergeConfig)(h.DefaultConfig,b);this.userConfig=b,Object(y.enableLogs)(L.debug),this._autoLevelCapping=-1,L.progressive&&Object(R.enableStreamingMode)(L);var u=L.abrController,c=L.bufferController,p=L.capLevelController,C=L.fpsController,I=this.abrController=new u(this),w=this.bufferController=new c(this),O=this.capLevelController=new p(this),x=new C(this),P=new i.default(this),F=new a.default(this),M=new v.default(this),U=this.levelController=new S.default(this),G=new o.FragmentTracker(this),K=this.streamController=new A.default(this,G);O.setStreamController(K),x.setStreamController(K);var q=[U,K];this.networkControllers=q;var Z=[P,F,I,w,O,x,M,G];this.audioTrackController=this.createController(L.audioTrackController,null,q),this.createController(L.audioStreamController,G,q),this.subtitleTrackController=this.createController(L.subtitleTrackController,null,q),this.createController(L.subtitleStreamController,G,q),this.createController(L.timelineController,null,Z),this.emeController=this.createController(L.emeController,null,Z),this.latencyController=this.createController(_.default,null,Z),this.coreComponents=Z}h.isSupported=function(){return Object(T.isSupported)()};var m,f,E,D=h.prototype;return D.createController=function(b,L,u){if(b){var c=L?new b(this,L):new b(this);return u&&u.push(c),c}return null},D.on=function(b,L,u){u===void 0&&(u=this),this._emitter.on(b,L,u)},D.once=function(b,L,u){u===void 0&&(u=this),this._emitter.once(b,L,u)},D.removeAllListeners=function(b){this._emitter.removeAllListeners(b)},D.off=function(b,L,u,c){u===void 0&&(u=this),this._emitter.off(b,L,u,c)},D.listeners=function(b){return this._emitter.listeners(b)},D.emit=function(b,L,u){return this._emitter.emit(b,L,u)},D.trigger=function(b,L){if(this.config.debug)return this.emit(b,b,L);try{return this.emit(b,b,L)}catch(u){y.logger.error("An internal error happened while handling event "+b+'. Error message: "'+u.message+'". Here is a stacktrace:',u),this.trigger(g.Events.ERROR,{type:s.ErrorTypes.OTHER_ERROR,details:s.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:b,error:u})}return!1},D.listenerCount=function(b){return this._emitter.listenerCount(b)},D.destroy=function(){y.logger.log("destroy"),this.trigger(g.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(b){return b.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(b){return b.destroy()}),this.coreComponents.length=0},D.attachMedia=function(b){y.logger.log("attachMedia"),this._media=b,this.trigger(g.Events.MEDIA_ATTACHING,{media:b})},D.detachMedia=function(){y.logger.log("detachMedia"),this.trigger(g.Events.MEDIA_DETACHING,void 0),this._media=null},D.loadSource=function(b){this.stopLoad();var L=this.media,u=this.url,c=this.url=n.buildAbsoluteURL(self.location.href,b,{alwaysNormalize:!0});y.logger.log("loadSource:"+c),L&&u&&u!==c&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(L)),this.trigger(g.Events.MANIFEST_LOADING,{url:b})},D.startLoad=function(b){b===void 0&&(b=-1),y.logger.log("startLoad("+b+")"),this.networkControllers.forEach(function(L){L.startLoad(b)})},D.stopLoad=function(){y.logger.log("stopLoad"),this.networkControllers.forEach(function(b){b.stopLoad()})},D.swapAudioCodec=function(){y.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},D.recoverMediaError=function(){y.logger.log("recoverMediaError");var b=this._media;this.detachMedia(),b&&this.attachMedia(b)},D.removeLevel=function(b,L){L===void 0&&(L=0),this.levelController.removeLevel(b,L)},m=h,E=[{key:"version",get:function(){return"1.0.10"}},{key:"Events",get:function(){return g.Events}},{key:"ErrorTypes",get:function(){return s.ErrorTypes}},{key:"ErrorDetails",get:function(){return s.ErrorDetails}},{key:"DefaultConfig",get:function(){return h.defaultConfig?h.defaultConfig:R.hlsDefaultConfig},set:function(b){h.defaultConfig=b}}],(f=[{key:"levels",get:function(){var b=this.levelController.levels;return b||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(b){y.logger.log("set currentLevel:"+b),this.loadLevel=b,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(b){y.logger.log("set nextLevel:"+b),this.levelController.manualLevel=b,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(b){y.logger.log("set loadLevel:"+b),this.levelController.manualLevel=b}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(b){this.levelController.nextLoadLevel=b}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(b){y.logger.log("set firstLevel:"+b),this.levelController.firstLevel=b}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(b){y.logger.log("set startLevel:"+b),b!==-1&&(b=Math.max(b,this.minAutoLevel)),this.levelController.startLevel=b}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(b){var L=!!b;L!==this.config.capLevelToPlayerSize&&(L?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=L)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(b){this._autoLevelCapping!==b&&(y.logger.log("set autoLevelCapping:"+b),this._autoLevelCapping=b)}},{key:"bandwidthEstimate",get:function(){var b=this.abrController.bwEstimator;return b?b.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var b=this.levels,L=this.config.minAutoBitrate;if(!b)return 0;for(var u=b.length,c=0;c<u;c++)if(b[c].maxBitrate>L)return c;return 0}},{key:"maxAutoLevel",get:function(){var b=this.levels,L=this.autoLevelCapping;return L===-1&&b&&b.length?b.length-1:L}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(b){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,b)}},{key:"audioTracks",get:function(){var b=this.audioTrackController;return b?b.audioTracks:[]}},{key:"audioTrack",get:function(){var b=this.audioTrackController;return b?b.audioTrack:-1},set:function(b){var L=this.audioTrackController;L&&(L.audioTrack=b)}},{key:"subtitleTracks",get:function(){var b=this.subtitleTrackController;return b?b.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var b=this.subtitleTrackController;return b?b.subtitleTrack:-1},set:function(b){var L=this.subtitleTrackController;L&&(L.subtitleTrack=b)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var b=this.subtitleTrackController;return!!b&&b.subtitleDisplay},set:function(b){var L=this.subtitleTrackController;L&&(L.subtitleDisplay=b)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(b){this.config.lowLatencyMode=b}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}])&&d(m.prototype,f),E&&d(m,E),h}();l.defaultConfig=void 0},"./src/is-supported.ts":function(e,t,r){r.r(t),r.d(t,"isSupported",function(){return a}),r.d(t,"changeTypeSupported",function(){return v});var n=r("./src/utils/mediasource-helper.ts");function i(){return self.SourceBuffer||self.WebKitSourceBuffer}function a(){var _=Object(n.getMediaSource)();if(!_)return!1;var S=i(),o=_&&typeof _.isTypeSupported=="function"&&_.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),A=!S||S.prototype&&typeof S.prototype.appendBuffer=="function"&&typeof S.prototype.remove=="function";return!!o&&!!A}function v(){var _,S=i();return typeof(S==null||(_=S.prototype)===null||_===void 0?void 0:_.changeType)=="function"}},"./src/loader/fragment-loader.ts":function(e,t,r){r.r(t),r.d(t,"default",function(){return T}),r.d(t,"LoadError",function(){return R});var n=r("./src/polyfills/number.ts"),i=r("./src/errors.ts");function a(k){var g=typeof Map=="function"?new Map:void 0;return(a=function(s){if(s===null||(d=s,Function.toString.call(d).indexOf("[native code]")===-1))return s;var d;if(typeof s!="function")throw new TypeError("Super expression must either be null or a function");if(g!==void 0){if(g.has(s))return g.get(s);g.set(s,l)}function l(){return v(s,arguments,o(this).constructor)}return l.prototype=Object.create(s.prototype,{constructor:{value:l,enumerable:!1,writable:!0,configurable:!0}}),S(l,s)})(k)}function v(k,g,s){return(v=_()?Reflect.construct:function(d,l,h){var m=[null];m.push.apply(m,l);var f=new(Function.bind.apply(d,m));return h&&S(f,h.prototype),f}).apply(null,arguments)}function _(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function S(k,g){return(S=Object.setPrototypeOf||function(s,d){return s.__proto__=d,s})(k,g)}function o(k){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(g){return g.__proto__||Object.getPrototypeOf(g)})(k)}var A=Math.pow(2,17),T=function(){function k(s){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=s}var g=k.prototype;return g.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},g.abort=function(){this.loader&&this.loader.abort()},g.load=function(s,d){var l=this,h=s.url;if(!h)return Promise.reject(new R({type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:s,networkDetails:null},"Fragment does not have a "+(h?"part list":"url")));this.abort();var m=this.config,f=m.fLoader,E=m.loader;return new Promise(function(D,b){l.loader&&l.loader.destroy();var L=l.loader=s.loader=f?new f(m):new E(m),u=y(s),c={timeout:m.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:m.fragLoadingMaxRetryTimeout,highWaterMark:A};s.stats=L.stats,L.load(u,c,{onSuccess:function(p,C,I,w){l.resetLoader(s,L),D({frag:s,part:null,payload:p.data,networkDetails:w})},onError:function(p,C,I){l.resetLoader(s,L),b(new R({type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:s,response:p,networkDetails:I}))},onAbort:function(p,C,I){l.resetLoader(s,L),b(new R({type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:s,networkDetails:I}))},onTimeout:function(p,C,I){l.resetLoader(s,L),b(new R({type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:s,networkDetails:I}))},onProgress:function(p,C,I,w){d&&d({frag:s,part:null,payload:I,networkDetails:w})}})})},g.loadPart=function(s,d,l){var h=this;this.abort();var m=this.config,f=m.fLoader,E=m.loader;return new Promise(function(D,b){h.loader&&h.loader.destroy();var L=h.loader=s.loader=f?new f(m):new E(m),u=y(s,d),c={timeout:m.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:m.fragLoadingMaxRetryTimeout,highWaterMark:A};d.stats=L.stats,L.load(u,c,{onSuccess:function(p,C,I,w){h.resetLoader(s,L),h.updateStatsFromPart(s,d);var O={frag:s,part:d,payload:p.data,networkDetails:w};l(O),D(O)},onError:function(p,C,I){h.resetLoader(s,L),b(new R({type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:s,part:d,response:p,networkDetails:I}))},onAbort:function(p,C,I){s.stats.aborted=d.stats.aborted,h.resetLoader(s,L),b(new R({type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:s,part:d,networkDetails:I}))},onTimeout:function(p,C,I){h.resetLoader(s,L),b(new R({type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:s,part:d,networkDetails:I}))}})})},g.updateStatsFromPart=function(s,d){var l=s.stats,h=d.stats,m=h.total;if(l.loaded+=h.loaded,m){var f=Math.round(s.duration/d.duration),E=Math.min(Math.round(l.loaded/m),f),D=(f-E)*Math.round(l.loaded/E);l.total=l.loaded+D}else l.total=Math.max(l.loaded,l.total);var b=l.loading,L=h.loading;b.start?b.first+=L.first-L.start:(b.start=L.start,b.first=L.first),b.end=L.end},g.resetLoader=function(s,d){s.loader=null,this.loader===d&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),d.destroy()},k}();function y(k,g){g===void 0&&(g=null);var s=g||k,d={frag:k,part:g,responseType:"arraybuffer",url:s.url,rangeStart:0,rangeEnd:0},l=s.byteRangeStartOffset,h=s.byteRangeEndOffset;return Object(n.isFiniteNumber)(l)&&Object(n.isFiniteNumber)(h)&&(d.rangeStart=l,d.rangeEnd=h),d}var R=function(k){var g,s;function d(l){for(var h,m=arguments.length,f=new Array(m>1?m-1:0),E=1;E<m;E++)f[E-1]=arguments[E];return(h=k.call.apply(k,[this].concat(f))||this).data=void 0,h.data=l,h}return s=k,(g=d).prototype=Object.create(s.prototype),g.prototype.constructor=g,S(g,s),d}(a(Error))},"./src/loader/fragment.ts":function(e,t,r){r.r(t),r.d(t,"ElementaryStreamTypes",function(){return n}),r.d(t,"BaseSegment",function(){return k}),r.d(t,"Fragment",function(){return g}),r.d(t,"Part",function(){return s});var n,i,a=r("./src/polyfills/number.ts"),v=r("./node_modules/url-toolkit/src/url-toolkit.js"),_=r("./src/utils/logger.ts"),S=r("./src/loader/level-key.ts"),o=r("./src/loader/load-stats.ts");function A(d,l){d.prototype=Object.create(l.prototype),d.prototype.constructor=d,T(d,l)}function T(d,l){return(T=Object.setPrototypeOf||function(h,m){return h.__proto__=m,h})(d,l)}function y(d,l){for(var h=0;h<l.length;h++){var m=l[h];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(d,m.key,m)}}function R(d,l,h){return l&&y(d.prototype,l),h&&y(d,h),d}(i=n||(n={})).AUDIO="audio",i.VIDEO="video",i.AUDIOVIDEO="audiovideo";var k=function(){function d(l){var h;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((h={})[n.AUDIO]=null,h[n.VIDEO]=null,h[n.AUDIOVIDEO]=null,h),this.baseurl=l}return d.prototype.setByteRange=function(l,h){var m=l.split("@",2),f=[];m.length===1?f[0]=h?h.byteRangeEndOffset:0:f[0]=parseInt(m[1]),f[1]=parseInt(m[0])+f[0],this._byteRange=f},R(d,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(v.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(l){this._url=l}}]),d}(),g=function(d){function l(m,f){var E;return(E=d.call(this,f)||this)._decryptdata=null,E.rawProgramDateTime=null,E.programDateTime=null,E.tagList=[],E.duration=0,E.sn=0,E.levelkey=void 0,E.type=void 0,E.loader=null,E.level=-1,E.cc=0,E.startPTS=void 0,E.endPTS=void 0,E.appendedPTS=void 0,E.startDTS=void 0,E.endDTS=void 0,E.start=0,E.deltaPTS=void 0,E.maxStartPTS=void 0,E.minEndPTS=void 0,E.stats=new o.LoadStats,E.urlId=0,E.data=void 0,E.bitrateTest=!1,E.title=null,E.initSegment=null,E.type=m,E}A(l,d);var h=l.prototype;return h.createInitializationVector=function(m){for(var f=new Uint8Array(16),E=12;E<16;E++)f[E]=m>>8*(15-E)&255;return f},h.setDecryptDataFromLevelKey=function(m,f){var E=m;return(m==null?void 0:m.method)==="AES-128"&&m.uri&&!m.iv&&((E=S.LevelKey.fromURI(m.uri)).method=m.method,E.iv=this.createInitializationVector(f),E.keyFormat="identity"),E},h.setElementaryStreamInfo=function(m,f,E,D,b,L){L===void 0&&(L=!1);var u=this.elementaryStreams,c=u[m];c?(c.startPTS=Math.min(c.startPTS,f),c.endPTS=Math.max(c.endPTS,E),c.startDTS=Math.min(c.startDTS,D),c.endDTS=Math.max(c.endDTS,b)):u[m]={startPTS:f,endPTS:E,startDTS:D,endDTS:b,partial:L}},h.clearElementaryStreamInfo=function(){var m=this.elementaryStreams;m[n.AUDIO]=null,m[n.VIDEO]=null,m[n.AUDIOVIDEO]=null},R(l,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var m=this.sn;typeof m!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&_.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),m=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,m)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(a.isFiniteNumber)(this.programDateTime))return null;var m=Object(a.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*m}},{key:"encrypted",get:function(){var m;return!((m=this.decryptdata)===null||m===void 0||!m.keyFormat||!this.decryptdata.uri)}}]),l}(k),s=function(d){function l(h,m,f,E,D){var b;(b=d.call(this,f)||this).fragOffset=0,b.duration=0,b.gap=!1,b.independent=!1,b.relurl=void 0,b.fragment=void 0,b.index=void 0,b.stats=new o.LoadStats,b.duration=h.decimalFloatingPoint("DURATION"),b.gap=h.bool("GAP"),b.independent=h.bool("INDEPENDENT"),b.relurl=h.enumeratedString("URI"),b.fragment=m,b.index=E;var L=h.enumeratedString("BYTERANGE");return L&&b.setByteRange(L,D),D&&(b.fragOffset=D.fragOffset+D.duration),b}return A(l,d),R(l,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var h=this.elementaryStreams;return!!(h.audio||h.video||h.audiovideo)}}]),l}(k)},"./src/loader/key-loader.ts":function(e,t,r){r.r(t),r.d(t,"default",function(){return v});var n=r("./src/events.ts"),i=r("./src/errors.ts"),a=r("./src/utils/logger.ts"),v=function(){function _(o){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=o,this._registerListeners()}var S=_.prototype;return S._registerListeners=function(){this.hls.on(n.Events.KEY_LOADING,this.onKeyLoading,this)},S._unregisterListeners=function(){this.hls.off(n.Events.KEY_LOADING,this.onKeyLoading)},S.destroy=function(){for(var o in this._unregisterListeners(),this.loaders){var A=this.loaders[o];A&&A.destroy()}this.loaders={}},S.onKeyLoading=function(o,A){var T=A.frag,y=T.type,R=this.loaders[y];if(T.decryptdata){var k=T.decryptdata.uri;if(k!==this.decrypturl||this.decryptkey===null){var g=this.hls.config;if(R&&(a.logger.warn("abort previous key loader for type:"+y),R.abort()),!k)return void a.logger.warn("key uri is falsy");var s=g.loader,d=T.loader=this.loaders[y]=new s(g);this.decrypturl=k,this.decryptkey=null;var l={url:k,frag:T,responseType:"arraybuffer"},h={timeout:g.fragLoadingTimeOut,maxRetry:0,retryDelay:g.fragLoadingRetryDelay,maxRetryDelay:g.fragLoadingMaxRetryTimeout,highWaterMark:0},m={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};d.load(l,h,m)}else this.decryptkey&&(T.decryptdata.key=this.decryptkey,this.hls.trigger(n.Events.KEY_LOADED,{frag:T}))}else a.logger.warn("Missing decryption data on fragment in onKeyLoading")},S.loadsuccess=function(o,A,T){var y=T.frag;y.decryptdata?(this.decryptkey=y.decryptdata.key=new Uint8Array(o.data),y.loader=null,delete this.loaders[y.type],this.hls.trigger(n.Events.KEY_LOADED,{frag:y})):a.logger.error("after key load, decryptdata unset")},S.loaderror=function(o,A){var T=A.frag,y=T.loader;y&&y.abort(),delete this.loaders[T.type],this.hls.trigger(n.Events.ERROR,{type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:T,response:o})},S.loadtimeout=function(o,A){var T=A.frag,y=T.loader;y&&y.abort(),delete this.loaders[T.type],this.hls.trigger(n.Events.ERROR,{type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:T})},_}()},"./src/loader/level-details.ts":function(e,t,r){r.r(t),r.d(t,"LevelDetails",function(){return a});var n=r("./src/polyfills/number.ts");function i(v,_){for(var S=0;S<_.length;S++){var o=_[S];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(v,o.key,o)}}var a=function(){function v(o){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.url=o}var _,S;return v.prototype.reloaded=function(o){if(!o)return this.advanced=!0,void(this.updated=!0);var A=this.lastPartSn-o.lastPartSn,T=this.lastPartIndex-o.lastPartIndex;this.updated=this.endSN!==o.endSN||!!T||!!A,this.advanced=this.endSN>o.endSN||A>0||A===0&&T>0,this.updated||this.advanced?this.misses=Math.floor(.6*o.misses):this.misses=o.misses+1,this.availabilityDelay=o.availabilityDelay},_=v,(S=[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&Object(n.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var o=this.driftEndTime-this.driftStartTime;return o>0?1e3*(this.driftEnd-this.driftStart)/o:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var o;return(o=this.partList)!==null&&o!==void 0&&o.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var o;return(o=this.fragments)!==null&&o!==void 0&&o.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var o;return(o=this.partList)!==null&&o!==void 0&&o.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var o;return(o=this.partList)!==null&&o!==void 0&&o.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}])&&i(_.prototype,S),v}()},"./src/loader/level-key.ts":function(e,t,r){r.r(t),r.d(t,"LevelKey",function(){return a});var n=r("./node_modules/url-toolkit/src/url-toolkit.js");function i(v,_){for(var S=0;S<_.length;S++){var o=_[S];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(v,o.key,o)}}var a=function(){function v(o,A){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,this._uri=A?Object(n.buildAbsoluteURL)(o,A,{alwaysNormalize:!0}):o}var _,S;return v.fromURL=function(o,A){return new v(o,A)},v.fromURI=function(o){return new v(o)},_=v,(S=[{key:"uri",get:function(){return this._uri}}])&&i(_.prototype,S),v}()},"./src/loader/load-stats.ts":function(e,t,r){r.r(t),r.d(t,"LoadStats",function(){return n});var n=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(e,t,r){r.r(t),r.d(t,"default",function(){return s});var n=r("./src/polyfills/number.ts"),i=r("./node_modules/url-toolkit/src/url-toolkit.js"),a=r("./src/loader/fragment.ts"),v=r("./src/loader/level-details.ts"),_=r("./src/loader/level-key.ts"),S=r("./src/utils/attr-list.ts"),o=r("./src/utils/logger.ts"),A=r("./src/utils/codecs.ts"),T=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,y=/#EXT-X-MEDIA:(.*)/g,R=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),k=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(PLAYLIST-TYPE):(.+)/.source,/#EXT-X-(MEDIA-SEQUENCE): *(\d+)/.source,/#EXT-X-(SKIP):(.+)/.source,/#EXT-X-(TARGETDURATION): *(\d+)/.source,/#EXT-X-(KEY):(.+)/.source,/#EXT-X-(START):(.+)/.source,/#EXT-X-(ENDLIST)/.source,/#EXT-X-(DISCONTINUITY-SEQ)UENCE: *(\d+)/.source,/#EXT-X-(DIS)CONTINUITY/.source,/#EXT-X-(VERSION):(\d+)/.source,/#EXT-X-(MAP):(.+)/.source,/#EXT-X-(SERVER-CONTROL):(.+)/.source,/#EXT-X-(PART-INF):(.+)/.source,/#EXT-X-(GAP)/.source,/#EXT-X-(BITRATE):\s*(\d+)/.source,/#EXT-X-(PART):(.+)/.source,/#EXT-X-(PRELOAD-HINT):(.+)/.source,/#EXT-X-(RENDITION-REPORT):(.+)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),g=/\.(mp4|m4s|m4v|m4a)$/i,s=function(){function m(){}return m.findGroup=function(f,E){for(var D=0;D<f.length;D++){var b=f[D];if(b.id===E)return b}},m.convertAVC1ToAVCOTI=function(f){var E=f.split(".");if(E.length>2){var D=E.shift()+".";return D+=parseInt(E.shift()).toString(16),D+=("000"+parseInt(E.shift()).toString(16)).substr(-4)}return f},m.resolve=function(f,E){return i.buildAbsoluteURL(E,f,{alwaysNormalize:!0})},m.parseMasterPlaylist=function(f,E){var D,b=[],L={},u=!1;for(T.lastIndex=0;(D=T.exec(f))!=null;)if(D[1]){var c=new S.AttrList(D[1]),p={attrs:c,bitrate:c.decimalInteger("AVERAGE-BANDWIDTH")||c.decimalInteger("BANDWIDTH"),name:c.NAME,url:m.resolve(D[2],E)},C=c.decimalResolution("RESOLUTION");C&&(p.width=C.width,p.height=C.height),d((c.CODECS||"").split(/[ ,]+/).filter(function(w){return w}),p),p.videoCodec&&p.videoCodec.indexOf("avc1")!==-1&&(p.videoCodec=m.convertAVC1ToAVCOTI(p.videoCodec)),b.push(p)}else if(D[3]){var I=new S.AttrList(D[3]);I["DATA-ID"]&&(u=!0,L[I["DATA-ID"]]=I)}return{levels:b,sessionData:u?L:null}},m.parseMasterPlaylistMedia=function(f,E,D,b){var L;b===void 0&&(b=[]);var u=[],c=0;for(y.lastIndex=0;(L=y.exec(f))!==null;){var p=new S.AttrList(L[1]);if(p.TYPE===D){var C={attrs:p,bitrate:0,id:c++,groupId:p["GROUP-ID"],instreamId:p["INSTREAM-ID"],name:p.NAME||p.LANGUAGE||"",type:D,default:p.bool("DEFAULT"),autoselect:p.bool("AUTOSELECT"),forced:p.bool("FORCED"),lang:p.LANGUAGE,url:p.URI?m.resolve(p.URI,E):""};if(b.length){var I=m.findGroup(b,C.groupId)||b[0];l(C,I,"audioCodec"),l(C,I,"textCodec")}u.push(C)}}return u},m.parseLevelPlaylist=function(f,E,D,b,L){var u,c,p,C=new v.LevelDetails(E),I=C.fragments,w=null,O=0,x=0,P=0,F=0,M=null,U=new a.Fragment(b,E),G=-1,K=!1;for(R.lastIndex=0,C.m3u8=f;(u=R.exec(f))!==null;){K&&(K=!1,(U=new a.Fragment(b,E)).start=P,U.sn=O,U.cc=F,U.level=D,w&&(U.initSegment=w,U.rawProgramDateTime=w.rawProgramDateTime));var q=u[1];if(q){U.duration=parseFloat(q);var Z=(" "+u[2]).slice(1);U.title=Z||null,U.tagList.push(Z?["INF",q,Z]:["INF",q])}else if(u[3])Object(n.isFiniteNumber)(U.duration)&&(U.start=P,p&&(U.levelkey=p),U.sn=O,U.level=D,U.cc=F,U.urlId=L,I.push(U),U.relurl=(" "+u[3]).slice(1),h(U,M),M=U,P+=U.duration,O++,x=0,K=!0);else if(u[4]){var ee=(" "+u[4]).slice(1);M?U.setByteRange(ee,M):U.setByteRange(ee)}else if(u[5])U.rawProgramDateTime=(" "+u[5]).slice(1),U.tagList.push(["PROGRAM-DATE-TIME",U.rawProgramDateTime]),G===-1&&(G=I.length);else{if(!(u=u[0].match(k))){o.logger.warn("No matches on slow regex match for level playlist!");continue}for(c=1;c<u.length&&u[c]===void 0;c++);var se=(" "+u[c]).slice(1),ne=(" "+u[c+1]).slice(1),ae=u[c+2]?(" "+u[c+2]).slice(1):"";switch(se){case"PLAYLIST-TYPE":C.type=ne.toUpperCase();break;case"MEDIA-SEQUENCE":O=C.startSN=parseInt(ne);break;case"SKIP":var me=new S.AttrList(ne),Ee=me.decimalInteger("SKIPPED-SEGMENTS");if(Object(n.isFiniteNumber)(Ee)){C.skippedSegments=Ee;for(var N=Ee;N--;)I.unshift(null);O+=Ee}var B=me.enumeratedString("RECENTLY-REMOVED-DATERANGES");B&&(C.recentlyRemovedDateranges=B.split("	"));break;case"TARGETDURATION":C.targetduration=parseFloat(ne);break;case"VERSION":C.version=parseInt(ne);break;case"EXTM3U":break;case"ENDLIST":C.live=!1;break;case"#":(ne||ae)&&U.tagList.push(ae?[ne,ae]:[ne]);break;case"DIS":F++;case"GAP":U.tagList.push([se]);break;case"BITRATE":U.tagList.push([se,ne]);break;case"DISCONTINUITY-SEQ":F=parseInt(ne);break;case"KEY":var j,H=new S.AttrList(ne),V=H.enumeratedString("METHOD"),z=H.URI,$=H.hexadecimalInteger("IV"),X=H.enumeratedString("KEYFORMATVERSIONS"),Q=H.enumeratedString("KEYID"),Y=(j=H.enumeratedString("KEYFORMAT"))!=null?j:"identity";if(["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"].indexOf(Y)>-1){o.logger.warn("Keyformat "+Y+" is not supported from the manifest");continue}if(Y!=="identity")continue;V&&(p=_.LevelKey.fromURL(E,z),z&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(V)>=0&&(p.method=V,p.keyFormat=Y,Q&&(p.keyID=Q),X&&(p.keyFormatVersions=X),p.iv=$));break;case"START":var ie=new S.AttrList(ne).decimalFloatingPoint("TIME-OFFSET");Object(n.isFiniteNumber)(ie)&&(C.startTimeOffset=ie);break;case"MAP":var te=new S.AttrList(ne);U.relurl=te.URI,te.BYTERANGE&&U.setByteRange(te.BYTERANGE),U.level=D,U.sn="initSegment",p&&(U.levelkey=p),U.initSegment=null,w=U,K=!0;break;case"SERVER-CONTROL":var re=new S.AttrList(ne);C.canBlockReload=re.bool("CAN-BLOCK-RELOAD"),C.canSkipUntil=re.optionalFloat("CAN-SKIP-UNTIL",0),C.canSkipDateRanges=C.canSkipUntil>0&&re.bool("CAN-SKIP-DATERANGES"),C.partHoldBack=re.optionalFloat("PART-HOLD-BACK",0),C.holdBack=re.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var oe=new S.AttrList(ne);C.partTarget=oe.decimalFloatingPoint("PART-TARGET");break;case"PART":var le=C.partList;le||(le=C.partList=[]);var he=x>0?le[le.length-1]:void 0,ge=x++,Te=new a.Part(new S.AttrList(ne),U,E,ge,he);le.push(Te),U.duration+=Te.duration;break;case"PRELOAD-HINT":var _e=new S.AttrList(ne);C.preloadHint=_e;break;case"RENDITION-REPORT":var He=new S.AttrList(ne);C.renditionReports=C.renditionReports||[],C.renditionReports.push(He);break;default:o.logger.warn("line parsed but not handled: "+u)}}}M&&!M.relurl?(I.pop(),P-=M.duration,C.partList&&(C.fragmentHint=M)):C.partList&&(h(U,M),U.cc=F,C.fragmentHint=U);var at=I.length,Me=I[0],ct=I[at-1];if((P+=C.skippedSegments*C.targetduration)>0&&at&&ct){C.averagetargetduration=P/at;var Ae=ct.sn;C.endSN=Ae!=="initSegment"?Ae:0,Me&&(C.startCC=Me.cc,Me.initSegment||C.fragments.every(function(Re){return Re.relurl&&(qe=Re.relurl,g.test((bt=(Je=i.parseURL(qe))===null||Je===void 0?void 0:Je.path)!=null?bt:""));var qe,bt,Je})&&(o.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(U=new a.Fragment(b,E)).relurl=ct.relurl,U.level=D,U.sn="initSegment",Me.initSegment=U,C.needSidxRanges=!0))}else C.endSN=0,C.startCC=0;return C.fragmentHint&&(P+=C.fragmentHint.duration),C.totalduration=P,C.endCC=F,G>0&&function(Re,qe){for(var bt=Re[qe],Je=qe;Je--;){var St=Re[Je];if(!St)return;St.programDateTime=bt.programDateTime-1e3*St.duration,bt=St}}(I,G),C},m}();function d(m,f){["video","audio","text"].forEach(function(E){var D=m.filter(function(L){return Object(A.isCodecType)(L,E)});if(D.length){var b=D.filter(function(L){return L.lastIndexOf("avc1",0)===0||L.lastIndexOf("mp4a",0)===0});f[E+"Codec"]=b.length>0?b[0]:D[0],m=m.filter(function(L){return D.indexOf(L)===-1})}}),f.unknownCodecs=m}function l(m,f,E){var D=f[E];D&&(m[E]=D)}function h(m,f){m.rawProgramDateTime?m.programDateTime=Date.parse(m.rawProgramDateTime):f!=null&&f.programDateTime&&(m.programDateTime=f.endProgramDateTime),Object(n.isFiniteNumber)(m.programDateTime)||(m.programDateTime=null,m.rawProgramDateTime=null)}},"./src/loader/playlist-loader.ts":function(e,t,r){r.r(t);var n=r("./src/polyfills/number.ts"),i=r("./src/events.ts"),a=r("./src/errors.ts"),v=r("./src/utils/logger.ts"),_=r("./src/utils/mp4-tools.ts"),S=r("./src/loader/m3u8-parser.ts"),o=r("./src/types/loader.ts"),A=r("./src/utils/attr-list.ts");function T(R,k){var g=R.url;return g!==void 0&&g.indexOf("data:")!==0||(g=k.url),g}var y=function(){function R(g){this.hls=void 0,this.loaders=Object.create(null),this.hls=g,this.registerListeners()}var k=R.prototype;return k.registerListeners=function(){var g=this.hls;g.on(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),g.on(i.Events.LEVEL_LOADING,this.onLevelLoading,this),g.on(i.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),g.on(i.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},k.unregisterListeners=function(){var g=this.hls;g.off(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),g.off(i.Events.LEVEL_LOADING,this.onLevelLoading,this),g.off(i.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),g.off(i.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},k.createInternalLoader=function(g){var s=this.hls.config,d=s.pLoader,l=s.loader,h=new(d||l)(s);return g.loader=h,this.loaders[g.type]=h,h},k.getInternalLoader=function(g){return this.loaders[g.type]},k.resetInternalLoader=function(g){this.loaders[g]&&delete this.loaders[g]},k.destroyInternalLoaders=function(){for(var g in this.loaders){var s=this.loaders[g];s&&s.destroy(),this.resetInternalLoader(g)}},k.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},k.onManifestLoading=function(g,s){var d=s.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:o.PlaylistContextType.MANIFEST,url:d,deliveryDirectives:null})},k.onLevelLoading=function(g,s){var d=s.id,l=s.level,h=s.url,m=s.deliveryDirectives;this.load({id:d,groupId:null,level:l,responseType:"text",type:o.PlaylistContextType.LEVEL,url:h,deliveryDirectives:m})},k.onAudioTrackLoading=function(g,s){var d=s.id,l=s.groupId,h=s.url,m=s.deliveryDirectives;this.load({id:d,groupId:l,level:null,responseType:"text",type:o.PlaylistContextType.AUDIO_TRACK,url:h,deliveryDirectives:m})},k.onSubtitleTrackLoading=function(g,s){var d=s.id,l=s.groupId,h=s.url,m=s.deliveryDirectives;this.load({id:d,groupId:l,level:null,responseType:"text",type:o.PlaylistContextType.SUBTITLE_TRACK,url:h,deliveryDirectives:m})},k.load=function(g){var s,d,l,h,m,f,E=this.hls.config,D=this.getInternalLoader(g);if(D){var b=D.context;if(b&&b.url===g.url)return void v.logger.trace("[playlist-loader]: playlist request ongoing");v.logger.log("[playlist-loader]: aborting previous loader for type: "+g.type),D.abort()}switch(g.type){case o.PlaylistContextType.MANIFEST:d=E.manifestLoadingMaxRetry,l=E.manifestLoadingTimeOut,h=E.manifestLoadingRetryDelay,m=E.manifestLoadingMaxRetryTimeout;break;case o.PlaylistContextType.LEVEL:case o.PlaylistContextType.AUDIO_TRACK:case o.PlaylistContextType.SUBTITLE_TRACK:d=0,l=E.levelLoadingTimeOut;break;default:d=E.levelLoadingMaxRetry,l=E.levelLoadingTimeOut,h=E.levelLoadingRetryDelay,m=E.levelLoadingMaxRetryTimeout}if(D=this.createInternalLoader(g),(s=g.deliveryDirectives)!==null&&s!==void 0&&s.part&&(g.type===o.PlaylistContextType.LEVEL&&g.level!==null?f=this.hls.levels[g.level].details:g.type===o.PlaylistContextType.AUDIO_TRACK&&g.id!==null?f=this.hls.audioTracks[g.id].details:g.type===o.PlaylistContextType.SUBTITLE_TRACK&&g.id!==null&&(f=this.hls.subtitleTracks[g.id].details),f)){var L=f.partTarget,u=f.targetduration;L&&u&&(l=Math.min(1e3*Math.max(3*L,.8*u),l))}var c={timeout:l,maxRetry:d,retryDelay:h,maxRetryDelay:m,highWaterMark:0},p={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};D.load(g,c,p)},k.loadsuccess=function(g,s,d,l){if(l===void 0&&(l=null),d.isSidxRequest)return this.handleSidxRequest(g,d),void this.handlePlaylistLoaded(g,s,d,l);this.resetInternalLoader(d.type);var h=g.data;h.indexOf("#EXTM3U")===0?(s.parsing.start=performance.now(),h.indexOf("#EXTINF:")>0||h.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(g,s,d,l):this.handleMasterPlaylist(g,s,d,l)):this.handleManifestParsingError(g,d,"no EXTM3U delimiter",l)},k.loaderror=function(g,s,d){d===void 0&&(d=null),this.handleNetworkError(s,d,!1,g)},k.loadtimeout=function(g,s,d){d===void 0&&(d=null),this.handleNetworkError(s,d,!0)},k.handleMasterPlaylist=function(g,s,d,l){var h=this.hls,m=g.data,f=T(g,d),E=S.default.parseMasterPlaylist(m,f),D=E.levels,b=E.sessionData;if(D.length){var L=D.map(function(I){return{id:I.attrs.AUDIO,audioCodec:I.audioCodec}}),u=D.map(function(I){return{id:I.attrs.SUBTITLES,textCodec:I.textCodec}}),c=S.default.parseMasterPlaylistMedia(m,f,"AUDIO",L),p=S.default.parseMasterPlaylistMedia(m,f,"SUBTITLES",u),C=S.default.parseMasterPlaylistMedia(m,f,"CLOSED-CAPTIONS");c.length&&(c.some(function(I){return!I.url})||!D[0].audioCodec||D[0].attrs.AUDIO||(v.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),c.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new A.AttrList({}),bitrate:0,url:""}))),h.trigger(i.Events.MANIFEST_LOADED,{levels:D,audioTracks:c,subtitles:p,captions:C,url:f,stats:s,networkDetails:l,sessionData:b})}else this.handleManifestParsingError(g,d,"no level found in manifest",l)},k.handleTrackOrLevelPlaylist=function(g,s,d,l){var h=this.hls,m=d.id,f=d.level,E=d.type,D=T(g,d),b=Object(n.isFiniteNumber)(m)?m:0,L=Object(n.isFiniteNumber)(f)?f:b,u=function(w){switch(w.type){case o.PlaylistContextType.AUDIO_TRACK:return o.PlaylistLevelType.AUDIO;case o.PlaylistContextType.SUBTITLE_TRACK:return o.PlaylistLevelType.SUBTITLE;default:return o.PlaylistLevelType.MAIN}}(d),c=S.default.parseLevelPlaylist(g.data,D,L,u,b);if(c.fragments.length){if(E===o.PlaylistContextType.MANIFEST){var p={attrs:new A.AttrList({}),bitrate:0,details:c,name:"",url:D};h.trigger(i.Events.MANIFEST_LOADED,{levels:[p],audioTracks:[],url:D,stats:s,networkDetails:l,sessionData:null})}if(s.parsing.end=performance.now(),c.needSidxRanges){var C,I=(C=c.fragments[0].initSegment)===null||C===void 0?void 0:C.url;this.load({url:I,isSidxRequest:!0,type:E,level:f,levelDetails:c,id:m,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null})}else d.levelDetails=c,this.handlePlaylistLoaded(g,s,d,l)}else h.trigger(i.Events.ERROR,{type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:D,reason:"no fragments found in level",level:typeof d.level=="number"?d.level:void 0})},k.handleSidxRequest=function(g,s){var d=Object(_.parseSegmentIndex)(new Uint8Array(g.data));if(d){var l=d.references,h=s.levelDetails;l.forEach(function(m,f){var E=m.info,D=h.fragments[f];D.byteRange.length===0&&D.setByteRange(String(1+E.end-E.start)+"@"+String(E.start)),D.initSegment&&D.initSegment.setByteRange(String(d.moovEndOffset)+"@0")})}},k.handleManifestParsingError=function(g,s,d,l){this.hls.trigger(i.Events.ERROR,{type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:s.type===o.PlaylistContextType.MANIFEST,url:g.url,reason:d,response:g,context:s,networkDetails:l})},k.handleNetworkError=function(g,s,d,l){d===void 0&&(d=!1),v.logger.warn("[playlist-loader]: A network "+(d?"timeout":"error")+" occurred while loading "+g.type+" level: "+g.level+" id: "+g.id+' group-id: "'+g.groupId+'"');var h=a.ErrorDetails.UNKNOWN,m=!1,f=this.getInternalLoader(g);switch(g.type){case o.PlaylistContextType.MANIFEST:h=d?a.ErrorDetails.MANIFEST_LOAD_TIMEOUT:a.ErrorDetails.MANIFEST_LOAD_ERROR,m=!0;break;case o.PlaylistContextType.LEVEL:h=d?a.ErrorDetails.LEVEL_LOAD_TIMEOUT:a.ErrorDetails.LEVEL_LOAD_ERROR,m=!1;break;case o.PlaylistContextType.AUDIO_TRACK:h=d?a.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:a.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,m=!1;break;case o.PlaylistContextType.SUBTITLE_TRACK:h=d?a.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:a.ErrorDetails.SUBTITLE_LOAD_ERROR,m=!1}f&&this.resetInternalLoader(g.type);var E={type:a.ErrorTypes.NETWORK_ERROR,details:h,fatal:m,url:g.url,loader:f,context:g,networkDetails:s};l&&(E.response=l),this.hls.trigger(i.Events.ERROR,E)},k.handlePlaylistLoaded=function(g,s,d,l){var h=d.type,m=d.level,f=d.id,E=d.groupId,D=d.loader,b=d.levelDetails,L=d.deliveryDirectives;if(b!=null&&b.targetduration){if(D)switch(b.live&&(D.getCacheAge&&(b.ageHeader=D.getCacheAge()||0),D.getCacheAge&&!isNaN(b.ageHeader)||(b.ageHeader=0)),h){case o.PlaylistContextType.MANIFEST:case o.PlaylistContextType.LEVEL:this.hls.trigger(i.Events.LEVEL_LOADED,{details:b,level:m||0,id:f||0,stats:s,networkDetails:l,deliveryDirectives:L});break;case o.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(i.Events.AUDIO_TRACK_LOADED,{details:b,id:f||0,groupId:E||"",stats:s,networkDetails:l,deliveryDirectives:L});break;case o.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(i.Events.SUBTITLE_TRACK_LOADED,{details:b,id:f||0,groupId:E||"",stats:s,networkDetails:l,deliveryDirectives:L})}}else this.handleManifestParsingError(g,d,"invalid target duration",l)},R}();t.default=y},"./src/polyfills/number.ts":function(e,t,r){r.r(t),r.d(t,"isFiniteNumber",function(){return n}),r.d(t,"MAX_SAFE_INTEGER",function(){return i});var n=Number.isFinite||function(a){return typeof a=="number"&&isFinite(a)},i=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(e,t,r){r.r(t);var n=function(){function i(){}return i.getSilentFrame=function(a,v){switch(a){case"mp4a.40.2":if(v===1)return new Uint8Array([0,200,0,128,35,128]);if(v===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(v===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(v===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(v===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(v===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(v===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(v===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(v===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},i}();t.default=n},"./src/remux/mp4-generator.ts":function(e,t,r){r.r(t);var n=Math.pow(2,32)-1,i=function(){function a(){}return a.init=function(){var v;for(v in a.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},a.types)a.types.hasOwnProperty(v)&&(a.types[v]=[v.charCodeAt(0),v.charCodeAt(1),v.charCodeAt(2),v.charCodeAt(3)]);var _=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),S=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);a.HDLR_TYPES={video:_,audio:S};var o=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),A=new Uint8Array([0,0,0,0,0,0,0,0]);a.STTS=a.STSC=a.STCO=A,a.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),a.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),a.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),a.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var T=new Uint8Array([105,115,111,109]),y=new Uint8Array([97,118,99,49]),R=new Uint8Array([0,0,0,1]);a.FTYP=a.box(a.types.ftyp,T,R,T,y),a.DINF=a.box(a.types.dinf,a.box(a.types.dref,o))},a.box=function(v){for(var _=8,S=arguments.length,o=new Array(S>1?S-1:0),A=1;A<S;A++)o[A-1]=arguments[A];for(var T=o.length,y=T;T--;)_+=o[T].byteLength;var R=new Uint8Array(_);for(R[0]=_>>24&255,R[1]=_>>16&255,R[2]=_>>8&255,R[3]=255&_,R.set(v,4),T=0,_=8;T<y;T++)R.set(o[T],_),_+=o[T].byteLength;return R},a.hdlr=function(v){return a.box(a.types.hdlr,a.HDLR_TYPES[v])},a.mdat=function(v){return a.box(a.types.mdat,v)},a.mdhd=function(v,_){_*=v;var S=Math.floor(_/(n+1)),o=Math.floor(_%(n+1));return a.box(a.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,v>>24&255,v>>16&255,v>>8&255,255&v,S>>24,S>>16&255,S>>8&255,255&S,o>>24,o>>16&255,o>>8&255,255&o,85,196,0,0]))},a.mdia=function(v){return a.box(a.types.mdia,a.mdhd(v.timescale,v.duration),a.hdlr(v.type),a.minf(v))},a.mfhd=function(v){return a.box(a.types.mfhd,new Uint8Array([0,0,0,0,v>>24,v>>16&255,v>>8&255,255&v]))},a.minf=function(v){return v.type==="audio"?a.box(a.types.minf,a.box(a.types.smhd,a.SMHD),a.DINF,a.stbl(v)):a.box(a.types.minf,a.box(a.types.vmhd,a.VMHD),a.DINF,a.stbl(v))},a.moof=function(v,_,S){return a.box(a.types.moof,a.mfhd(v),a.traf(S,_))},a.moov=function(v){for(var _=v.length,S=[];_--;)S[_]=a.trak(v[_]);return a.box.apply(null,[a.types.moov,a.mvhd(v[0].timescale,v[0].duration)].concat(S).concat(a.mvex(v)))},a.mvex=function(v){for(var _=v.length,S=[];_--;)S[_]=a.trex(v[_]);return a.box.apply(null,[a.types.mvex].concat(S))},a.mvhd=function(v,_){_*=v;var S=Math.floor(_/(n+1)),o=Math.floor(_%(n+1)),A=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,v>>24&255,v>>16&255,v>>8&255,255&v,S>>24,S>>16&255,S>>8&255,255&S,o>>24,o>>16&255,o>>8&255,255&o,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return a.box(a.types.mvhd,A)},a.sdtp=function(v){var _,S,o=v.samples||[],A=new Uint8Array(4+o.length);for(_=0;_<o.length;_++)S=o[_].flags,A[_+4]=S.dependsOn<<4|S.isDependedOn<<2|S.hasRedundancy;return a.box(a.types.sdtp,A)},a.stbl=function(v){return a.box(a.types.stbl,a.stsd(v),a.box(a.types.stts,a.STTS),a.box(a.types.stsc,a.STSC),a.box(a.types.stsz,a.STSZ),a.box(a.types.stco,a.STCO))},a.avc1=function(v){var _,S,o,A=[],T=[];for(_=0;_<v.sps.length;_++)o=(S=v.sps[_]).byteLength,A.push(o>>>8&255),A.push(255&o),A=A.concat(Array.prototype.slice.call(S));for(_=0;_<v.pps.length;_++)o=(S=v.pps[_]).byteLength,T.push(o>>>8&255),T.push(255&o),T=T.concat(Array.prototype.slice.call(S));var y=a.box(a.types.avcC,new Uint8Array([1,A[3],A[4],A[5],255,224|v.sps.length].concat(A).concat([v.pps.length]).concat(T))),R=v.width,k=v.height,g=v.pixelRatio[0],s=v.pixelRatio[1];return a.box(a.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,R>>8&255,255&R,k>>8&255,255&k,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),y,a.box(a.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),a.box(a.types.pasp,new Uint8Array([g>>24,g>>16&255,g>>8&255,255&g,s>>24,s>>16&255,s>>8&255,255&s])))},a.esds=function(v){var _=v.config.length;return new Uint8Array([0,0,0,0,3,23+_,0,1,0,4,15+_,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([_]).concat(v.config).concat([6,1,2]))},a.mp4a=function(v){var _=v.samplerate;return a.box(a.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,v.channelCount,0,16,0,0,0,0,_>>8&255,255&_,0,0]),a.box(a.types.esds,a.esds(v)))},a.mp3=function(v){var _=v.samplerate;return a.box(a.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,v.channelCount,0,16,0,0,0,0,_>>8&255,255&_,0,0]))},a.stsd=function(v){return v.type==="audio"?v.isAAC||v.codec!=="mp3"?a.box(a.types.stsd,a.STSD,a.mp4a(v)):a.box(a.types.stsd,a.STSD,a.mp3(v)):a.box(a.types.stsd,a.STSD,a.avc1(v))},a.tkhd=function(v){var _=v.id,S=v.duration*v.timescale,o=v.width,A=v.height,T=Math.floor(S/(n+1)),y=Math.floor(S%(n+1));return a.box(a.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,_>>24&255,_>>16&255,_>>8&255,255&_,0,0,0,0,T>>24,T>>16&255,T>>8&255,255&T,y>>24,y>>16&255,y>>8&255,255&y,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,o>>8&255,255&o,0,0,A>>8&255,255&A,0,0]))},a.traf=function(v,_){var S=a.sdtp(v),o=v.id,A=Math.floor(_/(n+1)),T=Math.floor(_%(n+1));return a.box(a.types.traf,a.box(a.types.tfhd,new Uint8Array([0,0,0,0,o>>24,o>>16&255,o>>8&255,255&o])),a.box(a.types.tfdt,new Uint8Array([1,0,0,0,A>>24,A>>16&255,A>>8&255,255&A,T>>24,T>>16&255,T>>8&255,255&T])),a.trun(v,S.length+16+20+8+16+8+8),S)},a.trak=function(v){return v.duration=v.duration||4294967295,a.box(a.types.trak,a.tkhd(v),a.mdia(v))},a.trex=function(v){var _=v.id;return a.box(a.types.trex,new Uint8Array([0,0,0,0,_>>24,_>>16&255,_>>8&255,255&_,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},a.trun=function(v,_){var S,o,A,T,y,R,k=v.samples||[],g=k.length,s=12+16*g,d=new Uint8Array(s);for(_+=8+s,d.set([0,0,15,1,g>>>24&255,g>>>16&255,g>>>8&255,255&g,_>>>24&255,_>>>16&255,_>>>8&255,255&_],0),S=0;S<g;S++)A=(o=k[S]).duration,T=o.size,y=o.flags,R=o.cts,d.set([A>>>24&255,A>>>16&255,A>>>8&255,255&A,T>>>24&255,T>>>16&255,T>>>8&255,255&T,y.isLeading<<2|y.dependsOn,y.isDependedOn<<6|y.hasRedundancy<<4|y.paddingValue<<1|y.isNonSync,61440&y.degradPrio,15&y.degradPrio,R>>>24&255,R>>>16&255,R>>>8&255,255&R],12+16*S);return a.box(a.types.trun,d)},a.initSegment=function(v){a.types||a.init();var _=a.moov(v),S=new Uint8Array(a.FTYP.byteLength+_.byteLength);return S.set(a.FTYP),S.set(_,a.FTYP.byteLength),S},a}();i.types=void 0,i.HDLR_TYPES=void 0,i.STTS=void 0,i.STSC=void 0,i.STCO=void 0,i.STSZ=void 0,i.VMHD=void 0,i.SMHD=void 0,i.STSD=void 0,i.FTYP=void 0,i.DINF=void 0,t.default=i},"./src/remux/mp4-remuxer.ts":function(e,t,r){r.r(t),r.d(t,"default",function(){return g}),r.d(t,"normalizePts",function(){return s});var n=r("./src/polyfills/number.ts"),i=r("./src/remux/aac-helper.ts"),a=r("./src/remux/mp4-generator.ts"),v=r("./src/events.ts"),_=r("./src/errors.ts"),S=r("./src/utils/logger.ts"),o=r("./src/types/loader.ts"),A=r("./src/utils/timescale-conversion.ts");function T(){return(T=Object.assign||function(h){for(var m=1;m<arguments.length;m++){var f=arguments[m];for(var E in f)Object.prototype.hasOwnProperty.call(f,E)&&(h[E]=f[E])}return h}).apply(this,arguments)}var y=null,R=null,k=!1,g=function(){function h(f,E,D,b){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=f,this.config=E,this.typeSupported=D,this.ISGenerated=!1,y===null){var L=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);y=L?parseInt(L[1]):0}if(R===null){var u=navigator.userAgent.match(/Safari\/(\d+)/i);R=u?parseInt(u[1]):0}k=!!y&&y<75||!!R&&R<600}var m=h.prototype;return m.destroy=function(){},m.resetTimeStamp=function(f){S.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=f},m.resetNextTimestamp=function(){S.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},m.resetInitSegment=function(){S.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},m.getVideoStartPts=function(f){var E=!1,D=f.reduce(function(b,L){var u=L.pts-b;return u<-4294967296?(E=!0,s(b,L.pts)):u>0?b:L.pts},f[0].pts);return E&&S.logger.debug("PTS rollover detected"),D},m.remux=function(f,E,D,b,L,u,c,p){var C,I,w,O,x,P,F=L,M=L,U=f.pid>-1,G=E.pid>-1,K=E.samples.length,q=f.samples.length>0,Z=K>1;if((!U||q)&&(!G||Z)||this.ISGenerated||c){this.ISGenerated||(w=this.generateIS(f,E,L));var ee=this.isVideoContiguous,se=-1;if(Z&&(se=function(N){for(var B=0;B<N.length;B++)if(N[B].key)return B;return-1}(E.samples),!ee&&this.config.forceKeyFrameOnDiscontinuity))if(P=!0,se>0){S.logger.warn("[mp4-remuxer]: Dropped "+se+" out of "+K+" video samples due to a missing keyframe");var ne=this.getVideoStartPts(E.samples);E.samples=E.samples.slice(se),E.dropped+=se,M+=(E.samples[0].pts-ne)/(E.timescale||9e4)}else se===-1&&(S.logger.warn("[mp4-remuxer]: No keyframe found out of "+K+" video samples"),P=!1);if(this.ISGenerated){if(q&&Z){var ae=this.getVideoStartPts(E.samples),me=(s(f.samples[0].pts,ae)-ae)/E.inputTimeScale;F+=Math.max(0,me),M+=Math.max(0,-me)}if(q){if(f.samplerate||(S.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),w=this.generateIS(f,E,L)),I=this.remuxAudio(f,F,this.isAudioContiguous,u,G||Z||p===o.PlaylistLevelType.AUDIO?M:void 0),Z){var Ee=I?I.endPTS-I.startPTS:0;E.inputTimeScale||(S.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),w=this.generateIS(f,E,L)),C=this.remuxVideo(E,M,ee,Ee)}}else Z&&(C=this.remuxVideo(E,M,ee,0));C&&(C.firstKeyFrame=se,C.independent=se!==-1)}}return this.ISGenerated&&(D.samples.length&&(x=this.remuxID3(D,L)),b.samples.length&&(O=this.remuxText(b,L))),{audio:I,video:C,initSegment:w,independent:P,text:O,id3:x}},m.generateIS=function(f,E,D){var b,L,u,c=f.samples,p=E.samples,C=this.typeSupported,I={},w=!Object(n.isFiniteNumber)(this._initPTS),O="audio/mp4";if(w&&(b=L=1/0),f.config&&c.length&&(f.timescale=f.samplerate,f.isAAC||(C.mpeg?(O="audio/mpeg",f.codec=""):C.mp3&&(f.codec="mp3")),I.audio={id:"audio",container:O,codec:f.codec,initSegment:!f.isAAC&&C.mpeg?new Uint8Array(0):a.default.initSegment([f]),metadata:{channelCount:f.channelCount}},w&&(u=f.inputTimeScale,b=L=c[0].pts-Math.round(u*D))),E.sps&&E.pps&&p.length&&(E.timescale=E.inputTimeScale,I.video={id:"main",container:"video/mp4",codec:E.codec,initSegment:a.default.initSegment([E]),metadata:{width:E.width,height:E.height}},w)){u=E.inputTimeScale;var x=this.getVideoStartPts(p),P=Math.round(u*D);L=Math.min(L,s(p[0].dts,x)-P),b=Math.min(b,x-P)}if(Object.keys(I).length)return this.ISGenerated=!0,w&&(this._initPTS=b,this._initDTS=L),{tracks:I,initPTS:b,timescale:u}},m.remuxVideo=function(f,E,D,b){var L,u,c,p=f.inputTimeScale,C=f.samples,I=[],w=C.length,O=this._initPTS,x=this.nextAvcDts,P=8,F=Number.POSITIVE_INFINITY,M=Number.NEGATIVE_INFINITY,U=0,G=!1;D&&x!==null||(x=E*p-(C[0].pts-s(C[0].dts,C[0].pts)));for(var K=0;K<w;K++){var q=C[K];q.pts=s(q.pts-O,x),q.dts=s(q.dts-O,x),q.dts>q.pts&&(U=Math.max(Math.min(U,q.pts-q.dts),-18e3)),q.dts<C[K>0?K-1:K].dts&&(G=!0)}G&&C.sort(function(Je,St){var Os=Je.dts-St.dts,Ps=Je.pts-St.pts;return Os||Ps}),u=C[0].dts,c=C[C.length-1].dts;var Z=Math.round((c-u)/(w-1));if(U<0){if(U<-2*Z){S.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(A.toMsFromMpegTsClock)(-Z,!0)+" ms");for(var ee=U,se=0;se<w;se++)C[se].dts=ee=Math.max(ee,C[se].pts-Z),C[se].pts=Math.max(ee,C[se].pts)}else{S.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(A.toMsFromMpegTsClock)(U,!0)+" ms to overcome this issue");for(var ne=0;ne<w;ne++)C[ne].dts=C[ne].dts+U}u=C[0].dts}if(D){var ae=u-x,me=ae>Z;if(me||ae<-1){me?S.logger.warn("AVC: "+Object(A.toMsFromMpegTsClock)(ae,!0)+" ms ("+ae+"dts) hole between fragments detected, filling it"):S.logger.warn("AVC: "+Object(A.toMsFromMpegTsClock)(-ae,!0)+" ms ("+ae+"dts) overlapping between fragments detected"),u=x;var Ee=C[0].pts-ae;C[0].dts=u,C[0].pts=Ee,S.logger.log("Video: First PTS/DTS adjusted: "+Object(A.toMsFromMpegTsClock)(Ee,!0)+"/"+Object(A.toMsFromMpegTsClock)(u,!0)+", delta: "+Object(A.toMsFromMpegTsClock)(ae,!0)+" ms")}}k&&(u=Math.max(0,u));for(var N=0,B=0,j=0;j<w;j++){for(var H=C[j],V=H.units,z=V.length,$=0,X=0;X<z;X++)$+=V[X].data.length;B+=$,N+=z,H.length=$,H.dts=Math.max(H.dts,u),H.pts=Math.max(H.pts,H.dts,0),F=Math.min(H.pts,F),M=Math.max(H.pts,M)}c=C[w-1].dts;var Q,Y=B+4*N+8;try{Q=new Uint8Array(Y)}catch{return void this.observer.emit(v.Events.ERROR,v.Events.ERROR,{type:_.ErrorTypes.MUX_ERROR,details:_.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Y,reason:"fail allocating video mdat "+Y})}var ie=new DataView(Q.buffer);ie.setUint32(0,Y),Q.set(a.default.types.mdat,4);for(var te=0;te<w;te++){for(var re=C[te],oe=re.units,le=0,he=0,ge=oe.length;he<ge;he++){var Te=oe[he],_e=Te.data,He=Te.data.byteLength;ie.setUint32(P,He),P+=4,Q.set(_e,P),P+=He,le+=4+He}if(te<w-1)L=C[te+1].dts-re.dts;else{var at=this.config,Me=re.dts-C[te>0?te-1:te].dts;if(at.stretchShortVideoTrack&&this.nextAudioPts!==null){var ct=Math.floor(at.maxBufferHole*p),Ae=(b?F+b*p:this.nextAudioPts)-re.pts;Ae>ct?((L=Ae-Me)<0&&(L=Me),S.logger.log("[mp4-remuxer]: It is approximately "+Ae/90+" ms to the next segment; using duration "+L/90+" ms for the last video frame.")):L=Me}else L=Me}var Re=Math.round(re.pts-re.dts);I.push(new d(re.key,L,le,Re))}if(I.length&&y&&y<70){var qe=I[0].flags;qe.dependsOn=2,qe.isNonSync=0}console.assert(L!==void 0,"mp4SampleDuration must be computed"),this.nextAvcDts=x=c+L,this.isVideoContiguous=!0;var bt={data1:a.default.moof(f.sequenceNumber++,u,T({},f,{samples:I})),data2:Q,startPTS:F/p,endPTS:(M+L)/p,startDTS:u/p,endDTS:x/p,type:"video",hasAudio:!1,hasVideo:!0,nb:I.length,dropped:f.dropped};return f.samples=[],f.dropped=0,console.assert(Q.length,"MDAT length must not be zero"),bt},m.remuxAudio=function(f,E,D,b,L){var u=f.inputTimeScale,c=u/(f.samplerate?f.samplerate:u),p=f.isAAC?1024:1152,C=p*c,I=this._initPTS,w=!f.isAAC&&this.typeSupported.mpeg,O=[],x=f.samples,P=w?0:8,F=this.nextAudioPts||-1,M=E*u;if(this.isAudioContiguous=D=D||x.length&&F>0&&(b&&Math.abs(M-F)<9e3||Math.abs(s(x[0].pts-I,M)-F)<20*C),x.forEach(function(_e){_e.pts=s(_e.pts-I,M)}),!D||F<0){if(!(x=x.filter(function(_e){return _e.pts>=0})).length)return;F=L===0?0:b?Math.max(0,M):x[0].pts}if(f.isAAC)for(var U=L!==void 0,G=this.config.maxAudioFramesDrift,K=0,q=F;K<x.length;K++){var Z=x[K],ee=Z.pts,se=ee-q,ne=Math.abs(1e3*se/u);if(se<=-G*C&&U)K===0&&(S.logger.warn("Audio frame @ "+(ee/u).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*se/u)+" ms."),this.nextAudioPts=F=q=ee);else if(se>=G*C&&ne<1e4&&U){var ae=Math.round(se/C);(q=ee-ae*C)<0&&(ae--,q+=C),K===0&&(this.nextAudioPts=F=q),S.logger.warn("[mp4-remuxer]: Injecting "+ae+" audio frame @ "+(q/u).toFixed(3)+"s due to "+Math.round(1e3*se/u)+" ms gap.");for(var me=0;me<ae;me++){var Ee=Math.max(q,0),N=i.default.getSilentFrame(f.manifestCodec||f.codec,f.channelCount);N||(S.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),N=Z.unit.subarray()),x.splice(K,0,{unit:N,pts:Ee}),q+=C,K++}}Z.pts=q,q+=C}for(var B,j=null,H=null,V=0,z=x.length;z--;)V+=x[z].unit.byteLength;for(var $=0,X=x.length;$<X;$++){var Q=x[$],Y=Q.unit,ie=Q.pts;if(H!==null)O[$-1].duration=Math.round((ie-H)/c);else{if(D&&f.isAAC&&(ie=F),j=ie,!(V>0))return;V+=P;try{B=new Uint8Array(V)}catch{return void this.observer.emit(v.Events.ERROR,v.Events.ERROR,{type:_.ErrorTypes.MUX_ERROR,details:_.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:V,reason:"fail allocating audio mdat "+V})}w||(new DataView(B.buffer).setUint32(0,V),B.set(a.default.types.mdat,4))}B.set(Y,P);var te=Y.byteLength;P+=te,O.push(new d(!0,p,te,0)),H=ie}var re=O.length;if(re){var oe=O[O.length-1];this.nextAudioPts=F=H+c*oe.duration;var le=w?new Uint8Array(0):a.default.moof(f.sequenceNumber++,j/c,T({},f,{samples:O}));f.samples=[];var he=j/u,ge=F/u,Te={data1:le,data2:B,startPTS:he,endPTS:ge,startDTS:he,endDTS:ge,type:"audio",hasAudio:!0,hasVideo:!1,nb:re};return this.isAudioContiguous=!0,console.assert(B.length,"MDAT length must not be zero"),Te}},m.remuxEmptyAudio=function(f,E,D,b){var L=f.inputTimeScale,u=L/(f.samplerate?f.samplerate:L),c=this.nextAudioPts,p=(c!==null?c:b.startDTS*L)+this._initDTS,C=b.endDTS*L+this._initDTS,I=1024*u,w=Math.ceil((C-p)/I),O=i.default.getSilentFrame(f.manifestCodec||f.codec,f.channelCount);if(S.logger.warn("[mp4-remuxer]: remux empty Audio"),O){for(var x=[],P=0;P<w;P++){var F=p+P*I;x.push({unit:O,pts:F,dts:F})}return f.samples=x,this.remuxAudio(f,E,D,!1)}S.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},m.remuxID3=function(f,E){var D=f.samples.length;if(D){for(var b=f.inputTimeScale,L=this._initPTS,u=this._initDTS,c=0;c<D;c++){var p=f.samples[c];p.pts=s(p.pts-L,E*b)/b,p.dts=s(p.dts-u,E*b)/b}var C=f.samples;return f.samples=[],{samples:C}}},m.remuxText=function(f,E){var D=f.samples.length;if(D){for(var b=f.inputTimeScale,L=this._initPTS,u=0;u<D;u++){var c=f.samples[u];c.pts=s(c.pts-L,E*b)/b}f.samples.sort(function(C,I){return C.pts-I.pts});var p=f.samples;return f.samples=[],{samples:p}}},h}();function s(h,m){var f;if(m===null)return h;for(f=m<h?-8589934592:8589934592;Math.abs(h-m)>4294967296;)h+=f;return h}var d=function(h,m,f,E){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=m,this.size=f,this.cts=E,this.flags=new l(h)},l=function(h){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=h?2:1,this.isNonSync=h?0:1}},"./src/remux/passthrough-remuxer.ts":function(e,t,r){r.r(t);var n=r("./src/polyfills/number.ts"),i=r("./src/utils/mp4-tools.ts"),a=r("./src/loader/fragment.ts"),v=r("./src/utils/logger.ts"),_=function(){function A(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var T=A.prototype;return T.destroy=function(){},T.resetTimeStamp=function(y){this.initPTS=y,this.lastEndDTS=null},T.resetNextTimestamp=function(){this.lastEndDTS=null},T.resetInitSegment=function(y,R,k){this.audioCodec=R,this.videoCodec=k,this.generateInitSegment(y),this.emitInitSegment=!0},T.generateInitSegment=function(y){var R=this.audioCodec,k=this.videoCodec;if(!y||!y.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var g=this.initData=Object(i.parseInitSegment)(y);R||(R=o(g.audio,a.ElementaryStreamTypes.AUDIO)),k||(k=o(g.video,a.ElementaryStreamTypes.VIDEO));var s={};g.audio&&g.video?s.audiovideo={container:"video/mp4",codec:R+","+k,initSegment:y,id:"main"}:g.audio?s.audio={container:"audio/mp4",codec:R,initSegment:y,id:"audio"}:g.video?s.video={container:"video/mp4",codec:k,initSegment:y,id:"main"}:v.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=s},T.remux=function(y,R,k,g,s){var d=this.initPTS,l=this.lastEndDTS,h={audio:void 0,video:void 0,text:g,id3:k,initSegment:void 0};Object(n.isFiniteNumber)(l)||(l=this.lastEndDTS=s||0);var m=R.samples;if(!m||!m.length)return h;var f={initPTS:void 0,timescale:1},E=this.initData;if(E&&E.length||(this.generateInitSegment(m),E=this.initData),!E||!E.length)return v.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),h;this.emitInitSegment&&(f.tracks=this.initTracks,this.emitInitSegment=!1),Object(n.isFiniteNumber)(d)||(this.initPTS=f.initPTS=d=S(E,m,l));var D=Object(i.getDuration)(m,E),b=l,L=D+b;Object(i.offsetStartDTS)(E,m,d),D>0?this.lastEndDTS=L:(v.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var u=!!E.audio,c=!!E.video,p="";u&&(p+="audio"),c&&(p+="video");var C={data1:m,startPTS:b,startDTS:b,endPTS:L,endDTS:L,type:p,hasAudio:u,hasVideo:c,nb:1,dropped:0};return h.audio=C.type==="audio"?C:void 0,h.video=C.type!=="audio"?C:void 0,h.text=g,h.id3=k,h.initSegment=f,h},A}(),S=function(A,T,y){return Object(i.getStartDTS)(A,T)-y};function o(A,T){var y=A==null?void 0:A.codec;return y&&y.length>4?y:y==="hvc1"?"hvc1.1.c.L120.90":y==="av01"?"av01.0.04M.08":y==="avc1"||T===a.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}t.default=_},"./src/task-loop.ts":function(e,t,r){r.r(t),r.d(t,"default",function(){return n});var n=function(){function i(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var a=i.prototype;return a.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},a.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},a.onHandlerDestroyed=function(){},a.hasInterval=function(){return!!this._tickInterval},a.hasNextTick=function(){return!!this._tickTimer},a.setInterval=function(v){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,v),!0)},a.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},a.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},a.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},a.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},a.doTick=function(){},i}()},"./src/types/level.ts":function(e,t,r){function n(o,A){for(var T=0;T<A.length;T++){var y=A[T];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(o,y.key,y)}}var i,a;function v(o,A){var T=o.canSkipUntil,y=o.canSkipDateRanges,R=o.endSN;return T&&(A!==void 0?A-R:0)<T?y?i.v2:i.Yes:i.No}r.r(t),r.d(t,"HlsSkip",function(){return i}),r.d(t,"getSkipValue",function(){return v}),r.d(t,"HlsUrlParameters",function(){return _}),r.d(t,"Level",function(){return S}),(a=i||(i={})).No="",a.Yes="YES",a.v2="v2";var _=function(){function o(A,T,y){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=A,this.part=T,this.skip=y}return o.prototype.addDirectives=function(A){var T=new self.URL(A);return this.msn!==void 0&&T.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&T.searchParams.set("_HLS_part",this.part.toString()),this.skip&&T.searchParams.set("_HLS_skip",this.skip),T.toString()},o}(),S=function(){function o(y){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[y.url],this.attrs=y.attrs,this.bitrate=y.bitrate,y.details&&(this.details=y.details),this.id=y.id||0,this.name=y.name,this.width=y.width||0,this.height=y.height||0,this.audioCodec=y.audioCodec,this.videoCodec=y.videoCodec,this.unknownCodecs=y.unknownCodecs,this.codecSet=[y.videoCodec,y.audioCodec].filter(function(R){return R}).join(",").replace(/\.[^.,]+/g,"")}var A,T;return A=o,(T=[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(y){var R=y%this.url.length;this._urlId!==R&&(this.details=void 0,this._urlId=R)}}])&&n(A.prototype,T),o}()},"./src/types/loader.ts":function(e,t,r){var n,i,a,v;r.r(t),r.d(t,"PlaylistContextType",function(){return n}),r.d(t,"PlaylistLevelType",function(){return a}),(i=n||(n={})).MANIFEST="manifest",i.LEVEL="level",i.AUDIO_TRACK="audioTrack",i.SUBTITLE_TRACK="subtitleTrack",(v=a||(a={})).MAIN="main",v.AUDIO="audio",v.SUBTITLE="subtitle"},"./src/types/transmuxer.ts":function(e,t,r){r.r(t),r.d(t,"ChunkMetadata",function(){return n});var n=function(i,a,v,_,S,o){_===void 0&&(_=0),S===void 0&&(S=-1),o===void 0&&(o=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=i,this.sn=a,this.id=v,this.size=_,this.part=S,this.partial=o}},"./src/utils/attr-list.ts":function(e,t,r){r.r(t),r.d(t,"AttrList",function(){return a});var n=/^(\d+)x(\d+)$/,i=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,a=function(){function v(S){for(var o in typeof S=="string"&&(S=v.parseAttrList(S)),S)S.hasOwnProperty(o)&&(this[o]=S[o])}var _=v.prototype;return _.decimalInteger=function(S){var o=parseInt(this[S],10);return o>Number.MAX_SAFE_INTEGER?1/0:o},_.hexadecimalInteger=function(S){if(this[S]){var o=(this[S]||"0x").slice(2);o=(1&o.length?"0":"")+o;for(var A=new Uint8Array(o.length/2),T=0;T<o.length/2;T++)A[T]=parseInt(o.slice(2*T,2*T+2),16);return A}return null},_.hexadecimalIntegerAsNumber=function(S){var o=parseInt(this[S],16);return o>Number.MAX_SAFE_INTEGER?1/0:o},_.decimalFloatingPoint=function(S){return parseFloat(this[S])},_.optionalFloat=function(S,o){var A=this[S];return A?parseFloat(A):o},_.enumeratedString=function(S){return this[S]},_.bool=function(S){return this[S]==="YES"},_.decimalResolution=function(S){var o=n.exec(this[S]);if(o!==null)return{width:parseInt(o[1],10),height:parseInt(o[2],10)}},v.parseAttrList=function(S){var o,A={};for(i.lastIndex=0;(o=i.exec(S))!==null;){var T=o[2];T.indexOf('"')===0&&T.lastIndexOf('"')===T.length-1&&(T=T.slice(1,-1)),A[o[1]]=T}return A},v}()},"./src/utils/binary-search.ts":function(e,t,r){r.r(t),t.default={search:function(n,i){for(var a=0,v=n.length-1,_=null,S=null;a<=v;){var o=i(S=n[_=(a+v)/2|0]);if(o>0)a=_+1;else{if(!(o<0))return S;v=_-1}}return null}}},"./src/utils/buffer-helper.ts":function(e,t,r){r.r(t),r.d(t,"BufferHelper",function(){return a});var n=r("./src/utils/logger.ts"),i={length:0,start:function(){return 0},end:function(){return 0}},a=function(){function v(){}return v.isBuffered=function(_,S){try{if(_){for(var o=v.getBuffered(_),A=0;A<o.length;A++)if(S>=o.start(A)&&S<=o.end(A))return!0}}catch{}return!1},v.bufferInfo=function(_,S,o){try{if(_){var A,T=v.getBuffered(_),y=[];for(A=0;A<T.length;A++)y.push({start:T.start(A),end:T.end(A)});return this.bufferedInfo(y,S,o)}}catch{}return{len:0,start:S,end:S,nextStart:void 0}},v.bufferedInfo=function(_,S,o){S=Math.max(0,S),_.sort(function(f,E){var D=f.start-E.start;return D||E.end-f.end});var A=[];if(o)for(var T=0;T<_.length;T++){var y=A.length;if(y){var R=A[y-1].end;_[T].start-R<o?_[T].end>R&&(A[y-1].end=_[T].end):A.push(_[T])}else A.push(_[T])}else A=_;for(var k,g=0,s=S,d=S,l=0;l<A.length;l++){var h=A[l].start,m=A[l].end;if(S+o>=h&&S<m)s=h,g=(d=m)-S;else if(S+o<h){k=h;break}}return{len:g,start:s||0,end:d||0,nextStart:k}},v.getBuffered=function(_){try{return _.buffered}catch(S){return n.logger.log("failed to get media.buffered",S),i}},v}()},"./src/utils/cea-608-parser.ts":function(e,t,r){r.r(t),r.d(t,"Row",function(){return h}),r.d(t,"CaptionScreen",function(){return m});var n,i,a=r("./src/utils/logger.ts"),v={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},_=function(L){var u=L;return v.hasOwnProperty(L)&&(u=v[L]),String.fromCharCode(u)},S=15,o=100,A={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},T={17:2,18:4,21:6,22:8,23:10,19:13,20:15},y={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},R={25:2,26:4,29:6,30:8,31:10,27:13,28:15},k=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];(i=n||(n={}))[i.ERROR=0]="ERROR",i[i.TEXT=1]="TEXT",i[i.WARNING=2]="WARNING",i[i.INFO=2]="INFO",i[i.DEBUG=3]="DEBUG",i[i.DATA=3]="DATA";var g=function(){function L(){this.time=null,this.verboseLevel=n.ERROR}return L.prototype.log=function(u,c){this.verboseLevel>=u&&a.logger.log(this.time+" ["+u+"] "+c)},L}(),s=function(L){for(var u=[],c=0;c<L.length;c++)u.push(L[c].toString(16));return u},d=function(){function L(c,p,C,I,w){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=c||"white",this.underline=p||!1,this.italics=C||!1,this.background=I||"black",this.flash=w||!1}var u=L.prototype;return u.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},u.setStyles=function(c){for(var p=["foreground","underline","italics","background","flash"],C=0;C<p.length;C++){var I=p[C];c.hasOwnProperty(I)&&(this[I]=c[I])}},u.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},u.equals=function(c){return this.foreground===c.foreground&&this.underline===c.underline&&this.italics===c.italics&&this.background===c.background&&this.flash===c.flash},u.copy=function(c){this.foreground=c.foreground,this.underline=c.underline,this.italics=c.italics,this.background=c.background,this.flash=c.flash},u.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},L}(),l=function(){function L(c,p,C,I,w,O){this.uchar=void 0,this.penState=void 0,this.uchar=c||" ",this.penState=new d(p,C,I,w,O)}var u=L.prototype;return u.reset=function(){this.uchar=" ",this.penState.reset()},u.setChar=function(c,p){this.uchar=c,this.penState.copy(p)},u.setPenState=function(c){this.penState.copy(c)},u.equals=function(c){return this.uchar===c.uchar&&this.penState.equals(c.penState)},u.copy=function(c){this.uchar=c.uchar,this.penState.copy(c.penState)},u.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},L}(),h=function(){function L(c){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var p=0;p<o;p++)this.chars.push(new l);this.logger=c,this.pos=0,this.currPenState=new d}var u=L.prototype;return u.equals=function(c){for(var p=!0,C=0;C<o;C++)if(!this.chars[C].equals(c.chars[C])){p=!1;break}return p},u.copy=function(c){for(var p=0;p<o;p++)this.chars[p].copy(c.chars[p])},u.isEmpty=function(){for(var c=!0,p=0;p<o;p++)if(!this.chars[p].isEmpty()){c=!1;break}return c},u.setCursor=function(c){this.pos!==c&&(this.pos=c),this.pos<0?(this.logger.log(n.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>o&&(this.logger.log(n.DEBUG,"Too large cursor position "+this.pos),this.pos=o)},u.moveCursor=function(c){var p=this.pos+c;if(c>1)for(var C=this.pos+1;C<p+1;C++)this.chars[C].setPenState(this.currPenState);this.setCursor(p)},u.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},u.insertChar=function(c){c>=144&&this.backSpace();var p=_(c);this.pos>=o?this.logger.log(n.ERROR,"Cannot insert "+c.toString(16)+" ("+p+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(p,this.currPenState),this.moveCursor(1))},u.clearFromPos=function(c){var p;for(p=c;p<o;p++)this.chars[p].reset()},u.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},u.clearToEndOfRow=function(){this.clearFromPos(this.pos)},u.getTextString=function(){for(var c=[],p=!0,C=0;C<o;C++){var I=this.chars[C].uchar;I!==" "&&(p=!1),c.push(I)}return p?"":c.join("")},u.setPenStyles=function(c){this.currPenState.setStyles(c),this.chars[this.pos].setPenState(this.currPenState)},L}(),m=function(){function L(c){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var p=0;p<S;p++)this.rows.push(new h(c));this.logger=c,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var u=L.prototype;return u.reset=function(){for(var c=0;c<S;c++)this.rows[c].clear();this.currRow=14},u.equals=function(c){for(var p=!0,C=0;C<S;C++)if(!this.rows[C].equals(c.rows[C])){p=!1;break}return p},u.copy=function(c){for(var p=0;p<S;p++)this.rows[p].copy(c.rows[p])},u.isEmpty=function(){for(var c=!0,p=0;p<S;p++)if(!this.rows[p].isEmpty()){c=!1;break}return c},u.backSpace=function(){this.rows[this.currRow].backSpace()},u.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},u.insertChar=function(c){this.rows[this.currRow].insertChar(c)},u.setPen=function(c){this.rows[this.currRow].setPenStyles(c)},u.moveCursor=function(c){this.rows[this.currRow].moveCursor(c)},u.setCursor=function(c){this.logger.log(n.INFO,"setCursor: "+c),this.rows[this.currRow].setCursor(c)},u.setPAC=function(c){this.logger.log(n.INFO,"pacData = "+JSON.stringify(c));var p=c.row-1;if(this.nrRollUpRows&&p<this.nrRollUpRows-1&&(p=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==p){for(var C=0;C<S;C++)this.rows[C].clear();var I=this.currRow+1-this.nrRollUpRows,w=this.lastOutputScreen;if(w){var O=w.rows[I].cueStartTime,x=this.logger.time;if(O&&x!==null&&O<x)for(var P=0;P<this.nrRollUpRows;P++)this.rows[p-this.nrRollUpRows+P+1].copy(w.rows[I+P])}}this.currRow=p;var F=this.rows[this.currRow];if(c.indent!==null){var M=c.indent,U=Math.max(M-1,0);F.setCursor(c.indent),c.color=F.chars[U].penState.foreground}var G={foreground:c.color,underline:c.underline,italics:c.italics,background:"black",flash:!1};this.setPen(G)},u.setBkgData=function(c){this.logger.log(n.INFO,"bkgData = "+JSON.stringify(c)),this.backSpace(),this.setPen(c),this.insertChar(32)},u.setRollUpRows=function(c){this.nrRollUpRows=c},u.rollUp=function(){if(this.nrRollUpRows!==null){this.logger.log(n.TEXT,this.getDisplayText());var c=this.currRow+1-this.nrRollUpRows,p=this.rows.splice(c,1)[0];p.clear(),this.rows.splice(this.currRow,0,p),this.logger.log(n.INFO,"Rolling up")}else this.logger.log(n.DEBUG,"roll_up but nrRollUpRows not set yet")},u.getDisplayText=function(c){c=c||!1;for(var p=[],C="",I=-1,w=0;w<S;w++){var O=this.rows[w].getTextString();O&&(I=w+1,c?p.push("Row "+I+": '"+O+"'"):p.push(O.trim()))}return p.length>0&&(C=c?"["+p.join(" | ")+"]":p.join(`
`)),C},u.getTextAndFormat=function(){return this.rows},L}(),f=function(){function L(c,p,C){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=c,this.outputFilter=p,this.mode=null,this.verbose=0,this.displayedMemory=new m(C),this.nonDisplayedMemory=new m(C),this.lastOutputScreen=new m(C),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=C}var u=L.prototype;return u.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},u.getHandler=function(){return this.outputFilter},u.setHandler=function(c){this.outputFilter=c},u.setPAC=function(c){this.writeScreen.setPAC(c)},u.setBkgData=function(c){this.writeScreen.setBkgData(c)},u.setMode=function(c){c!==this.mode&&(this.mode=c,this.logger.log(n.INFO,"MODE="+c),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=c)},u.insertChars=function(c){for(var p=0;p<c.length;p++)this.writeScreen.insertChar(c[p]);var C=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(n.INFO,C+": "+this.writeScreen.getDisplayText(!0)),this.mode!=="MODE_PAINT-ON"&&this.mode!=="MODE_ROLL-UP"||(this.logger.log(n.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},u.ccRCL=function(){this.logger.log(n.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},u.ccBS=function(){this.logger.log(n.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},u.ccAOF=function(){},u.ccAON=function(){},u.ccDER=function(){this.logger.log(n.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},u.ccRU=function(c){this.logger.log(n.INFO,"RU("+c+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(c)},u.ccFON=function(){this.logger.log(n.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},u.ccRDC=function(){this.logger.log(n.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},u.ccTR=function(){this.logger.log(n.INFO,"TR"),this.setMode("MODE_TEXT")},u.ccRTD=function(){this.logger.log(n.INFO,"RTD"),this.setMode("MODE_TEXT")},u.ccEDM=function(){this.logger.log(n.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},u.ccCR=function(){this.logger.log(n.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},u.ccENM=function(){this.logger.log(n.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},u.ccEOC=function(){if(this.logger.log(n.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var c=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=c,this.writeScreen=this.nonDisplayedMemory,this.logger.log(n.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},u.ccTO=function(c){this.logger.log(n.INFO,"TO("+c+") - Tab Offset"),this.writeScreen.moveCursor(c)},u.ccMIDROW=function(c){var p={flash:!1};if(p.underline=c%2==1,p.italics=c>=46,p.italics)p.foreground="white";else{var C=Math.floor(c/2)-16;p.foreground=["white","green","blue","cyan","red","yellow","magenta"][C]}this.logger.log(n.INFO,"MIDROW: "+JSON.stringify(p)),this.writeScreen.setPen(p)},u.outputDataUpdate=function(c){c===void 0&&(c=!1);var p=this.logger.time;p!==null&&this.outputFilter&&(this.cueStartTime!==null||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,p,this.lastOutputScreen),c&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:p):this.cueStartTime=p,this.lastOutputScreen.copy(this.displayedMemory))},u.cueSplitAtTime=function(c){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,c,this.displayedMemory),this.cueStartTime=c))},L}(),E=function(){function L(c,p,C){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var I=new g;this.channels=[null,new f(c,p,I),new f(c+1,C,I)],this.cmdHistory={a:null,b:null},this.logger=I}var u=L.prototype;return u.getHandler=function(c){return this.channels[c].getHandler()},u.setHandler=function(c,p){this.channels[c].setHandler(p)},u.addData=function(c,p){var C,I,w,O=!1;this.logger.time=c;for(var x=0;x<p.length;x+=2)if(I=127&p[x],w=127&p[x+1],I!==0||w!==0){if(this.logger.log(n.DATA,"["+s([p[x],p[x+1]])+"] -> ("+s([I,w])+")"),(C=this.parseCmd(I,w))||(C=this.parseMidrow(I,w)),C||(C=this.parsePAC(I,w)),C||(C=this.parseBackgroundAttributes(I,w)),!C&&(O=this.parseChars(I,w))){var P=this.currentChannel;P&&P>0?this.channels[P].insertChars(O):this.logger.log(n.WARNING,"No channel found yet. TEXT-MODE?")}C||O||this.logger.log(n.WARNING,"Couldn't parse cleaned data "+s([I,w])+" orig: "+s([p[x],p[x+1]]))}},u.parseCmd=function(c,p){var C=this.cmdHistory;if(!((c===20||c===28||c===21||c===29)&&p>=32&&p<=47||(c===23||c===31)&&p>=33&&p<=35))return!1;if(b(c,p,C))return D(null,null,C),this.logger.log(n.DEBUG,"Repeated command ("+s([c,p])+") is dropped"),!0;var I=c===20||c===21||c===23?1:2,w=this.channels[I];return c===20||c===21||c===28||c===29?p===32?w.ccRCL():p===33?w.ccBS():p===34?w.ccAOF():p===35?w.ccAON():p===36?w.ccDER():p===37?w.ccRU(2):p===38?w.ccRU(3):p===39?w.ccRU(4):p===40?w.ccFON():p===41?w.ccRDC():p===42?w.ccTR():p===43?w.ccRTD():p===44?w.ccEDM():p===45?w.ccCR():p===46?w.ccENM():p===47&&w.ccEOC():w.ccTO(p-32),D(c,p,C),this.currentChannel=I,!0},u.parseMidrow=function(c,p){var C=0;if((c===17||c===25)&&p>=32&&p<=47){if((C=c===17?1:2)!==this.currentChannel)return this.logger.log(n.ERROR,"Mismatch channel in midrow parsing"),!1;var I=this.channels[C];return!!I&&(I.ccMIDROW(p),this.logger.log(n.DEBUG,"MIDROW ("+s([c,p])+")"),!0)}return!1},u.parsePAC=function(c,p){var C,I=this.cmdHistory;if(!((c>=17&&c<=23||c>=25&&c<=31)&&p>=64&&p<=127||(c===16||c===24)&&p>=64&&p<=95))return!1;if(b(c,p,I))return D(null,null,I),!0;var w=c<=23?1:2;C=p>=64&&p<=95?w===1?A[c]:y[c]:w===1?T[c]:R[c];var O=this.channels[w];return!!O&&(O.setPAC(this.interpretPAC(C,p)),D(c,p,I),this.currentChannel=w,!0)},u.interpretPAC=function(c,p){var C,I={color:null,italics:!1,indent:null,underline:!1,row:c};return C=p>95?p-96:p-64,I.underline=(1&C)==1,C<=13?I.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(C/2)]:C<=15?(I.italics=!0,I.color="white"):I.indent=4*Math.floor((C-16)/2),I},u.parseChars=function(c,p){var C,I,w=null,O=null;if(c>=25?(C=2,O=c-8):(C=1,O=c),O>=17&&O<=19?(I=O===17?p+80:O===18?p+112:p+144,this.logger.log(n.INFO,"Special char '"+_(I)+"' in channel "+C),w=[I]):c>=32&&c<=127&&(w=p===0?[c]:[c,p]),w){var x=s(w);this.logger.log(n.DEBUG,"Char codes =  "+x.join(",")),D(c,p,this.cmdHistory)}return w},u.parseBackgroundAttributes=function(c,p){var C;if(!((c===16||c===24)&&p>=32&&p<=47||(c===23||c===31)&&p>=45&&p<=47))return!1;var I={};c===16||c===24?(C=Math.floor((p-32)/2),I.background=k[C],p%2==1&&(I.background=I.background+"_semi")):p===45?I.background="transparent":(I.foreground="black",p===47&&(I.underline=!0));var w=c<=23?1:2;return this.channels[w].setBkgData(I),D(c,p,this.cmdHistory),!0},u.reset=function(){for(var c=0;c<Object.keys(this.channels).length;c++){var p=this.channels[c];p&&p.reset()}this.cmdHistory={a:null,b:null}},u.cueSplitAtTime=function(c){for(var p=0;p<this.channels.length;p++){var C=this.channels[p];C&&C.cueSplitAtTime(c)}},L}();function D(L,u,c){c.a=L,c.b=u}function b(L,u,c){return c.a===L&&c.b===u}t.default=E},"./src/utils/codecs.ts":function(e,t,r){r.r(t),r.d(t,"isCodecType",function(){return i}),r.d(t,"isCodecSupportedInMp4",function(){return a});var n={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function i(v,_){var S=n[_];return!!S&&S[v.slice(0,4)]===!0}function a(v,_){return MediaSource.isTypeSupported((_||"video")+'/mp4;codecs="'+v+'"')}},"./src/utils/cues.ts":function(e,t,r){r.r(t);var n=r("./src/utils/vttparser.ts"),i=r("./src/utils/webvtt-parser.ts"),a=r("./src/utils/texttrack-utils.ts"),v=/\s/,_={newCue:function(S,o,A,T){for(var y,R,k,g,s,d=[],l=self.VTTCue||self.TextTrackCue,h=0;h<T.rows.length;h++)if(k=!0,g=0,s="",!(y=T.rows[h]).isEmpty()){for(var m=0;m<y.chars.length;m++)v.test(y.chars[m].uchar)&&k?g++:(s+=y.chars[m].uchar,k=!1);y.cueStartTime=o,o===A&&(A+=1e-4),g>=16?g--:g++;var f=Object(n.fixLineBreaks)(s.trim()),E=Object(i.generateCueId)(o,A,f);S&&S.cues&&S.cues.getCueById(E)||((R=new l(o,A,f)).id=E,R.line=h+1,R.align="left",R.position=10+Math.min(80,10*Math.floor(8*g/32)),d.push(R))}return S&&d.length&&(d.sort(function(D,b){return D.line==="auto"||b.line==="auto"?0:D.line>8&&b.line>8?b.line-D.line:D.line-b.line}),d.forEach(function(D){return Object(a.addCueToTrack)(S,D)})),d}};t.default=_},"./src/utils/discontinuities.ts":function(e,t,r){r.r(t),r.d(t,"findFirstFragWithCC",function(){return v}),r.d(t,"shouldAlignOnDiscontinuities",function(){return _}),r.d(t,"findDiscontinuousReferenceFrag",function(){return S}),r.d(t,"adjustSlidingStart",function(){return A}),r.d(t,"alignStream",function(){return T}),r.d(t,"alignPDT",function(){return y});var n=r("./src/polyfills/number.ts"),i=r("./src/utils/logger.ts"),a=r("./src/controller/level-helper.ts");function v(R,k){for(var g=null,s=0,d=R.length;s<d;s++){var l=R[s];if(l&&l.cc===k){g=l;break}}return g}function _(R,k,g){return!(!k.details||!(g.endCC>g.startCC||R&&R.cc<g.startCC))}function S(R,k){var g=R.fragments,s=k.fragments;if(s.length&&g.length){var d=v(g,s[0].cc);if(d&&(!d||d.startPTS))return d;i.logger.log("No frag in previous level to align on")}else i.logger.log("No fragments to align")}function o(R,k){if(R){var g=R.start+k;R.start=R.startPTS=g,R.endPTS=g+R.duration}}function A(R,k){for(var g=k.fragments,s=0,d=g.length;s<d;s++)o(g[s],R);k.fragmentHint&&o(k.fragmentHint,R),k.alignedSliding=!0}function T(R,k,g){k&&(function(s,d,l){if(_(s,l,d)){var h=S(l.details,d);h&&Object(n.isFiniteNumber)(h.start)&&(i.logger.log("Adjusting PTS using last level due to CC increase within current level "+d.url),A(h.start,d))}}(R,g,k),!g.alignedSliding&&k.details&&y(g,k.details),g.alignedSliding||!k.details||g.skippedSegments||Object(a.adjustSliding)(k.details,g))}function y(R,k){if(k.fragments.length&&R.hasProgramDateTime&&k.hasProgramDateTime){var g=k.fragments[0].programDateTime,s=R.fragments[0].programDateTime,d=(s-g)/1e3+k.fragments[0].start;d&&Object(n.isFiniteNumber)(d)&&(i.logger.log("Adjusting PTS using programDateTime delta "+(s-g)+"ms, sliding:"+d.toFixed(3)+" "+R.url+" "),A(d,R))}}},"./src/utils/ewma-bandwidth-estimator.ts":function(e,t,r){r.r(t);var n=r("./src/utils/ewma.ts"),i=function(){function a(_,S,o){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=o,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new n.default(_),this.fast_=new n.default(S)}var v=a.prototype;return v.update=function(_,S){var o=this.slow_,A=this.fast_;this.slow_.halfLife!==_&&(this.slow_=new n.default(_,o.getEstimate(),o.getTotalWeight())),this.fast_.halfLife!==S&&(this.fast_=new n.default(S,A.getEstimate(),A.getTotalWeight()))},v.sample=function(_,S){var o=(_=Math.max(_,this.minDelayMs_))/1e3,A=8*S/o;this.fast_.sample(o,A),this.slow_.sample(o,A)},v.canEstimate=function(){var _=this.fast_;return _&&_.getTotalWeight()>=this.minWeight_},v.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},v.destroy=function(){},a}();t.default=i},"./src/utils/ewma.ts":function(e,t,r){r.r(t);var n=function(){function i(v,_,S){_===void 0&&(_=0),S===void 0&&(S=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=v,this.alpha_=v?Math.exp(Math.log(.5)/v):0,this.estimate_=_,this.totalWeight_=S}var a=i.prototype;return a.sample=function(v,_){var S=Math.pow(this.alpha_,v);this.estimate_=_*(1-S)+S*this.estimate_,this.totalWeight_+=v},a.getTotalWeight=function(){return this.totalWeight_},a.getEstimate=function(){if(this.alpha_){var v=1-Math.pow(this.alpha_,this.totalWeight_);if(v)return this.estimate_/v}return this.estimate_},i}();t.default=n},"./src/utils/fetch-loader.ts":function(e,t,r){r.r(t),r.d(t,"fetchSupported",function(){return T});var n=r("./src/polyfills/number.ts"),i=r("./src/loader/load-stats.ts"),a=r("./src/demux/chunk-cache.ts");function v(g){var s=typeof Map=="function"?new Map:void 0;return(v=function(d){if(d===null||(l=d,Function.toString.call(l).indexOf("[native code]")===-1))return d;var l;if(typeof d!="function")throw new TypeError("Super expression must either be null or a function");if(s!==void 0){if(s.has(d))return s.get(d);s.set(d,h)}function h(){return _(d,arguments,A(this).constructor)}return h.prototype=Object.create(d.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),o(h,d)})(g)}function _(g,s,d){return(_=S()?Reflect.construct:function(l,h,m){var f=[null];f.push.apply(f,h);var E=new(Function.bind.apply(l,f));return m&&o(E,m.prototype),E}).apply(null,arguments)}function S(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function o(g,s){return(o=Object.setPrototypeOf||function(d,l){return d.__proto__=l,d})(g,s)}function A(g){return(A=Object.setPrototypeOf?Object.getPrototypeOf:function(s){return s.__proto__||Object.getPrototypeOf(s)})(g)}function T(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var y=function(){function g(d){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=d.fetchSetup||R,this.controller=new self.AbortController,this.stats=new i.LoadStats}var s=g.prototype;return s.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},s.abortInternal=function(){var d=this.response;d&&d.ok||(this.stats.aborted=!0,this.controller.abort())},s.abort=function(){var d;this.abortInternal(),(d=this.callbacks)!==null&&d!==void 0&&d.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},s.load=function(d,l,h){var m=this,f=this.stats;if(f.loading.start)throw new Error("Loader can only be used once.");f.loading.start=self.performance.now();var E=function(u,c){var p={method:"GET",mode:"cors",credentials:"same-origin",signal:c};return u.rangeEnd&&(p.headers=new self.Headers({Range:"bytes="+u.rangeStart+"-"+String(u.rangeEnd-1)})),p}(d,this.controller.signal),D=h.onProgress,b=d.responseType==="arraybuffer",L=b?"byteLength":"length";this.context=d,this.config=l,this.callbacks=h,this.request=this.fetchSetup(d,E),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){m.abortInternal(),h.onTimeout(f,d,m.response)},l.timeout),self.fetch(this.request).then(function(u){if(m.response=m.loader=u,!u.ok){var c=u.status,p=u.statusText;throw new k(p||"fetch, bad network response",c,u)}return f.loading.first=Math.max(self.performance.now(),f.loading.start),f.total=parseInt(u.headers.get("Content-Length")||"0"),D&&Object(n.isFiniteNumber)(l.highWaterMark)?m.loadProgressively(u,f,d,l.highWaterMark,D):b?u.arrayBuffer():u.text()}).then(function(u){var c=m.response;self.clearTimeout(m.requestTimeout),f.loading.end=Math.max(self.performance.now(),f.loading.first),f.loaded=f.total=u[L];var p={url:c.url,data:u};D&&!Object(n.isFiniteNumber)(l.highWaterMark)&&D(f,d,u,c),h.onSuccess(p,f,d,c)}).catch(function(u){if(self.clearTimeout(m.requestTimeout),!f.aborted){var c=u.code||0;h.onError({code:c,text:u.message},d,u.details)}})},s.getCacheAge=function(){var d=null;if(this.response){var l=this.response.headers.get("age");d=l?parseFloat(l):null}return d},s.loadProgressively=function(d,l,h,m,f){m===void 0&&(m=0);var E=new a.default,D=d.body.getReader();return function b(){return D.read().then(function(L){if(L.done)return E.dataLength&&f(l,h,E.flush(),d),Promise.resolve(new ArrayBuffer(0));var u=L.value,c=u.length;return l.loaded+=c,c<m||E.dataLength?(E.push(u),E.dataLength>=m&&f(l,h,E.flush(),d)):f(l,h,u,d),b()}).catch(function(){return Promise.reject()})}()},g}();function R(g,s){return new self.Request(g.url,s)}var k=function(g){var s,d;function l(h,m,f){var E;return(E=g.call(this,h)||this).code=void 0,E.details=void 0,E.code=m,E.details=f,E}return d=g,(s=l).prototype=Object.create(d.prototype),s.prototype.constructor=s,o(s,d),l}(v(Error));t.default=y},"./src/utils/imsc1-ttml-parser.ts":function(e,t,r){r.r(t),r.d(t,"IMSC1_CODEC",function(){return A}),r.d(t,"parseIMSC1",function(){return k});var n=r("./src/utils/mp4-tools.ts"),i=r("./src/utils/vttparser.ts"),a=r("./src/utils/vttcue.ts"),v=r("./src/demux/id3.ts"),_=r("./src/utils/timescale-conversion.ts"),S=r("./src/utils/webvtt-parser.ts");function o(){return(o=Object.assign||function(f){for(var E=1;E<arguments.length;E++){var D=arguments[E];for(var b in D)Object.prototype.hasOwnProperty.call(D,b)&&(f[b]=D[b])}return f}).apply(this,arguments)}var A="stpp.ttml.im1t",T=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,y=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,R={left:"start",center:"center",right:"end",start:"start",end:"end"};function k(f,E,D,b,L){var u=Object(n.findBox)(new Uint8Array(f),["mdat"]);if(u.length!==0){var c=u[0],p=Object(v.utf8ArrayToStr)(new Uint8Array(f,c.start,c.end-c.start)),C=Object(_.toTimescaleFromScale)(E,1,D);try{b(function(I,w){var O=new DOMParser().parseFromString(I,"text/xml").getElementsByTagName("tt")[0];if(!O)throw new Error("Invalid ttml");var x={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},P=Object.keys(x).reduce(function(K,q){return K[q]=O.getAttribute("ttp:"+q)||x[q],K},{}),F=O.getAttribute("xml:space")!=="preserve",M=s(g(O,"styling","style")),U=s(g(O,"layout","region")),G=g(O,"body","[begin]");return[].map.call(G,function(K){var q=d(K,F);if(!q||!K.hasAttribute("begin"))return null;var Z=m(K.getAttribute("begin"),P),ee=m(K.getAttribute("dur"),P),se=m(K.getAttribute("end"),P);if(Z===null)throw h(K);if(se===null){if(ee===null)throw h(K);se=Z+ee}var ne=new a.default(Z-w,se-w,q);ne.id=Object(S.generateCueId)(ne.startTime,ne.endTime,ne.text);var ae=U[K.getAttribute("region")],me=M[K.getAttribute("style")];ne.position=10,ne.size=80;var Ee=function(j,H){var V="http://www.w3.org/ns/ttml#styling";return["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce(function(z,$){var X=l(H,V,$)||l(j,V,$);return X&&(z[$]=X),z},{})}(ae,me),N=Ee.textAlign;if(N){var B=R[N];B&&(ne.lineAlign=B),ne.align=N}return o(ne,Ee),ne}).filter(function(K){return K!==null})}(p,C))}catch(I){L(I)}}else L(new Error("Could not parse IMSC1 mdat"))}function g(f,E,D){var b=f.getElementsByTagName(E)[0];return b?[].slice.call(b.querySelectorAll(D)):[]}function s(f){return f.reduce(function(E,D){var b=D.getAttribute("xml:id");return b&&(E[b]=D),E},{})}function d(f,E){return[].slice.call(f.childNodes).reduce(function(D,b,L){var u;return b.nodeName==="br"&&L?D+`
`:(u=b.childNodes)!==null&&u!==void 0&&u.length?d(b,E):E?D+b.textContent.trim().replace(/\s+/g," "):D+b.textContent},"")}function l(f,E,D){return f.hasAttributeNS(E,D)?f.getAttributeNS(E,D):null}function h(f){return new Error("Could not parse ttml timestamp "+f)}function m(f,E){if(!f)return null;var D=Object(i.parseTimeStamp)(f);return D===null&&(T.test(f)?D=function(b,L){var u=T.exec(b),c=(0|u[4])+(0|u[5])/L.subFrameRate;return 3600*(0|u[1])+60*(0|u[2])+(0|u[3])+c/L.frameRate}(f,E):y.test(f)&&(D=function(b,L){var u=y.exec(b),c=Number(u[1]);switch(u[2]){case"h":return 3600*c;case"m":return 60*c;case"ms":return 1e3*c;case"f":return c/L.frameRate;case"t":return c/L.tickRate}return c}(f,E))),D}},"./src/utils/logger.ts":function(e,t,r){r.r(t),r.d(t,"enableLogs",function(){return _}),r.d(t,"logger",function(){return S});var n=function(){},i={trace:n,debug:n,log:n,warn:n,info:n,error:n},a=i;function v(o){var A=self.console[o];return A?A.bind(self.console,"["+o+"] >"):n}function _(o){if(self.console&&o===!0||typeof o=="object"){(function(A){for(var T=arguments.length,y=new Array(T>1?T-1:0),R=1;R<T;R++)y[R-1]=arguments[R];y.forEach(function(k){a[k]=A[k]?A[k].bind(A):v(k)})})(o,"debug","log","info","warn","error");try{a.log()}catch{a=i}}else a=i}var S=i},"./src/utils/mediakeys-helper.ts":function(e,t,r){var n,i;r.r(t),r.d(t,"KeySystems",function(){return n}),r.d(t,"requestMediaKeySystemAccess",function(){return a}),(i=n||(n={})).WIDEVINE="com.widevine.alpha",i.PLAYREADY="com.microsoft.playready";var a=typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null},"./src/utils/mediasource-helper.ts":function(e,t,r){function n(){return self.MediaSource||self.WebKitMediaSource}r.r(t),r.d(t,"getMediaSource",function(){return n})},"./src/utils/mp4-tools.ts":function(e,t,r){r.r(t),r.d(t,"bin2str",function(){return _}),r.d(t,"readUint16",function(){return S}),r.d(t,"readUint32",function(){return o}),r.d(t,"writeUint32",function(){return A}),r.d(t,"findBox",function(){return T}),r.d(t,"parseSegmentIndex",function(){return y}),r.d(t,"parseInitSegment",function(){return R}),r.d(t,"getStartDTS",function(){return k}),r.d(t,"getDuration",function(){return g}),r.d(t,"computeRawDurationFromSamples",function(){return s}),r.d(t,"offsetStartDTS",function(){return d}),r.d(t,"segmentValidRange",function(){return l}),r.d(t,"appendUint8Array",function(){return h});var n=r("./src/utils/typed-array.ts"),i=r("./src/loader/fragment.ts"),a=Math.pow(2,32)-1,v=[].push;function _(m){return String.fromCharCode.apply(null,m)}function S(m,f){"data"in m&&(f+=m.start,m=m.data);var E=m[f]<<8|m[f+1];return E<0?65536+E:E}function o(m,f){"data"in m&&(f+=m.start,m=m.data);var E=m[f]<<24|m[f+1]<<16|m[f+2]<<8|m[f+3];return E<0?4294967296+E:E}function A(m,f,E){"data"in m&&(f+=m.start,m=m.data),m[f]=E>>24,m[f+1]=E>>16&255,m[f+2]=E>>8&255,m[f+3]=255&E}function T(m,f){var E,D,b,L=[];if(!f.length)return L;"data"in m?(E=m.data,D=m.start,b=m.end):(D=0,b=(E=m).byteLength);for(var u=D;u<b;){var c=o(E,u),p=c>1?u+c:b;if(_(E.subarray(u+4,u+8))===f[0])if(f.length===1)L.push({data:E,start:u+8,end:p});else{var C=T({data:E,start:u+8,end:p},f.slice(1));C.length&&v.apply(L,C)}u=p}return L}function y(m){var f=T(m,["moov"])[0],E=f?f.end:null,D=T(m,["sidx"]);if(!D||!D[0])return null;var b=[],L=D[0],u=L.data[0],c=u===0?8:16,p=o(L,c);c+=4,c+=u===0?8:16,c+=2;var C=L.end+0,I=S(L,c);c+=2;for(var w=0;w<I;w++){var O=c,x=o(L,O);O+=4;var P=2147483647&x;if((2147483648&x)>>>31==1)return console.warn("SIDX has hierarchical references (not supported)"),null;var F=o(L,O);O+=4,b.push({referenceSize:P,subsegmentDuration:F,info:{duration:F/p,start:C,end:C+P-1}}),C+=P,c=O+=4}return{earliestPresentationTime:0,timescale:p,version:u,referencesCount:I,references:b,moovEndOffset:E}}function R(m){for(var f=[],E=T(m,["moov","trak"]),D=0;D<E.length;D++){var b=E[D],L=T(b,["tkhd"])[0];if(L){var u=L.data[L.start],c=u===0?12:20,p=o(L,c),C=T(b,["mdia","mdhd"])[0];if(C){var I=o(C,c=(u=C.data[C.start])===0?12:20),w=T(b,["mdia","hdlr"])[0];if(w){var O=_(w.data.subarray(w.start+8,w.start+12)),x={soun:i.ElementaryStreamTypes.AUDIO,vide:i.ElementaryStreamTypes.VIDEO}[O];if(x){var P=T(b,["mdia","minf","stbl","stsd"])[0],F=void 0;P&&(F=_(P.data.subarray(P.start+12,P.start+16))),f[p]={timescale:I,type:x},f[x]={timescale:I,id:p,codec:F}}}}}}return T(m,["moov","mvex","trex"]).forEach(function(M){var U=o(M,4),G=f[U];G&&(G.default={duration:o(M,12),flags:o(M,20)})}),f}function k(m,f){return T(f,["moof","traf"]).reduce(function(E,D){var b=T(D,["tfdt"])[0],L=b.data[b.start],u=T(D,["tfhd"]).reduce(function(c,p){var C=o(p,4),I=m[C];if(I){var w=o(b,4);L===1&&(w*=Math.pow(2,32),w+=o(b,8));var O=w/(I.timescale||9e4);if(isFinite(O)&&(c===null||O<c))return O}return c},null);return u!==null&&isFinite(u)&&(E===null||u<E)?u:E},null)||0}function g(m,f){for(var E=0,D=0,b=0,L=T(m,["moof","traf"]),u=0;u<L.length;u++){var c=L[u],p=T(c,["tfhd"])[0],C=f[o(p,4)];if(C){var I=C.default,w=o(p,0)|(I==null?void 0:I.flags),O=I==null?void 0:I.duration;8&w&&(O=o(p,2&w?12:8));for(var x=C.timescale||9e4,P=T(c,["trun"]),F=0;F<P.length;F++)E=O?O*o(P[F],4):s(P[F]),C.type===i.ElementaryStreamTypes.VIDEO?D+=E/x:C.type===i.ElementaryStreamTypes.AUDIO&&(b+=E/x)}}if(D===0&&b===0){var M=y(m);if(M!=null&&M.references)return M.references.reduce(function(U,G){return U+G.info.duration||0},0)}return D||b}function s(m){var f=o(m,0),E=8;1&f&&(E+=4),4&f&&(E+=4);for(var D=0,b=o(m,4),L=0;L<b;L++)256&f&&(D+=o(m,E),E+=4),512&f&&(E+=4),1024&f&&(E+=4),2048&f&&(E+=4);return D}function d(m,f,E){T(f,["moof","traf"]).forEach(function(D){T(D,["tfhd"]).forEach(function(b){var L=o(b,4),u=m[L];if(u){var c=u.timescale||9e4;T(D,["tfdt"]).forEach(function(p){var C=p.data[p.start],I=o(p,4);if(C===0)A(p,4,I-E*c);else{I*=Math.pow(2,32),I+=o(p,8),I-=E*c,I=Math.max(I,0);var w=Math.floor(I/(a+1)),O=Math.floor(I%(a+1));A(p,4,w),A(p,8,O)}})}})})}function l(m){var f={valid:null,remainder:null},E=T(m,["moof"]);if(!E)return f;if(E.length<2)return f.remainder=m,f;var D=E[E.length-1];return f.valid=Object(n.sliceUint8)(m,0,D.start-8),f.remainder=Object(n.sliceUint8)(m,D.start-8),f}function h(m,f){var E=new Uint8Array(m.length+f.length);return E.set(m),E.set(f,m.length),E}},"./src/utils/output-filter.ts":function(e,t,r){r.r(t),r.d(t,"default",function(){return n});var n=function(){function i(v,_){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=v,this.trackName=_}var a=i.prototype;return a.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},a.newCue=function(v,_,S){(this.startTime===null||this.startTime>v)&&(this.startTime=v),this.endTime=_,this.screen=S,this.timelineController.createCaptionsTrack(this.trackName)},a.reset=function(){this.cueRanges=[]},i}()},"./src/utils/texttrack-utils.ts":function(e,t,r){r.r(t),r.d(t,"sendAddTrackEvent",function(){return i}),r.d(t,"addCueToTrack",function(){return a}),r.d(t,"clearCurrentCues",function(){return v}),r.d(t,"removeCuesInRange",function(){return _}),r.d(t,"getCuesInRange",function(){return S});var n=r("./src/utils/logger.ts");function i(o,A){var T;try{T=new Event("addtrack")}catch{(T=document.createEvent("Event")).initEvent("addtrack",!1,!1)}T.track=o,A.dispatchEvent(T)}function a(o,A){var T=o.mode;if(T==="disabled"&&(o.mode="hidden"),o.cues&&!o.cues.getCueById(A.id))try{if(o.addCue(A),!o.cues.getCueById(A.id))throw new Error("addCue is failed for: "+A)}catch(R){n.logger.debug("[texttrack-utils]: "+R);var y=new self.TextTrackCue(A.startTime,A.endTime,A.text);y.id=A.id,o.addCue(y)}T==="disabled"&&(o.mode=T)}function v(o){var A=o.mode;if(A==="disabled"&&(o.mode="hidden"),o.cues)for(var T=o.cues.length;T--;)o.removeCue(o.cues[T]);A==="disabled"&&(o.mode=A)}function _(o,A,T){var y=o.mode;if(y==="disabled"&&(o.mode="hidden"),o.cues&&o.cues.length>0)for(var R=S(o.cues,A,T),k=0;k<R.length;k++)o.removeCue(R[k]);y==="disabled"&&(o.mode=y)}function S(o,A,T){var y=[],R=function(d,l){if(l<d[0].startTime)return 0;var h=d.length-1;if(l>d[h].endTime)return-1;for(var m=0,f=h;m<=f;){var E=Math.floor((f+m)/2);if(l<d[E].startTime)f=E-1;else{if(!(l>d[E].startTime&&m<h))return E;m=E+1}}return d[m].startTime-l<l-d[f].startTime?m:f}(o,A);if(R>-1)for(var k=R,g=o.length;k<g;k++){var s=o[k];if(s.startTime>=A&&s.endTime<=T)y.push(s);else if(s.startTime>T)return y}return y}},"./src/utils/time-ranges.ts":function(e,t,r){r.r(t),t.default={toString:function(n){for(var i="",a=n.length,v=0;v<a;v++)i+="["+n.start(v).toFixed(3)+","+n.end(v).toFixed(3)+"]";return i}}},"./src/utils/timescale-conversion.ts":function(e,t,r){function n(_,S,o,A){o===void 0&&(o=1),A===void 0&&(A=!1);var T=_*S*o;return A?Math.round(T):T}function i(_,S,o,A){return o===void 0&&(o=1),A===void 0&&(A=!1),n(_,S,1/o,A)}function a(_,S){return S===void 0&&(S=!1),n(_,1e3,1/9e4,S)}function v(_,S){return S===void 0&&(S=1),n(_,9e4,1/S)}r.r(t),r.d(t,"toTimescaleFromBase",function(){return n}),r.d(t,"toTimescaleFromScale",function(){return i}),r.d(t,"toMsFromMpegTsClock",function(){return a}),r.d(t,"toMpegTsClockFromTimescale",function(){return v})},"./src/utils/typed-array.ts":function(e,t,r){function n(i,a,v){return Uint8Array.prototype.slice?i.slice(a,v):new Uint8Array(Array.prototype.slice.call(i,a,v))}r.r(t),r.d(t,"sliceUint8",function(){return n})},"./src/utils/vttcue.ts":function(e,t,r){r.r(t),t.default=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;var n=["","lr","rl"],i=["start","middle","end","left","right"];function a(o,A){if(typeof A!="string"||!Array.isArray(o))return!1;var T=A.toLowerCase();return!!~o.indexOf(T)&&T}function v(o){return a(i,o)}function _(o){for(var A=arguments.length,T=new Array(A>1?A-1:0),y=1;y<A;y++)T[y-1]=arguments[y];for(var R=1;R<arguments.length;R++){var k=arguments[R];for(var g in k)o[g]=k[g]}return o}function S(o,A,T){var y=this,R={enumerable:!0};y.hasBeenReset=!1;var k="",g=!1,s=o,d=A,l=T,h=null,m="",f=!0,E="auto",D="start",b=50,L="middle",u=50,c="middle";Object.defineProperty(y,"id",_({},R,{get:function(){return k},set:function(p){k=""+p}})),Object.defineProperty(y,"pauseOnExit",_({},R,{get:function(){return g},set:function(p){g=!!p}})),Object.defineProperty(y,"startTime",_({},R,{get:function(){return s},set:function(p){if(typeof p!="number")throw new TypeError("Start time must be set to a number.");s=p,this.hasBeenReset=!0}})),Object.defineProperty(y,"endTime",_({},R,{get:function(){return d},set:function(p){if(typeof p!="number")throw new TypeError("End time must be set to a number.");d=p,this.hasBeenReset=!0}})),Object.defineProperty(y,"text",_({},R,{get:function(){return l},set:function(p){l=""+p,this.hasBeenReset=!0}})),Object.defineProperty(y,"region",_({},R,{get:function(){return h},set:function(p){h=p,this.hasBeenReset=!0}})),Object.defineProperty(y,"vertical",_({},R,{get:function(){return m},set:function(p){var C=function(I){return a(n,I)}(p);if(C===!1)throw new SyntaxError("An invalid or illegal string was specified.");m=C,this.hasBeenReset=!0}})),Object.defineProperty(y,"snapToLines",_({},R,{get:function(){return f},set:function(p){f=!!p,this.hasBeenReset=!0}})),Object.defineProperty(y,"line",_({},R,{get:function(){return E},set:function(p){if(typeof p!="number"&&p!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");E=p,this.hasBeenReset=!0}})),Object.defineProperty(y,"lineAlign",_({},R,{get:function(){return D},set:function(p){var C=v(p);if(!C)throw new SyntaxError("An invalid or illegal string was specified.");D=C,this.hasBeenReset=!0}})),Object.defineProperty(y,"position",_({},R,{get:function(){return b},set:function(p){if(p<0||p>100)throw new Error("Position must be between 0 and 100.");b=p,this.hasBeenReset=!0}})),Object.defineProperty(y,"positionAlign",_({},R,{get:function(){return L},set:function(p){var C=v(p);if(!C)throw new SyntaxError("An invalid or illegal string was specified.");L=C,this.hasBeenReset=!0}})),Object.defineProperty(y,"size",_({},R,{get:function(){return u},set:function(p){if(p<0||p>100)throw new Error("Size must be between 0 and 100.");u=p,this.hasBeenReset=!0}})),Object.defineProperty(y,"align",_({},R,{get:function(){return c},set:function(p){var C=v(p);if(!C)throw new SyntaxError("An invalid or illegal string was specified.");c=C,this.hasBeenReset=!0}})),y.displayState=void 0}return S.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},S}()},"./src/utils/vttparser.ts":function(e,t,r){r.r(t),r.d(t,"parseTimeStamp",function(){return a}),r.d(t,"fixLineBreaks",function(){return T}),r.d(t,"VTTParser",function(){return y});var n=r("./src/utils/vttcue.ts"),i=function(){function R(){}return R.prototype.decode=function(k,g){if(!k)return"";if(typeof k!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(k))},R}();function a(R){function k(s,d,l,h){return 3600*(0|s)+60*(0|d)+(0|l)+parseFloat(h||0)}var g=R.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return g?parseFloat(g[2])>59?k(g[2],g[3],0,g[4]):k(g[1],g[2],g[3],g[4]):null}var v=function(){function R(){this.values=Object.create(null)}var k=R.prototype;return k.set=function(g,s){this.get(g)||s===""||(this.values[g]=s)},k.get=function(g,s,d){return d?this.has(g)?this.values[g]:s[d]:this.has(g)?this.values[g]:s},k.has=function(g){return g in this.values},k.alt=function(g,s,d){for(var l=0;l<d.length;++l)if(s===d[l]){this.set(g,s);break}},k.integer=function(g,s){/^-?\d+$/.test(s)&&this.set(g,parseInt(s,10))},k.percent=function(g,s){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(s)){var d=parseFloat(s);if(d>=0&&d<=100)return this.set(g,d),!0}return!1},R}();function _(R,k,g,s){var d=s?R.split(s):[R];for(var l in d)if(typeof d[l]=="string"){var h=d[l].split(g);h.length===2&&k(h[0],h[1])}}var S=new n.default(0,0,""),o=S.align==="middle"?"middle":"center";function A(R,k,g){var s=R;function d(){var h=a(R);if(h===null)throw new Error("Malformed timestamp: "+s);return R=R.replace(/^[^\sa-zA-Z-]+/,""),h}function l(){R=R.replace(/^\s+/,"")}if(l(),k.startTime=d(),l(),R.substr(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+s);R=R.substr(3),l(),k.endTime=d(),l(),function(h,m){var f=new v;_(h,function(b,L){var u;switch(b){case"region":for(var c=g.length-1;c>=0;c--)if(g[c].id===L){f.set(b,g[c].region);break}break;case"vertical":f.alt(b,L,["rl","lr"]);break;case"line":u=L.split(","),f.integer(b,u[0]),f.percent(b,u[0])&&f.set("snapToLines",!1),f.alt(b,u[0],["auto"]),u.length===2&&f.alt("lineAlign",u[1],["start",o,"end"]);break;case"position":u=L.split(","),f.percent(b,u[0]),u.length===2&&f.alt("positionAlign",u[1],["start",o,"end","line-left","line-right","auto"]);break;case"size":f.percent(b,L);break;case"align":f.alt(b,L,["start",o,"end","left","right"])}},/:/,/\s/),m.region=f.get("region",null),m.vertical=f.get("vertical","");var E=f.get("line","auto");E==="auto"&&S.line===-1&&(E=-1),m.line=E,m.lineAlign=f.get("lineAlign","start"),m.snapToLines=f.get("snapToLines",!0),m.size=f.get("size",100),m.align=f.get("align",o);var D=f.get("position","auto");D==="auto"&&S.position===50&&(D=m.align==="start"||m.align==="left"?0:m.align==="end"||m.align==="right"?100:50),m.position=D}(R,k)}function T(R){return R.replace(/<br(?: \/)?>/gi,`
`)}var y=function(){function R(){this.state="INITIAL",this.buffer="",this.decoder=new i,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var k=R.prototype;return k.parse=function(g){var s=this;function d(){var E=s.buffer,D=0;for(E=T(E);D<E.length&&E[D]!=="\r"&&E[D]!==`
`;)++D;var b=E.substr(0,D);return E[D]==="\r"&&++D,E[D]===`
`&&++D,s.buffer=E.substr(D),b}g&&(s.buffer+=s.decoder.decode(g,{stream:!0}));try{var l="";if(s.state==="INITIAL"){if(!/\r\n|\n/.test(s.buffer))return this;var h=(l=d()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!h||!h[0])throw new Error("Malformed WebVTT signature.");s.state="HEADER"}for(var m=!1;s.buffer;){if(!/\r\n|\n/.test(s.buffer))return this;switch(m?m=!1:l=d(),s.state){case"HEADER":/:/.test(l)?_(l,function(E,D){},/:/):l||(s.state="ID");continue;case"NOTE":l||(s.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(l)){s.state="NOTE";break}if(!l)continue;if(s.cue=new n.default(0,0,""),s.state="CUE",l.indexOf("-->")===-1){s.cue.id=l;continue}case"CUE":if(!s.cue){s.state="BADCUE";continue}try{A(l,s.cue,s.regionList)}catch{s.cue=null,s.state="BADCUE";continue}s.state="CUETEXT";continue;case"CUETEXT":var f=l.indexOf("-->")!==-1;if(!l||f&&(m=!0)){s.oncue&&s.cue&&s.oncue(s.cue),s.cue=null,s.state="ID";continue}if(s.cue===null)continue;s.cue.text&&(s.cue.text+=`
`),s.cue.text+=l;continue;case"BADCUE":l||(s.state="ID")}}}catch{s.state==="CUETEXT"&&s.cue&&s.oncue&&s.oncue(s.cue),s.cue=null,s.state=s.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},k.flush=function(){var g=this;try{if((g.cue||g.state==="HEADER")&&(g.buffer+=`

`,g.parse()),g.state==="INITIAL"||g.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(s){g.onparsingerror&&g.onparsingerror(s)}return g.onflush&&g.onflush(),this},R}()},"./src/utils/webvtt-parser.ts":function(e,t,r){r.r(t),r.d(t,"generateCueId",function(){return T}),r.d(t,"parseWebVTT",function(){return y});var n=r("./src/polyfills/number.ts"),i=r("./src/utils/vttparser.ts"),a=r("./src/demux/id3.ts"),v=r("./src/utils/timescale-conversion.ts"),_=r("./src/remux/mp4-remuxer.ts"),S=/\r\n|\n\r|\n|\r/g,o=function(R,k,g){return g===void 0&&(g=0),R.substr(g,k.length)===k},A=function(R){for(var k=5381,g=R.length;g;)k=33*k^R.charCodeAt(--g);return(k>>>0).toString()};function T(R,k,g){return A(R.toString())+A(k.toString())+A(g)}function y(R,k,g,s,d,l,h,m){var f,E=new i.VTTParser,D=Object(a.utf8ArrayToStr)(new Uint8Array(R)).trim().replace(S,`
`).split(`
`),b=[],L=Object(v.toMpegTsClockFromTimescale)(k,g),u="00:00.000",c=0,p=0,C=!0,I=!1;E.oncue=function(w){var O=s[d],x=s.ccOffset,P=(c-L)/9e4;if(O!=null&&O.new&&(p!==void 0?x=s.ccOffset=O.start:function(G,K,q){var Z=G[K],ee=G[Z.prevCC];if(!ee||!ee.new&&Z.new)return G.ccOffset=G.presentationOffset=Z.start,void(Z.new=!1);for(;(se=ee)!==null&&se!==void 0&&se.new;){var se;G.ccOffset+=Z.start-ee.start,Z.new=!1,ee=G[(Z=ee).prevCC]}G.presentationOffset=q}(s,d,P)),P&&(x=P-s.presentationOffset),I){var F=w.endTime-w.startTime,M=Object(_.normalizePts)(9e4*(w.startTime+x-p),9e4*l)/9e4;w.startTime=M,w.endTime=M+F}var U=w.text.trim();w.text=decodeURIComponent(encodeURIComponent(U)),w.id||(w.id=T(w.startTime,w.endTime,U)),w.endTime>0&&b.push(w)},E.onparsingerror=function(w){f=w},E.onflush=function(){f?m(f):h(b)},D.forEach(function(w){if(C){if(o(w,"X-TIMESTAMP-MAP=")){C=!1,I=!0,w.substr(16).split(",").forEach(function(O){o(O,"LOCAL:")?u=O.substr(6):o(O,"MPEGTS:")&&(c=parseInt(O.substr(7)))});try{p=function(O){var x=parseInt(O.substr(-3)),P=parseInt(O.substr(-6,2)),F=parseInt(O.substr(-9,2)),M=O.length>9?parseInt(O.substr(0,O.indexOf(":"))):0;if(!(Object(n.isFiniteNumber)(x)&&Object(n.isFiniteNumber)(P)&&Object(n.isFiniteNumber)(F)&&Object(n.isFiniteNumber)(M)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+O);return x+=1e3*P,(x+=6e4*F)+36e5*M}(u)/1e3}catch(O){I=!1,f=O}return}w===""&&(C=!1)}E.parse(w+`
`)}),E.flush()}},"./src/utils/xhr-loader.ts":function(e,t,r){r.r(t);var n=r("./src/utils/logger.ts"),i=r("./src/loader/load-stats.ts"),a=/^age:\s*[\d.]+\s*$/m,v=function(){function _(o){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=o?o.xhrSetup:null,this.stats=new i.LoadStats,this.retryDelay=0}var S=_.prototype;return S.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},S.abortInternal=function(){var o=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),o&&(o.onreadystatechange=null,o.onprogress=null,o.readyState!==4&&(this.stats.aborted=!0,o.abort()))},S.abort=function(){var o;this.abortInternal(),(o=this.callbacks)!==null&&o!==void 0&&o.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},S.load=function(o,A,T){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=o,this.config=A,this.callbacks=T,this.retryDelay=A.retryDelay,this.loadInternal()},S.loadInternal=function(){var o=this.config,A=this.context;if(o){var T=this.loader=new self.XMLHttpRequest,y=this.stats;y.loading.first=0,y.loaded=0;var R=this.xhrSetup;try{if(R)try{R(T,A.url)}catch{T.open("GET",A.url,!0),R(T,A.url)}T.readyState||T.open("GET",A.url,!0)}catch(k){return void this.callbacks.onError({code:T.status,text:k.message},A,T)}A.rangeEnd&&T.setRequestHeader("Range","bytes="+A.rangeStart+"-"+(A.rangeEnd-1)),T.onreadystatechange=this.readystatechange.bind(this),T.onprogress=this.loadprogress.bind(this),T.responseType=A.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),o.timeout),T.send()}},S.readystatechange=function(){var o=this.context,A=this.loader,T=this.stats;if(o&&A){var y=A.readyState,R=this.config;if(!T.aborted&&y>=2)if(self.clearTimeout(this.requestTimeout),T.loading.first===0&&(T.loading.first=Math.max(self.performance.now(),T.loading.start)),y===4){A.onreadystatechange=null,A.onprogress=null;var k=A.status;if(k>=200&&k<300){var g,s;if(T.loading.end=Math.max(self.performance.now(),T.loading.first),s=o.responseType==="arraybuffer"?(g=A.response).byteLength:(g=A.responseText).length,T.loaded=T.total=s,!this.callbacks)return;var d=this.callbacks.onProgress;if(d&&d(T,o,g,A),!this.callbacks)return;var l={url:A.responseURL,data:g};this.callbacks.onSuccess(l,T,o,A)}else T.retry>=R.maxRetry||k>=400&&k<499?(n.logger.error(k+" while loading "+o.url),this.callbacks.onError({code:k,text:A.statusText},o,A)):(n.logger.warn(k+" while loading "+o.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,R.maxRetryDelay),T.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),R.timeout)}},S.loadtimeout=function(){n.logger.warn("timeout while loading "+this.context.url);var o=this.callbacks;o&&(this.abortInternal(),o.onTimeout(this.stats,this.context,this.loader))},S.loadprogress=function(o){var A=this.stats;A.loaded=o.loaded,o.lengthComputable&&(A.total=o.total)},S.getCacheAge=function(){var o=null;if(this.loader&&a.test(this.loader.getAllResponseHeaders())){var A=this.loader.getResponseHeader("age");o=A?parseFloat(A):null}return o},_}();t.default=v}}).default);var ri=ru(Rs.exports);const iu={name:"d-icon"},Ye=Object.assign(iu,{props:{icon:String,size:[Number,String]},setup:function(e){const t=e,r=yt(()=>({fontSize:/^\d+$/.test(t.size)?t.size+"px":t.size}));return(n,i)=>(fe(),pe("i",{class:nt(["d-icon iconfont",e.icon]),style:it(J(r))},null,6))}});Ye.__scopeId="data-v-0c690e66";Nt("data-v-4cb76d59");const nu={class:"d-player-top"},su={class:"top-title"},au={class:"top-title"};Bt();const ou={props:{title:{default:""}},setup(e){Date.prototype.format=function(n){let i={"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds()};for(var a in i)new RegExp("("+a+")").test(n)&&(n=n.replace(RegExp.$1,RegExp.$1.length==1?i[a]:("00"+i[a]).substr((""+i[a]).length)));return n};let t=pt("00:00:00");t.value=new Date().format("hh:mm:ss");let r=null;return r=setInterval(()=>{t.value=new Date().format("hh:mm:ss")},1e3),mr(()=>{clearInterval(r)}),(n,i)=>(fe(),pe("div",nu,[W("p",su,Le(e.title||""),1),W("p",au,Le(J(t)),1)]))},__scopeId:"data-v-4cb76d59"};Nt("data-v-ac2469ec");const lu={class:"d-status"},uu={class:"d-flex-center"},cu={class:"d-flex-center"},du=Pe("5X速播放中 ");Bt();var Cs=$t({props:["state"],setup:e=>(t,r)=>De((fe(),pe("div",lu,[De(W("li",uu,[de(Ye,{size:"18",class:"d-status-icon",icon:"icon-volume-"+(e.state.volume==0?"mute":e.state.volume>.5?"up":"down")},null,8,["icon"]),Pe(" "+Le(~~(100*e.state.volume))+"% ",1)],512),[[je,e.state.handleType=="volume"]]),De(W("li",cu,[de(Ye,{size:"12",icon:"icon-play"}),de(Ye,{size:"12",icon:"icon-play",style:{"margin-right":"5px"}}),du],512),[[je,e.state.handleType=="playbackRate"||e.state.isMultiplesPlay]])],512)),[[je,e.state.handleType||e.state.isMultiplesPlay]])});Cs.__scopeId="data-v-ac2469ec",Nt("data-v-385f7870");const fu=["checked","true-value","false-value"],hu=W("span",{class:"d-switch_action"},null,-1);Bt();var Cr=$t({props:{modelValue:{type:[Number,String,Boolean]},width:{type:String,default:"40px"},trueValue:{type:[Number,String,Boolean],default:!0},falseValue:{type:[Number,String,Boolean],default:!0},activeColor:{type:[String],default:"#409EFF"}},emits:["update:modelValue","change"],setup(e,{emit:t}){const r=e;Ki(v=>({"014e5dc0":e.width,e4e32852:e.activeColor}));const n=pt(null),i=yt(()=>r.modelValue===r.trueValue),a=()=>{Fi(()=>{const v=n.value.checked;t("update:modelValue",v),t("change",v)})};return(v,_)=>(fe(),pe("div",{class:nt(["d-switch",{"is-checked":J(i)}])},[W("input",{class:"d-switch__input",ref:n,type:"checkbox",checked:J(i),onChange:a,"true-value":e.trueValue,"false-value":e.falseValue},null,40,fu),hu],2))}});Cr.__scopeId="data-v-385f7870",Nt("data-v-b2384226");const gu={key:0},pu=W("i",{class:"rotating iconfont icon-loading f50"},null,-1),vu=[W("i",{class:"rotating iconfont icon-loading f50"},null,-1),W("p",null,"正在缓冲...",-1)],mu=[W("i",{class:"iconfont icon-replay f24 mr5"},null,-1),Pe("重新播放 ")],yu=[W("i",{class:"iconfont icon-replay f24 mr5"},null,-1),Pe("请求错误 ")];Bt();var Is=$t({props:{loadType:String,text:{type:String,default:""}},setup(e){const t=e,{proxy:r}=Yr(),n=["loadstart","waiting","ended","error","stalled"],i=()=>{r.$parent.play()},a=yt(()=>{let v="background: rgba(0, 0, 0, .1);z-index:1";return t.loadType=="loadstart"&&(v="background: rgba(0, 0, 0, 1);;z-index:3"),v});return(v,_)=>De((fe(),pe("div",{class:"d-loading",style:it(J(a))},[W("div",null,[e.loadType=="loadstart"?(fe(),pe("span",gu,[pu,W("p",null,Le(e.text),1)])):Ce("",!0),De(W("span",null,vu,512),[[je,e.loadType=="waiting"]]),De(W("span",null,[W("p",{onClick:i,class:"d-flex-x d-pointer"},mu)],512),[[je,e.loadType=="ended"]]),De(W("span",null,[W("p",{onClick:i,class:"d-flex-x d-pointer"},yu)],512),[[je,e.loadType=="error"||e.loadType=="stalled"]])])],4)),[[je,n.includes(e.loadType)]])}});Is.__scopeId="data-v-b2384226";const xt=function(e,t,r,n=!1){e&&t&&r&&e.addEventListener(t,r,n)},Ue=function(e,t,r,n=!1){e&&t&&r&&e.removeEventListener(t,r,n)};Nt("data-v-5a794390");const Eu=["onMousedown"];Bt();var Wt=$t(bi(Ti({},{name:"DSlider"}),{props:{modelValue:{required:!0,type:Number,default:0},disabled:{type:Boolean,default:!1},vertical:{type:Boolean,default:!1},hover:{type:Boolean,default:!0},hoverText:{type:String,default:""},preload:{type:Number,default:0},size:{type:String,default:"10px"}},emits:["update:modelValue","change","onMousemove"],setup:function(e,{emit:t}){const r=e;Ki(s=>({"5242b67b":e.size}));const n=pt(null),i=pt(null),a=Ft({dragging:!1,hoverPosition:0,hoverTipsLeft:"50%"}),v=yt(()=>{let s=r.modelValue<0?0:r.modelValue>1?1:r.modelValue;return r.vertical?`height:${100*s}%`:`width:${100*s}%`}),_=yt(()=>{let s=r.preload<0?0:r.preload>1?1:r.preload;return r.vertical?`height:${100*s}%`:`width:${100*s}%`}),S=yt(()=>{let s=a.hoverPosition<0?0:a.hoverPosition>1?1:a.hoverPosition;return r.vertical?`bottom:${100*s}%`:`left:${100*s}%`}),o=s=>{s.preventDefault()},A=s=>{r.disabled||(s.preventDefault(),a.dragging=!0,y(s),xt(window,"mousemove",k),xt(window,"touchmove",k),xt(window,"mouseup",g),xt(window,"touchend",g))},T=s=>{if(!r.hover)return;let d=R(s);if(t("onMousemove",s,d),a.hoverPosition=d,r.vertical)return;let l=n.value,h=i.value.clientWidth/2,m=s.clientX-l.getBoundingClientRect().left;m<h?a.hoverTipsLeft=h-m+"px":l.clientWidth-m<h?a.hoverTipsLeft=l.clientWidth-m-h+"px":a.hoverTipsLeft="50%"},y=s=>{let d=R(s);t("update:modelValue",d),t("change",s,d)},R=s=>{let d=n.value,l=0;if(r.vertical){let h=d.clientHeight;l=(d.getBoundingClientRect().bottom-s.clientY)/h}else l=(s.clientX-d.getBoundingClientRect().left)/d.clientWidth;return l<0?0:l>1?1:l},k=s=>{y(s)},g=s=>{a.dragging&&(Ue(window,"mousemove",k),Ue(window,"touchmove",k),Ue(window,"mouseup",g),Ue(window,"touchend",g),Ue(window,"contextmenu",g),setTimeout(()=>{a.dragging=!1},0))};return(s,d)=>(fe(),pe("div",{ref:n,class:nt(["d-slider",{"is-vertical":r.vertical}]),onMousedown:ll(A,["stop"]),onContextmenu:o},[W("div",{class:"d-slider__runway",onMousemove:T},[De(W("div",{class:"d-slider__cursor",style:it(J(S))},[De(W("div",{class:"d-slider__tips",ref:i,style:it({left:J(a).hoverTipsLeft})},Le(r.hoverText),5),[[je,r.hoverText]])],4),[[je,r.hover]]),W("div",{class:"d-slider__preload",style:it(J(_))},null,4),W("div",{class:"d-slider__bar",style:it(J(v))},null,4)],32)],42,Eu))}}));Wt.__scopeId="data-v-5a794390";Nt("data-v-570fa0d1");const Tu={key:0,class:"d-player-dialog"},bu={class:"d-player-dialog-body"},Su={class:"d-player-dialog-title"},Lu={class:"d-player-hotkey-panel"},_u={class:"d-player-filter-panel"},Au={class:"d-player-filter-panel-item"},Du=W("span",null,"饱和度",-1),ku={class:"d-player-filter-panel-item"},Ru=W("span",null,"亮度",-1),Cu={class:"d-player-filter-panel-item"},Iu=W("span",null,"对比度",-1),wu={key:0,class:"d-player-contextmenu"},xu=["dplayerKeyCode"],Ou=W("input",{class:"d-player-copyText"},null,-1);Bt();var ws=$t({setup(e){const t=Ft({show:!1,dialogType:"",dialogTitle:"",version:"1.3.1-beta.6",mouseX:0,mouseY:0}),r=[{label:"视频色彩调整",key:"filter"},{label:"快捷键说明",key:"hotkey"},{label:"复制视频网址",key:"copy"},{label:"版本：1.3.1-beta.6",key:"version"}],n=[{key:"Space",label:"播放/暂停"},{key:"→",label:"单次快进10s，长按5倍速播放"},{key:"←",label:"快退5s"},{key:"↑",label:"音量增加10%"},{key:"↓",label:"音量增加降低10%"},{key:"Esc",label:"退出全屏/退出网页全屏"},{key:"F",label:"全屏/退出全屏"}],i=Ft({saturate:.392,brightness:.392,contrast:.392}),a=yt(()=>({left:t.mouseX+"px",top:t.mouseY+"px"}));rr(i,A=>{let T=document.querySelector("#dPlayerVideo"),y=(2.55*A.saturate).toFixed(2),R=(2.55*A.brightness).toFixed(2),k=(2.55*A.contrast).toFixed(2);T.style.filter=`saturate(${y}) brightness(${R}) contrast(${k})`});const v=()=>{i.saturate=.392,i.brightness=.392,i.contrast=.392},_=A=>{A.key=="Escape"&&o(0)},S=A=>{A.preventDefault(),xt(window,"keydown",_),xt(window,"click",o);let T=document.querySelector("#refPlayerWrap"),y=T.clientWidth;T.clientHeight,t.mouseX=A.clientX-T.getBoundingClientRect().left,y-t.mouseX<130&&(t.mouseX=t.mouseX+(y-t.mouseX-130)),t.mouseY=A.clientY-T.getBoundingClientRect().top,t.show=!0},o=A=>{let T=A.path[0].tagName=="LI",y=A.path[0].attributes.dplayerKeyCode&&A.path[0].attributes.dplayerKeyCode.value,R=r.map(k=>k.key);if(T&&R.includes(y))if(t.dialogTitle=A.path[0].innerText,t.dialogType=y,y=="copy"){let k=document.querySelector(".d-player-copyText");k.value=window.location.href,k.select(),document.execCommand("copy"),t.dialogType=""}else y=="version"&&(t.dialogType="");t.show=!1,Ue(window,"keydown",_),Ue(window,"click",o)};return vr(()=>{let A=document.querySelector("#refPlayerWrap");Ue(window,"keydown",_),Ue(window,"click",o),Ue(A,"contextmenu",S),xt(A,"contextmenu",S)}),mr(()=>{let A=document.querySelector("#refPlayerWrap");Ue(window,"keydown",_),Ue(window,"click",o),Ue(A,"contextmenu",S)}),(A,T)=>(fe(),pe("div",null,[de(gr,{name:"d-fade-in"},{default:Or(()=>[J(t).dialogType?(fe(),pe("div",Tu,[W("div",bu,[W("h5",Su,[Pe(Le(J(t).dialogTitle)+" ",1),W("i",{onClick:T[0]||(T[0]=y=>J(t).dialogType=!1),class:"icon icon-close"},"X")]),De(W("ul",Lu,[(fe(),pe(xe,null,dr(n,y=>W("li",{class:"d-player-hotkey-panel-item",key:y.key},[W("span",null,Le(y.key),1),W("span",null,Le(y.label),1)])),64))],512),[[je,J(t).dialogType=="hotkey"]]),De(W("ul",_u,[W("li",Au,[Du,de(Wt,{class:"filter-panel-slider",size:"5px",modelValue:J(i).saturate,"onUpdate:modelValue":T[1]||(T[1]=y=>J(i).saturate=y)},null,8,["modelValue"]),W("span",null,Le(Math.round(255*J(i).saturate)),1)]),W("li",ku,[Ru,de(Wt,{class:"filter-panel-slider",size:"5px",modelValue:J(i).brightness,"onUpdate:modelValue":T[2]||(T[2]=y=>J(i).brightness=y)},null,8,["modelValue"]),W("span",null,Le(Math.round(255*J(i).brightness)),1)]),W("li",Cu,[Iu,de(Wt,{class:"filter-panel-slider",size:"5px",modelValue:J(i).contrast,"onUpdate:modelValue":T[3]||(T[3]=y=>J(i).contrast=y)},null,8,["modelValue"]),W("span",null,Le(Math.round(255*J(i).contrast)),1)]),W("span",{onClick:v,title:"重置","aria-label":"重置",class:"d-player-filter-reset"},"重置")],512),[[je,J(t).dialogType=="filter"]])])])):Ce("",!0)]),_:1}),J(t).show?(fe(),pe("div",wu,[W("ul",{class:"d-player-contextmenu-body",style:it(J(a))},[(fe(),pe(xe,null,dr(r,y=>W("li",{dplayerKeyCode:y.key,key:y.key},Le(y.label),9,xu)),64))],4),Ou])):Ce("",!0)]))}});ws.__scopeId="data-v-570fa0d1";const ii=e=>{let t=~~(e/3600),r=~~(e%3600/60),n=~~(e%60);return t=t<10?"0"+t:t,r=r<10?"0"+r:r,n=n<10?"0"+n:n,`${t}:${r}:${n}`},er="ontouchstart"in window,Cn=["loadstart","play","pause","playing","seeking","seeked","waiting","durationchange","progress","canplay","timeupdate","ended","error","stalled"],Pu={width:{type:String,default:"800px"},height:{type:String,default:"450px"},color:{type:String,default:"#409eff"},src:{required:!0,type:String,default:""},title:{type:String,default:""},type:{type:String,default:"video/mp4"},poster:{type:String,default:""},webFullScreen:{type:Boolean,default:!1},speed:{type:Boolean,default:!0},currentTime:{type:Number,default:0},playsinline:{type:Boolean,default:!1},muted:{type:Boolean,default:!1},speedRate:{type:Array,default:()=>["2.0","1.5","1.25","1.0","0.75","0.5"]},autoPlay:{type:Boolean,default:!1},loop:{type:Boolean,default:!1},mirror:{type:Boolean,default:!1},ligthOff:{type:Boolean,default:!1},volume:{type:[String,Number],default:.3},control:{type:Boolean,default:!0},controlBtns:{type:Array,default:["audioTrack","quality","speedRate","volume","setting","pip","pageFullScreen","fullScreen"]},preload:{type:String,default:"auto"}};Nt("data-v-01791e9e");const Fu={class:"d-player-video",id:"dPlayerVideo"},Mu=["controls","webkit-playsinline","playsinline","volume","muted","loop","preload","src","poster"],Nu={class:"d-player-lightoff"},Bu={key:1,class:"d-player-state"},Uu={class:"d-play-btn"},Gu=["onKeyup","onKeydown"],ju={class:"d-control-progress"},Ku={class:"d-tool-bar"},Hu={key:0,class:"d-tool-item d-tool-time audioTrack-btn"},Vu=W("span",{style:{margin:"0 3px"}},"/",-1),Wu={class:"total-time"},qu={class:"d-tool-bar"},Yu={key:0,class:"d-tool-item quality-btn"},zu={class:"d-tool-item-main"},Xu={class:"speed-main",style:{"text-align":"center"}},$u=["onClick"],Qu={key:1,class:"d-tool-item speedRate-btn"},Ju={class:"d-tool-item-main"},Zu={class:"speed-main"},ec=["onClick"],tc={key:2,class:"d-tool-item volume-btn"},rc={class:"d-tool-item-main volume-box",style:{width:"52px"}},ic={class:"volume-text-size"},nc={key:3,class:"d-tool-item setting-btn"},sc={class:"d-tool-item-main"},ac={class:"speed-main"},oc=Pe(" 镜像画面 "),lc=Pe(" 循环播放 "),uc=Pe(" 关灯模式 "),cc=W("div",{class:"d-tool-item-main"},"画中画",-1),dc=W("div",{class:"d-tool-item-main"},"网页全屏",-1),fc=W("div",{class:"d-tool-item-main"},"全屏",-1);Bt();var pr=$t(bi(Ti({},{name:"vue3VideoPlay",inheritAttrs:!1}),{props:Pu,emits:[...Cn,"mirrorChange","loopChange","lightOffChange"],setup:function(e,{expose:t,emit:r}){const n=e;Ki(x=>({"51d4439c":J(R),"77e758a6":x.width,b8a1afc0:x.height}));const i=new ri({fragLoadingTimeOut:2e3}),a=pt(null),v=pt(null),_=pt(null),S=pt(null),o=Ft(bi(Ti({dVideo:null},n),{muted:n.muted,playBtnState:n.autoPlay?"pause":"play",loadStateType:"loadstart",fullScreen:!1,handleType:"",currentTime:"00:00:00",preloadBar:0,totalTime:"00:00:00",isVideoHovering:!0,speedActive:"1.0",playProgress:0,isMultiplesPlay:!1,longPressTimeout:null,progressCursorTime:"00:00:00",qualityLevels:[],currentLevel:0})),A=(...x)=>P=>x.reverse().reduce((F,M)=>M(F),P),T=Cn.reduce((x,P)=>{var F;return x[`on${F=P,F.charAt(0).toUpperCase()+F.slice(1)}`]=M=>{o.loadStateType=P,r(P,M)},x},{});T.onCanplay=A(T.onCanplay,()=>{o.playBtnState!="play"&&o.dVideo.play(),o.autoPlay&&(o.dVideo.play(),o.playBtnState="pause")}),T.onEnded=A(T.onEnded,()=>{o.playBtnState="replay"}),T.onDurationchange=x=>{r("durationchange",x),n.currentTime!=0&&(o.dVideo.currentTime=n.currentTime),T.onTimeupdate(x)},T.onProgress=x=>{console.log("缓冲中..."),r("progress",x);let P=x.target.duration,F=x.target.buffered,M=x.target.buffered.length&&x.target.buffered.end(F-1);o.preloadBar=M/P},T.onTimeupdate=x=>{r("timeupdate",x);let P=x.duration||x.target.duration||0,F=x.currentTime||x.target.currentTime;o.playProgress=F/P,o.currentTime=ii(F),o.totalTime=ii(P)},T.onError=A(T.onError,()=>{o.playBtnState="replay"});let y=xo();for(let x in y)T[x]=y[x];const R=(k=o.color,`${parseInt("0x"+k.slice(1,3))},${parseInt("0x"+k.slice(3,5))},${parseInt("0x"+k.slice(5,7))}`);var k;const g=Rn(500,()=>{o.handleType=""}),s=x=>{x.preventDefault(),x.code=="ArrowUp"?o.volume=o.volume+.1>1?1:o.volume+.1:o.volume=o.volume-.1<0?0:o.volume-.1,o.muted=!1,o.handleType="volume",g()},d=x=>{n.speed&&(o.dVideo.currentTime=o.dVideo.currentTime<10?.1:o.dVideo.currentTime-10,T.onTimeupdate(o.dVideo),m())},l=x=>{x.preventDefault();let P=x.type;if(x.key=="ArrowRight"){if(m(),P=="keyup"){if(clearTimeout(o.longPressTimeout),!n.speed&&!o.longPressTimeout)return;o.isMultiplesPlay?(o.dVideo.playbackRate=o.speedActive,o.isMultiplesPlay=!1):(o.dVideo.currentTime=o.dVideo.currentTime+10,T.onTimeupdate(o.dVideo))}else if(P=="keydown"){if(!n.speed)return;o.isMultiplesPlay&&clearTimeout(o.longPressTimeout),o.longPressTimeout=setTimeout(()=>{o.isMultiplesPlay=!0,o.dVideo.playbackRate=5,o.handleType="playbackRate",g()},500)}}},h=()=>{er||S.value.focus()},m=()=>{o.loadStateType="play",o.dVideo.play().catch(()=>{setTimeout(()=>{o.playBtnState="replay",o.loadStateType="error"},500)}),o.playBtnState="pause"},f=()=>{o.dVideo.pause(),o.playBtnState="play"},E=x=>{x&&x.preventDefault(),o.playBtnState=="play"||o.playBtnState=="replay"?m():o.playBtnState=="pause"&&f()},D=()=>{o.muted=!o.muted,o.volume==0&&(o.volume=.05)},b=(x,P)=>{let F=o.dVideo.duration||o.dVideo.target.duration;o.dVideo.currentTime=F*P,o.playBtnState=="play"&&(o.dVideo.play(),o.playBtnState="pause")},L=(x,P)=>{o.progressCursorTime=ii(o.dVideo.duration*P)},u=Rn(2500,()=>{o.isVideoHovering=!1}),c=x=>{o.isVideoHovering=!0,u()},p=x=>{r("mirrorChange",x,o.dVideo)},C=x=>{r("loopChange",x,o.dVideo)},I=x=>{r("lightOffChange",x,o.dVideo)},w=()=>{var x;x=o.dVideo,document.pictureInPictureElement?document.exitPictureInPicture().catch(P=>{console.log(P,"Video failed to leave Picture-in-Picture mode.")}):x.requestPictureInPicture().catch(P=>{console.log(P,"Video failed to enter Picture-in-Picture mode.")})},O=()=>{o.fullScreen=(x=>{let P=document,F=P.webkitIsFullScreen||P.fullscreen;return F?(document.exitFullscreen||P.webkitExitFullScreen).call(P):(x.requestFullscreen||x.webkitRequestFullScreen).call(x),!F})(a.value)};return rr(()=>n.src,()=>{Fi(()=>{o.dVideo.canPlayType(n.type)||o.dVideo.canPlayType("application/vnd.apple.mpegurl")?o.muted=n.autoPlay:ri.isSupported()&&(i.detachMedia(),i.attachMedia(o.dVideo),i.on(ri.Events.MEDIA_ATTACHED,()=>{i.loadSource(n.src),i.on("hlsManifestParsed",(x,P)=>{console.log(P),o.currentLevel=P.level,o.qualityLevels=P.levels||[]})}),i.on("hlsLevelSwitching",(x,P)=>{console.log(P),console.log("LEVEL_SWITCHING")}),i.on("hlsLevelSwitched",(x,P)=>{o.currentLevel=P.level,console.log("LEVEL_SWITCHED")}))})},{immediate:!0}),vr(()=>{o.dVideo=v,h()}),t({play:m,pause:f,togglePlay:E}),(x,P)=>(fe(),pe("div",{ref:a,id:"refPlayerWrap",class:nt(["d-player-wrap",{"web-full-screen":J(o).webFullScreen,"is-lightoff":J(o).lightOff,"d-player-wrap-hover":J(o).playBtnState=="play"||J(o).isVideoHovering}]),onMousemove:c},[W("div",Fu,[W("video",ji({ref:v,class:["d-player-video-main",{"video-mirror":J(o).mirror}],id:"dPlayerVideoMain",controls:!(!J(er)||!J(o).speed),"webkit-playsinline":n.playsinline,playsinline:n.playsinline},J(T),{volume:J(o).volume,muted:J(o).muted,loop:J(o).loop,preload:x.preload,width:"100%",height:"100%",src:n.src,poster:n.poster}),"您的浏览器不支持Video标签。",16,Mu)]),de(gr,{name:"d-fade-in"},{default:Or(()=>[De(W("div",Nu,null,512),[[je,J(o).lightOff]])]),_:1}),J(o).fullScreen?(fe(),bs(ou,{key:0,title:n.title},null,8,["title"])):Ce("",!0),J(er)?Ce("",!0):(fe(),pe("div",Bu,[de(gr,{name:"d-scale-out"},{default:Or(()=>[De(W("div",Uu,[de(Ye,{icon:"icon-play",size:40})],512),[[je,J(o).playBtnState=="play"]])]),_:1}),de(Cs,{state:J(o)},null,8,["state"])])),J(er)?Ce("",!0):(fe(),pe("input",{key:2,type:"input",readonly:"readonly",ref:S,onDblclick:O,onKeyup:[Jt(O,["f"]),P[0]||(P[0]=Jt(F=>J(o).webFullScreen=!1,["esc"])),l],onClick:E,onKeydown:[Jt(E,["space"]),Jt(d,["arrow-left"]),Jt(s,["arrow-up","arrow-down"]),l],class:"d-player-input",maxlength:"0"},null,40,Gu)),de(Is,{loadType:J(o).loadStateType},null,8,["loadType"]),de(ws),!J(er)&&J(o).control?(fe(),pe("div",{key:3,class:"d-player-control",ref:_},[W("div",ju,[de(Wt,{class:"d-progress-bar",onOnMousemove:L,onChange:b,disabled:!J(o).speed,hoverText:J(o).progressCursorTime,modelValue:J(o).playProgress,"onUpdate:modelValue":P[1]||(P[1]=F=>J(o).playProgress=F),preload:J(o).preloadBar},null,8,["disabled","hoverText","modelValue","preload"])]),W("div",{class:"d-control-tool",onClick:h},[W("div",Ku,[W("div",{class:"d-tool-item",onClick:E},[de(Ye,{size:"24",icon:`icon-${J(o).playBtnState}`},null,8,["icon"])]),n.controlBtns.includes("audioTrack")?(fe(),pe("div",Hu,[W("span",null,Le(J(o).currentTime),1),Vu,W("span",Wu,Le(J(o).totalTime),1)])):Ce("",!0)]),W("div",qu,[J(o).qualityLevels.length&&n.controlBtns.includes("quality")?(fe(),pe("div",Yu,[Pe(Le(J(o).qualityLevels.length&&(J(o).qualityLevels[J(o).currentLevel]||{}).height)+"P ",1),W("div",zu,[W("ul",Xu,[(fe(!0),pe(xe,null,dr(J(o).qualityLevels,(F,M)=>(fe(),pe("li",{class:nt({"speed-active":J(o).currentLevel==M}),onClick:U=>((G,K)=>{i.currentLevel=K,o.currentLevel=K})(0,M),key:F},Le(F.height)+"P",11,$u))),128))])])])):Ce("",!0),n.controlBtns.includes("speedRate")?(fe(),pe("div",Qu,[Pe(Le(J(o).speedActive=="1.0"?"倍速":J(o).speedActive+"x")+" ",1),W("div",Ju,[W("ul",Zu,[(fe(!0),pe(xe,null,dr(J(o).speedRate,F=>(fe(),pe("li",{class:nt({"speed-active":J(o).speedActive==F}),onClick:M=>(U=>{o.speedActive=U,o.dVideo.playbackRate=U})(F),key:F},Le(F)+"x",11,ec))),128))])])])):Ce("",!0),n.controlBtns.includes("volume")?(fe(),pe("div",tc,[W("div",rc,[W("div",{class:nt(["volume-main",{"is-muted":J(o).muted}])},[W("span",ic,Le(J(o).muted?0:~~(100*J(o).volume))+"%",1),de(Wt,{onChange:P[2]||(P[2]=F=>J(o).muted=!1),hover:!1,size:"5px",vertical:!0,modelValue:J(o).volume,"onUpdate:modelValue":P[3]||(P[3]=F=>J(o).volume=F)},null,8,["modelValue"])],2)]),W("span",{onClick:D,style:{display:"flex"}},[de(Ye,{size:"20",icon:"icon-volume-"+(J(o).volume==0||J(o).muted?"mute":J(o).volume>.5?"up":"down")},null,8,["icon"])])])):Ce("",!0),n.controlBtns.includes("setting")?(fe(),pe("div",nc,[de(Ye,{size:"20",class:"rotateHover",icon:"icon-settings"}),W("div",sc,[W("ul",ac,[W("li",null,[oc,de(Cr,{onChange:p,modelValue:J(o).mirror,"onUpdate:modelValue":P[4]||(P[4]=F=>J(o).mirror=F)},null,8,["modelValue"])]),W("li",null,[lc,de(Cr,{onChange:C,modelValue:J(o).loop,"onUpdate:modelValue":P[5]||(P[5]=F=>J(o).loop=F)},null,8,["modelValue"])]),W("li",null,[uc,de(Cr,{onChange:I,modelValue:J(o).lightOff,"onUpdate:modelValue":P[6]||(P[6]=F=>J(o).lightOff=F)},null,8,["modelValue"])])])])])):Ce("",!0),n.controlBtns.includes("pip")?(fe(),pe("div",{key:4,class:"d-tool-item pip-btn",onClick:w},[de(Ye,{size:"20",icon:"icon-pip"}),cc])):Ce("",!0),n.controlBtns.includes("pageFullScreen")?(fe(),pe("div",{key:5,class:"d-tool-item pip-btn",onClick:P[7]||(P[7]=F=>J(o).webFullScreen=!J(o).webFullScreen)},[de(Ye,{size:"20",icon:"icon-web-screen"}),dc])):Ce("",!0),n.controlBtns.includes("fullScreen")?(fe(),pe("div",{key:6,class:"d-tool-item fullScreen-btn",onClick:O},[fc,de(Ye,{size:"20",icon:"icon-screen"})])):Ce("",!0)])])],512)):Ce("",!0)],34))}}));function hc(e){e.component(pr.name,pr)}pr.__scopeId="data-v-01791e9e",pr.install=hc;const xs=fl($l);xs.use(pr);xs.mount("#app");
